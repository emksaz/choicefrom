(function(c){c.fn.extend({InitUpload:function(a){var b=!1,d={iscrop:!1,autoRemoveCompleted:!0,maxSize:2097152,tokenURL:"/UploadRoot/UploadFile.aspx?action\x3dgettoken",frmUploadURL:"/UploadRoot/upload.php?action\x3dfd;",uploadURL:"/UploadRoot/UploadFile.aspx?action\x3dupext",extFilters:[".jpg",".gif",".png",".jpeg",".bmp"],onSelect:function(a){b?alert(Prompt.UploadPrompt):b=!0},onMaxSizeExceed:function(a,d,f){alert(Prompt.QSNRD_FileExceedCeiling);b=!1},onComplete:function(f){c.ajax({type:"POST",url:"/Upload/CropBitmap",data:{fileName:f.token,uplaodPath:d.parentfolder,companyID:d.CompanyID,uType:d.UType,quesID:d.QuesID},dataType:"json",success:function(b){b.IsSuccess&&a.complete instanceof Function&&a.complete({name:f.name,url:b.FileUrl,size:f.size,serverName:b.FileName})},error:function(b){RestLoginForDesign(b)}});b=!1},onUploadProgress:function(b){a.progress instanceof Function&&a.progress(b)},onCancelAll:function(){b=!1}},f;f="\x3cdiv class\x3d'panelext'\x3e\x3cdiv class\x3d'closebtnext'\x3e";f+="\x3cdiv onclick\x3d'$(\"this\").CloseUpload()'\x3e\x3c/div\x3e";f+="\x3c/div\x3e";f+="\x3cdiv\x3e";f+="\x3cdiv class\x3d'uploadpaneel'\x3e";f+="\x3cdiv id\x3d'i_select_files'\x3e";f+="\x3c/div\x3e";f+="\x3cdiv id\x3d'i_stream_files_queue'\x3e";f+="\x3c/div\x3e";f+="\x3cbutton class\x3d'custombtn' onclick\x3d'javascript:_t.upload();'\x3e\u5f00\u59cb\u4e0a\u4f20\x3c/button\x3e\x3cbutton onclick\x3d'javascript:_t.cancel();' class\x3d'custombtn'\x3e\u53d6\u6d88\x3c/button\x3e";f+="\x3cdiv id\x3d'i_stream_message_container' class\x3d'stream-main-upload-box none' style\x3d'overflow: auto;height:200px;'\x3e";f+="\x3c/div\x3e";f+="\x3c/div\x3e";f+="\x3c/div\x3e";f+="\x3c/div\x3e";c(".panelext").remove();c("#uploadDiv").append(f);d=c.extend(d,a);return new Stream(d)}})})(jQuery);(function(){var c=window.ZYDesign=window.ZYDesign||{};c.Class=function(){return{inheritPrototype:function(a,b){var d=function(){};d.prototype=a.prototype;b.prototype=new d;b.prototype.constructor=b;b.base=a.prototype}}}();c.Enum=function(){var a={NODESTATE:{}};a.NODESTATE.FREE="FREE";a.NODESTATE.NORMAL="NORMAL";a.NODESTATE.RANDOM="RANDOM";a.NODESTATE.LOOP="LOOP";a.NODESTATE.FREEWITHTOOL="FREEWITHTOOL";a.NODETYPE={};a.NODETYPE.START="START";a.NODETYPE.END="END";a.NODETYPE.CHECK="CHECK";a.NODETYPE.COMMENT="COMMENT";a.NODETYPE.SUBJECT="SUBJECT";a.NODETYPE.SELECT="SELECT";a.NODETYPE.MARK="MARK";a.NODETYPE.SEQUENCE="SEQUENCE";a.NODETYPE.FILL="FILL";a.NODETYPE.MATRIX="MATRIX";a.NODETYPE.SELECTPIC="SELECTPIC";a.NODETYPE.TOOL="TOOL";a.NODETYPE.LOGIC="LOGIC";a.NODETYPE.RANDOM="RANDOM";a.NODETYPE.LOOP="LOOP";a.NODETYPE.REGION="REGION";a.NODETYPE.GENDER="GENDER";a.NODETYPE.AGEGROUP="AGEGROUP";a.NODETYPE.MARITALSTATUS="MARITALSTATUS";a.NODETYPE.EDUSTATUS="EDUSTATUS";a.NODETYPE.OCCUPATION="OCCUPATION";a.NODETYPE.PROFESSION="PROFESSION";a.NODETYPE.JOBTITLE="JOBTITLE";a.NODETYPE.INCOME="INCOME";a.NODETYPE.FAMILYINCOME="FAMILYINCOME";a.NODECOMMONTYPE={};a.NODECOMMONTYPE.SUBJECT="SUBJECT";a.NODECOMMONTYPE.INFO="INFO";a.NODECOMMONTYPE.TOOL="TOOL";a.NODECOMMONTYPE.TERMINAL="TERMINAL";a.CONNTYPE={};a.CONNTYPE.INPUT="INPUT";a.CONNTYPE.OUTPUT="OUTPUT";a.CONNEXACTTYPE={};a.CONNEXACTTYPE.RANDOMSTART="RANDOMSTART";a.CONNEXACTTYPE.LOOPSTART="LOOPSTART";a.CONNEXACTTYPE.LOOPEND="LOOPEND";a.CONNEXACTTYPE.OPTION="OPTION";a.CONNEXACTTYPE.OUTPUTBASE="OUTPUTBASE";a.CONNEXACTTYPE.INPUTBASE="INPUTBASE";return a}();c.DesignManager=null;c.ErrorHanlder=function(){return{log:function(a){console.log(a)}}}();c.TextUtil=function(){function a(a,f,g){if("string"!==typeof f||a<=g)return{};g/=13;for(var h="",c=0,p=f.split(""),k=0;k<p.length;k++){var n=p[k],m=b[n.charCodeAt()];m||(m=b["default"]);c+=m*g;if(c>a)return{text:h,leftText:f.substring(h.length),more:!0};h+=n}return{text:f,leftText:"",more:!1}}var b=JSON.parse('{"32": 5.7, "33": 4.06, "34": 5.66, "35": 8.3, "36": 7.62, "37": 11.57, "38": 11.31, "39": 3.33, "40": 4.34, "41": 4.34, "42": 5.92, "43": 9.64, "44": 3.13, "45": 5.62, "46": 3.13, "47": 5.55, "48": 7.62, "49": 7.62, "50": 7.62, "51": 7.62, "52": 7.62, "53": 7.62, "54": 7.62, "55": 7.62, "56": 7.62, "57": 7.62, "58": 3.13, "59": 3.13, "60": 9.64, "61": 9.64, "62": 9.64, "63": 6.28, "64": 13.41, "65": 9.15, "66": 8.16, "67": 8.7, "68": 9.9, "69": 7.15, "70": 6.91, "71": 9.67, "72": 10.05, "73": 3.82, "74": 5.15, "75": 8.25, "76": 6.67, "77": 12.7, "78": 10.57, "79": 10.59, "80": 7.95, "81": 10.59, "82": 8.49, "83": 7.5, "84": 7.45, "85": 9.71, "86": 8.79, "87": 13.23, "88": 8.39, "89": 7.85, "90": 8.06, "91": 4.34, "92": 5.41, "93": 4.34, "94": 9.64, "95": 5.83, "96": 3.83, "97": 7.19, "98": 8.3, "99": 6.52, "100": 8.32, "101": 7.38, "102": 4.51, "103": 8.32, "104": 8, "105": 3.46, "106": 3.47, "107": 7.08, "108": 3.46, "109": 12.18, "110": 8.01, "111": 8.26, "112": 8.3, "113": 8.32, "114": 4.96, "115": 6.02, "116": 4.84, "117": 8.01, "118": 6.82, "119": 10.26, "120": 6.59, "121": 6.88, "122": 6.39, "123": 4.34, "124": 3.5, "125": 4.34, "126": 9.64, "default": 13 }');return{getEllipsisByWidth:function(b,f,g){if(!("string"!==typeof f||b<=g))return b=a(b,f,g),b.more?b.text+"...":b.text},divideStringByWidth:function(b,f,g){if(!("string"!==typeof f||b<=g)){var h=[],c={text:"",leftText:"",more:!1};do c=a(b,f,g),h.push(c.text),c.more&&(f=c.leftText);while(c.more);return h}},isNumberInputKey:function(b){if(8==b||9==b||13==b||37==b||39==b||46==b||110==b||48<=b&&57>=b||96<=b&&105>=b)return!0}}}();c.UuidUtil=function(){var a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");return{generate:function(){for(var b=Array(36),d=0,f,g=0;36>g;g++)8==g||13==g||18==g||23==g?b[g]="-":14==g?b[g]="4":(2>=d&&(d=33554432+16777216*Math.random()|0),f=d&15,d>>=4,b[g]=a[19==g?f&3|8:f]);return b.join("")}}}();c.ColorUtil=function(){var a=/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/;return{rgbToHex:function(b){if(/^(rgb|RGB)/.test(b)){for(var d=b.replace(/(?:\(|\)|rgb|RGB)*/g,"").split(","),f="#",g=0;g<d.length;g++){var h=Number(d[g]).toString(16);"0"===h&&(h+=h);f+=h}7!==f.length&&(f=b);return f}if(a.test(b)){d=b.replace(/#/,"").split("");if(6===d.length)return b;if(3===d.length){b="#";for(g=0;g<d.length;g+=1)b+=d[g]+d[g];return b}}else return b},hexToRgb:function(b){if((b=b.toLowerCase())&&a.test(b)){if(4===b.length){for(var d="#",f=1;4>f;f+=1)d+=b.slice(f,f+1).concat(b.slice(f,f+1));b=d}d=[];for(f=1;7>f;f+=2)d.push(parseInt("0x"+b.slice(f,f+2)));return"RGB("+d.join(",")+")"}return b},hexToRgba:function(b,d){d||(d=1);var f=b.toLowerCase();if(f&&a.test(f)){if(4===f.length){for(var g="#",h=1;4>h;h+=1)g+=f.slice(h,h+1).concat(f.slice(h,h+1));f=g}g=[];for(h=1;7>h;h+=2)g.push(parseInt("0x"+f.slice(h,h+2)));return"RGBA("+g.join(",")+","+d+")"}return f},rgbaToRgb:function(b,a,f,g,h,c,p){b=Math.round((1-g)*h+g*b);a=Math.round((1-g)*c+g*a);f=Math.round((1-g)*p+g*f);return"rgb("+b+","+a+","+f+")"}}}();c.Dict=function(){function a(){return{list:[{text:"\u5b57\u6570",id:1},{text:"\u6574\u6570",id:2},{text:"\u5c0f\u6570",id:3},{text:"\u65e5\u671f",id:4},{text:"\u90ae\u4ef6\u5730\u5740",id:5},{text:"\u624b\u673a\u53f7\u7801",id:6}],getItemById:function(b){for(var a=0;a<this.list.length;a++){var f=this.list[a];if(f.id==b)return f}}}}return function(){var b={fillLimitTypeDict:[{id:1,text:"\u6570\u5b57"},{id:2,text:"\u6587\u672c"},{id:3,text:"\u65e5\u671f"}],decimalDigitsDict:[{id:1,value:0},{id:2,value:1},{id:3,value:2},{id:4,value:3}],selectTypeLimitDict:[{id:1,text:"\u5355\u9009"},{id:2,text:"\u884c\u5355\u9009"},{id:3,text:"\u5217\u5355\u9009"},{id:4,text:"\u884c\u5217\u5355\u9009"},{id:5,text:"\u591a\u9009"}],provinceDict:[{text:"\u4e0a\u6d77",id:0},{text:"\u6c5f\u82cf",id:1},{text:"\u6d59\u6c5f",id:2}],cityDict:[{pid:0,text:"\u4e0a\u6d77",id:0},{pid:1,text:"\u5357\u4eac",id:1},{pid:1,text:"\u82cf\u5dde",id:2},{pid:2,text:"\u676d\u5dde",id:3},{pid:2,text:"\u6e29\u5dde",id:4}],countyDict:[{pid:0,text:"\u5f90\u6c47\u533a",id:0},{pid:0,text:"\u9ec4\u6d66\u533a",id:1},{pid:1,text:"\u7384\u6b66\u533a",id:2},{pid:1,text:"\u6c5f\u5b81\u533a",id:3},{pid:2,text:"\u59d1\u82cf\u533a",id:4},{pid:2,text:"\u6606\u5c71\u5e02",id:5},{pid:3,text:"\u897f\u6e56\u533a",id:6},{pid:3,text:"\u8427\u5c71\u5e02",id:7},{pid:4,text:"\u745e\u5b89\u5e02",id:8},{pid:4,text:"\u82cd\u5357\u53bf",id:9}],getCityInProvice:function(b){for(var a=[],g=0;g<this.cityDict.length;g++){var h=this.cityDict[g];h.pid==b&&a.push(h)}return a},getCountyInCity:function(b){for(var a=[],g=0;g<this.countyDict.length;g++){var h=this.countyDict[g];h.pid==b&&a.push(h)}return a},genderDict:[{text:"\u5168\u90e8",id:0},{text:"\u7537",id:1},{text:"\u5973",id:2},{text:"\u5176\u4ed6",id:3}],ageGroupDict:[{text:"10",id:0},{text:"20",id:1},{text:"30",id:2},{text:"40",id:3}],maritalStatusDict:[{text:"\u672a\u5a5a",id:0},{text:"\u5df2\u5a5a",id:1},{text:"\u79bb\u5a5a",id:2},{text:"\u4e27\u5076",id:3}],eduStatusDict:[{text:"\u79c0\u624d",id:0},{text:"\u4e3e\u4eba",id:1},{text:"\u8d21\u58eb",id:2},{text:"\u8fdb\u58eb",id:3}],occupationDict:[{text:"IT\u6c11\u5de5",id:0},{text:"\u7801\u519c",id:1},{text:"\u7a0b\u5e8f\u733f",id:2},{text:"\u7a0b\u5e8f\u5a9b",id:3}],professionDict:[{text:"\u8ba1\u7b97\u673a",id:0},{text:"\u6cd5\u5f8b",id:1},{text:"\u9ed1\u793e\u4f1a",id:2},{text:"\u4e10\u5e2e",id:3}],jobTitleDict:[{text:"\u5e2e\u4e3b",id:0},{text:"\u957f\u8001",id:1},{text:"\u5802\u4e3b",id:2},{text:"\u55bd\u5570",id:3}],incomeDict:[{text:"1000",id:0},{text:"2000",id:1},{text:"3000",id:2},{text:"50000",id:3}],requireMethodDict:[{text:"AND",id:0},{text:"OR",id:1}],requireLimitDict:[{text:"\u4ecb\u4e8e",id:0},{text:"\u4e0d\u4ecb\u4e8e",id:1},{text:"\u7b49\u4e8e",id:2},{text:"\u4e0d\u7b49\u4e8e",id:3},{text:"\u5927\u4e8e",id:4},{text:"\u5c0f\u4e8e",id:5},{text:"\u5c0f\u4e8e\u7b49\u4e8e",id:6},{text:"\u5927\u4e8e\u7b49\u4e8e",id:7},{text:"\u5217\u4e3e",id:8}]};b.ValidateTypeDict=a();b.getItemByIdInDict=function(b,a){for(var g=0;g<a.length;g++){var h=a[g];if(h.id==b)return h}return null};b.getProvinceById=function(b){return this.getItemByIdInDict(b,this.provinceDict)};b.getCityById=function(b){return this.getItemByIdInDict(b,this.cityDict)};b.getCountyById=function(b){return this.getItemByIdInDict(b,this.countyDict)};b.getGenderById=function(b){return this.getItemByIdInDict(b,this.genderDict)};b.getAgeGroupById=function(b){return this.getItemByIdInDict(b,this.ageGroupDict)};b.getMaritalStatusById=function(b){return this.getItemByIdInDict(b,this.maritalStatusDict)};b.getEduStatusById=function(b){return this.getItemByIdInDict(b,this.eduStatusDict)};b.getOccupationById=function(b){return this.getItemByIdInDict(b,this.occupationDict)};b.getProfessionById=function(b){return this.getItemByIdInDict(b,this.professionDict)};b.getJobTitleById=function(b){return this.getItemByIdInDict(b,this.jobTitleDict)};b.getIncomeById=function(b){return this.getItemByIdInDict(b,this.incomeDict)};b.getMatrixLimitById=function(b){return this.getItemByIdInDict(b,this.selectTypeLimitDict)};return b}()}();c.Initial={regionNodeJson:{isInit:!0,x:260,y:164,input:{text:"\u8f93\u5165"},output:{text:"\u5168\u90e8\u8f93\u51fa\u6216\u5176\u4ed6"},options:[{extField_1:0,extField_2:0,extField_3:0},{extField_1:1,extField_2:1,extField_3:2}]},genderNodeJson:{isInit:!0,x:260,y:204,input:{text:"\u8f93\u5165"},output:{text:"\u5168\u90e8\u8f93\u51fa\u6216\u5176\u4ed6"},options:[{extField_1:0,extField_2:0,extField_3:0},{extField_1:1,extField_2:1,extField_3:2}]},ageGroupNodeJson:{isInit:!0,x:260,y:244,input:{text:"\u8f93\u5165"},output:{text:"\u5168\u90e8\u8f93\u51fa\u6216\u5176\u4ed6"},options:[{extField_1:0,extField_2:0,extField_3:0},{extField_1:1,extField_2:1,extField_3:2}]},maritalStatusNodeJson:{isInit:!0,x:260,y:284,input:{text:"\u8f93\u5165"},output:{text:"\u5168\u90e8\u8f93\u51fa\u6216\u5176\u4ed6"},options:[{extField_1:0,extField_2:0,extField_3:0},{extField_1:1,extField_2:1,extField_3:2}]},eduStatusNodeJson:{isInit:!0,x:260,y:324,input:{text:"\u8f93\u5165"},output:{text:"\u5168\u90e8\u8f93\u51fa\u6216\u5176\u4ed6"},options:[{extField_1:0,extField_2:0,extField_3:0},{extField_1:1,extField_2:1,extField_3:2}]},occupationNodeJson:{isInit:!0,x:260,y:364,input:{text:"\u8f93\u5165"},output:{text:"\u5168\u90e8\u8f93\u51fa\u6216\u5176\u4ed6"},options:[{extField_1:0,extField_2:0,extField_3:0},{extField_1:1,extField_2:1,extField_3:2}]},professionNodeJson:{isInit:!0,x:260,y:404,input:{text:"\u8f93\u5165"},output:{text:"\u5168\u90e8\u8f93\u51fa\u6216\u5176\u4ed6"},options:[{extField_1:0,extField_2:0,extField_3:0},{extField_1:1,extField_2:1,extField_3:2}]},jobTitleNodeJson:{isInit:!0,x:260,y:444,input:{text:"\u8f93\u5165"},output:{text:"\u5168\u90e8\u8f93\u51fa\u6216\u5176\u4ed6"},options:[{extField_1:0,extField_2:0,extField_3:0},{extField_1:1,extField_2:1,extField_3:2}]},incomeNodeJson:{isInit:!0,x:260,y:484,input:{text:"\u8f93\u5165"},output:{text:"\u5168\u90e8\u8f93\u51fa\u6216\u5176\u4ed6"},options:[{extField_1:0,extField_2:0,extField_3:0},{extField_1:1,extField_2:1,extField_3:2}]},familyIncomeNodeJson:{isInit:!0,x:260,y:524,input:{text:"\u8f93\u5165"},output:{text:"\u5168\u90e8\u8f93\u51fa\u6216\u5176\u4ed6"},options:[{extField_1:0,extField_2:0,extField_3:0},{extField_1:1,extField_2:1,extField_3:2}]},startNodeJson:{isInit:!0,x:260,y:16},checkNodeJson:{isInit:!0,x:260,y:100},endNodeJson:{isInit:!0,x:260,y:402,questionText:"\u8c22\u8c22\u60a8\u7684\u53c2\u4e0e\uff01"},commentNodeJson:{isInit:!0,x:260,y:468,commentText:""},selectNodeJson:{isInit:!0,x:260,y:16,input:{text:"\u8f93\u5165"},output:{text:"\u5168\u90e8\u8f93\u51fa\u6216\u5176\u4ed6"},options:[{text:""},{text:""},{text:""},{text:""},{text:""}]},selectPicNodeJson:{isInit:!0,x:260,y:106,input:{text:"\u8f93\u5165"},output:{text:"\u5168\u90e8\u8f93\u51fa\u6216\u5176\u4ed6"},options:[{text:""},{text:""},{text:""},{text:""},{text:""}]},markingNodeJson:{isInit:!0,x:260,y:58,input:{text:"\u8f93\u5165"},output:{text:"\u5168\u90e8\u8f93\u51fa\u6216\u5176\u4ed6"},options:[{text:""},{text:""},{text:""},{text:""},{text:""}]},sequencingNodeJson:{isInit:!0,x:260,y:100,input:{text:"\u8f93\u5165"},output:{text:"\u5168\u90e8\u8f93\u51fa\u6216\u5176\u4ed6"},options:[{text:"",isTarget:!1,index:0},{text:"",isTarget:!1,index:1},{text:"",isTarget:!1,index:2},{text:"",isTarget:!1,index:3},{text:"",isTarget:!1,index:4}]},fillblankNodeJson:{isInit:!0,x:260,y:142,extField_10:"\u8f93\u5165\u683c\u5f0f\u65e0\u6548\uff01",input:{text:"\u8f93\u5165"},output:{text:"\u8f93\u51fa"},options:[{number:1,text:""}]},matrixNodeJson:{isInit:!0,x:260,y:184,input:{text:"\u8f93\u5165"},output:{text:"\u5168\u90e8\u8f93\u51fa\u6216\u5176\u4ed6"},optionsY:[{text:""},{text:""},{text:""},{text:""},{text:""}],optionsX:[{text:""},{text:""},{text:""},{text:""},{text:""}]},logicNodeJson:{isInit:!0,x:260,y:294,input:{text:"\u8f93\u5165"},output:{text:"\u5176\u4ed6"},logics:[{text:"\u903b\u8f911",index:0,requires:[]}]},loopNodeJson:{isInit:!0,x:260,y:250,input:{text:"\u8f93\u5165"},output:{text:"\u5176\u4ed6"},loopStart:{text:"\u5faa\u73af\u5f00\u59cb"},loopEnd:{text:"\u5faa\u73af\u7ed3\u675f"}},randomNodeJson:{isInit:!0,x:260,y:336,input:{text:"\u8f93\u5165"},output:{text:"\u5176\u4ed6"},randomStart:{text:"\u968f\u673a\u5f00\u59cb"}}};c.Environment=function(){function a(a){return a.test(b)}var b=navigator.userAgent.toLowerCase(),d=a(/windows|win32/),f=a(/macintosh|mac os x/),g="CSS1Compat"==document.compatMode,h=a(/opera/)||a(/opr/),c=a(/chrome/),p=a(/webkit/),k=!c&&a(/safari/),n=k&&a(/version3/),m=k&&a(/version4/),q=!h&&a(/msie/),t=q&&a(/msie 7/),u=q&&a(/msie 8/),r=!p&&a(/gecko/),w=r&&a(/rv:1.9/),v=q&&!g,d=a(/windows|win32/),f=a(/macintosh|mac os x/),s=a(/adobeair/),y=a(/linux/);return{isWindows:d,isMac:f,isStrict:g,isOpera:h,isChrome:c,isWebkit:p,isSafari:k,isSafari3:n,isSafari4:m,isIE:q,isIE7:t,isIE8:u,isGecko:r,isGecko3:w,isBorderBox:v,isAir:s,isLinux:y}}();c.HotKey={Zoomout:189,Zoomin:187,Undo:90,Redo:89,Save:83,Release:80,SelectAll:65,Help:112,ToggleNodePanel:113,Test:121,ShowAll:122,ShowDefault:122,Preview:-113,Copy:67,Paste:86,Dulplicate:68,Clip:88,Break:66,Delete:46,DeleteMac:8};c.Hinter=function(){function a(f){clearTimeout(a.run);b=b||$("#system_hinter");d=d||b.parent();b&&(b.remove(),b.text(f),d.append(b),console.log("hinted message:"+f),a.run=setTimeout(function(){b.remove()},5E3))}var b=null,d=null;return{hint:a}}();c.ContextMenu={optionbatch:{text:"\u6279\u91cf\u8f93\u5165",hotKey:"",operation:"OPTIONBATCH",enable:!0,line:!0},copy:{text:"\u590d\u5236",hotKey:"CTRL + C",operation:"COPY",enable:!0},paste:{text:"\u7c98\u8d34",hotKey:"CTRL + V",operation:"PASTE",enable:!0},duplicate:{text:"\u5373\u65f6\u590d\u5236",hotKey:"CTRL + D",operation:"DUPLICATE",enable:!0},clip:{text:"\u526a\u5207",hotKey:"CTRL + X",operation:"CLIP",enable:!0},del:{text:"\u5220\u9664",hotKey:"DEL",operation:"DELETE",enable:!0},bre:{text:"\u65ad\u5f00\u8fde\u7ebf",hotKey:"CTRL + B",operation:"BREAK",enable:!0}};c.HelpMessage={selectNode:{text:"\x3ch5 class\x3d'TipsTile'\x3e\u9009\u62e9\u9898\u8282\u70b9\x3c/h5\x3e\x3cp class\x3d'TipsTitle2'\x3e \u9009\u62e9\u9898\u7531\u9898\u76ee\u5185\u5bb9\u548c\u9009\u9879\u4e24\u90e8\u5206\u6784\u6210\u3002\x3c/br\x3e         \u9898\u76ee\u5185\u5bb9\u5c31\u662f\u7528\u9648\u8ff0\u53e5\u6216\u7591\u95ee\u53e5\u63cf\u8ff0\u51fa\u95ee\u9898\u7684\u60c5\u666f\u548c\u60f3\u83b7\u5f97\u5f97\u7b54\u6848\u3002\x3c/br\x3e         \u9009\u9879\u662f\u6307\u4e0e\u9898\u76ee\u5185\u5bb9\u6709\u76f4\u63a5\u5173\u8054\u7684\u5907\u9009\u7b54\u6848\u3002\x3c/br\x3e   \u201c\u5176\u4ed6\u201d\u9009\u9879\u6709\u52a9\u4e8e\u83b7\u5f97\u8fdb\u4e00\u6b65\u7684\u4fe1\u606f\uff0c\u7279\u522b\u662f\u5f53\u9009\u9879\u65e0\u6cd5\u8986\u76d6\u6240\u6709\u53ef\u80fd\u7684\u60c5\u51b5\u65f6\u3002\x3c/br\x3e\x3c/p\x3e\x3ch5  class\x3d'TipsTile'\x3e\u53c2\u8003\u793a\u610f\u56fe\x3c/h5\x3e\x3cdiv\x3e\x3cimg src\x3d'/Images/TipsPics/tips_select.jpg'\x3e\x3c/div\x3e\x3ch5 class\x3d'TipsTile'\x3e\u5176\u4ed6\u4fe1\u606f:\x3c/h5\x3e\x3cul class\x3d'TipsTitle2'\x3e\x3cli\x3e\u901a\u7528\u8bbe\u7f6e\u4e2d\u53ef\u8bbe\u5b9a\u672c\u9898\u662f\u5426\u5fc5\u7b54\u3002\x3c/li\x3e\x3cli\x3e\u901a\u7528\u8bbe\u7f6e\u4e2d\u53ef\u8bbe\u5b9a\u591a\u9009\u9898\u548c\u9009\u9879\u968f\u673a\u3002\x3c/li\x3e\x3cli\x3e\u53ef\u4e3a\u9009\u62e9\u9898\u6dfb\u52a0\u201c\u5176\u4ed6\u201d\u9009\u9879\u3002\x3c/li\x3e\x3cli\x3e\u53ef\u4e3a\u9009\u62e9\u9898\u8282\u70b9\u8bbe\u5b9a\u9898\u76ee\u7684\u56fe\u7247\u3002\x3c/li\x3e\x3cli\x3e\u9009\u9879\u524d\u7684\u5b57\u6bcd\u4e3a\u952e\u76d8\u5feb\u6377\u952e\uff0c\u5728\u4f7f\u7528\u952e\u76d8\u65f6\u76f4\u63a5\u6309\u5b57\u6bcd\u952e\u5b8c\u6210\u9009\u62e9\u3002\x3c/li\x3e\x3c/ul\x3e"},markingNode:{text:"\x3ch5 class\x3d'TipsTile'\x3e\u6253\u5206\u9898\u8282\u70b9\x3c/h5\x3e\x3cp class\x3d'TipsTitle2'\x3e\u6253\u5206\u9898\u53ef\u8bbe\u5b9a\u4e3a2\u79cd\u4e0d\u540c\u72b6\u6001\uff0c\u5206\u522b\u4e3a\uff1a\x3c/p\x3e\x3cul class\x3d'TipsTitle2'\x3e\x3cli\x3e\u5206\u503c\u8bc4\u4ef7\x3c/li\x3e\x3cli\x3e\u56fe\u5f62\u8bc4\u4ef7\x3c/li\x3e\x3c/ul\x3e\x3cp class\x3d'TipsTitle2'\x3e\u5206\u503c\u8bc4\u4ef7\uff1a\x3c/br\x3e\u5bf9\u95ee\u9898\u9009\u9879\u8fdb\u884c\u6570\u503c\u6253\u5206\u3002\u5728\u95ee\u5377\u4e2d\uff0c\u4ee5\u5206\u503c\u6ed1\u52a8\u6761\u5f62\u5f0f\u663e\u793a\uff0c\u6ed1\u52a8\u6539\u53d8\u5206\u503c\u3002\x3c/br\x3e\u53ef\u8bbe\u7f6e\u5206\u503c\u7684\u6700\u4f4e\u5206\u4e0e\u6700\u9ad8\u5206\uff0c\u5e76\u53ef\u8bbe\u5b9a\u662f\u5426\u663e\u793a\u5206\u503c\u3002\x3c/br\x3e\x3cdiv\x3e\x3cimg src\x3d'/Images/TipsPics/tips_range2.jpg'\x3e\x3c/div\x3e\x3c/p\x3e\x3cp class\x3d'TipsTitle2'\x3e\u56fe\u5f62\u8bc4\u4ef7\uff1a\x3c/br\x3e\u5bf9\u95ee\u9898\u9009\u9879\u4ee5\u56fe\u5f62\u7684\u5f62\u5f0f\u6253\u5206\u3002\u5728\u95ee\u5377\u4e2d\uff0c\u56fe\u5f62\u6570\u91cf\u7684\u591a\u5c11\u4ee3\u8868\u8fd9\u4e0d\u540c\u7684\u6570\u503c\u4e0e\u542b\u4e49\u3002\x3c/br\x3e\u7cfb\u7edf\u5185\u7f6e\u4e86\u591a\u79cd\u6253\u5206\u56fe\u5f62\u4f9b\u60a8\u9009\u62e9\uff0c\u5e76\u53ef\u8bbe\u5b9a\u56fe\u5f62\u7684\u6570\u91cf\u3002\x3c/br\x3e\x3cdiv\x3e\x3cimg src\x3d'/Images/TipsPics/tips_range1.jpg'\x3e\x3c/div\x3e\x3c/p\x3e\x3ch5 class\x3d'TipsTile'\x3e\u5176\u4ed6\u4fe1\u606f:\x3c/h5\x3e\x3cul class\x3d'TipsTitle2'\x3e\x3cli\x3e\u901a\u7528\u8bbe\u7f6e\u4e2d\u53ef\u8bbe\u5b9a\u672c\u9898\u662f\u5426\u5fc5\u7b54\u3002\x3c/li\x3e\x3cli\x3e\u901a\u7528\u8bbe\u7f6e\u4e2d\u53ef\u9009\u9879\u968f\u673a\u3002\x3c/li\x3e\x3cli\x3e\u53ef\u4e3a\u9009\u62e9\u9898\u8282\u70b9\u8bbe\u5b9a\u9898\u76ee\u7684\u56fe\u7247\u3002\x3c/li\x3e\x3c/ul\x3e"},fillblankNode:{text:"\x3ch5 class\x3d'TipsTile'\x3e\u586b\u7a7a\u9898\u8282\u70b9\x3c/h5\x3e\x3cp class\x3d'TipsTitle2'\x3e\u586b\u7a7a\u9898\u7531\u95ee\u9898\u63cf\u8ff0\u548c\u586b\u7a7a\u9009\u9879\u6784\u6210\u3002\x3c/br\x3e\u95ee\u5377\u8bbe\u8ba1\u8fc7\u7a0b\u4e2d\uff0c\u9009\u9879\u4e2d\u8bbe\u5b9a\u7684\u6587\u5b57\u6700\u7ec8\u4f1a\u4ee5\u63d0\u793a\u4fe1\u606f\u7684\u5f62\u5f0f\u5728\u6700\u7ec8\u95ee\u5377\u4e2d\u5448\u73b0\uff0c\u63d0\u793a\u53d7\u8bbf\u8005\u8f93\u5165\u6b63\u786e\u7684\u5185\u5bb9\u3002\x3c/br\x3e\u53ef\u5bf9\u5141\u8bb8\u8f93\u5165\u7684\u6587\u5b57\u5185\u5bb9\u8fdb\u884c\u9a8c\u8bc1\uff0c\u4f8b\u5982\u8f93\u5165\u5185\u5bb9\u5fc5\u987b\u4e3a\u6587\u5b57\u3001\u90ae\u7bb1\u5730\u5740\u7b49\u3002\x3c/br\x3e\x3c/p\x3e\x3ch5 class\x3d'TipsTile'\x3e\u53c2\u8003\u793a\u610f\u56fe\x3c/h5\x3e\x3cdiv\x3e\x3cimg src\x3d'/Images/TipsPics/tips_input.jpg'\x3e\x3c/div\x3e\x3ch5 class\x3d'TipsTile'\x3e\u5176\u4ed6\u4fe1\u606f:\x3c/h5\x3e\x3cul class\x3d'TipsTitle2'\x3e\x3cli\x3e\u901a\u7528\u8bbe\u7f6e\u4e2d\u53ef\u8bbe\u5b9a\u672c\u9898\u662f\u5426\u5fc5\u7b54\u3002\x3c/li\x3e\x3cli\x3e\u901a\u7528\u8bbe\u7f6e\u4e2d\u53ef\u5bf9\u8f93\u5165\u7684\u6587\u5b57\u5185\u5bb9\u8fdb\u884c\u9a8c\u8bc1\u3002\x3c/li\x3e\x3cli\x3e\u53ef\u4e3a\u586b\u7a7a\u9898\u8282\u70b9\u8bbe\u5b9a\u9898\u76ee\u7684\u56fe\u7247\u3002\x3c/li\x3e\x3c/ul\x3e"},sequencingNode:{text:""},matrixNode:{text:""},selectPicNode:{text:"\x3ch5 class\x3d'TipsTile'\x3e\u56fe\u7247\u9898\u8282\u70b9\x3c/h5\x3e\x3cp class\x3d'TipsTitle2'\x3e\u56fe\u7247\u9898\u5c06\u56fe\u7247\u548c\u4ecb\u7ecd\u6587\u5b57\u7531\u4ee5\u5361\u7247\u5f62\u5f0f\u5448\u73b0\uff0c\u53d7\u8bbf\u8005\u70b9\u51fb\u5bf9\u5e94\u56fe\u7247\u5361\u7247\u4ee3\u8868\u9009\u62e9\u8be5\u56fe\u7247\u9009\u9879\u3002\x3c/br\x3e\u5e03\u5c40\u6837\u5f0f\u548c\u56fe\u7247\u6837\u5f0f\u63a7\u5236\u4e86\u56fe\u7247\u5728\u95ee\u5377\u4e0a\u7684\u5916\u89c2\u3002\x3c/br\x3e\u5e03\u5c40\u6837\u5f0f\uff1a\x3c/br\x3e\x3cul class\x3d'TipsTitle2'\x3e\x3cli\x3e\u5355\u884c\x3c/li\x3e\x3cli\x3e\u7011\u5e03\u6d41\x3c/li\x3e\x3c/br\x3e\x3cimg src\x3d'/Images/TipsPics/tips_tpt.png'\x3e\x3c/br\x3e\x3c/br\x3e\x3cli\x3e\u7f51\u683c\x3c/li\x3e\x3c/ul\x3e\x3c/p\x3e\x3ch5  class\x3d'TipsTile'\x3e\u5176\u4ed6\u4fe1\u606f:\x3c/h5\x3e\x3cul class\x3d'TipsTitle2'\x3e\x3cli\x3e\u901a\u7528\u8bbe\u7f6e\u4e2d\u53ef\u8bbe\u5b9a\u672c\u9898\u662f\u5426\u5fc5\u7b54\u3002\x3c/li\x3e\x3cli\x3e\u901a\u7528\u8bbe\u7f6e\u4e2d\u53ef\u8bbe\u5b9a\u591a\u9009\u9898\u548c\u9009\u9879\u968f\u673a\u3002\x3c/li\x3e\x3cli\x3e\u53ef\u4e3a\u9009\u62e9\u9898\u8282\u70b9\u8bbe\u5b9a\u9898\u76ee\u7684\u56fe\u7247\u3002\x3c/li\x3e\x3cli\x3e\u9009\u9879\u524d\u7684\u5b57\u6bcd\u4e3a\u952e\u76d8\u5feb\u6377\u952e\uff0c\u5728\u4f7f\u7528\u952e\u76d8\u65f6\uff0c\u76f4\u63a5\u6309\u5b57\u6bcd\u952e\u5b8c\u6210\u9009\u62e9\u3002\x3c/li\x3e\x3c/ul\x3e"},vidioNode:{text:""},screenSelect:{text:"\x3ch5 class\x3d'TipsTile'\x3e\u7504\u522b\u9009\u62e9\u9898\u8282\u70b9\x3c/h5\x3e\x3cp class\x3d'TipsTitle2'\x3e\u7504\u522b\u9898\u578b\u53ef\u4ee5\u5728\u95ee\u5377\u5f00\u59cb\u524d\u5bf9\u53d7\u8bbf\u8005\u8fdb\u884c\u7b5b\u9009\uff0c\u6392\u9664\u6389\u4e0d\u5728\u8c03\u7814\u8303\u56f4\u5185\u7684\u5bf9\u8c61\uff0c\u8ba9\u95ee\u5377\u7684\u8c03\u67e5\u7ed3\u679c\u66f4\u771f\u5b9e\uff0c\u66f4\u51c6\u786e\u3002\x3c/br\x3e\x3ch5 class\x3d'TipsTile'\x3e\u4f7f\u7528\u7504\u522b\u9898\u578b\u65f6\u987b\u9075\u5faa\u5982\u4e0b\u89c4\u8303\uff1a\x3c/h5\x3e\x3cul class\x3d'TipsTitle2'\x3e\x3cli\x3e\u4e0d\u80fd\u5728\u666e\u901a\u9898\u578b\u95f4\u63d2\u5165\u7504\u522b\u9898\u578b\u3002\x3c/li\x3e\x3cli\x3e\u5f53\u95ee\u5377\u9700\u7504\u522b\u65f6\uff0c\u5fc5\u987b\u5728\u5f00\u59cb\u8282\u70b9\u540e\u8fde\u63a5\u7504\u522b\u9898\u578b\u3002\x3c/li\x3e\x3cli\x3e\u7504\u522b\u9898\u578b\u4e00\u65e6\u8fde\u63a5\u8f93\u51fa\u5230\u666e\u901a\u9898\u578b\uff0c\u5373\u89c6\u4e3a\u540e\u7eed\u5206\u652f\u4e0d\u9700\u8981\u518d\u8fdb\u4e00\u6b65\u7504\u522b\u3002\x3c/li\x3e\x3c/ul\x3e\x3c/br\x3e\x3c/p\x3e\x3cp class\x3d'TipsTitle2'\x3e\u7504\u522b\u9009\u62e9\u9898\u4e0e\u9009\u62e9\u9898\u76f8\u540c\uff0c\u7531\u9898\u76ee\u5185\u5bb9\u548c\u9009\u9879\u4e24\u90e8\u5206\u6784\u6210\u3002\x3c/br\x3e\u9898\u76ee\u5185\u5bb9\u5c31\u662f\u7528\u9648\u8ff0\u53e5\u6216\u7591\u95ee\u53e5\u63cf\u8ff0\u51fa\u95ee\u9898\u7684\u60c5\u666f\u548c\u60f3\u83b7\u5f97\u5f97\u7b54\u6848\u3002\x3c/br\x3e\u9009\u9879\u662f\u6307\u4e0e\u9898\u76ee\u5185\u5bb9\u6709\u76f4\u63a5\u5173\u8054\u7684\u5907\u9009\u7b54\u6848\u3002\x3c/br\x3e\u201c\u5176\u4ed6\u201d\u9009\u9879\u6709\u52a9\u4e8e\u83b7\u5f97\u8fdb\u4e00\u6b65\u7684\u4fe1\u606f\uff0c\u7279\u522b\u662f\u5f53\u9009\u9879\u65e0\u6cd5\u8986\u76d6\u6240\u6709\u53ef\u80fd\u7684\u60c5\u51b5\u65f6\u3002\x3c/br\x3e\x3c/p\x3e\x3ch5 class\x3d'TipsTile'\x3e\u53c2\u8003\u793a\u610f\u56fe\x3c/h5\x3e\x3cimg src\x3d'/Images/TipsPics/tips_select.jpg'\x3e\x3ch5 class\x3d'TipsTile'\x3e\u5176\u4ed6\u4fe1\u606f\uff1a\x3c/h5\x3e\x3cul class\x3d'TipsTitle2'\x3e\x3cli\x3e\u901a\u7528\u8bbe\u7f6e\u4e2d\u53ef\u8bbe\u5b9a\u672c\u9898\u662f\u5426\u5fc5\u7b54\u3002\x3c/li\x3e\x3cli\x3e\u901a\u7528\u8bbe\u7f6e\u4e2d\u53ef\u8bbe\u5b9a\u591a\u9009\u9898\u548c\u9009\u9879\u968f\u673a\u3002\x3c/li\x3e\x3cli\x3e\u53ef\u4e3a\u9009\u62e9\u9898\u8282\u70b9\u8bbe\u5b9a\u9898\u76ee\u7684\u56fe\u7247\u3002\x3c/li\x3e\x3cli\x3e\u9009\u9879\u524d\u7684\u5b57\u6bcd\u4e3a\u952e\u76d8\u5feb\u6377\u952e\uff0c\u5728\u4f7f\u7528\u952e\u76d8\u65f6\uff0c\u76f4\u63a5\u6309\u5b57\u6bcd\u952e\u5b8c\u6210\u9009\u62e9\u3002\x3c/li\x3e\x3c/ul\x3e"},randomNode:{text:"\x3ch5 class\x3d'TipsTile'\x3e\u968f\u673a\u8282\u70b9\x3c/h5\x3e\x3cp class\x3d'TipsTitle2'\x3e\u95ee\u5377\u4e2d\uff0c\u60a8\u5e0c\u671b\u67d0\u4e9b\u9898\u76ee\u4ee5\u968f\u673a\u7684\u5f62\u5f0f\u5448\u73b0\u5728\u95ee\u5377\u4e2d\uff0c\u968f\u673a\u8282\u70b9\u53ef\u5bf9\u60a8\u9700\u8981\u968f\u673a\u7684\u9898\u76ee\u8fdb\u884c\u968f\u673a\u5904\u7406\u3002\u56de\u7b54\u95ee\u5377\u65f6\uff0c\u4e0d\u540c\u53d7\u8bbf\u8005\u7684\u95ee\u5377\u4e2d\u8fd9\u90e8\u5206\u9898\u76ee\u51fa\u73b0\u7684\u6b21\u5e8f\u5b8c\u5168\u4e0d\u540c\u3002\x3c/p\x3e\x3ch5 class\x3d'TipsTile'\x3e\u53c2\u8003\u793a\u610f\u56fe\x3c/h5\x3e\x3cdiv\x3e\x3cimg src\x3d'/Images/TipsPics/tips_select.jpg'\x3e\x3c/div\x3e\x3ch5 class\x3d'TipsTile'\x3e\u5176\u4ed6\u4fe1\u606f:\x3c/h5\x3e\x3cul class\x3d'TipsTitle2'\x3e \x3cli\x3e\u901a\u7528\u8bbe\u7f6e\u4e2d\u53ef\u8bbe\u5b9a\u672c\u9898\u662f\u5426\u5fc5\u7b54\u3002\x3c/li\x3e \x3cli\x3e\u901a\u7528\u8bbe\u7f6e\u4e2d\u53ef\u8bbe\u5b9a\u591a\u9009\u9898\u548c\u9009\u9879\u968f\u673a\u3002\x3c/li\x3e \x3cli\x3e\u53ef\u4e3a\u9009\u62e9\u9898\u6dfb\u52a0\u201c\u5176\u4ed6\u201d\u9009\u9879\u3002\x3c/li\x3e \x3cli\x3e\u53ef\u4e3a\u9009\u62e9\u9898\u8282\u70b9\u8bbe\u5b9a\u9898\u76ee\u7684\u56fe\u7247\u3002\x3c/li\x3e \x3cli\x3e\u9009\u9879\u524d\u7684\u5b57\u6bcd\u4e3a\u952e\u76d8\u5feb\u6377\u952e\uff0c\u5728\u4f7f\u7528\u952e\u76d8\u65f6\uff0c\u76f4\u63a5\u6309\u5b57\u6bcd\u952e\u5b8c\u6210\u9009\u62e9\u3002\x3c/li\x3e\x3c/ul\x3e"},endNode:{text:"\x3ch5 class\x3d'TipsTile'\x3e\u7ed3\u675f\u8282\u70b9\x3c/h5\x3e\x3cp class\x3d'TipsTitle2'\x3e\u7ed3\u675f\u8282\u70b9\u662f\u4e00\u4efd\u95ee\u5377\u7684\u7ec8\u6b62\u8282\u70b9\uff0c\u7b49\u540c\u4e8e\u95ee\u5377\u7684\u5c01\u5e95\u3002\x3c/br\x3e\u5f53\u53d7\u8bbf\u8005\u5b8c\u6210\u95ee\u5377\u65f6\uff0c\u5c06\u770b\u5230\u7ed3\u675f\u63cf\u8ff0\u4e2d\u7684\u6587\u5b57\u3002\x3c/br\x3e\u4e00\u4efd\u95ee\u5377\u53ef\u4ee5\u6709\u591a\u4e2a\u7ed3\u675f\u8282\u70b9,\u5206\u522b\u5bf9\u5e94\u95ee\u5377\u4e0d\u540c\u7684\u7ed3\u675f\u60c5\u51b5\u3002\x3c/br\x3e\x3c/p\x3e\x3ch5 class\x3d'TipsTile'\x3e\u5176\u4ed6\u4fe1\u606f:\x3c/h5\x3e\x3cul class\x3d'TipsTitle2'\x3e\x3cli\x3e\u7ed3\u675f\u8282\u70b9\u4e2d\u8bbe\u7f6e\u7684\u56fe\u7247\u5373\u4e3a\u8be5\u95ee\u5377\u7684\u5c01\u5e95\u3002\x3c/li\x3e\x3cli\x3e\u95ee\u5377\u751f\u6210\u65f6\u7cfb\u7edf\u5c06\u751f\u6210\u4e00\u4e2a\u7ed3\u675f\u8282\u70b9\u3002\x3c/li\x3e\x3c/ul\x3e"},mediaNode:{text:"\x3ch5 class\x3d'TipsTile'\x3e\u6dfb\u52a0\u5a92\u4f53\x3c/h5\x3e\x3cp class\x3d'TipsTitle2'\x3e\u5728\u95ee\u5377\u9898\u76ee\u4e2d\u6dfb\u52a0\u56fe\u7247\u7b49\u5a92\u4f53\u4e30\u5bcc\u4e86\u95ee\u5377\u7684\u5f62\u5f0f\uff0c\u540c\u65f6\u6709\u52a9\u4e8e\u51c6\u786e\u5730\u8868\u8fbe\u95ee\u9898\u7684\u6838\u5fc3\u3002\x3c/br\x3e\u70b9\u51fb\x3cimg src\x3d'/Images/TipsPics/tips_midia_pic.jpg' style\x3d'margin-left: 10px;margin-right: 10px'\x3e \u4e0a\u4f20\u56fe\u7247\u6309\u94ae\u6dfb\u52a0\u56fe\u7247\u5a92\u4f53\u5230\u8d44\u6e90\u5e93\u3002\x3c/br\x3e\u6dfb\u52a0\u56fe\u7247\u5230\u5a92\u4f53\u5e93\u540e\uff0c\u9009\u62e9\u95ee\u5377\u4e2d\u9898\u76ee\u8282\u70b9\uff0c\u70b9\u9009\x3cimg src\x3d'/Images/TipsPics/tips_addmedia.jpg' style\x3d'margin-left: 10px;margin-right: 10px'\x3e \u6dfb\u52a0\u5a92\u4f53\u6309\u94ae\uff0c\u5373\u53ef\u5728\u4e0b\u62c9\u5217\u8868\u4e2d\u9009\u62e9\u5a92\u4f53\u5e93\u4e2d\u7684\u56fe\u7247\u3002\x3c/p\x3e\x3ch5 class\x3d'TipsTile'\x3e\u5176\u4ed6\u4fe1\u606f:\x3c/h5\x3e\x3cul class\x3d'TipsTitle2'\x3e\x3cli\x3e\u8fd8\u53ef\u4ee5\u9009\u62e9\u8282\u70b9\uff0c\u4e3a\u8be5\u8282\u70b9\u6dfb\u52a0\u5a92\u4f53\uff0c\u5728\u4e0b\u62c9\u5217\u8868\u4e2d\u70b9\u9009\u201c\u6dfb\u52a0\u56fe\u7247\u201d\u3002\x3c/li\x3e\x3c/ul\x3e"},otherOption:{text:"\x3ch5 class\x3d'TipsTile'\x3e\u201c\u5176\u4ed6\u201d\u9009\u9879\x3c/h5\x3e\x3cp class\x3d'TipsTitle2'\x3e\u201c\u5176\u4ed6\u201d\u9009\u9879\u6709\u52a9\u4e8e\u83b7\u5f97\u8fdb\u4e00\u6b65\u7684\u4fe1\u606f\uff0c\u7279\u522b\u662f\u5f53\u9009\u9879\u65e0\u6cd5\u8986\u76d6\u6240\u6709\u53ef\u80fd\u7684\u60c5\u51b5\u65f6\u3002\x3c/br\x3e\u53ef\u8bbe\u5b9a\u4e3a3\u79cd\u72b6\u6001,\u5206\u522b\u4e3a\u9009\u9879\u3001\u5907\u6ce8\u680f\u548c\u4e24\u8005\u3002\x3c/p\x3e\x3ch5 class\x3d'TipsTile'\x3e\u53c2\u8003\u793a\u610f\u56fe\x3c/h5\x3e\x3cul class\x3d'TipsTitle2'\x3e\x3cli\x3e\u9009\u9879:\x3c/li\x3e\x3cimg src\x3d'/Images/TipsPics/tips_select_option.jpg'\x3e\x3cli\x3e\u5907\u6ce8\u680f:\x3c/li\x3e\x3cimg src\x3d'/Images/TipsPics/tips_select_note.jpg'\x3e\x3cli\x3e\u4e24\u8005:\x3c/li\x3e\x3cimg src\x3d'/Images/TipsPics/tips_select_other2.jpg'\x3e\x3c/ul\x3e\x3ch5 class\x3d'TipsTile'\x3e\u5176\u4ed6\u4fe1\u606f:\x3c/h5\x3e\x3cul class\x3d'TipsTitle2'\x3e\x3cli\x3e\u53ef\u4e3a\u5bf9\u201c\u5176\u4ed6\u201d\u9009\u9879\u6240\u586b\u5165\u7684\u5185\u5bb9\u8fdb\u884c\u9a8c\u8bc1,\u907f\u514d\u53d7\u8bbf\u8005\u8f93\u5165\u9519\u8bef\u7684\u5185\u5bb9\u3002\x3c/li\x3e\x3c/ul\x3e"},verify:{text:"\x3ch5 class\x3d'TipsTile'\x3e\u8f93\u5165\u5185\u5bb9\u9a8c\u8bc1\x3c/h5\x3e\x3cp class\x3d'TipsTile2'\x3e\u5f53\u5e0c\u671b\u53d7\u8bbf\u8005\u8f93\u5165\u7279\u5b9a\u5185\u5bb9\u65f6\uff0c\u53ef\u4f7f\u7528\u9a8c\u8bc1\u529f\u80fd\u5bf9\u6587\u5b57\u5185\u5bb9\u8fdb\u884c\u6709\u6548\u6027\u5224\u65ad\u3002\x3c/br\x3e\x3c/p\x3e\x3ch5 class\x3d'TipsTile'\x3e\u9a8c\u8bc1\u9009\u9879:\x3c/h5\x3e\x3cul class\x3d'TipsTitle2'\x3e\x3cli\x3e\u5b57\u6570\uff1a\u53ea\u63a5\u53d7\u6587\u5b57\u8f93\u5165\uff0c\u8bbe\u5b9a\u53ef\u8f93\u5165\u6587\u5b57\u5b57\u6570\u7684\u4e0a\u9650\u548c\u4e0b\u9650\u3002\x3c/li\x3e\x3cli\x3e\u6574\u6570\uff1a\u53ea\u63a5\u53d7\u6574\u6570\u8f93\u5165\uff0c\u8bbe\u5b9a\u53ef\u8f93\u5165\u6570\u503c\u7684\u4e0a\u9650\u548c\u4e0b\u9650\u3002\x3c/li\x3e\x3cli\x3e\u5c0f\u6570\uff1a\u53ea\u63a5\u53d7\u6574\u6570\u548c\u5c0f\u6570\u8f93\u5165\uff0c\u8bbe\u5b9a\u53ef\u8f93\u5165\u6570\u503c\u7684\u4e0a\u9650\u548c\u4e0b\u9650\u3002\x3c/li\x3e\x3cli\x3e\u65e5\u671f\uff1a\u9009\u62e9\u5236\u5b9a\u65e5\u671f\u3002\x3c/li\x3e\x3cli\x3e\u90ae\u4ef6\u5730\u5740\uff1a\u53ea\u63a5\u53d7\u90ae\u4ef6\u5730\u5740\u683c\u5f0f\u3002\x3c/li\x3e\x3cli\x3e\u624b\u673a\u53f7\u7801\uff1a\u53ea\u63a5\u53d7\u624b\u673a\u53f7\u7801\u683c\u5f0f\u3002\x3c/li\x3e\x3c/ul\x3e"},generalSetting:{text:"\x3ch5 class\x3d'TipsTile'\x3e\u901a\u7528\u8bbe\u7f6e\x3c/h5\x3e\x3cp class\x3d'TipsTitle2'\x3e \u901a\u7528\u8bbe\u7f6e\u9762\u677f\u7528\u4e8e\u8bbe\u5b9a\u5982\u4e0b\u9898\u76ee\u5c5e\u6027\uff1a\x3c/br\x3e\x3c/p\x3e\x3cul class\x3d'TipsTitle2'\x3e\x3cli\x3e\u591a\u9009\u9898\uff1a\u52fe\u9009\u540e\u5c06\u672c\u9898\u8bbe\u5b9a\u4e3a\u591a\u9009\u9898\u3002\u9ed8\u8ba4\u4e3a\u5355\u9009\u9898\u3002\x3c/li\x3e\x3cli\x3e\u9009\u9879\u968f\u673a\uff1a\u52fe\u9009\u540e\u672c\u9898\u5c06\u968f\u673a\u6253\u4e71\u6240\u6709\u9009\u9879\u540e\u518d\u5448\u73b0\u7ed9\u53d7\u8bbf\u7528\u6237\u3002\u4e0d\u540c\u53d7\u8bbf\u7528\u6237\u56de\u7b54\u95ee\u5377\u65f6\u5c06\u770b\u5230\u4e0d\u540c\u6392\u5217\u6b21\u5e8f\u7684\u9009\u9879\u3002\x3c/li\x3e\x3c/ul\x3e"}};c.Theme=[{bgColor:"#ffffff",quesColor:"#4e5b68",btnBgColor:"#5940aa",btnColor:"#ffffff",selColor:"#4e5b68"},{bgColor:"#ffffff",quesColor:"#4a4a4a",btnBgColor:"#2ecc71",btnColor:"#ffffff",selColor:"#9b9075"},{bgColor:"#ffffff",quesColor:"#00baeb",btnBgColor:"#f85462",btnColor:"#ffffff",selColor:"#68dcfc"},{bgColor:"#121212",quesColor:"#ffffff",btnBgColor:"#dcb05a",btnColor:"#ffffff",selColor:"#c9c9c9"},{bgColor:"#88c446",quesColor:"#206970",btnBgColor:"#d7ffc4",btnColor:"#88c446",selColor:"#206970"}]})();$(function(){ZYDesign.Environment.isWebkit?$(".design_wrapper").show():confirm(Prompt.QSNRD_CurrentBrowserUseDisable+"\x3cbr\x3e"+Prompt.QSNRD_AdviceBrowser,function(){$(".design_wrapper").show()},function(){window.location.href="/Home/Index#/QM"},"\u7ee7\u7eed","","\u9000\u51fa")});angular.module("ZYDesign","batchOption eagleEye nodeBox nodeEditor nodeFlow nodeSearcher helpBox nodeValidator themeBox versionHistory versionSave designManager recordManager".split(" ")).controller("ZYDesignController",["$scope","designManager","recordManager","$timeout",function(c,a,b,d){c.designManager=ZYDesign.DesignManager=a;c.handleBackIconClick=function(){a.leavePage("/Home/DashBoard#/QM")};c.handleReleaseIconClick=function(){var b="/Home/DashBoard#/QMSet/Publish/"+$("#quesIDEx").val();a.leavePage(b)};c.handleToggleNodeBoxClick=function(){a.nodeBoxManager.toggleShow();a.themeBoxManager.close()};c.handleToggleThemeBoxClick=function(){a.themeBoxManager.toggleShow();a.nodeBoxManager.close()};c.handleMouseUp=function(b){a.tempConncetion&&(a.removeTempConnection(),a.tempConncetion=null)};c.handleZoomOutClick=function(){a.zoomOut()};c.chartSvgZoomIn=function(){a.zoomIn()};c.handleShowAllClick=function(){a.showAll()};c.handleSaveClick=function(){a.save("N",null,null,"Y","");a.autoSaveManager.reset()};c.handleTestClick=function(){a.test()};c.handleSearcherKeydown=function(b){13==b.keyCode&&(b=b.currentTarget.value.trim())&&a.searchManager.search(b)};c.handleSearchClick=function(){var b=$("#search_txt").val().trim();b&&a.searchManager.search(b)};c.handleGridToggleClick=function(){a.toggleGrid()};c.handleDeleteNodeClick=function(){a.removeSelected()};c.handleCopyNodeClick=function(){a.clipBoard.dulplicate(0,0)};c.handleBreakConnClick=function(){a.breakConnOfSelectedNodes()};c.handleSearcherMouseEnter=function(){a.searchManager.releaseSearcher()};c.handleSearcherMouseLeave=function(){a.searchManager.wrapSearcher()};c.handleVersionHistoryMouseEnter=function(){a.versionHistoryManager.open()};c.handleVersionHistoryMouseLeave=function(){a.versionHistoryManager.close()};c.handleUndoClick=function(){b.undo()&&a.digest()};c.handleRedoClick=function(){b.redo()&&a.digest()}}]);(function(){var c=ZYDesign.Class;c.ImageModel=function(){function a(){this instanceof a&&(this.id=ZYDesign.UuidUtil.generate(),this.size=this.index=0,this.serverFileName=this.url=this.fileName="",this.settingHeight=this.settingWidth=this.originHeight=this.originWidth=this.cutY=this.cutX=0,this.reCut=!1)}a.prototype.container={width:640,height:360};a.prototype.getStyle=function(){return"top:"+-this.cutY+"px;left:"+-this.cutX+"px;width:"+this.settingWidth+"px;height:"+this.settingHeight+"px;"};a.prototype.fitAuto=function(){this.originWidth/this.originHeight<=this.container.width/this.container.height?this.fitPortrait():this.fitLandscape()};a.prototype.fitLandscape=function(){this.settingWidth=this.container.width;this.settingHeight=Math.round(this.settingWidth/this.originWidth*this.originHeight);this.cutX=0;this.cutY=Math.round((this.settingHeight-this.container.height)/2);this.reCut=!0};a.prototype.fitPortrait=function(){this.settingHeight=this.container.height;this.settingWidth=Math.round(this.settingHeight/this.originHeight*this.originWidth);this.cutY=0;this.cutX=Math.round((this.settingWidth-this.container.width)/2);this.reCut=!0};a.prototype.getSizeText=function(){return this.originWidth+" x "+this.originHeight+"px"};a.prototype.getVolumnText=function(){return Math.round(this.size/1024)+"kB"};a.prototype.getBigImageStyle=function(){return this.url+"640_"+this.serverFileName};a.prototype.getThumbnailStyle=function(){return"background-image:url('"+this.url+"64_"+this.serverFileName+"');"};return a}();c.QuestionModel=function(){function a(b){this instanceof a&&(this.parent=b,this.videoUrl=this.originText="")}a.prototype.getX=function(){return this.parent?this.parent.questionX:0};a.prototype.getY=function(){return this.parent?this.parent.questionY+this.parent.getExtraY():0};a.prototype.getShowText=function(){var b=143;1>ZYDesign.DesignManager.chartZoomRate&&(b=Math.round(b*ZYDesign.DesignManager.chartZoomRate));return ZYDesign.TextUtil.getEllipsisByWidth(b,this.originText,13)};return a}();c.LineModel=function(){function a(b,d){this instanceof a&&(this.parent=b,this.type=d)}a.prototype.getX1=function(){return this.parent?0==this.type?this.parent.lineX1:1==this.type?this.parent.hLineX1:2==this.type?this.parent.vLineX1+this.parent.getExtraWidth()/2:this.parent.lineX1:0};a.prototype.getX2=function(){return this.parent?0==this.type?this.parent.lineX2+this.parent.getExtraWidth():1==this.type?this.parent.hLineX2:2==this.type?this.parent.vLineX2+this.parent.getExtraWidth()/2:this.parent.lineX2+this.parent.getExtraWidth():0};a.prototype.getY1=function(){return this.parent?0==this.type?this.parent.lineY1+this.parent.getExtraY():1==this.type?this.parent.hLineY1+this.parent.getExtraHeight()/2:2==this.type?this.parent.vLineY1:this.parent.getBackgroundHeight()-this.parent.optionLineHeight:0};a.prototype.getY2=function(){return this.parent?0==this.type?this.parent.lineY2+this.parent.getExtraY():1==this.type?this.parent.hLineY2+this.parent.getExtraHeight()/2:2==this.type?this.parent.vLineY2:this.parent.getBackgroundHeight()-this.parent.optionLineHeight:0};return a}();c.Hoverable=function(){function a(){this instanceof a&&(this._hovered=!1)}a.prototype.hover=function(){this._hovered=!0};a.prototype.unhover=function(){this._hovered=!1};a.prototype.isHovered=function(){return this._hovered};return a}();c.Selectable=function(){function a(){this instanceof a&&(c.Hoverable.call(this),this._selected=!1)}c.inheritPrototype(c.Hoverable,a);a.prototype.select=function(){this._selected=!0};a.prototype.deselect=function(){this._selected=!1};a.prototype.isSelected=function(){return this._selected};return a}();c.InputConnector=function(a){function b(a){this instanceof b&&(c.Selectable.call(this),this.parent=a,this.inputId=ZYDesign.UuidUtil.generate(),this.sources=[],this.text="\u8f93\u5165")}c.inheritPrototype(c.Selectable,b);b.prototype.type=ZYDesign.Enum.CONNTYPE.INPUT;b.prototype.exactType=ZYDesign.Enum.CONNEXACTTYPE.INPUTBASE;b.prototype.isConnected=function(){return!!this.sources.length};b.prototype.getTextX=function(){return this.parent?this.parent.inputTextX:0};b.prototype.getTextY=function(){return this.parent?this.parent.inputTextY+this.parent.getExtraY():0};b.prototype.getCircleR=function(){return this.parent?this.parent.circleR:0};b.prototype.getCircleX=function(){return this.parent?this.parent.inputCircleX:0};b.prototype.getCircleY=function(){return this.parent?this.parent.inputCircleY+this.parent.getExtraY():0};b.prototype.getBlockX=function(){return this.getCircleX()-13};b.prototype.getBlockY=function(){return this.getCircleY()-13};return b}();c.LoopEndConnector=function(){function a(b){this instanceof a&&(c.InputConnector.call(this,b),this.text="\u5faa\u73af\u7ed3\u675f")}c.inheritPrototype(c.InputConnector,a);a.prototype.exactType=ZYDesign.Enum.CONNEXACTTYPE.LOOPEND;a.prototype.getTextX=function(){return this.parent?this.parent.loopEndTextX:0};a.prototype.getTextY=function(){return this.parent?this.parent.loopEndTextY:0};a.prototype.getCircleX=function(){return this.parent?this.parent.loopEndCircleX:0};a.prototype.getCircleY=function(){return this.parent?this.parent.loopEndCircleY:0};return a}();c.OutputConnector=function(){function a(b){this instanceof a&&(c.Selectable.call(this),this.parent=b,this.outputId=ZYDesign.UuidUtil.generate(),this.dest=null,this.text="\u8f93\u51fa")}c.inheritPrototype(c.Selectable,a);a.prototype.type=ZYDesign.Enum.CONNTYPE.OUTPUT;a.prototype.exactType=ZYDesign.Enum.CONNEXACTTYPE.OUTPUTBASE;a.prototype.isConnected=function(){return!!this.dest};a.prototype.getTextX=function(){return this.parent?this.parent.outputTextX+this.parent.getExtraWidth():0};a.prototype.getTextY=function(){return this.parent?this.parent.outputTextY+this.parent.getExtraY():0};a.prototype.getCircleR=function(){return this.parent?this.parent.circleR:0};a.prototype.getCircleX=function(){return this.parent?this.parent.outputCircleX+this.parent.getExtraWidth():0};a.prototype.getCircleY=function(){return this.parent?this.parent.outputCircleY+this.parent.getExtraY():0};a.prototype.getBlockX=function(){return this.getCircleX()-13};a.prototype.getBlockY=function(){return this.getCircleY()-13};a.prototype.getShowText=function(){if(!this.parent)return"";if(this.parent.optionHidden||!this.parent.outputTextChangable)return"\u8f93\u51fa";for(var b=!1,a=0;a<this.parent.options.length;a++)if(null!=this.parent.options[a].dest){b=!0;break}return b?"\u5176\u4ed6\u9009\u9879\u8f93\u51fa":"\u5168\u90e8\u9009\u9879\u8f93\u51fa"};return a}();c.RandomStartConnector=function(){function a(b){this instanceof a&&(c.OutputConnector.call(this,b),this.dests=[],this.text="\u968f\u673a\u5f00\u59cb")}c.inheritPrototype(c.OutputConnector,a);a.prototype.exactType=ZYDesign.Enum.CONNEXACTTYPE.RANDOMSTART;a.prototype.isConnected=function(){return!!this.dests.length};a.prototype.getTextX=function(){return this.parent?this.parent.randomStartTextX:0};a.prototype.getTextY=function(){return this.parent?this.parent.randomStartTextY:0};a.prototype.getCircleX=function(){return this.parent?this.parent.randomStartCircleX:0};a.prototype.getCircleY=function(){return this.parent?this.parent.randomStartCircleY:0};a.prototype.containDest=function(b){for(var a=0;a<this.dests.length;a++)if(b==this.dests[a])return!0;return!1};return a}();c.LoopStartConnector=function(){function a(b){this instanceof a&&(c.OutputConnector.call(this,b),this.text="\u5faa\u73af\u5f00\u59cb")}c.inheritPrototype(c.OutputConnector,a);a.prototype.exactType=ZYDesign.Enum.CONNEXACTTYPE.LOOPSTART;a.prototype.getTextX=function(){return this.parent?this.parent.loopStartTextX:0};a.prototype.getTextY=function(){return this.parent?this.parent.loopStartTextY:0};a.prototype.getCircleX=function(){return this.parent?this.parent.loopStartCircleX:0};a.prototype.getCircleY=function(){return this.parent?this.parent.loopStartCircleY:0};return a}();c.OptionConnector=function(){function a(b,d){this instanceof a&&(c.OutputConnector.call(this,b),this.originText="",this.number=this.index=0,this.belong=d?d:"options")}c.inheritPrototype(c.OutputConnector,a);a.prototype.exactType=ZYDesign.Enum.CONNEXACTTYPE.OPTION;a.prototype.isCircleNeed=function(){return!0};a.prototype.getTextX=function(){return this.parent?this.parent.optionTextXBase:0};a.prototype.getTextY=function(){return this.parent?this.parent.optionTextYBase+this.index*this.parent.optionLineHeight+this.parent.getExtraY():0};a.prototype.getCircleX=function(){return this.parent?this.parent.optionHidden?this.parent.output.getCircleX():this.parent.optionCircleXBase:0};a.prototype.getCircleY=function(){return this.parent?this.parent.optionHidden?this.parent.output.getCircleY():this.parent.optionCircleYBase+this.index*this.parent.optionLineHeight+this.parent.getExtraY():0};a.prototype.getShowText=function(){var b=143;1>ZYDesign.DesignManager.chartZoomRate&&(b=Math.round(b*ZYDesign.DesignManager.chartZoomRate));return ZYDesign.TextUtil.getEllipsisByWidth(b,this.originText,13)};return a}();c.SelectOptionConnector=function(){function a(b){this instanceof a&&(c.OptionConnector.call(this,b),this.isOtherOption=!1,this.otherType=1,this.fillRequired=!1,this.validateType=1,this.validateStart=0,this.validateEnd=50,this.errorMsg="\u8f93\u5165\u683c\u5f0f\u65e0\u6548\uff01")}c.inheritPrototype(c.OptionConnector,a);a.prototype.extractVariable=function(){var b=this.originText,a=b.indexOf("@["),f=b.lastIndexOf("]");return-1==a||-1==f?null:b.substring(a+2,f)};a.prototype.isCircleNeed=function(){return!(this.isOtherOption&&2==this.otherType)};return a}();c.SelectPicOptionConnector=function(){function a(b){this instanceof a&&(this.image=null,c.OptionConnector.call(this,b))}c.inheritPrototype(c.OptionConnector,a);a.prototype.extractVariable=function(){return c.SelectOptionConnector.prototype.extractVariable.call(this)};return a}();c.FillOptionConnector=function(){function a(b){this instanceof a&&c.OptionConnector.call(this,b)}c.inheritPrototype(c.OptionConnector,a);a.prototype.isCircleNeed=function(){return!1};return a}();c.SequenceOptionConnector=function(){function a(b){this instanceof a&&(c.OptionConnector.call(this,b),this.seqTarget=!1)}c.inheritPrototype(c.OptionConnector,a);a.prototype.getShowText=function(){for(var b="",a=0;a<this.parent.options.length;a++)if(this.parent.options[a].seqTarget){b=this.parent.options[a].originText;break}return b?(a=65,1>ZYDesign.DesignManager.chartZoomRate&&(a=Math.round(a*ZYDesign.DesignManager.chartZoomRate)),"\u76ee\u6807"+ZYDesign.TextUtil.getEllipsisByWidth(a,b,13)+"\u6392\u5728\u7b2c"+(this.index+1)+"\u4f4d"):"\u76ee\u6807\u6392\u5728\u7b2c"+(this.index+1)+"\u4f4d"};return a}();c.MarkOptionConnector=function(){function a(b){this instanceof a&&c.OptionConnector.call(this,b)}c.inheritPrototype(c.OptionConnector,a);a.prototype.getShowText=function(){var b=130;1>ZYDesign.DesignManager.chartZoomRate&&(b=Math.round(b*ZYDesign.DesignManager.chartZoomRate));return ZYDesign.TextUtil.getEllipsisByWidth(b,this.originText,13)};a.prototype.isCircleNeed=function(){return!1};return a}();c.MatrixOptionConnector=function(){function a(b){this instanceof a&&(c.OptionConnector.call(this,b),this.xIndex=0,this.yIndex-0)}c.inheritPrototype(c.OptionConnector,a);a.prototype.getCircleX=function(){return this.parent.optionCircleXBase+this.xIndex*this.parent.optionWidth};a.prototype.getCircleY=function(){return this.parent.optionCircleYBase+this.yIndex*this.parent.optionLineHeight};return a}();c.MatrixXOptionConnector=function(){function a(b){this instanceof a&&c.OptionConnector.call(this,b,"optionsX")}c.inheritPrototype(c.OptionConnector,a);a.prototype.getTitle=function(){return"C"+(this.index+1)};a.prototype.getTitleX=function(){return this.parent?this.parent.optionsXTitleX+this.index*this.parent.optionWidth:0};a.prototype.getTitleY=function(){return this.parent?this.parent.optionsXTitleY:0};a.prototype.getShowText=function(){var b=65;1>ZYDesign.DesignManager.chartZoomRate&&(b=Math.round(b*ZYDesign.DesignManager.chartZoomRate));return ZYDesign.TextUtil.getEllipsisByWidth(b,this.originText,13)};a.prototype.getTextX=function(){return this.parent?this.parent.optionsXTextX+this.index*this.parent.optionWidth:0};a.prototype.getTextY=function(){return this.parent?this.parent.optionsXTextY:0};a.prototype.getTextRotation=function(){return"rotate(90,"+(this.getTextX()+5)+","+(this.getTextY()-2)+")"};return a}();c.MatrixYOptionConnector=function(){function a(b){this instanceof a&&c.OptionConnector.call(this,b,"optionsY")}c.inheritPrototype(c.OptionConnector,a);a.prototype.getTitle=function(){return"R"+(this.index+1)};a.prototype.getTitleX=function(){return this.parent?this.parent.optionsYTitleX:0};a.prototype.getTitleY=function(){return this.parent?this.parent.optionsYTitleY+this.index*this.parent.optionLineHeight:0};a.prototype.getShowText=function(){var b=117;1>ZYDesign.DesignManager.chartZoomRate&&(b=Math.round(b*ZYDesign.DesignManager.chartZoomRate));return ZYDesign.TextUtil.getEllipsisByWidth(b,this.originText,13)};a.prototype.getTextX=function(){return this.parent?this.parent.optionsYTextX:0};a.prototype.getTextY=function(){return this.parent?this.parent.optionsYTextY+this.index*this.parent.optionLineHeight:0};return a}();c.RegionOptionConnector=function(){function a(b){this instanceof a&&(c.OptionConnector.call(this,b),this.countyId=this.cityId=this.provinceId=0)}c.inheritPrototype(c.OptionConnector,a);a.prototype.getProvince=function(){return ZYDesign.Dict.getProvinceById(this.provinceId)};a.prototype.getCity=function(){return ZYDesign.Dict.getProvinceById(this.cityId)};a.prototype.getCounty=function(){return ZYDesign.Dict.getProvinceById(this.countyId)};a.prototype.getShowText=function(){this.originText="";var b=this.getProvince(),a=this.getCity(),f=this.getCounty();b&&(this.originText+=b.text);a&&(this.originText+="-",this.originText+=a.text);f&&(this.originText+="-",this.originText+=f.text);b=143;1>ZYDesign.DesignManager.chartZoomRate&&(b=Math.round(b*ZYDesign.DesignManager.chartZoomRate));return ZYDesign.TextUtil.getEllipsisByWidth(b,this.originText,13)};return a}();c.GenderOptionConnector=function(){function a(b){this instanceof a&&(c.OptionConnector.call(this,b),this.genderId=0)}c.inheritPrototype(c.OptionConnector,a);a.prototype.getGender=function(){return ZYDesign.Dict.getGenderById(this.genderId)};a.prototype.getShowText=function(){this.originText="";var b=this.getGender();b&&(this.originText+=b.text);return this.originText};return a}();c.AgeGroupOptionConnector=function(){function a(b){this instanceof a&&(c.OptionConnector.call(this,b),this.endAgeGroupId=this.startAgeGroupId=0)}c.inheritPrototype(c.OptionConnector,a);a.prototype.getStartAgeGroup=function(){return ZYDesign.Dict.getAgeGroupById(this.startAgeGroupId)};a.prototype.getEndAgeGroup=function(){return ZYDesign.Dict.getAgeGroupById(this.endAgeGroupId)};a.prototype.getShowText=function(){this.originText="";var b=this.getStartAgeGroup(),a=this.getEndAgeGroup();b&&(this.originText+=b.text);a&&(this.originText+="-",this.originText+=a.text);return this.originText};return a}();c.MaritalOptionConnector=function(){function a(b){this instanceof a&&(c.OptionConnector.call(this,b),this.maritalStatusId=0)}c.inheritPrototype(c.OptionConnector,a);a.prototype.getMaritalStatus=function(){return ZYDesign.Dict.getMaritalStatusById(this.maritalStatusId)};a.prototype.getShowText=function(){this.originText="";var b=this.getMaritalStatus();b&&(this.originText+=b.text);return this.originText};return a}();c.EduOptionConnector=function(){function a(b){this instanceof a&&(c.OptionConnector.call(this,b),this.eduStatusId=0)}c.inheritPrototype(c.OptionConnector,a);a.prototype.getEduStatus=function(){return ZYDesign.Dict.getEduStatusById(this.eduStatusId)};a.prototype.getShowText=function(){this.originText="";var b=this.getEduStatus();b&&(this.originText+=b.text);return this.originText};return a}();c.OccupationOptionConnector=function(){function a(b){this instanceof a&&(c.OptionConnector.call(this,b),this.occupationId=0)}c.inheritPrototype(c.OptionConnector,a);a.prototype.getOccupation=function(){return ZYDesign.Dict.getOccupationById(this.occupationId)};a.prototype.getShowText=function(){this.originText="";var b=this.getOccupation();b&&(this.originText+=b.text);b=143;1>ZYDesign.DesignManager.chartZoomRate&&(b=Math.round(b*ZYDesign.DesignManager.chartZoomRate));return ZYDesign.TextUtil.getEllipsisByWidth(b,this.originText,13)};return a}();c.ProfessionOptionConnector=function(){function a(b){this instanceof a&&(c.OptionConnector.call(this,b),this.professionId=0)}c.inheritPrototype(c.OptionConnector,a);a.prototype.getProfession=function(){return ZYDesign.Dict.getProfessionById(this.professionId)};a.prototype.getShowText=function(){this.originText="";var b=this.getProfession();b&&(this.originText+=b.text);b=143;1>ZYDesign.DesignManager.chartZoomRate&&(b=Math.round(b*ZYDesign.DesignManager.chartZoomRate));return ZYDesign.TextUtil.getEllipsisByWidth(b,this.originText,13)};return a}();c.JobTitleOptionConnector=function(){function a(b){this instanceof a&&(c.OptionConnector.call(this,b),this.jobTitleId=0)}c.inheritPrototype(c.OptionConnector,a);a.prototype.getJobTitle=function(){return ZYDesign.Dict.getJobTitleById(this.jobTitleId)};a.prototype.getShowText=function(){this.originText="";var b=this.getJobTitle();b&&(this.originText+=b.text);b=143;1>ZYDesign.DesignManager.chartZoomRate&&(b=Math.round(b*ZYDesign.DesignManager.chartZoomRate));return ZYDesign.TextUtil.getEllipsisByWidth(b,this.originText,13)};return a}();c.IncomeOptionConnector=function(){function a(b){this instanceof a&&(c.OptionConnector.call(this,b),this.incomeEndId=this.incomeStartId=0)}c.inheritPrototype(c.OptionConnector,a);a.prototype.getIncomeStart=function(){return ZYDesign.Dict.getIncomeById(this.incomeStartId)};a.prototype.getIncomeEnd=function(){return ZYDesign.Dict.getIncomeById(this.incomeEndId)};a.prototype.getShowText=function(){this.originText="";var b=this.getIncomeStart(),a=this.getIncomeEnd();b&&(this.originText+=b.text);a&&(this.originText+="-",this.originText+=a.text);b=143;1>ZYDesign.DesignManager.chartZoomRate&&(b=Math.round(b*ZYDesign.DesignManager.chartZoomRate));return ZYDesign.TextUtil.getEllipsisByWidth(b,this.originText,13)};return a}();c.LogicConnector=function(){function a(b){this instanceof a&&(c.OutputConnector.call(this,b),this.index=0,this.originText="\u903b\u8f91",this.requires=[])}c.inheritPrototype(c.OutputConnector,a);a.prototype.getTextX=function(){return this.parent?this.parent.optionTextXBase:0};a.prototype.getTextY=function(){return this.parent?this.parent.optionTextYBase+this.index*this.parent.optionLineHeight:0};a.prototype.getCircleX=function(){return this.parent?this.parent.optionHidden?this.parent.output.getCircleX():this.parent.optionCircleXBase:0};a.prototype.getCircleY=function(){return this.parent?this.parent.optionHidden?this.parent.output.getCircleY():this.parent.optionCircleYBase+this.index*this.parent.optionLineHeight:0};a.prototype.getShowText=function(){var b=143;1>ZYDesign.DesignManager.chartZoomRate&&(b=Math.round(b*ZYDesign.DesignManager.chartZoomRate));return ZYDesign.TextUtil.getEllipsisByWidth(b,this.originText,13)};a.prototype.isCircleNeed=function(){return!0};a.prototype.collectRequires=function(){for(var b=[],a=0;a<this.requires.length;a++){var f=this.requires[a],g={};g.index=f.index;g.originText=f.originText;g.arithmetic=f.arithmetic;g.limitType=f.limitType;g.answerFirst=f.answerFirst;g.answerSecond=f.answerSecond;g.subjectId=f.subjectId;g.rowId=f.rowId;g.columnId=f.columnId;b.push(g)}return b};a.prototype.addRequire=function(b){var a=new ZYDesign.Class.LogicRequireModel(this);a.index=b.index?b.index:this.requires.length;a.originText=b.text?b.text:"\u6761\u4ef6"+(this.requires.length+1);a.arithmetic=b.arithmetic;a.limitType=b.limitType;a.answerFirst=b.answerFirst;a.answerSecond=b.answerSecond;a.subjectId=b.subjectId;a.rowId=b.rowId;a.columnId=b.columnId;a.relatedSubject=ZYDesign.DesignManager.searchSubjectById(a.subjectId);this.requires.push(a)};a.prototype.removeRequire=function(b){for(var a=-1,f=0;f<this.requires.length;f++){var g=this.requires[f];g==b&&(this.requires.splice(f,1),a=f);f>a&&0<f&&(g.index-=1)}};a.prototype.initRequires=function(b){if(b){this.requires=[];for(var a=0;a<b.length;a++)this.addRequire(b[a])}};return a}();c.ConnectionModel=function(){function a(){this instanceof a&&(c.Selectable.call(this),this.dest=this.source=null,this.disable=this.temp=!1,this.uuid=ZYDesign.UuidUtil.generate(),this.visible=!0)}c.inheritPrototype(c.Selectable,a);a.prototype.select=function(){a.base.select.call(this);this.dest&&(this.dest.select(),this.source.select())};a.prototype.deselect=function(){a.base.deselect.call(this);this.dest&&(this.dest.deselect(),this.source.deselect())};a.prototype.hover=function(){a.base.hover.call(this);this.dest&&(this.dest.connHovered=!0,this.source.connHovered=!0)};a.prototype.unhover=function(){a.base.unhover.call(this);this.dest&&(this.dest.connHovered=!1,this.source.connHovered=!1)};a.prototype.isDisabled=function(){return this.temp||this.disable};a.prototype.ApplyTwowayRelationship=function(){this.temp||(this.dest.sources.push(this.source),this.source.exactType==ZYDesign.Enum.CONNEXACTTYPE.RANDOMSTART?this.source.dests.push(this.dest):this.source.dest=this.dest,this.source.parent.relatedConnections.push(this),this.dest.parent.relatedConnections.push(this))};a.prototype.removeTwowayRelationship=function(){for(var b=0;b<this.dest.sources.length;b++)if(this.dest.sources[b]==this.source){this.dest.sources.splice(b,1);break}if(this.source.exactType==ZYDesign.Enum.CONNEXACTTYPE.RANDOMSTART)for(b=0;b<this.source.dests.length;b++){if(this.source.dests[b]==this.dest){this.source.dests.splice(b,1);break}}else this.source.dest=null;for(var a=this.source.parent,b=0;b<a.relatedConnections.length;b++){var f=a.relatedConnections[b];if(f==this){a.relatedConnections.splice(b,1);break}}a=this.dest.parent;for(b=0;b<a.relatedConnections.length;b++)if(f=a.relatedConnections[b],f==this){a.relatedConnections.splice(b,1);break}};a.prototype.sourceCoordX=function(){return this.source.getCircleX()+this.source.parent.getX()};a.prototype.sourceCoordY=function(){return this.source.getCircleY()+this.source.parent.getY()};a.prototype.sourceTangentX=function(){var b=(this.destCoordX()-this.sourceCoordX())/2;Math.abs(b);return this.sourceCoordX()+b};a.prototype.sourceTangentY=function(){return this.sourceCoordY()};a.prototype.destTangentX=function(){var b=(this.destCoordX()-this.sourceCoordX())/2;Math.abs(b);return this.destCoordX()-b};a.prototype.destTangentY=function(){return this.destCoordY()};a.prototype.destCoordX=function(){return this.dest.getCircleX()+this.dest.parent.getX()};a.prototype.destCoordY=function(){return this.dest.getCircleY()+this.dest.parent.getY()};a.prototype.getPathCls=function(){var b="connection_line";this.isSelected()?b="selected_connection_line":this.isHovered()&&(b="mouseover_connection_line");return b};a.prototype.getPathD=function(){return"M"+this.sourceCoordX()+","+this.sourceCoordY()+" C "+this.sourceTangentX()+","+this.sourceTangentY()+" "+this.destTangentX()+","+this.destTangentY()+" "+this.destCoordX()+","+this.destCoordY()};a.prototype.getCircleCls=function(){var b="connection_endpoint";this.isSelected()?b="selected_connection_endpoint":this.isHovered()&&(b="mouseover_connection_endpoint");return b};a.prototype.getSrcCircleCls=function(){return this.getCircleCls()+" src_circle"};a.prototype.getDestCircleCls=function(){return this.getCircleCls()+" dest_circle"};a.prototype.fixPosition=function(){var b=$("#"+this.uuid);b.find("path").attr("d",this.getPathD());b.find(".src_circle").attr({cx:this.sourceCoordX(),cy:this.sourceCoordY()});b.find(".dest_circle").attr({cx:this.destCoordX(),cy:this.destCoordY()})};a.prototype.getX=function(){return Math.min(this.sourceCoordX(),this.destCoordX())};a.prototype.getRight=function(){return Math.max(this.sourceCoordX(),this.destCoordX())};a.prototype.getY=function(){return Math.min(this.sourceCoordY(),this.destCoordY())};a.prototype.getBottom=function(){return Math.max(this.sourceCoordY(),this.destCoordY())};a.prototype.checkVisible=function(){var b=ZYDesign.DesignManager,a=b.containerInfo,b=b.chartZoomRate,f=!1,g=!0;if(this.getX()*b>a.right||this.getRight()*b<a.left||this.getBottom()*b<a.top||this.getY()*b>a.bottom)g=!1;this.visible!=g&&(f=!0);this.visible=g;return f};return a}();c.LogicRequireModel=function(){function a(b){this instanceof a&&(this.originText="\u6761\u4ef6",this.arithmetic=0,this.columnId=this.rowId=this.subjectId=this.relatedSubject="",this.limitType=0,this.answerSecond=this.answerFirst="",this.parent=b)}a.prototype.isDoubleAnswerEnabled=function(){return 0==this.limitType||1==this.limitType?!0:!1};a.prototype.isColumnEnabled=function(){return this.relatedSubject?this.relatedSubject.type==ZYDesign.Enum.NODETYPE.MATRIX?!0:!1:!1};a.prototype.getOptions=function(){return this.relatedSubject?this.relatedSubject.type==ZYDesign.Enum.NODETYPE.MATRIX?this.relatedSubject.optionsX:this.relatedSubject.options:!1};a.prototype.isRowEnabled=function(){return this.relatedSubject?this.relatedSubject.type==ZYDesign.Enum.NODETYPE.MATRIX||this.relatedSubject.type==ZYDesign.Enum.NODETYPE.SELECT||this.relatedSubject.type==ZYDesign.Enum.NODETYPE.MARK?!0:!1:!1};return a}();c.VitualNode=function(){function a(){this instanceof a&&(c.Selectable.call(this),this.y=this.x=0,this.isVitual=!0)}c.inheritPrototype(c.Selectable,a);a.prototype.getX=function(){return this.x-ZYDesign.DesignManager.chartXDiffer};a.prototype.getY=function(){return this.y-ZYDesign.DesignManager.chartYDiffer};a.prototype.getWidth=function(){return 0};a.prototype.getHeight=function(){return 0};a.prototype.getRight=function(){return this.getX()+this.getWidth()};a.prototype.getBottom=function(){return this.getY()+this.getHeight()};return a}();c.NodeBase=function(){function a(){this instanceof a&&(c.Selectable.call(this),this.dirty=!1,this.mode=0,this.sortNo=-1,this.backgroundColor="#4593D0",this.width=this.y=this.x=this.height=0,this.nodeUuid="",this.nodeName="Q",this.relatedConnections=[],this.originData={},this.order=-1,this.validateResult=this.image=null,this.visible=!0,this.useMedia=!1)}c.inheritPrototype(c.Selectable,a);a.prototype.circleR=5;a.prototype.type=ZYDesign.Enum.NODETYPE.BASE;a.prototype.backgroundRadius=5;a.prototype.typeInt=-1;a.prototype.categoryType=-1;a.prototype.commonType="BASE";a.prototype.typeListKey="";a.prototype.breakDisabled=!1;a.prototype.copyDisabled=!1;a.prototype.removeDisabled=!1;a.prototype.previewDisabled=!1;a.prototype.optionbatchDisabled=!1;a.prototype.differWidth=0;a.prototype.differHeight=0;a.prototype.addition=!1;a.prototype.outputTextChangable=!1;a.prototype.nameLengthLimit=20;a.prototype.nameText="\u7f16\u53f7";a.prototype.describeText="\u95ee\u9898\u63cf\u8ff0";a.prototype.mediaDisable=!1;a.prototype.nodeNameEditable=!0;a.prototype.markChange=function(){this.dirty=!0};a.prototype.getMediaIconText=function(){return this.useMedia?"\u5220\u9664\u5a92\u4f53":"\u6dfb\u52a0\u5a92\u4f53"};a.prototype.getExtraY=function(){return 1==this.mode?30:0};a.prototype.getNodeNameX=function(){return 0};a.prototype.getNodeNameY=function(){return-6};a.prototype.getWarnIconTrasform=function(){return"translate(180, -20)"};a.prototype.isTypeOf=function(b){return b.toUpperCase()==this.type};a.prototype.isTypeIn=function(b){b=b.toString().split(",");for(var a=0;a<b.length;a++)if(b[a].toUpperCase()==this.type)return!0;return!1};a.prototype.isTerminal=function(){return this.commonType==ZYDesign.Enum.NODECOMMONTYPE.TERMINAL};a.prototype.isInputNeed=function(){return!(this.type==ZYDesign.Enum.NODETYPE.CHECK||this.type==ZYDesign.Enum.NODETYPE.START||this.type==ZYDesign.Enum.NODETYPE.COMMENT)};a.prototype.isOutputNeed=function(){return!(this.type==ZYDesign.Enum.NODETYPE.END||this.type==ZYDesign.Enum.NODETYPE.COMMENT)};a.prototype.isLineNeed=function(){return this.commonType==ZYDesign.Enum.NODECOMMONTYPE.SUBJECT||this.commonType==ZYDesign.Enum.NODECOMMONTYPE.TOOL||this.commonType==ZYDesign.Enum.NODECOMMONTYPE.INFO};a.prototype.isLineTNeed=function(){return this.hasOtherOption instanceof Function&&this.hasOtherOption()};a.prototype.isHeadNeed=function(){return this.commonType==ZYDesign.Enum.NODECOMMONTYPE.TOOL||this.type==ZYDesign.Enum.NODETYPE.COMMENT||1==this.mode};a.prototype.isSubject=function(){return this.commonType==ZYDesign.Enum.NODECOMMONTYPE.SUBJECT};a.prototype.getX=function(){return this.x-ZYDesign.DesignManager.chartXDiffer+6};a.prototype.getY=function(){return this.y-ZYDesign.DesignManager.chartYDiffer+24};a.prototype.getEyeX=function(){return this.x-ZYDesign.DesignManager.eyeXDiffer};a.prototype.getEyeY=function(){return this.y-ZYDesign.DesignManager.eyeYDiffer};a.prototype.getWidth=function(){return this.width+this.differWidth};a.prototype.getBackgroundWidth=function(){return this.width};a.prototype.getHeight=function(){var b=this.getExtraY();return this.optionHidden?74+b:this.height+this.differHeight+b};a.prototype.getBackgroundHeight=function(){return this.getHeight()-14};a.prototype.getBackgroundColor=function(){return this.backgroundColor};a.prototype.getBackgroundTop=function(){return 0};a.prototype.getBackgroundLeft=function(){return 0};a.prototype.getBackgrounRadius=function(){return this.backgroundRadius};a.prototype.maintainWidth=function(){};a.prototype.maintainHeight=function(){};a.prototype.getRight=function(){return this.getX()+this.getWidth()};a.prototype.getBottom=function(){return this.getY()+this.getHeight()};a.prototype.init=function(b,a,f){this.originData=b;this.x="number"==typeof a?a:this.originData.x;this.y="number"==typeof f?f:this.originData.y;this.nodeUuid=b.nodeUuid?b.nodeUuid:ZYDesign.UuidUtil.generate();this.originData.mode&&(this.mode=this.originData.mode);this.originData.nodeName&&(this.nodeName=this.originData.nodeName);this.originData.isInit&&!this.originData.isCopy&&(a=ZYDesign.DesignManager.chartXDiffer-this.x,this.x+=a-a/ZYDesign.DesignManager.chartZoomRate,a=ZYDesign.DesignManager.chartYDiffer-this.y,this.y+=a-a/ZYDesign.DesignManager.chartZoomRate);this.originData.backgroundColor&&(this.backgroundColor=this.originData.backgroundColor);this.image=ZYDesign.DesignManager.imageUploadManager.getImageById(b.questionImageId);this.useMedia=!!this.image};a.prototype.collectDestList=function(){for(var b=[],a=0;a<this.relatedConnections.length;a++){var f=this.relatedConnections[a];f.source.parent==this&&b.push({selfPortId:f.source.outputId,destInputId:f.dest.inputId})}return b};a.prototype.updateName=function(b){this.nodeName=b};a.prototype.getShowNodeName=function(){return ZYDesign.TextUtil.getEllipsisByWidth(this.width-47,this.nodeName,13)};a.prototype.exportJson=function(b,a){a.questionairId=b;a.mode=this.mode;a.sortNo=this.sortNo;a.x=this.x;a.y=this.y;a.backgroundColor=this.backgroundColor;a.nodeName=this.nodeName;a.nodeUuid=this.nodeUuid;a.type=this.typeInt;a.categoryType=this.categoryType;a.commonType=this.commonType;a.questionImageId=this.image?this.image.id:"";a.questionImageName=this.image?this.image.serverFileName:"";a.imageOriginName=this.image?this.image.fileName:"";a.order=this.order};a.prototype.allowShowText=function(){return 0.5>=ZYDesign.DesignManager.chartZoomRate?!1:!0};a.prototype.getTransform=function(){return"translate("+this.getX()+","+this.getY()+")"};a.prototype.getEyeTransform=function(){return"translate("+this.getX()+","+this.getY()+")"};a.prototype.hasKeyword=function(b){return-1<this.nodeName.indexOf(b)?!0:!1};a.prototype.getCtrIconTransform=function(){return"translate(0,"+this.getBackgroundHeight()+")"};a.prototype.cloneNodeJson=function(b,a,f){b.isInit=!0;b.isCopy=!0;b.mode=this.mode;b.x=this.x+a;b.y=this.y+f;b.backgroundColor=this.backgroundColor;b.questionImageId=this.image?this.image.id:""};a.prototype.hasRouteTo=function(b,a){if(!b&&!a)return!1;if(b==this||this.type==a)return!0;var f={result:!1,doneList:[],alreadyDone:function(b){for(var a=0;a<this.doneList.length;a++)if(b==this.doneList[a])return!0;return!1}};this.searchDestNode(f,b,a);return f.result};a.prototype.searchDestNode=function(b,a,f){if(!b.result){b.doneList.push(this);var g=[];this.input&&this.input.sources&&(g=g.concat(this.input.sources));this.output&&this.output.dest&&(g=g.concat(this.output.dest));if(this.options)for(var h=0;h<this.options.length;h++){var c=this.options[h];c.dest&&(g=g.concat(c.dest))}for(h=0;h<g.length;h++)if(c=g[h],c.exactType!=ZYDesign.Enum.CONNEXACTTYPE.LOOPSTART&&c.exactType!=ZYDesign.Enum.CONNEXACTTYPE.LOOPEND&&c.exactType!=ZYDesign.Enum.CONNEXACTTYPE.RANDOMSTART&&(c=c.parent,!b.alreadyDone(c)))if(c==a||c.exactType==f){b.result=!0;break}else if(c.searchDestNode(b,a,f),b.result)break}};a.prototype.getCircleNode1Id=function(){var b=this.getEngagement();if(b.status!=ZYDesign.Enum.NODESTATE.LOOP)return"";var b=b.dueToNode,a=b.getEngagement();return a.status==ZYDesign.Enum.NODESTATE.LOOP?a.dueToNode.nodeUuid:b.nodeUuid};a.prototype.getCircleNode2Id=function(){var b=this.getEngagement();if(b.status!=ZYDesign.Enum.NODESTATE.LOOP)return"";b=b.dueToNode;return b.getEngagement().status==ZYDesign.Enum.NODESTATE.LOOP?b.nodeUuid:""};a.prototype.getEngageStatus=function(){return this.getEngagement().status};a.prototype.getEngageDueToNode=function(){return this.getEngagement().dueToNode};a.prototype.getEngagement=function(){var b={status:ZYDesign.Enum.NODESTATE.FREE,dueToNode:null,doneList:[],alreadyDone:function(b){for(var a=0;a<this.doneList.length;a++)if(b==this.doneList[a])return!0;return!1},checkState:function(b){b.exactType==ZYDesign.Enum.CONNEXACTTYPE.RANDOMSTART?(this.status=ZYDesign.Enum.NODESTATE.RANDOM,this.dueToNode=b.parent):b.exactType==ZYDesign.Enum.CONNEXACTTYPE.LOOPSTART||b.exactType==ZYDesign.Enum.CONNEXACTTYPE.LOOPEND?(this.status=ZYDesign.Enum.NODESTATE.LOOP,this.dueToNode=b.parent):b.parent.type==ZYDesign.Enum.NODETYPE.START||b.parent.type==ZYDesign.Enum.NODETYPE.END||b.parent.type==ZYDesign.Enum.NODETYPE.CHECK?this.status=ZYDesign.Enum.NODESTATE.NORMAL:b.parent.commonType==ZYDesign.Enum.NODECOMMONTYPE.TOOL&&(this.status=ZYDesign.Enum.NODESTATE.FREEWITHTOOL)}};this.searchEngageState(b);return b};a.prototype.searchEngageState=function(b){if(b.status==ZYDesign.Enum.NODESTATE.FREE||b.status==ZYDesign.Enum.NODESTATE.FREEWITHTOOL){b.doneList.push(this);var a=[];this.input&&this.input.sources&&(a=a.concat(this.input.sources));this.output&&this.output.dest&&(a=a.concat(this.output.dest));if(this.options)for(var f=0;f<this.options.length;f++){var c=this.options[f];c.dest&&(a=a.concat(c.dest))}for(f=0;f<a.length&&(c=a[f],b.checkState(c),b.status==ZYDesign.Enum.NODESTATE.FREE||b.status==ZYDesign.Enum.NODESTATE.FREEWITHTOOL)&&(c=c.parent,b.alreadyDone(c)||(c.searchEngageState(b),b.status==ZYDesign.Enum.NODESTATE.FREE||b.status==ZYDesign.Enum.NODESTATE.FREEWITHTOOL));f++);}};a.prototype.isMasterOutputed=function(){return this.output&&this.output.dest?!0:!1};a.prototype.isAllOptionOutputed=function(){if(!this.options||0==this.options.length)return!1;for(var b=0;b<this.options.length;b++)if(!this.options[b].dest)return!1;return!0};a.prototype.hasDeadOutput=function(){return this.isMasterOutputed()||this.isAllOptionOutputed()?!1:!0};a.prototype.hasDeadInput=function(){return this.input&&0==this.input.sources.length?!0:!1};a.prototype.validate=function(b){b||(b={isValid:!0,message:Prompt.QSNRD_Valid});this.validateResult=b;if(!this.nodeName.trim())return b.isValid=!1,b.message=Prompt.QSNRD_InvalidNoNodeName,b;if(this.hasDeadInput())return b.isValid=!1,b.message=Prompt.QSNRD_InvalidNoInput,b;this.hasDeadOutput()&&this.getEngageStatus()!=ZYDesign.Enum.NODESTATE.RANDOM&&(b.isValid=!1,b.message=Prompt.QSNRD_InvalidNoFullOutput);return b};a.prototype.hasRepeatedDest=function(){if(!this.output||!this.options)return!1;var b=this.output.dest;if(!b)return!1;for(var a=0;a<this.options.length;a++)if(this.options[a].dest==b)return!0;return!1};a.prototype.hasOptionDest=function(){if(!this.options)return!1;for(var b=0;b<this.options.length;b++)if(this.options[b].dest)return!0;return!1};a.prototype.isSingleSelect=function(){return!0};a.prototype.getExtraWidth=function(){return 0};a.prototype.getExtraHeight=function(){return 0};a.prototype.searchConnectorById=function(b){return null};a.prototype.showWarnMsg=function(){$("#"+this.nodeUuid+" .elem_warning_msg").show()};a.prototype.hideWarnMsg=function(){$("#"+this.nodeUuid+" .elem_warning_msg").hide()};a.prototype.toggleImage=function(){var b={oldImage:null,newImage:null};this.useMedia=!this.useMedia;this.useMedia||(b.oldImage=this.image,b.newImage=this.image=null);return b};a.prototype.searchNextNodesByOrder=function(){return{resultList:[],seedList:[]}};a.prototype.fixPosition=function(b){$("#"+this.nodeUuid).attr("transform",this.getTransform());var a=$("#eye-"+this.nodeUuid);a.find(".eye_bg_main").attr("transform",this.getEyeTransform());if(b)for(b=0;b<this.relatedConnections.length;b++)this.relatedConnections[b].fixPosition();return a};a.prototype.checkVisible=function(){var b=ZYDesign.DesignManager,a=b.containerInfo,b=b.chartZoomRate,f=!1,c=!0;if(this.getX()*b>a.right||this.getRight()*b<a.left||this.getBottom()*b<a.top||this.getY()*b>a.bottom)c=!1;this.visible!=c&&(f=!0);this.visible=c;return f};a.prototype.getMultiTransform=function(){return"translate(0,"+(this.getBackgroundHeight()+3)+")"};a.prototype.getMediaTransform=function(){var b=0;this.multipleSelect&&b++;return"translate("+24*b+","+(this.getBackgroundHeight()+3)+")"};return a}()})();(function(){var c=ZYDesign.Class;c.SubjectNode=function(){function a(){this instanceof a&&(c.NodeBase.call(this),this.width=205,this.height=74,this.line=new ZYDesign.Class.LineModel(this,0),this.question=new ZYDesign.Class.QuestionModel(this),this.input=new ZYDesign.Class.InputConnector(this),this.output=new ZYDesign.Class.OutputConnector(this),this.options=[],this.backgroundColor="#b089c8",this.randomOptionY=this.randomOption=this.optionHidden=!1,this.answerRequired=!0)}c.inheritPrototype(c.NodeBase,a);a.prototype.questionX=10;a.prototype.questionY=20;a.prototype.inputTextX=15.5;a.prototype.inputTextY=48;a.prototype.inputCircleX=0.5;a.prototype.inputCircleY=43;a.prototype.outputTextX=185.5;a.prototype.outputTextY=48;a.prototype.outputCircleX=199.5;a.prototype.outputCircleY=43;a.prototype.lineX1=0;a.prototype.lineY1=61;a.prototype.lineX2=200;a.prototype.lineY2=61;a.prototype.optionTextXBase=185.5;a.prototype.optionTextYBase=82;a.prototype.optionCircleXBase=199.5;a.prototype.optionCircleYBase=77;a.prototype.optionLineHeight=30;a.prototype.type=ZYDesign.Enum.NODETYPE.SUBJECT;a.prototype.typeInt=-100;a.prototype.categoryType=3;a.prototype.commonType=ZYDesign.Enum.NODECOMMONTYPE.SUBJECT;a.prototype.optionConstructor=ZYDesign.Class.OptionConnector;a.prototype.isRandomOption=function(){return this.randomOption};a.prototype.isRandomOptionY=function(){return this.randomOptionY};a.prototype.getQuestionShowLength=function(){return(this.width-80)/6};a.prototype.getBackgroundHeight=function(){return this.getHeight()-18};a.prototype.init=function(b,d,f){a.base.init.call(this,b,d,f);this.optionHidden=this.originData.optionHidden;this.randomOption="Y"==b.randomOption?!0:!1;this.randomOptionY="Y"==b.randomOptionY?!0:!1;this.answerRequired="N"==b.answerRequired?!1:!0;this.initOptions();this.initQuestion();this.initInput();this.initOutput()};a.prototype.initQuestion=function(){var b=this.originData;this.question.originText=b.questionText?b.questionText:"";this.question.videoUrl=b.questionVideoUrl?b.questionVideoUrl:""};a.prototype.initInput=function(){this.input.parent=this;this.input.text="\u8f93\u5165";this.originData.input.uuid&&(this.input.inputId=this.originData.input.uuid)};a.prototype.initOutput=function(){this.output.text="\u8f93\u51fa";this.originData.output.uuid&&(this.output.outputId=this.originData.output.uuid)};a.prototype.getExpansionIconTransform=function(){return this.optionHidden?"translate(192.5,8) rotate(90)":"translate(177.5,8)"};a.prototype.maintainOption=function(b){for(b=0;b<this.options.length;b++)this.options[b].index=b};a.prototype.generateOptionNumber=function(){for(var b=1,a=0;a<this.options.length;a++){var f=this.options[a];b<=f.number&&(b=f.number+1)}999<b&&(b="");return b};a.prototype.addOption=function(b,a,f){b=b||{};this.options||(this.options=[]);b instanceof this.optionConstructor?(a=b,a.index=this.options.length):(a=new this.optionConstructor(this),this.initOption(b,a));this.addOptionToList(a);this.maintainHeight();f||this.fixNodeSize(!0);return a};a.prototype.initOption=function(b,a){a.originText=b.text||"";a.outputId=b.uuid?b.uuid:ZYDesign.UuidUtil.generate();var f=parseInt(b.index);a.index=isNaN(f)?this.options.length:f;f=parseInt(b.number);a.number=isNaN(f)?this.generateOptionNumber():f};a.prototype.addOptionToList=function(b){this.options.push(b)};a.prototype.maintainHeight=function(){this.height=79+30*this.options.length};a.prototype.removeOption=function(b){var a=b.index;this.options.splice(a,1);for(this.maintainHeight();a<this.options.length;a++)b=this.options[a],b.index-=1;this.fixNodeSize(!0);return b};a.prototype.removeOptionInRange=function(b,a){if(!(0>b||a>=this.options.length||b>a)){for(var f=[],c=a;c>b;c--){var h=this.options[c];this.removeOption(h);f.push(h)}return f}};a.prototype.initOptions=function(){var a=this.originData.options;if(a)for(var d=0;d<a.length;d++)this.addOption(a[d],!1,!0)};a.prototype.collectOptions=function(){if(!this.options||0==this.options.length)return null;for(var a=[],d=0;d<this.options.length;d++){var f={};this.collectOption(this.options[d],f);a.push(f)}return a};a.prototype.collectOption=function(a,d){a&&d&&(d.nodeType=this.typeInt,d.number=a.number,d.typeFlag=0,d.index=a.index,d.text=a.originText,d.uuid=a.outputId)};a.prototype.hasKeyword=function(b){return a.base.hasKeyword.call(this,b)||-1<this.question.originText.indexOf(b)||this.hasKeywordInOptions(b)?!0:!1};a.prototype.hasKeywordInOptions=function(a){for(var d=0;d<this.options.length;d++)if(-1<this.options[d].originText.indexOf(a))return!0;return!1};a.prototype.searchConnectorById=function(a){if(this.output.outputId==a)return this.output;if(this.input.inputId==a)return this.input;for(var d=0;d<this.options.length;d++){var f=this.options[d];if(f.outputId==a)return f}return!1};a.prototype.cloneNodeJson=function(b,d,f){a.base.cloneNodeJson.call(this,b,d,f);b.input={text:"\u8f93\u5165"};b.output={text:"\u8f93\u51fa"};b.questionText=this.question.originText;b.questionVideoUrl=this.question.videoUrl;b.randomOptionY=this.randomOptionY?"Y":"N";b.answerRequired=this.answerRequired?"Y":"N";this.cloneOptionsJson(b)};a.prototype.cloneOptionsJson=function(a){for(var d=[],f=0;f<this.options.length;f++){var c={};c.text=this.options[f].originText;d.push(c)}a.options=d};a.prototype.validate=function(b){b||(b={isValid:!0,message:Prompt.QSNRD_Valid});a.base.validate.call(this,b);if(!b.isValid)return b;if(this.hasRepeatedDest())return b.isValid=!1,b.message=Prompt.QSNRD_InvalidOutputRepeat,b;if(this.isAllOptionOutputed()&&this.isMasterOutputed())return b.isValid=!1,b.message=Prompt.QSNRD_InvalidOutputConflict,b;this.question.originText.trim()||(b.isValid=!1,b.message=Prompt.QSNRD_InvalidNoQuestionText);return b};a.prototype.exportJson=function(b,d){a.base.exportJson.call(this,b,d);d.questionText=this.question.originText;d.questionVideoUrl=this.question.videoUrl;d.input={index:-2,uuid:this.input.inputId};d.output={index:-1,uuid:this.output.outputId};d.destList=this.collectDestList();d.randomOptionY=this.randomOptionY?"Y":"N";d.randomOption=this.randomOption?"Y":"N";d.optionHidden=this.optionHidden;d.circleNode1Id=this.getCircleNode1Id();d.circleNode2Id=this.getCircleNode2Id();d.typeText=this.extractTypeText();d.answerRequired=this.answerRequired?"Y":"N";this.exportOptionJson(d)};a.prototype.extractTypeText=function(){return""};a.prototype.exportOptionJson=function(a){a.options=this.collectOptions()};a.prototype.fixNodeSize=function(a){var d=$("#"+this.nodeUuid);d.find(".background_size").attr({width:this.getBackgroundWidth(),height:this.getBackgroundHeight()});d.find(".expansion_icon").attr("transform",this.getExpansionIconTransform());this instanceof ZYDesign.Class.SelectNode&&d.find(".line_t").attr({x1:this.lineT.getX1(),x2:this.lineT.getX2(),y1:this.lineT.getY1(),y2:this.lineT.getY2()});a&&this.fixOptionPosition()};a.prototype.fixOptionPosition=function(){for(var a=0;a<this.options.length;a++){var d=this.options[a],f=$("#"+d.outputId);f.find("rect").attr({x:d.getBlockX(),y:d.getBlockY()});f.find("circle").attr({cx:d.getCircleX(),cy:d.getCircleY()});f.find(".option_text").attr({x:d.getTextX(),y:d.getTextY()});f.find(".option_number").attr({x:30,y:d.getTextY()})}};a.prototype.toggleExpansion=function(a){this.optionHidden=!this.optionHidden;a&&(this.optionHidden?$("#"+this.nodeUuid).find(".expansion_hide").hide():$("#"+this.nodeUuid).find(".expansion_hide").show());this.fixNodeSize(!1)};a.prototype.dislocateOption=function(a,d,f){if(d!=f&&!("options"!=a&&"optionsX"!=a&&"optionsY"!=a||this instanceof ZYDesign.Class.MatrixNode&&"options"==a||0>d||0>f)){a=this[a];var c=a.length;d>=c||f>=c||(d=a.splice(d,1)[0],a.splice(f,0,d),this.maintainOption(),this.fixOptionPosition())}};a.prototype.searchNextNodesByOrder=function(){var a=[],d=[],f=this.options,c=this.output.dest;if(c&&c.exactType!=ZYDesign.Enum.CONNEXACTTYPE.LOOPEND){var h=c.parent;a.push(h);d.push(h)}for(c=0;c<f.length;c++)(h=f[c].dest)&&h.exactType!=ZYDesign.Enum.CONNEXACTTYPE.LOOPEND&&(h=h.parent,a.push(h),d.push(h));return{resultList:a,seedList:d}};return a}()})();(function(){var c=ZYDesign.Class;c.ToolNode=function(){function a(){this instanceof a&&(c.NodeBase.call(this),this.width=150,this.height=108,this.line=new ZYDesign.Class.LineModel(this,0),this.input=new ZYDesign.Class.InputConnector(this),this.output=new ZYDesign.Class.OutputConnector(this))}c.inheritPrototype(c.NodeBase,a);a.prototype.inputTextX=15;a.prototype.inputTextY=39;a.prototype.inputCircleX=0;a.prototype.inputCircleY=34;a.prototype.outputTextX=138;a.prototype.outputTextY=39;a.prototype.outputCircleX=150;a.prototype.outputCircleY=34;a.prototype.lineX1=0;a.prototype.lineY1=57;a.prototype.lineX2=150;a.prototype.lineY2=57;a.prototype.type=ZYDesign.Enum.NODETYPE.TOOL;a.prototype.categoryType=2;a.prototype.commonType=ZYDesign.Enum.NODECOMMONTYPE.TOOL;a.prototype.copyDisabled=!0;a.prototype.previewDisabled=!0;a.prototype.optionbatchDisabled=!0;a.prototype.mediaDisable=!0;a.prototype.nodeNameEditable=!1;a.prototype.getWarnIconTrasform=function(){return"translate(130, -20)"};a.prototype.init=function(b,d,f){a.base.init.call(this,b,d,f);this.initInput();this.initOutput()};a.prototype.initInput=function(){this.input.parent=this;this.input.text="\u8f93\u5165";this.originData.input.uuid&&(this.input.inputId=this.originData.input.uuid)};a.prototype.initOutput=function(){this.output.text="\u8f93\u51fa";this.originData.output.uuid&&(this.output.outputId=this.originData.output.uuid)};a.prototype.exportJson=function(b,d){a.base.exportJson.call(this,b,d);d.input={index:-2,uuid:this.input.inputId};d.output={index:-1,uuid:this.output.outputId};d.destList=this.collectDestList()};a.prototype.hasKeyword=function(b){return a.base.hasKeyword.call(this,b)?!0:!1};a.prototype.cloneNodeJson=function(b,d,f){a.base.cloneNodeJson.call(this,b,d,f);b.input={text:"\u8f93\u5165"};b.output={text:"\u8f93\u51fa"}};return a}()})();(function(){var c=ZYDesign.Class;c.SelectNode=function(){function a(){this instanceof a&&(c.SubjectNode.call(this),this.width=200,this.height=88,this.backgroundColor="#2980b9",this.multipleSelect=!1,this.multipleMax=1,this.multipleMin=0,this.lineT=new ZYDesign.Class.LineModel(this,3),this.useOtherOption=!1,this.otherOption=null)}c.inheritPrototype(c.SubjectNode,a);a.prototype.type=ZYDesign.Enum.NODETYPE.SELECT;a.prototype.typeInt=1;a.prototype.categoryType=3;a.prototype.typeListKey="selectNodes";a.prototype.addition=!0;a.prototype.outputTextChangable=!0;a.prototype.optionConstructor=ZYDesign.Class.SelectOptionConnector;a.prototype.typeName="\u9009\u62e9\u9898";a.prototype.typeIcon="ic_mc";a.prototype.getOtherOptionIconText=function(){return this.useOtherOption?"\u5220\u9664\u5176\u4ed6\u9009\u9879":"\u6dfb\u52a0\u5176\u4ed6\u9009\u9879"};a.prototype.isSingleSelect=function(){return!this.multipleSelect};a.prototype.isMultiSelect=function(){return this.multipleSelect};a.prototype.extractTypeText=function(){return this.multipleSelect?"\u9009\u62e9\u9898(\u591a\u9009)":"\u9009\u62e9\u9898(\u5355\u9009)"};a.prototype.initOption=function(b,d){b&&d&&(a.base.initOption.call(this,b,d),d.isOtherOption="Y"==b.extField_1?!0:!1,d.otherType=b.extField_2||1,d.fillRequired="Y"==b.extField_4?!0:!1,d.validateType=b.extField_5||1,d.validateStart=b.extField_6||1,d.validateEnd=b.extField_7||30,d.errorMsg=b.extField_10||"")};a.prototype.addOptionToList=function(a){if(a.isOtherOption)this.options.push(a),this.otherOption=a,this.useOtherOption=!0;else{for(var d=-1,f=0;f<this.options.length;f++){var c=this.options[f];0<=d&&f>d&&(c.index+=1);-1==d&&c.isOtherOption&&(a.index=f,this.options.splice(f,0,a),d=f)}-1==d&&this.options.push(a)}};a.prototype.cloneOptionsJson=function(a){for(var d=[],f=0;f<this.options.length;f++){var c=this.options[f],h={};h.text=c.originText;h.extField_1=c.isOtherOption?"Y":"N";h.extField_2=c.otherType;h.extField_4=c.fillRequired?"Y":"N";h.extField_5=c.validateType;h.extField_6=c.validateStart;h.extField_7=c.validateEnd;h.extField_10=c.errorMsg;d.push(h)}a.options=d};a.prototype.addOtherOption=function(){this.useOtherOption=!0;if(!this.hasOtherOption())return this.addOption({text:"\u5176\u4ed6",extField_1:"Y",extField_2:1,extField_4:"N",extField_5:1,extField_6:1,extField_7:50,extField_10:"\u8f93\u5165\u683c\u5f0f\u65e0\u6548\uff01"}),this.otherOption=this.options[this.options.length-1],this.fixNodeSize(),this.otherOption};a.prototype.removeOtherOption=function(){var a=null;this.hasOtherOption()&&(a=this.removeOption(this.otherOption));a&&(this.otherOption=null,this.useOtherOption=!1,this.fixNodeSize());return a};a.prototype.getNormalOptions=function(){for(var a=[],d=0;d<this.options.length;d++){var f=this.options[d];f.isOtherOption||a.push(f)}return a};a.prototype.getOtherOption=function(){if(this.hasOtherOption())return this.options[this.options.length-1]};a.prototype.hasOtherOption=function(){var a=this.options[this.options.length-1];return!(!a||!a.isOtherOption)};a.prototype.init=function(b,d,f){a.base.init.call(this,b,d,f);this.multipleSelect="Y"==this.originData.extField_1?!0:!1;this.multipleMin=this.originData.extField_2||1;this.multipleMax=this.originData.extField_3||2};a.prototype.exportJson=function(b,d){a.base.exportJson.call(this,b,d);d.extField_1=this.multipleSelect?"Y":"N";d.extField_2=parseInt(this.multipleMin);d.extField_3=parseInt(this.multipleMax);d.extField_4=this.useOtherOption?"Y":"N"};a.prototype.setOptionEnable=function(){this.isMultiSelect()?$("#"+this.nodeUuid+" .chart_options circle").attr("style","stroke: #34495e;fill: rgba(52, 73, 94, 0.49);"):$("#"+this.nodeUuid+" .chart_options circle").attr("style","")};a.prototype.collectOption=function(b,d){if(b&&d){var f=b.extractVariable()?"Y":"N";a.base.collectOption.call(this,b,d);d.extField_1=b.isOtherOption?"Y":"N";d.extField_2=b.otherType;d.extField_3=f;d.extField_4=b.fillRequired?"Y":"N";d.extField_5=b.validateType;d.extField_6=b.validateStart;d.extField_7=b.validateEnd;d.extField_10=b.errorMsg}};a.prototype.cloneNodeJson=function(b,d,f){a.base.cloneNodeJson.call(this,b,d,f);b.extField_1=this.multipleSelect?"Y":"N";b.extField_2=this.multipleMin;b.extField_3=this.multipleMax;b.addFnKey="addSelectNode"};a.prototype.isMultipleLegal=function(){if(!this.multipleSelect)return!0;var a=parseInt(this.multipleMin),d=parseInt(this.multipleMax);return isNaN(a+d)||0>a||0>d||d>this.options.length||a>d?!1:!0};a.prototype.isOtherTypeLegal=function(){if(!this.otherOption||3<this.otherOption.validateType)return!0;var a=parseInt(this.otherOption.validateStart),d=parseInt(this.otherOption.validateEnd);return isNaN(a+d)||0>a||0>d||a>d?!1:!0};a.prototype.validate=function(b){b||(b={isValid:!0,message:Prompt.QSNRD_Valid});a.base.validate.call(this,b);if(!b.isValid)return b;if(!this.isMultipleLegal())return b.isValid=!1,b.message=Prompt.QSNRD_InvalidMultiRangeError,b;if(!this.isOtherTypeLegal())return b.isValid=!1,b.message=Prompt.QSNRD_InvalidValidateRangeError,b;if(2>this.options.length)return b.isValid=!1,b.message=Prompt.QSNRD_OptionNotBelowTwo,b;for(var d=0;d<this.options.length;d++){var f=this.options[d];if(!f.number.toString()||!f.originText){b.isValid=!1;b.message=Prompt.QSNRD_InvalidIncompleteOption;break}for(var c=d+1;c<this.options.length;c++){var h=this.options[c];if(h.number==f.number||h.originText==f.originText)return b.isValid=!1,b.message=Prompt.QSNRD_InvalidConflictOption,b}}return b};a.prototype.toggleOtherOption=function(){var a={type:"add",option:null};this.useOtherOption?(a.type="remove",a.option=this.removeOtherOption()):(a.option=this.addOtherOption(),a.type="add");return a};a.prototype.removeOptionInRange=function(b,d){if(!(0>b||d>=this.options.length||b>d)){var f=this.hasOtherOption(),c=a.base.removeOptionInRange.call(this,b,d),h=this.hasOtherOption();f!=h&&(this.otherOption=null,this.useOtherOption=!1);return c}};return a}()})();(function(){var c=ZYDesign.Class;c.LogicNode=function(){function a(){this instanceof a&&(c.ToolNode.call(this),this.options=[],this.backgroundColor="#5e84aa")}c.inheritPrototype(c.ToolNode,a);a.prototype.optionTextXBase=138;a.prototype.optionTextYBase=82;a.prototype.optionCircleXBase=150;a.prototype.optionCircleYBase=77;a.prototype.optionLineHeight=30;a.prototype.type=ZYDesign.Enum.NODETYPE.LOGIC;a.prototype.typeInt=7;a.prototype.categoryType=2;a.prototype.typeListKey="logicNodes";a.prototype.typeName="\u903b\u8f91\u8282\u70b9";a.prototype.typeIcon="ic_logic";a.prototype.init=function(b,d,f){a.base.init.call(this,b,d,f);this.initOptions()};a.prototype.maintainOption=function(){for(var a=0;a<this.options.length;a++)this.options[a].index=a};a.prototype.getFormerSubjectList=function(){var a=[];this.searchFormerSubject(a,this);return a};a.prototype.searchFormerSubject=function(a,d){for(var f=d.input,c=0;c<f.sources.length;c++){var h=f.sources[c].parent;h.commonType!=ZYDesign.Enum.NODECOMMONTYPE.TERMINAL&&(h.commonType==ZYDesign.Enum.NODECOMMONTYPE.SUBJECT&&a.push(h),this.searchFormerSubject(a,h))}};a.prototype.addOption=function(a){var d=new ZYDesign.Class.LogicConnector(this);d.originText=a.text||"\u903b\u8f91"+(this.options.length+1);var f=a.requires;f&&0!=f.length||(f=[{arithmetic:0,limitType:0,answerFirst:"\u7b54\u6848\u4e00",answerSecond:"\u7b54\u6848\u4e8c"}]);d.initRequires(f);d.outputId=a.uuid?a.uuid:ZYDesign.UuidUtil.generate();d.index=a.index||0==a.index?a.index:this.options.length;this.options.push(d);this.maintainHeight();return d};a.prototype.maintainHeight=function(){this.height=78+30*this.options.length};a.prototype.removeOption=function(a){var d=a.index;this.options.splice(d,1);for(this.maintainHeight();d<this.options.length;d++)a=this.options[d],a.index-=1;this.fixNodeSize(!0);return a};a.prototype.initOptions=function(){var a=this.originData.logics;if(a)for(var d=0;d<a.length;d++)this.addOption(a[d])};a.prototype.hasKeyword=function(b){if(a.base.hasKeyword.call(this,b))return!0;for(var d=0;d<this.options.length;d++)if(-1<this.options[d].originText.indexOf(b))return!0;return!1};a.prototype.searchConnectorById=function(a){if(this.output.outputId==a)return this.output;if(this.input.inputId==a)return this.input;for(var d=0;d<this.options.length;d++){var f=this.options[d];if(f.outputId==a)return f}return!1};a.prototype.exportJson=function(b,d){a.base.exportJson.call(this,b,d);d.logics=this.collectOptions()};a.prototype.collectOptions=function(){if(!this.options||0==this.options.length)return null;for(var a=[],d=0;d<this.options.length;d++){var f=this.options[d],f={nodeType:this.typeInt,number:f.number,index:f.index,text:f.originText,uuid:f.outputId,requires:f.collectRequires()};a.push(f)}return a};a.prototype.cloneNodeJson=function(b,d,f){a.base.cloneNodeJson.call(this,b,d,f);b.addFnKey="addLogicNode"};a.prototype.validate=function(b){b||(b={isValid:!0,message:Prompt.QSNRD_Valid});a.base.validate.call(this,b);if(!b.isValid)return b;if(this.hasRepeatedDest())return b.isValid=!1,b.message=Prompt.QSNRD_InvalidOutputRepeat,b;if(this.isAllOptionOutputed()&&this.isMasterOutputed())return b.isValid=!1,b.message=Prompt.QSNRD_InvalidOutputConflict,b;0==this.getFormerSubjectList().length&&(b.isValid=!1,b.message=Prompt.QSNRD_InvalidNoSubjectToRelate);return b};a.prototype.searchNextNodesByOrder=function(){var a=[],d=[],f=this.options,c=this.output.dest;if(c){var h=c.parent;a.push(h);d.push(h)}for(c=0;c<f.length;c++)if(h=f[c].dest)h=h.parent,a.push(h),d.push(h);return{resultList:a,seedList:d}};return a}()})();(function(){var c=ZYDesign.Class;c.CheckNode=function(){function a(){this instanceof a&&(c.NodeBase.call(this),this.mode=3,this.output=new ZYDesign.Class.OutputConnector(this),this.backgroundColor="#97D700",this.width=150,this.height=64)}c.inheritPrototype(c.NodeBase,a);a.prototype.outputCircleX=150.5;a.prototype.outputCircleY=26;a.prototype.outputTextX=138.5;a.prototype.outputTextY=31;a.prototype.type=ZYDesign.Enum.NODETYPE.CHECK;a.prototype.commonType=ZYDesign.Enum.NODECOMMONTYPE.TERMINAL;a.prototype.typeInt=9;a.prototype.categoryType=2;a.prototype.typeListKey="checkNodes";a.prototype.copyDisabled=!0;a.prototype.removeDisabled=!0;a.prototype.previewDisabled=!0;a.prototype.optionbatchDisabled=!0;a.prototype.mediaDisable=!0;a.prototype.nodeNameEditable=!1;a.prototype.getWarnIconTrasform=function(){return"translate(130, -20)"};a.prototype.getSmallBgX=function(){return 2};a.prototype.getSmallBgY=function(){return 2};a.prototype.getSmallBgWidth=function(){return 75};a.prototype.getSmallBgHeight=function(){return 46};a.prototype.getSmallBgTxtX=function(){return 10};a.prototype.getSmallBgTxtY=function(){return 33};a.prototype.getSmallBgTxt=function(){return"Check"};a.prototype.initOutput=function(){this.originData.output&&this.originData.output.uuid&&(this.output.outputId=this.originData.output.uuid)};a.prototype.init=function(b,d,f){a.base.init.call(this,b,d,f);this.initOutput()};a.prototype.exportJson=function(b,d){a.base.exportJson.call(this,b,d);d.mode=0;d.commonMode=0;d.output={index:-1,uuid:this.output.outputId};d.destList=this.collectDestList()};a.prototype.searchConnectorById=function(a){return this.output.outputId==a?this.output:!1};a.prototype.cloneNodeJson=function(b,d,f){a.base.cloneNodeJson.call(this,b,d,f);b.output={text:"\u8f93\u51fa"};b.addFnKey="addCheckNode"};a.prototype.getCtrIconTransform=function(){return"translate(-2,"+this.getBackgroundHeight()+")"};a.prototype.getEngagement=function(){return{status:ZYDesign.Enum.NODESTATE.NORMAL,dueToNode:null}};a.prototype.hasDeadInput=function(){return!1};a.prototype.hasDeadOutput=function(){return this.output.dest?!1:!0};return a}()})();(function(){var c=ZYDesign.Class;c.CommentNode=function(){function a(){this instanceof a&&(c.NodeBase.call(this),this.width=200,this.height=80,this.line=new ZYDesign.Class.LineModel(this,0),this.backgroundColor="#f1c40f",this.commentText="\u6ce8\u91ca",this.commentTexts=[])}c.inheritPrototype(c.NodeBase,a);a.prototype.lineX1=0;a.prototype.lineY1=30;a.prototype.lineX2=200;a.prototype.lineY2=30;a.prototype.lineBaseY=45;a.prototype.lineHeight=20;a.prototype.typeListKey="commentNodes";a.prototype.type=ZYDesign.Enum.NODETYPE.COMMENT;a.prototype.typeInt=11;a.prototype.categoryType=1;a.prototype.typeName="\u5907\u6ce8\u8282\u70b9";a.prototype.typeIcon="";a.prototype.mediaDisable=!0;a.prototype.nodeNameEditable=!1;a.prototype.updateTexts=function(){var a=this.commentTexts.length;if(this.commentText==this.updateTexts.formerText)return this.commentTexts;this.updateTexts.formerText=this.commentText;this.commentTexts=ZYDesign.TextUtil.divideStringByWidth(160,originText,13);this.height=55+this.commentTexts.length*this.lineHeight;a!=this.commentTexts.length&&$("#"+this.nodeUuid).find(".background_size").attr({width:this.getBackgroundWidth(),height:this.getBackgroundHeight()});return this.commentTexts};a.prototype.init=function(b,d,f){a.base.init.call(this,b,d,f);this.commentText=b.commentText;this.updateTexts()};a.prototype.getBackgroundHeight=function(){return this.getHeight()-14};a.prototype.getEngagement=function(){return{status:ZYDesign.Enum.NODESTATE.FREE,dueToNode:null}};a.prototype.exportJson=function(b,d){a.base.exportJson.call(this,b,d);d.commentText=this.commentText};a.prototype.validate=function(){return{isValid:!0,message:Prompt.QSNRD_Valid}};a.prototype.hasKeyword=function(b){return a.base.hasKeyword.call(this,b)||-1<this.commentText.indexOf(b)?!0:!1};return a}()})();(function(){var c=ZYDesign.Class;c.EndNode=function(){function a(){this instanceof a&&(c.NodeBase.call(this),this.mode=3,this.input=new ZYDesign.Class.InputConnector(this),this.question=new ZYDesign.Class.QuestionModel(this),this.backgroundColor="#d44637",this.width=150,this.height=64,this.linkUrl="")}c.inheritPrototype(c.NodeBase,a);a.prototype.inputCircleX=0;a.prototype.inputCircleY=26;a.prototype.inputTextX=14;a.prototype.inputTextY=31;a.prototype.type=ZYDesign.Enum.NODETYPE.END;a.prototype.commonType=ZYDesign.Enum.NODECOMMONTYPE.TERMINAL;a.prototype.typeInt=10;a.prototype.categoryType=2;a.prototype.typeListKey="endNodes";a.prototype.differHeight=0;a.prototype.previewDisabled=!0;a.prototype.optionbatchDisabled=!0;a.prototype.typeName="\u7ed3\u675f\u8282\u70b9";a.prototype.typeIcon="";a.prototype.nodeNameEditable=!1;a.prototype.describeText="\u7ed3\u675f\u63cf\u8ff0";a.prototype.getWarnIconTrasform=function(){return"translate(130, -20)"};a.prototype.getSmallBgX=function(){return 73};a.prototype.getSmallBgY=function(){return 2};a.prototype.getSmallBgWidth=function(){return 75};a.prototype.getSmallBgHeight=function(){return 46};a.prototype.getSmallBgTxtX=function(){return 93};a.prototype.getSmallBgTxtY=function(){return 33};a.prototype.getSmallBgTxt=function(){return"End"};a.prototype.getCtrIconTransform=function(){return"translate(-2,"+this.getBackgroundHeight()+")"};a.prototype.initInput=function(){this.input.parent=this;this.originData.input&&this.originData.input.uuid&&(this.input.inputId=this.originData.input.uuid)};a.prototype.init=function(b,d,f){a.base.init.call(this,b,d,f);this.initInput();this.initQuestion();this.linkUrl=b.linkUrl||""};a.prototype.initQuestion=function(){var a=this.originData;this.question.originText=a.questionText||"";this.question.videoUrl=a.questionVideoUrl||""};a.prototype.exportJson=function(b,d){a.base.exportJson.call(this,b,d);d.questionText=this.question.originText;d.questionVideoUrl=this.question.videoUrl;d.input={index:-2,uuid:this.input.inputId};d.linkUrl=this.linkUrl};a.prototype.searchConnectorById=function(a){return this.input.inputId==a?this.input:!1};a.prototype.cloneNodeJson=function(b,d,f){a.base.cloneNodeJson.call(this,b,d,f);b.input={text:"\u8f93\u5165"};b.addFnKey="addEndNode";b.questionText=this.question.originText;b.questionVideoUrl=this.question.videoUrl;b.linkUrl=this.linkUrl};a.prototype.getEngagement=function(){return{status:ZYDesign.Enum.NODESTATE.NORMAL,dueToNode:null}};a.prototype.hasDeadInput=function(){return 0==this.input.sources.length?!0:!1};a.prototype.hasDeadOutput=function(){return!1};a.prototype.validate=function(b){b||(b={isValid:!0,message:Prompt.QSNRD_Valid});a.base.validate.call(this,b);if(!b.isValid)return b;this.question.originText||(b.isValid=!1,b.message=Prompt.QSNRD_InvalidNoQuestionText);return b};a.prototype.hasKeyword=function(b){return a.base.hasKeyword.call(this,b)||-1<this.question.originText.indexOf(b)?!0:!1};return a}()})();(function(){var c=ZYDesign.Class;c.FillblankNode=function(){function a(){this instanceof a&&(c.SubjectNode.call(this),this.backgroundColor="#d47d00",this.width=200,this.height=88,this.validateType=1,this.validateStart=0,this.validateEnd=30,this.errorMsg="")}c.inheritPrototype(c.SubjectNode,a);a.prototype.type=ZYDesign.Enum.NODETYPE.FILL;a.prototype.typeInt=4;a.prototype.categoryType=3;a.prototype.typeListKey="fillblankNodes";a.prototype.addition=!0;a.prototype.typeName="\u586b\u7a7a\u9898";a.prototype.typeIcon="ic_the_blanks";a.prototype.optionConstructor=ZYDesign.Class.FillOptionConnector;a.prototype.init=function(b,d,f){a.base.init.call(this,b,d,f);this.validateType=this.originData.extField_1||1;this.validateStart=this.originData.extField_2||0;this.validateEnd=this.originData.extField_3||30;this.errorMsg=this.originData.extField_10||""};a.prototype.exportJson=function(b,d){a.base.exportJson.call(this,b,d);d.extField_1=this.validateType;d.extField_2=this.validateStart;d.extField_3=this.validateEnd;d.extField_10=this.errorMsg};a.prototype.cloneNodeJson=function(b,d,f){a.base.cloneNodeJson.call(this,b,d,f);b.extField_1=this.validateType;b.extField_2=this.validateStart;b.extField_3=this.validateEnd;b.extField_10=this.errorMsg;b.answerRequired=this.answerRequired?"Y":"N";b.addFnKey="addFillblankNode"};a.prototype.extractTypeText=function(){return"\u586b\u7a7a\u9898"};a.prototype.isValidateRangeLegal=function(){if(3<this.validateType)return!0;var a=parseInt(this.validateStart),d=parseInt(this.validateEnd);return isNaN(a+d)||0>a||0>d||a>d?!1:!0};a.prototype.validate=function(b){b||(b={isValid:!0,message:Prompt.QSNRD_Valid});a.base.validate.call(this,b);if(!b.isValid)return b;if(!this.isValidateRangeLegal())return b.isValid=!1,b.message=Prompt.QSNRD_InvalidValidateRangeError,b;1>this.options.length&&(b.isValid=!1,b.message=Prompt.QSNRD_OptionNotExist);return b};return a}()})();(function(){var c=ZYDesign.Class;c.InfoNode=function(){function a(){this instanceof a&&(c.SubjectNode.call(this),this.mode=1,this.width=200,this.height=88,this.backgroundColor="#00A3E0")}c.inheritPrototype(c.SubjectNode,a);a.prototype.categoryType=4;a.prototype.commonType=ZYDesign.Enum.NODECOMMONTYPE.INFO;a.prototype.copyDisabled=!0;a.prototype.previewDisabled=!0;a.prototype.optionbatchDisabled=!0;a.prototype.outputTextChangable=!0;a.prototype.mediaDisable=!0;a.prototype.exportJson=function(b,d){a.base.exportJson.call(this,b,d)};return a}();c.RegionNode=function(){function a(){this instanceof a&&c.InfoNode.call(this)}c.inheritPrototype(c.InfoNode,a);a.prototype.type=ZYDesign.Enum.NODETYPE.REGION;a.prototype.typeInt=13;a.prototype.typeListKey="regionNodes";a.prototype.optionConstructor=ZYDesign.Class.RegionOptionConnector;a.prototype.typeName="\u5730\u57df\u8282\u70b9";a.prototype.typeIcon="";a.prototype.collectOption=function(b,d){b&&d&&(a.base.collectOption.call(this,b,d),d.extField_1=b.provinceId,d.extField_2=b.cityId,d.extField_3=b.countyId)};a.prototype.initOption=function(b,d){b&&d&&(a.base.initOption.call(this,b,d),d.provinceId=void 0==b.extField_1?0:b.extField_1,d.cityId=void 0==b.extField_2?0:b.extField_2,d.countyId=void 0==b.extField_3?0:b.extField_3)};return a}();c.GenderNode=function(){function a(){this instanceof a&&c.InfoNode.call(this)}c.inheritPrototype(c.InfoNode,a);a.prototype.type=ZYDesign.Enum.NODETYPE.GENDER;a.prototype.typeInt=14;a.prototype.typeListKey="genderNodes";a.prototype.optionConstructor=ZYDesign.Class.GenderOptionConnector;a.prototype.typeName="\u6027\u522b\u8282\u70b9";a.prototype.typeIcon="";a.prototype.collectOption=function(b,d){b&&d&&(a.base.collectOption.call(this,b,d),d.extField_1=b.genderId)};a.prototype.initOption=function(b,d){b&&d&&(a.base.initOption.call(this,b,d),d.genderId=void 0==b.extField_1?0:b.extField_1)};return a}();c.AgeGroupNode=function(){function a(){this instanceof a&&c.InfoNode.call(this)}c.inheritPrototype(c.InfoNode,a);a.prototype.type=ZYDesign.Enum.NODETYPE.AGEGROUP;a.prototype.typeInt=15;a.prototype.typeListKey="ageGroupNodes";a.prototype.optionConstructor=ZYDesign.Class.AgeGroupOptionConnector;a.prototype.typeName="\u5e74\u9f84\u8282\u70b9";a.prototype.typeIcon="";a.prototype.collectOption=function(b,d){b&&d&&(a.base.collectOption.call(this,b,d),d.extField_1=b.startAgeGroupId,d.extField_2=b.endAgeGroupId)};a.prototype.initOption=function(b,d){b&&d&&(a.base.initOption.call(this,b,d),d.startAgeGroupId=void 0==b.extField_1?0:b.extField_1,d.endAgeGroupId=void 0==b.extField_2?0:b.extField_2)};return a}();c.MaritalStatusNode=function(){function a(){this instanceof a&&c.InfoNode.call(this)}c.inheritPrototype(c.InfoNode,a);a.prototype.type=ZYDesign.Enum.NODETYPE.MARITALSTATUS;a.prototype.typeInt=16;a.prototype.typeListKey="maritalStatusNodes";a.prototype.optionConstructor=ZYDesign.Class.MaritalOptionConnector;a.prototype.typeName="\u5a5a\u59fb\u8282\u70b9";a.prototype.typeIcon="";a.prototype.collectOption=function(b,d){b&&d&&(a.base.collectOption.call(this,b,d),d.extField_1=b.maritalStatusId)};a.prototype.initOption=function(b,d){b&&d&&(a.base.initOption.call(this,b,d),d.maritalStatusId=void 0==b.extField_1?0:b.extField_1)};return a}();c.EduStatusNode=function(){function a(){this instanceof a&&c.InfoNode.call(this)}c.inheritPrototype(c.InfoNode,a);a.prototype.type=ZYDesign.Enum.NODETYPE.EDUSTATUS;a.prototype.typeInt=17;a.prototype.typeListKey="eduStatusNodes";a.prototype.optionConstructor=ZYDesign.Class.EduOptionConnector;a.prototype.typeName="\u5b66\u5386\u8282\u70b9";a.prototype.typeIcon="";a.prototype.collectOption=function(b,d){b&&d&&(a.base.collectOption.call(this,b,d),d.extField_1=b.eduStatusId)};a.prototype.initOption=function(b,d){b&&d&&(a.base.initOption.call(this,b,d),d.eduStatusId=void 0==b.extField_1?0:b.extField_1)};return a}();c.OccupationNode=function(){function a(){this instanceof a&&c.InfoNode.call(this)}c.inheritPrototype(c.InfoNode,a);a.prototype.type=ZYDesign.Enum.NODETYPE.OCCUPATION;a.prototype.typeInt=18;a.prototype.typeListKey="occupationNodes";a.prototype.optionConstructor=ZYDesign.Class.OccupationOptionConnector;a.prototype.typeName="\u804c\u4e1a\u8282\u70b9";a.prototype.typeIcon="";a.prototype.collectOption=function(b,d){b&&d&&(a.base.collectOption.call(this,b,d),d.extField_1=b.occupationId)};a.prototype.initOption=function(b,d){b&&d&&(a.base.initOption.call(this,b,d),d.occupationId=void 0==b.extField_1?0:b.extField_1,d.getOccupation=function(){return ZYDesign.Dict.getOccupationById(this.occupationId)},d.getShowText=function(){this.originText="";var a=this.getOccupation();a&&(this.originText+=a.text);a=143;1>ZYDesign.DesignManager.chartZoomRate&&(a=Math.round(a*ZYDesign.DesignManager.chartZoomRate));return ZYDesign.TextUtil.getEllipsisByWidth(a,this.originText,13)})};return a}();c.ProfessionNode=function(){function a(){this instanceof a&&c.InfoNode.call(this)}c.inheritPrototype(c.InfoNode,a);a.prototype.type=ZYDesign.Enum.NODETYPE.PROFESSION;a.prototype.typeInt=19;a.prototype.typeListKey="professionNodes";a.prototype.optionConstructor=ZYDesign.Class.ProfessionOptionConnector;a.prototype.typeName="\u884c\u4e1a\u8282\u70b9";a.prototype.typeIcon="";a.prototype.collectOption=function(b,d){b&&d&&(a.base.collectOption.call(this,b,d),d.extField_1=b.professionId)};a.prototype.initOption=function(b,d){b&&d&&(a.base.initOption.call(this,b,d),d.professionId=void 0==b.extField_1?0:b.extField_1)};return a}();c.JobTitleNode=function(){function a(){this instanceof a&&c.InfoNode.call(this)}c.inheritPrototype(c.InfoNode,a);a.prototype.type=ZYDesign.Enum.NODETYPE.JOBTITLE;a.prototype.typeInt=20;a.prototype.typeListKey="jobTitleNodes";a.prototype.optionConstructor=ZYDesign.Class.JobTitleOptionConnector;a.prototype.typeName="\u804c\u4f4d\u8282\u70b9";a.prototype.typeIcon="";a.prototype.collectOption=function(b,d){b&&d&&(a.base.collectOption.call(this,b,d),d.extField_1=b.jobTitleId)};a.prototype.initOption=function(b,d){b&&d&&(a.base.initOption.call(this,b,d),d.jobTitleId=void 0==b.extField_1?0:b.extField_1)};return a}();c.IncomeNode=function(){function a(){this instanceof a&&c.InfoNode.call(this)}c.inheritPrototype(c.InfoNode,a);a.prototype.type=ZYDesign.Enum.NODETYPE.INCOME;a.prototype.typeInt=21;a.prototype.typeListKey="incomeNodes";a.prototype.optionConstructor=ZYDesign.Class.IncomeOptionConnector;a.prototype.typeName="\u6536\u5165\u8282\u70b9";a.prototype.typeIcon="";a.prototype.collectOption=function(b,d){b&&d&&(a.base.collectOption.call(this,b,d),d.extField_1=b.incomeStartId,d.extField_2=b.incomeEndId)};a.prototype.initOption=function(b,d){b&&d&&(a.base.initOption.call(this,b,d),d.incomeStartId=void 0==b.extField_1?0:b.extField_1,d.incomeEndId=void 0==b.extField_2?0:b.extField_2)};return a}();c.FamilyIncomeNode=function(){function a(){this instanceof a&&c.InfoNode.call(this)}c.inheritPrototype(c.InfoNode,a);a.prototype.type=ZYDesign.Enum.NODETYPE.FAMILYINCOME;a.prototype.typeInt=22;a.prototype.typeListKey="familyIncomeNodes";a.prototype.optionConstructor=ZYDesign.Class.IncomeOptionConnector;a.prototype.typeName="\u5bb6\u5ead\u6536\u5165\u8282\u70b9";a.prototype.typeIcon="";a.prototype.collectOption=function(b,d){b&&d&&(a.base.collectOption.call(this,b,d),d.extField_1=b.incomeStartId,d.extField_2=b.incomeEndId)};a.prototype.initOption=function(b,d){b&&d&&(a.base.initOption.call(this,b,d),d.incomeStartId=void 0==b.extField_1?0:b.extField_1,d.incomeEndId=void 0==b.extField_2?0:b.extField_2)};return a}()})();(function(){var c=ZYDesign.Class;c.LoopNode=function(){function a(){this instanceof a&&(c.ToolNode.call(this),this.loopStart=new ZYDesign.Class.LoopStartConnector(this),this.loopEnd=new ZYDesign.Class.LoopEndConnector(this),this.backgroundColor="#6b5eaa",this.options=this.loopVariables=[])}c.inheritPrototype(c.ToolNode,a);a.prototype.loopStartTextX=15;a.prototype.loopStartTextY=79;a.prototype.loopStartCircleX=0;a.prototype.loopStartCircleY=74;a.prototype.loopEndTextX=138;a.prototype.loopEndTextY=79;a.prototype.loopEndCircleX=150;a.prototype.loopEndCircleY=74;a.prototype.type=ZYDesign.Enum.NODETYPE.LOOP;a.prototype.typeInt=8;a.prototype.categoryType=2;a.prototype.typeListKey="loopNodes";a.prototype.typeName="\u5faa\u73af\u8282\u70b9";a.prototype.typeIcon="ic_loop";a.prototype.createVariable=function(){if(this.originData.variables)for(var a=0;a<this.originData.variables.length;a++)this.loopVariables.push(this.originData.variables[a])};a.prototype.addOption=function(a){this.addVariable(a.text,a.number)};a.prototype.removeOption=function(a){var d=a.index;this.options.splice(d,1);for(this.maintainHeight();d<this.options.length;d++)a=this.options[d],a.index-=1;this.fixNodeSize(!0);return a};a.prototype.addVariable=function(a,d){var f={originText:a||"",number:d||this.loopVariables.length+1,outputId:ZYDesign.UuidUtil.generate(),index:this.loopVariables.length};this.loopVariables.push(f)};a.prototype.removeVariable=function(a){for(var d=0;d<this.loopVariables.length;d++)this.loopVariables[d]==a&&this.loopVariables.splice(d,1)};a.prototype.getSourceVariables=function(){for(var a=null,d=this.input.sources,f=0;f<d.length;f++){var c=d[f];if(c.parent.type==ZYDesign.Enum.NODETYPE.SELECT&&c.parent.multipleSelect){a=c;break}}if(!a)return[];d=[];a=a.parent.options;for(f=0;f<a.length;f++)c=a[f],c.extractVariable()&&d.push(c);return d};a.prototype.collectLoopNodes=function(){var a={from:this,dead:!1,tempList:[],nodeList:[],roundDone:function(a){if(a==this.from)return!0;for(var b=0;b<this.nodeList.length;b++)if(this.nodeList[b]==a)return!0;return!1}};this.searchNodesInLoopCircle(this.loopEnd.sources,a);return a.nodeList};a.prototype.searchNodesInLoopCircle=function(a,d){for(var f=0;f<a.length;f++){var c=a[f].parent;d.roundDone(c)?(d.nodeList=d.nodeList.concat(d.tempList),d.tempList=[],d.dead=!1):(d.tempList.push(c),0<c.input.sources.length?(this.searchNodesInLoopCircle(c.input.sources,d),d.dead&&(f!=a.length-1?d.dead=!1:(d.dead=!0,d.tempList.splice(d.tempList.length-1,1)))):(d.tempList.splice(d.tempList.length-1,1),d.dead=!0))}};a.prototype.init=function(b,d,f){a.base.init.call(this,b,d,f);this.initLoopStart();this.initLoopEnd();this.createVariable()};a.prototype.initLoopStart=function(){this.loopStart.text="\u5faa\u73af\u5f00\u59cb";this.originData.loopStart.uuid&&(this.loopStart.outputId=this.originData.loopStart.uuid)};a.prototype.initLoopEnd=function(){this.loopEnd.text="\u5faa\u73af\u7ed3\u675f";this.originData.loopEnd.uuid&&(this.loopEnd.inputId=this.originData.loopEnd.uuid)};a.prototype.searchConnectorById=function(a){return this.output.outputId==a?this.output:this.input.inputId==a?this.input:this.loopStart.outputId==a?this.loopStart:this.loopEnd.inputId==a?this.loopEnd:!1};a.prototype.exportJson=function(b,d){a.base.exportJson.call(this,b,d);for(var f="",c=0;c<this.input.sources.length;c++){var h=this.input.sources[c];if(h.parent.type==ZYDesign.Enum.NODETYPE.SELECT&&h.parent.multipleSelect){f=h.parent.nodeUuid;break}}d.circleNode1Id=this.getCircleNode1Id();d.circleNode2Id=this.getCircleNode2Id();d.loopEnd={index:-3,uuid:this.loopEnd.inputId};d.loopStart={index:-4,uuid:this.loopStart.outputId};d.options=this.collectOptions();d.variables=this.loopVariables;d.extField_1=f};a.prototype.collectOptions=function(){for(var a=[],d=0;d<this.options.length;d++){var f=this.options[d];a.push({text:f.originText,number:f.number,uuid:f.outputId,index:f.index,nodeType:this.typeInt,typeFlag:0})}return a};a.prototype.cloneNodeJson=function(b,d,f){a.base.cloneNodeJson.call(this,b,d,f);b.addFnKey="addLoopNode";b.loopStart={text:"\u5faa\u73af\u5f00\u59cb"};b.loopEnd={text:"\u5faa\u73af\u7ed3\u675f"}};a.prototype.validate=function(b){b||(b={isValid:!0,message:Prompt.QSNRD_Valid});a.base.validate.call(this,b);if(!b.isValid)return b;if(0==this.collectLoopNodes().length)return b.isValid=!1,b.message=Prompt.QSNRD_InvalidNoLoopCircle,b;if(0==this.loopVariables.length&&0==this.getSourceVariables().length)return b.isValid=!1,b.message=Prompt.QSNRD_InvalidNoLoopVariable,b;if(!this.isUniqueSourceVariable())return b.isValid=!1,b.message=Prompt.QSNRD_InvalidOnlyMultiToLoop,b;if(this.getEngageStatus()==ZYDesign.Enum.NODESTATE.LOOP&&this.getEngageDueToNode().getEngageStatus()==ZYDesign.Enum.NODESTATE.LOOP)return b.isValid=!1,b.message=Prompt.QSNRD_InvalidLoopMoreThanTwoFloor,b;for(var d=[],d=d.concat(this.options),d=d.concat(this.getSourceVariables()),f=0;f<d.length;f++){var c=d[f];if(!c.number||!c.originText){b.isValid=!1;b.message=Prompt.QSNRD_InvalidIncompleteVariable;break}for(var h=f+1;h<d.length;h++){var l=d[h];if(l.number==c.number||l.originText==c.originText)return b.isValid=!1,b.message=Prompt.QSNRD_InvalidVariableConflict,b}}return b};a.prototype.isUniqueSourceVariable=function(){return!(1>=this.input.sources.length)&&0<this.getSourceVariables().length?!1:!0};a.prototype.hasKeyword=function(b){if(a.base.hasKeyword.call(this,b))return!0;for(var d=0;d<this.loopVariables.length;d++)if(-1<this.loopVariables[d].originText.indexOf(b))return!0;return!1};a.prototype.searchNextNodesByOrder=function(){var a=[],d=this.loopStart.dest.parent,f=[d],d=[d],c=0,h=d.length;do{for(;c<h;c++){for(var l=d[c].searchNextNodesByOrder(),p=0;p<l.resultList.length;p++){var k=l.resultList[p];0>f.indexOf(k)&&f.push(k)}for(p=0;p<l.seedList.length;p++)k=l.seedList[p],0>d.indexOf(k)&&d.push(k)}c=h;h=d.length}while(h>c);(d=this.output.dest)&&d.exactType!=ZYDesign.Enum.CONNEXACTTYPE.LOOPEND&&(d=d.parent,f.push(d),a.push(d));return{resultList:f,seedList:a}};return a}()})();(function(){var c=ZYDesign.Class,a=ZYDesign.Hinter;c.MarkingNode=function(){function b(){this instanceof b&&(c.SubjectNode.call(this),this.width=200,this.height=88,this.backgroundColor="#9153aa",this.markType=2,this.showMarkValueDescribe=this.showMarkValue=!1,this.defaultMark=5,this.markMax=10,this.markMin=0,this.maxText=this.midText=this.minText="",this.markImgCode=1,this.markImgCount=5,this.markTxtList=[])}c.inheritPrototype(c.SubjectNode,b);var d=b.base;b.prototype.type=ZYDesign.Enum.NODETYPE.MARK;b.prototype.typeInt=2;b.prototype.categoryType=3;b.prototype.typeListKey="markingNodes";b.prototype.optionConstructor=ZYDesign.Class.MarkOptionConnector;b.prototype.typeName="\u6253\u5206\u9898";b.prototype.typeIcon="";b.prototype.exportJson=function(a,b){d.exportJson.call(this,a,b);b.extField_1=this.markType;if(1==this.markType){b.extField_2=this.markMin;b.extField_3=this.markMax;if(b.markValueDescribeFlag=this.showMarkValueDescribe)b.extField_4=this.minText,b.extField_5=this.midText,b.extField_6=this.maxText;b.extField_7=this.showMarkValue?"Y":"N";b.extField_8=this.defaultMark}else if(2==this.markType)b.extField_2=this.markImgCode,b.extField_3=this.markImgCount;else if(3==this.markType)for(var c=0;c<this.markTxtList.length;c++)b["extField_"+(c+2)]=this.markTxtList[c].text};b.prototype.init=function(a,b,c){d.init.call(this,a,b,c);this.markType=this.originData.extField_1||2;if(1==this.markType)this.markMin=this.originData.extField_2||0,this.markMax=this.originData.extField_3||10,this.minText=this.originData.extField_4||"",this.midText=this.originData.extField_5||"",this.maxText=this.originData.extField_6||"",this.showMarkValue="Y"==this.originData.extField_7?!0:!1,this.showMarkValueDescribe=this.originData.markValueDescribeFlag,this.defaultMark=this.originData.extField_8||5;else if(2==this.markType)this.markImgCode=this.originData.extField_2||1,this.markImgCount=this.originData.extField_3||5;else if(3==this.markType)for(a=2;7>a;a++)(b=this.originData["extField_"+a])&&this.markTxtList.push({text:b})};b.prototype.cloneNodeJson=function(a,b,c){d.cloneNodeJson.call(this,a,b,c);a.extField_1=this.markType;if(1==this.markType)a.extField_2=this.markMin,a.extField_3=this.markMax,a.extField_4=this.minText,a.extField_5=this.midText,a.extField_6=this.maxText;else if(2==this.markType)a.extField_2=this.markImgCode,a.extField_3=this.markImgCount;else if(3==this.markType)for(b=0;b<this.markTxtList.length;b++)a["extField_"+(b+2)]=this.markTxtList[b].text;a.addFnKey="addMarkingNode"};b.prototype.extractTypeText=function(){return"\u6253\u5206\u9898"};b.prototype.addMarkItem=function(){5==this.markTxtList.length?a.hint(Prompt.QSNRD_MarkItemMoreThanFive):this.markTxtList.push({text:""})};b.prototype.removeMarkItem=function(a){a=this.markTxtList.indexOf(a);0<=a&&this.markTxtList.splice(a,1)};b.prototype.validateMarkValue=function(a){a=a||{};if(1==this.markType)if(this.markMin>=this.markMax)a.isValid=!1,a.message=Prompt.QSNRD_WrongMarkValue;else if(this.defaultMark<this.markMin||this.defaultMark>this.markMax)a.isValid=!1,a.message=Prompt.QSNRD_DefaultMarkBeyond};b.prototype.validateMarkText=function(a){a=a||{};if(3==this.markType)if(2>this.markTxtList.length&&3==this.markType)a.isValid=!1,a.message=Prompt.QSNRD_MarkItemLowThanTwo;else{for(var b=!0,d=0;d<this.markTxtList.length;d++){var c=this.markTxtList[d];if(!c.text){b=!1;break}for(var p=d+1;p<this.markTxtList.length;p++)if(c.text==this.markTxtList[p].text){b=!1;break}if(!b)break}b||(a.isValid=!1,a.message=Prompt.QSNRD_WrongMarkText)}};b.prototype.validate=function(a){a||(a={isValid:!0,message:Prompt.QSNRD_Valid});d.validate.call(this,a);if(!a.isValid)return a;if(1>this.options.length)return a.isValid=!1,a.message=Prompt.QSNRD_OptionNotExist,a;this.validateMarkValue(a);if(!a.isValid)return a;this.validateMarkText(a);if(!a.isValid)return a;for(var b=0;b<this.options.length;b++){var c=this.options[b];if(!c.number.toString()||!c.originText){a.isValid=!1;a.message=Prompt.QSNRD_InvalidIncompleteOption;break}for(var l=b+1;l<this.options.length;l++){var p=this.options[l];if(p.number==c.number||p.originText==c.originText)return a.isValid=!1,a.message=Prompt.QSNRD_InvalidConflictOption,a}}return a};return b}()})();(function(){var c=ZYDesign.Class;c.MatrixNode=function(){function a(){this instanceof a&&(c.SubjectNode.call(this),this.width=422,this.height=279,this.backgroundColor="#2693aa",this.optionsX=[],this.optionsY=[],this.line=new ZYDesign.Class.LineModel(this,0),this.hLine=new ZYDesign.Class.LineModel(this,1),this.vLine=new ZYDesign.Class.LineModel(this,2),this.optionXName="\u5217\u9009\u9879",this.optionYName="\u884c\u9009\u9879",this.selectTypeLimit=this.matrixType=0,this.multipleMax=1,this.multipleMin=0,this.markMax=1,this.markMin=0,this.markMaxComment=this.markMinComment="",this.loopOptionY=this.loopOptionX=!1)}c.inheritPrototype(c.SubjectNode,a);a.prototype.type=ZYDesign.Enum.NODETYPE.MATRIX;a.prototype.typeInt=5;a.prototype.categoryType=3;a.prototype.optionWidth=41.8;a.prototype.lineX1=217.757;a.prototype.lineY1=218;a.prototype.lineX2=418.845;a.prototype.lineY2=218;a.prototype.hLineX1=166.443;a.prototype.hLineX2=217.301;a.prototype.hLineY1=290.58;a.prototype.hLineY2=290.58;a.prototype.vLineX1=321.113;a.prototype.vLineX2=321.113;a.prototype.vLineY1=111.982;a.prototype.vLineY2=157.337;a.prototype.optionsXTitleX=268.8;a.prototype.optionsXTitleY=25;a.prototype.optionsYTitleX=10;a.prototype.optionsYTitleY=268;a.prototype.optionsXTextX=268.8;a.prototype.optionsXTextY=40;a.prototype.optionsYTextX=35;a.prototype.optionsYTextY=268;a.prototype.optionCircleXBase=276.8;a.prototype.optionCircleYBase=264;a.prototype.inputTextX=233;a.prototype.inputTextY=208;a.prototype.inputCircleX=218;a.prototype.inputCircleY=200;a.prototype.outputTextX=404;a.prototype.outputTextY=208;a.prototype.outputCircleX=418;a.prototype.outputCircleY=200;a.prototype.questionX=228;a.prototype.questionY=178;a.prototype.typeListKey="matrixNodes";a.prototype.addition=!0;a.prototype.outputTextChangable=!0;a.prototype.optionConstructor=ZYDesign.Class.MatrixOptionConnector;a.prototype.typeName="\u77e9\u9635\u9898";a.prototype.typeIcon="ic_matrix";a.prototype.TypeDic=[{id:0,value:"\u9009\u62e9\u9898"},{id:1,value:"\u6253\u5206\u9898"}];a.prototype.SelectDic=[{id:0,value:"\u9009\u62e9\u9898"},{id:1,value:"\u6253\u5206\u9898"}];a.prototype.getNodeNameX=function(){return 218};a.prototype.getNodeNameY=function(){return 153};a.prototype.maintainWidth=function(){this.width=4>=this.optionsX.length?422:422+(this.optionsX.length-4)*this.optionWidth};a.prototype.maintainHeight=function(){this.height=0>=this.optionsY.length?268:268+30*this.optionsY.length};a.prototype.getBackgroundTop=function(){return 158};a.prototype.getBackgroundLeft=function(){return 218};a.prototype.getBackgroundWidth=function(){return this.width-222};a.prototype.getBackgroundHeight=function(){return this.optionHidden?this.getHeight()-18:this.getHeight()-177};a.prototype.getBackgroundWidthX=function(){return this.width-222};a.prototype.getBackgroundHeightX=function(){return 112};a.prototype.getBackgroundWidthY=function(){return 166};a.prototype.getBackgroundHeightY=function(){return this.height-233};a.prototype.isMyMatrixType=function(a){return this.matrixType==a};a.prototype.updateName=function(a){this.isOptionXSelected()?this.optionXName=a:this.isOptionYSelected()?this.optionYName=a:this.nodeName=a};a.prototype.maintainOption=function(a){var d=this[a],f="",f="optionsX"==a?"xIndex":"yIndex";for(a=0;a<d.length;a++){var c=d[a].index;if(c!=a)for(var h=0;h<this.options.length;h++){var l=this.options[h];l[f]!=c||l.maintained||(l[f]=a,l.maintained=!0)}d[a].index=a}for(a=0;a<this.options.length;a++)this.options[a].maintained=!1};a.prototype.removeOption=function(a){if(a instanceof ZYDesign.Class.OptionConnector&&"options"!=a.belong){var d=a.belong,f="xIndex",c=a.index;"optionsY"==d&&(f="yIndex");this[d].splice(c,1);for(var h=c;h<this[d].length;h++){var l=this[d][h];l.index-=1}for(h=this.options.length-1;0<=h;h--)l=this.options[h],l[f]==c?this.options.splice(h,1):l[f]>c&&(l[f]-=1);this.maintainWidth();this.maintainHeight();this.fixNodeSize(!0);return a}};a.prototype.generateOptionNumber=function(a){for(var d=1,f=0;f<a.length;f++){var c=a[f];d<=c.number&&(d=c.number+1)}999<d&&(d="");return d};a.prototype.addOption=function(a,d,f){a=a instanceof ZYDesign.Class.MatrixXOptionConnector||d?this.addOptionX(a):this.addOptionY(a);f||this.fixNodeSize(!0);return a};a.prototype.addOptionX=function(a,d){a=a||{};var f;a instanceof ZYDesign.Class.MatrixXOptionConnector?(f=a,f.index=this.optionsX.length):(f=new ZYDesign.Class.MatrixXOptionConnector(this),f.originText=a.text||"",f.index=a.index?a.index:this.optionsX.length,f.outputId=a.uuid?a.uuid:ZYDesign.UuidUtil.generate(),f.number=a.number?a.number:this.generateOptionNumber(this.optionsX));this.optionsX.push(f);this.maintainWidth();if(!d)for(var c=0;c<this.optionsY.length;c++)this.addMatrixOption(f,this.optionsY[c]);return f};a.prototype.addOptionY=function(a,d){a=a||{};var f;a instanceof ZYDesign.Class.MatrixYOptionConnector?(f=a,f.index=this.optionsY.length):(f=new ZYDesign.Class.MatrixYOptionConnector(this),f.originText=a.text||"",f.index=a.index?a.index:this.optionsY.length,f.outputId=a.uuid?a.uuid:ZYDesign.UuidUtil.generate(),f.number=a.number?a.number:this.generateOptionNumber(this.optionsY));this.optionsY.push(f);this.maintainHeight();if(!d)for(var c=0;c<this.optionsX.length;c++)this.addMatrixOption(this.optionsX[c],f);return f};a.prototype.addMatrixOption=function(a,d){var f=new this.optionConstructor(this);f.outputId=a.outputId+"|"+d.outputId;f.xIndex=a.index;f.yIndex=d.index;this.options.push(f);return f};a.prototype.initOptions=function(){for(var a=this.originData.optionsX,d=this.originData.optionsY,f=0;f<a.length;f++){this.addOptionX(a[f],!0);for(var c=0;c<d.length;c++){var h=d[c];0==f&&this.addOptionY(h,!0);this.addMatrixOption(this.optionsX[f],this.optionsY[c])}}};a.prototype.isMultiSelect=function(){return 5==this.selectTypeLimit?!0:!1};a.prototype.isSingleSelect=function(){return 0!=this.matrixType?!1:1==this.selectTypeLimit?!0:!1};a.prototype.init=function(b,d,f){a.base.init.call(this,b,d,f);this.matrixType=this.originData.extField_1||0;this.selectTypeLimit=this.originData.extField_2||5;this.oldMultipleMin=this.multipleMin=this.originData.extField_3||2;this.multipleMax=this.originData.extField_4||this.options.length;this.markMin=this.originData.extField_5||1;this.markMax=this.originData.extField_6||100;this.loopOptionY="Y"==this.originData.extField_7?!0:!1;this.loopOptionX="Y"==this.originData.extField_8?!0:!1;this.markMinComment=this.originData.extField_9||"";this.markMaxComment=this.originData.extField_10||"";this.randomOpen=(this.randomOptionX="Y"==this.originData.randomOptionX?!0:!1)||this.randomOptionY;this.loopOpen=this.loopOptionX||this.loopOptionY};a.prototype.exportJson=function(b,d){a.base.exportJson.call(this,b,d);d.extField_1=this.matrixType;d.extField_2=this.selectTypeLimit;d.extField_3=this.multipleMin;d.extField_4=this.multipleMax;d.extField_5=this.markMin;d.extField_6=this.markMax;d.extField_7=this.loopOptionY?"Y":"N";d.extField_8=this.loopOptionX?"Y":"N";d.extField_9=this.markMinComment;d.extField_10=this.markMaxComment;d.randomOptionX=this.randomOptionX?"Y":"N"};a.prototype.exportOptionJson=function(a){a.optionsX=this.collectOptionsX();a.optionsY=this.collectOptionsY()};a.prototype.collectOption=function(b,d,f){b&&d&&(a.base.collectOption.call(this,b,d),d.typeFlag=f)};a.prototype.collectOptionsX=function(){if(!this.optionsX||0==this.optionsX.length)return null;for(var a=[],d=0;d<this.optionsX.length;d++){var f={};this.collectOption(this.optionsX[d],f,1);a.push(f)}return a};a.prototype.collectOptionsY=function(){if(!this.optionsY||0==this.optionsY.length)return null;for(var a=[],d=0;d<this.optionsY.length;d++){var f={};this.collectOption(this.optionsY[d],f,0);a.push(f)}return a};a.prototype.hasKeywordInOptions=function(a){for(var d=0;d<this.optionsX.length;d++)if(-1<this.optionsX[d].originText.indexOf(a))return!0;for(d=0;d<this.optionsY.length;d++)if(-1<this.optionsY[d].originText.indexOf(a))return!0;return!1};a.prototype.getCtrIconTransform=function(){return"translate(218,"+(this.getBackgroundHeight()+159)+")"};a.prototype.cloneNodeJson=function(b,d,f){a.base.cloneNodeJson.call(this,b,d,f);b.addFnKey="addMatrixNode"};a.prototype.cloneOptionsJson=function(a){for(var d=["optionsX","optionsY"],f=0;f<d.length;f++){for(var c=d[f],h=[],l=0;l<this[c].length;l++){var p={};p.text=this[c][f].originText;h.push(p)}a[c]=h}};a.prototype.extractTypeText=function(){var a="\u77e9\u9635\u9898";if(0==this.matrixType)var d=ZYDesign.Dict.getMatrixLimitById(this.selectTypeLimit),a=a+("("+d+")");else a+="(\u6253\u5206)";return a};a.prototype.getWarnIconTrasform=function(){return 4>=this.optionsX.length?"translate(398,138)":"translate("+(398+(this.optionsX.length-4)*this.optionWidth)+",138)"};a.prototype.validate=function(b){b||(b={isValid:!0,message:Prompt.QSNRD_Valid});a.base.validate.call(this,b);if(!b.isValid)return b;if(2>this.optionsX.length&&2>this.optionsY.length)return b.isValid=!1,b.message=Prompt.QSNRD_OptionNotBelowTwo,b;for(var d=0;d<this.optionsX.length;d++){var f=this.optionsX[d];if(!f.number||!f.originText)return b.isValid=!1,b.message=Prompt.QSNRD_InvalidIncompleteOptionX,b;for(var c=d+1;c<this.optionsX.length;c++){var h=this.optionsX[c];if(h.number==f.number||h.originText==f.originText)return b.isValid=!1,b.message=Prompt.QSNRD_InvalidConflictOptionX,b}}for(d=0;d<this.optionsY.length;d++){f=this.optionsY[d];if(!f.number||!f.originText){b.isValid=!1;b.message=Prompt.QSNRD_InvalidIncompleteOptionY;break}for(c=d+1;c<this.optionsY.length;c++)if(h=this.optionsY[c],h.number==f.number||h.originText==f.originText)return b.isValid=!1,b.message=Prompt.QSNRD_InvalidConflictOptionY,b}return b};a.prototype.fixNodeSize=function(a){var d=$("#"+this.nodeUuid);d.find(".background_size_x").attr({width:this.getBackgroundWidthX(),height:this.getBackgroundHeightX()});d.find(".background_size_y").attr({width:this.getBackgroundWidthY(),height:this.getBackgroundHeightY()});d.find(".background_size").attr({width:this.getBackgroundWidth(),height:this.getBackgroundHeight()});d.find(".seg_line").attr("x2",this.line.getX2());d.find(".expansion_icon").attr("transform",this.getExpansionIconTransform());var f=d.find(".elem_output");f.find("text").attr({x:this.output.getTextX(),y:this.output.getTextY()});f.find("rect").attr({x:this.output.getBlockX(),y:this.output.getBlockY()});f.find("circle").attr({cx:this.output.getCircleX(),cy:this.output.getCircleY()});d.find(".elem_warn_icon").attr("transform",this.getWarnIconTrasform());a&&this.fixOptionPosition()};a.prototype.fixOptionPosition=function(){for(var a=0;a<this.options.length;a++){var d=this.options[a],f=$("#"+d.outputId.replace("|","a"));f.find("rect").attr({x:d.getBlockX(),y:d.getBlockY()});f.find("circle").attr({cx:d.getCircleX(),cy:d.getCircleY()})}for(a=0;a<this.optionsX.length;a++)d=this.optionsX[a],$("#"+d.outputId).find("text").attr({x:d.getTitleX()});for(a=0;a<this.optionsY.length;a++)d=this.optionsY[a],$("#"+d.outputId).find("text").attr({y:d.getTitleY()})};a.prototype.setOptionEnable=function(){this.isSingleSelect()?$("#"+this.nodeUuid+" .chart_options circle").attr("style",""):$("#"+this.nodeUuid+" .chart_options circle").attr("style","stroke: #34495e;fill: rgba(52, 73, 94, 0.49);")};a.prototype.getEyeTransform=function(){return"translate("+(this.getX()+218)+","+(this.getY()+158)+")"};a.prototype.getEyeTransformX=function(){return"translate("+(this.getX()+218)+","+this.getY()+")"};a.prototype.getEyeTransformY=function(){return"translate("+this.getX()+","+(this.getY()+214)+")"};a.prototype.getExtraWidth=function(){var a=0;4<this.optionsX.length&&(a=(this.optionsX.length-4)*this.optionWidth);return a};a.prototype.getExpansionIconTransform=function(){var a=409.5;4<this.optionsX.length&&(a+=(this.optionsX.length-4)*this.optionWidth);return this.optionHidden?"translate("+a+",166) rotate(90)":"translate("+(a-15)+",166)"};a.prototype.getExpansionTrasform=function(){return 4>=this.optionsX.length?"translate(396,180) scale(1.5)":"translate("+(396+(this.optionsX.length-4)*this.optionWidth)+",180) scale(1.5)"};a.prototype.getExtraHeight=function(){var a=0;5<this.optionsY.length&&(a=(this.optionsY.length-5)*this.optionWidth);return a};a.prototype.removeOptionInRange=function(a,d,f){return f?this.removeOptionXInRange(a,d):this.removeOptionYInRange(a,d)};a.prototype.removeOptionXInRange=function(a,d){if(!(0>a||d>=this.optionsX.length||a>d)){for(var f=[],c=d;c>a;c--){var h=this.optionsX[c];this.removeOption(h);f.push(h)}return f}};a.prototype.removeOptionYInRange=function(a,d){if(!(0>a||d>=this.optionsY.length||a>d)){for(var f=[],c=d;c>a;c--){var h=this.optionsY[c];this.removeOption(h);f.push(h)}return f}};a.prototype.fixPosition=function(b){b=a.base.fixPosition.call(this,b);b.find(".eye_bg_x").attr("transform",this.getEyeTransformX());b.find(".eye_bg_y").attr("transform",this.getEyeTransformY())};return a}()})();(function(){var c=ZYDesign.Class;c.RandomNode=function(){function a(){this instanceof a&&(c.ToolNode.call(this),this.backgroundColor="#aa4843",this.randomStart=new ZYDesign.Class.RandomStartConnector(this))}c.inheritPrototype(c.ToolNode,a);a.prototype.type=ZYDesign.Enum.NODETYPE.RANDOM;a.prototype.typeInt=12;a.prototype.categoryType=3;a.prototype.randomStartTextX=15;a.prototype.randomStartTextY=79;a.prototype.randomStartCircleX=0;a.prototype.randomStartCircleY=74;a.prototype.typeListKey="randomNodes";a.prototype.typeName="\u968f\u673a\u8282\u70b9";a.prototype.typeIcon="";a.prototype.init=function(b,d,f){a.base.init.call(this,b,d,f);this.initRandomStart()};a.prototype.initRandomStart=function(){this.randomStart.text="\u968f\u673a\u5f00\u59cb";this.originData.randomStart.uuid&&(this.randomStart.outputId=this.originData.randomStart.uuid)};a.prototype.searchConnectorById=function(a){return this.output.outputId==a?this.output:this.input.inputId==a?this.input:this.randomStart.outputId==a?this.randomStart:!1};a.prototype.exportJson=function(b,d){a.base.exportJson.call(this,b,d);d.randomStart={index:-5,uuid:this.randomStart.outputId}};a.prototype.cloneNodeJson=function(b,d,f){a.base.cloneNodeJson.call(this,b,d,f);b.addFnKey="addRandomNode";b.randomStart={text:"\u968f\u673a\u5f00\u59cb"}};a.prototype.validate=function(b){b||(b={isValid:!0,message:Prompt.QSNRD_Valid});a.base.validate.call(this,b);if(!b.isValid)return b;0==this.randomStart.dests.length&&(b.isValid=!1,b.message=Prompt.QSNRD_InvalidNoRandomGroup);return b};a.prototype.searchNextNodesByOrder=function(){for(var a=[],d=[],f=this.randomStart.dests,c=0;c<f.length;c++){var h=f[c].parent,l=[h],h=[h],p=0,k=h.length;do{for(;p<k;p++){for(var n=h[p].searchNextNodesByOrder(),m=0;m<n.resultList.length;m++){var q=n.resultList[m];0>l.indexOf(q)&&l.push(q)}for(m=0;m<n.seedList.length;m++)q=n.seedList[m],0>h.indexOf(q)&&h.push(q)}p=k;k=h.length}while(k>p);a=a.concat(l)}if(f=this.output.dest)f=f.parent,a.push(f),d.push(f);return{resultList:a,seedList:d}};return a}()})();(function(){var c=ZYDesign.Class,a=ZYDesign.Enum,b=c.SelectNode;c.SelectPicNode=function(){function d(){this instanceof d&&(c.SubjectNode.call(this),this.width=200,this.height=88,this.backgroundColor="#9D11EF",this.multipleSelect=!1,this.multipleMax=1,this.multipleMin=0,this.listType=2,this.borderType=1)}c.inheritPrototype(c.SubjectNode,d);var f=d.base;d.prototype.type=a.NODETYPE.SELECTPIC;d.prototype.typeInt=23;d.prototype.categoryType=3;d.prototype.outputTextChangable=!0;d.prototype.optionConstructor=c.SelectPicOptionConnector;d.prototype.typeName="\u56fe\u7247\u9009\u62e9\u9898";d.prototype.typeIcon="ic_mc";d.prototype.isSingleSelect=function(){return!this.multipleSelect};d.prototype.isMultiSelect=function(){return this.multipleSelect};d.prototype.extractTypeText=function(){return this.multipleSelect?"\u56fe\u7247\u9009\u62e9\u9898(\u591a\u9009)":"\u56fe\u7247\u9009\u62e9\u9898(\u5355\u9009)"};d.prototype.initOption=function(a,b){a&&b&&(f.initOption.call(this,a,b),b.image=ZYDesign.DesignManager.imageUploadManager.getImageById(a.imageId))};d.prototype.cloneOptionsJson=function(a){for(var b=[],d=0;d<this.options.length;d++){var c=this.options[d],f={};f.text=c.originText;f.imageId=c.image?c.image.id:"";b.push(f)}a.options=b};d.prototype.init=function(a,b,d){f.init.call(this,a,b,d);this.multipleSelect="Y"==this.originData.extField_1?!0:!1;this.multipleMin=this.originData.extField_2||1;this.multipleMax=this.originData.extField_3||2;this.listType=this.originData.extField_4||2;this.borderType=this.originData.extField_5||1};d.prototype.exportJson=function(a,b){f.exportJson.call(this,a,b);b.extField_1=this.multipleSelect?"Y":"N";b.extField_2=parseInt(this.multipleMin);b.extField_3=parseInt(this.multipleMax);b.extField_4=this.listType;b.extField_5=this.borderType};d.prototype.setOptionEnable=function(){b.prototype.setOptionEnable.call(this)};d.prototype.collectOption=function(a,b){if(a&&b){var c=a.extractVariable()?"Y":"N";d.base.collectOption.call(this,a,b);b.imageId=a.image?a.image.id:"";b.imageName=a.image?a.image.serverFileName:"";b.imageOriginName=a.image?a.image.fileName:"";b.extField_3=c}};d.prototype.cloneNodeJson=function(a,b,d){f.cloneNodeJson.call(this,a,b,d);a.extField_1=this.multipleSelect?"Y":"N";a.extField_2=this.multipleMin;a.extField_3=this.multipleMax;a.extField_4=this.listType;a.extField_5=this.borderType;a.addFnKey="addSelectPicNode"};d.prototype.isMultipleLegal=function(){return b.prototype.isMultipleLegal(this)};d.prototype.isDisabledListType=function(a){return this.isConflictType(a,this.borderType)};d.prototype.isDisabledBorderType=function(a){return this.isConflictType(this.listType,a)};d.prototype.isConflictType=function(a,b){return 1==a&&(3==b||2==b)||2==a&&(2==b||3==b)?!0:!1};d.prototype.validate=function(a){a||(a={isValid:!0,message:Prompt.QSNRD_Valid});f.validate.call(this,a);if(!a.isValid)return a;if(!this.isMultipleLegal())return a.isValid=!1,a.message=Prompt.QSNRD_InvalidMultiRangeError,a;if(2>this.options.length)return a.isValid=!1,a.message=Prompt.QSNRD_OptionNotBelowTwo,a;for(var b=0;b<this.options.length;b++){var d=this.options[b];if(!d.number.toString()||!d.originText||!d.image){a.isValid=!1;a.message=Prompt.QSNRD_InvalidIncompleteOption;break}for(var c=b+1;c<this.options.length;c++){var k=this.options[c];if(k.number==d.number||k.originText==d.originText||k.image==d.image)return a.isValid=!1,a.message=Prompt.QSNRD_InvalidConflictOption,a}}return a};return d}()})();(function(){var c=ZYDesign.Class;c.SequencingNode=function(){function a(){!this instanceof a||(c.SubjectNode.call(this),this.width=200,this.height=88,this.backgroundColor="#26aaa0")}c.inheritPrototype(c.SubjectNode,a);a.prototype.type=ZYDesign.Enum.NODETYPE.SEQUENCE;a.prototype.typeInt=3;a.prototype.categoryType=3;a.prototype.typeListKey="sequencingNodes";a.prototype.addition=!0;a.prototype.outputTextChangable=!0;a.prototype.optionConstructor=ZYDesign.Class.SequenceOptionConnector;a.prototype.typeName="\u6392\u5e8f\u9898";a.prototype.typeIcon="ic_sorting";a.prototype.extractTypeText=function(){return"\u6392\u5e8f\u9898"};a.prototype.initOption=function(b,d){b&&d&&(a.base.initOption.call(this,b,d),d.seqTarget="Y"==b.extField_1?!0:!1)};a.prototype.exportJson=function(b,d){a.base.exportJson.call(this,b,d)};a.prototype.collectOption=function(b,d){b&&d&&(a.base.collectOption.call(this,b,d),d.extField_1=b.seqTarget?"Y":"N")};a.prototype.cloneNodeJson=function(b,d,c){a.base.cloneNodeJson.call(this,b,d,c);b.addFnKey="addSequencingNode"};a.prototype.changeSeqTarget=function(a){if(a.seqTarget=!a.seqTarget)for(var d=0;d<this.options.length;d++){var c=this.options[d];c!=a&&(c.seqTarget=!1)}};return a}()})();(function(){var c=ZYDesign.Class;c.StartNode=function(){function a(){this instanceof a&&(c.NodeBase.call(this),this.mode=3,this.output=new ZYDesign.Class.OutputConnector(this),this.question=new ZYDesign.Class.QuestionModel(this),this.backgroundColor="#3498db",this.width=150,this.height=64)}c.inheritPrototype(c.NodeBase,a);a.prototype.outputCircleX=150.5;a.prototype.outputCircleY=26;a.prototype.outputTextX=138.5;a.prototype.outputTextY=31;a.prototype.type=ZYDesign.Enum.NODETYPE.START;a.prototype.commonType=ZYDesign.Enum.NODECOMMONTYPE.TERMINAL;a.prototype.typeInt=6;a.prototype.differHeight=0;a.prototype.categoryType=2;a.prototype.typeListKey="startNodes";a.prototype.copyDisabled=!0;a.prototype.removeDisabled=!0;a.prototype.previewDisabled=!0;a.prototype.optionbatchDisabled=!0;a.prototype.typeName="\u5f00\u59cb\u8282\u70b9";a.prototype.typeIcon="";a.prototype.nameLengthLimit=100;a.prototype.nameText="\u95ee\u5377\u6807\u9898";a.prototype.describeText="\u95ee\u5377\u63cf\u8ff0";a.prototype.getWarnIconTrasform=function(){return"translate(130, -20)"};a.prototype.getSmallBgX=function(){return 2};a.prototype.getSmallBgY=function(){return 2};a.prototype.getSmallBgWidth=function(){return 75};a.prototype.getSmallBgHeight=function(){return 46};a.prototype.getSmallBgTxtX=function(){return 16};a.prototype.getSmallBgTxtY=function(){return 33};a.prototype.getSmallBgTxt=function(){return"Start"};a.prototype.initOutput=function(){this.originData.output&&this.originData.output.uuid&&(this.output.outputId=this.originData.output.uuid)};a.prototype.initInput=function(){this.input.parent=this;this.originData.input&&this.originData.input.uuid&&(this.input.inputId=this.originData.input.uuid)};a.prototype.init=function(b,d,c){a.base.init.call(this,b,d,c);this.initOutput();this.initQuestion()};a.prototype.initQuestion=function(){var a=this.originData;this.question.originText=a.questionText||"";this.question.videoUrl=a.questionVideoUrl||""};a.prototype.exportJson=function(b,d){a.base.exportJson.call(this,b,d);d.questionText=this.question.originText;d.questionVideoUrl=this.question.videoUrl;d.output={index:-1,uuid:this.output.outputId};d.destList=this.collectDestList()};a.prototype.searchConnectorById=function(a){return this.output.outputId==a?this.output:!1};a.prototype.cloneNodeJson=function(b,d,c){a.base.cloneNodeJson.call(this,b,d,c);b.output={text:"\u8f93\u51fa"};b.addFnKey="addStartNode"};a.prototype.getCtrIconTransform=function(){return"translate(-2,"+this.getBackgroundHeight()+")"};a.prototype.getEngagement=function(){return{status:ZYDesign.Enum.NODESTATE.NORMAL,dueToNode:null}};a.prototype.validate=function(b){b||(b={isValid:!0,message:Prompt.QSNRD_Valid});a.base.validate.call(this,b);if(!b.isValid)return b;if(this.output.dest&&this.output.dest.parent.type==ZYDesign.Enum.NODETYPE.END)return b.isValid=!1,b.message=Prompt.QSNRD_InvalidStartToEnd,b;for(var d=!1,c=ZYDesign.DesignManager.mixNodes,g=0;g<c.length;g++){var h=c[g];if(0==h.mode&&h.isSubject()){d=!0;break}}d||(b.isValid=!1,b.message=Prompt.QSNRD_InvalidNoSubject);return b};a.prototype.searchNextNodesByOrder=function(){var a=[],d=[],c=this.output.dest;c&&(c=c.parent,a.push(c),d.push(c));return{resultList:a,seedList:d}};return a}()})();angular.module("batchOption",[]).directive("batchOption",function(){function c(b){9==b.keyCode?b.preventDefault():27==b.keyCode?(a.close(),a.digest()):b.ctrlKey&&13==b.keyCode&&(a.apply(),a.digest())}var a;return{restrict:"A",templateUrl:"/Content/QSNR/batch_option_template.html",replace:!0,scope:{optionBatchAddManager:"\x3dbatchOption"},controller:"BatchOptionController",link:function(b,d){d.find("textarea,input").on("keydown",c);a=b.optionBatchAddManager}}}).controller("BatchOptionController",["$scope","recordManager",function(c,a){c.handleApplyOptionClick=function(a){this.optionBatchAddManager.apply()};c.handleCancleOptionClick=function(){this.optionBatchAddManager.close()}}]);angular.module("helpBox",["dragging"]).directive("helpBox",function(){return{restrict:"A",templateUrl:"/Content/QSNR/context_help_template.html",replace:!0,scope:{designManager:"\x3dhelpBox",helpManager:"\x3dhelpText"},controller:"HelpBoxController"}}).controller("HelpBoxController",["$scope","dragging","recordManager",function(c,a,b){c.handleHelpMouseDown=function(b){$(document.activeElement).blur();var c,g=this;a.startDrag(b,{dragStarted:function(a,b){g.designManager.disableConns();c={x:a,y:b};this.options.silent&&g.designManager.digest()},dragging:function(a,b){var d={x:a,y:b},k=d.y-c.y;g.designManager.helpManager.x+=d.x-c.x;g.designManager.helpManager.y+=k;this.options.silent&&g.designManager.helpManager.fixPosition();c=d},dragEnded:function(){g.designManager.enableConns()},clicked:function(){},options:{silent:ZYDesign.Config.draggingSilent}})};c.handleCloseHelpClick=function(){this.designManager.helpManager.close()};c.handleOpenHelpClick=function(){this.designManager.helpManager.close()}}]);angular.module("contextMenu",[]).directive("contextMenu",function(){return{restrict:"A",templateUrl:"/Content/QSNR/context_menu_template.html",replace:!0,scope:{contextMenu:"\x3dcontextMenu"},controller:"ContextMenuController"}}).controller("ContextMenuController",["$scope","recordManager",function(c,a){c.handleMenuMouseDown=function(a){a.stopPropagation()};c.handleMenuItemClick=function(a){this.contextMenu.executeItem(a)}}]);angular.module("dragOption",[]).directive("dragOption",function(){function c(a){k=a.target;setTimeout(function(){$(k).addClass("drag_source_option")},10);$(".drag_option_item").find("*").addClass("event_none")}function a(a){k&&$(a.target).addClass("drag_target_option")}function b(a){k&&a.preventDefault()}function d(a){k&&$(a.target).removeClass("drag_target_option")}function f(a){if(k){var b=a.target;$(b).removeClass("drag_target_option");if(b!=k){a=parseInt($(k).attr("data-option-index"));var b=parseInt($(b).attr("data-option-index")),d=$(k).attr("data-option-belong");m.dislocateOptOfCurrNode(d,a,b);m.digest()}}}function g(a){$(".drag_option_item").find("*").removeClass("event_none");$(k).removeClass("drag_source_option");k=null;p()}function h(){n||($(".drag_option_item").attr("draggable","true"),n=!0)}function l(){p()}function p(){n&&($(".drag_option_item").removeAttr("draggable"),n=!1)}var k=null,n=!1,m=null;return{restrict:"A",templateUrl:"/Content/QSNR/drag_option_template.html",replace:!0,scope:{designManager:"\x3ddesignManager",node:"\x3dcurrentNode",optionList:"\x3ddragOption"},controller:"DragOptionController",link:function(q,t){m=q.designManager;t.delegate(".drag_option_item",{dragstart:c,dragenter:a,dragover:b,dragleave:d,drop:f,dragend:g}).delegate(".option_dragger",{mouseover:h,mouseleave:l})}}}).controller("DragOptionController",["$scope","recordManager",function(c,a){var b=c.designManager;c.handleDeleteOptionClick=function(d,c){var g=b.removeConnOfOption(d,c);d.removeOption(c);b.markChange();a.register({descript:"\u5220\u9664\u9009\u9879",param:{manager:b,node:d,option:c,conns:g},undo:function(){var a=this.param;a.node.addOption(a.option);for(var b=0;b<a.conns.length;b++)a.manager.addConnection(a.conns[b])},redo:function(){var a=this.param;a.manager.removeConnOfOption(a.node,a.option);a.node.removeOption(a.option)}})};c.handleChangeSeqTargetClick=function(a,c){a instanceof ZYDesign.Class.SequencingNode&&c instanceof ZYDesign.Class.SequenceOptionConnector&&(a.changeSeqTarget(c),b.markChange())};c.handleOnlyNumberInputKeyDown=function(a){ZYDesign.TextUtil.isNumberInputKey(a.keyCode)&&!a.shiftKey||a.preventDefault()};c.handleCommonAttrChange=function(a){b.markChange(a)};c.handleOptionNumberChange=function(a,c){c||(a.number=parseInt(a.number),a.number=isNaN(a.number)?0:a.number);b.recordCommonChange(a,"number",c,"\u66f4\u6539\u9009\u9879\u7f16\u53f7")};c.handleOptionTextChange=function(a,c){b.recordCommonChange(a,"originText",c,"\u66f4\u6539\u9009\u9879\u63cf\u8ff0")}}]);angular.module("eagleEye",["dragging"]).directive("eagleEye",function(){return{restrict:"A",templateUrl:"/Content/QSNR/eagle_eye_template.html",replace:!0,scope:{designManager:"\x3deagleEye"},controller:"EagleEyeController"}}).controller("EagleEyeController",["$scope","dragging","$element","recordManager",function(c,a,b,d){c.handleEyeMouseDown=function(c){var g=this.designManager,h=g.translateCoordinates(c.pageX,c.pageY,b),l,p=g.borderInfo,k=g.containerInfo,n=k.width/k.height,m=p.width/p.height,q=1,k=1;n>m?q=m/n:k=n/m;n=0-(p.left+h.x/g.eyeZoomRate*g.chartZoomRate*q);p=0-(p.top+h.y/g.eyeZoomRate*g.chartZoomRate*k);g.moveNodes(n,p);g.checkVisibleOfNodesAndConns();d.register({descript:"\u9e70\u773c\u70b9\u51fb\u79fb\u52a8\u753b\u5e03",param:{manager:g,deltaX:n,deltaY:p},undo:function(){var a=this.param;a.manager.moveNodes(-a.deltaX,-a.deltaY);a.manager.checkVisibleOfNodesAndConns()},redo:function(){var a=this.param;a.manager.moveNodes(a.deltaX,a.deltaY);a.manager.checkVisibleOfNodesAndConns()}});a.startDrag(c,{dragStarted:function(a,d){h=l=g.translateCoordinates(a,d,b)},dragging:function(a,d){var m=g.translateCoordinates(a,d,b),c=(h.x-m.x)/g.eyeZoomRate*g.chartZoomRate,q=(h.y-m.y)/g.eyeZoomRate*g.chartZoomRate;0==c&&0==q||g.moveNodes(c,q);this.options.silent&&g.updateNodeFlowPosition();h=m},dragEnded:function(a,b){d.register({descript:"\u9e70\u773c\u62d6\u52a8\u79fb\u52a8\u753b\u5e03",param:{manager:g,deltaX:(l.x-h.x)/g.eyeZoomRate*g.chartZoomRate,deltaY:(l.y-h.y)/g.eyeZoomRate*g.chartZoomRate},undo:function(){var a=this.param;a.manager.moveNodes(-a.deltaX,-a.deltaY);a.manager.checkVisibleOfNodesAndConns()},redo:function(){var a=this.param;a.manager.moveNodes(a.deltaX,a.deltaY);a.manager.checkVisibleOfNodesAndConns()}})},options:{silent:ZYDesign.Config.draggingSilent}})}}]);angular.module("imageSelect",[]).directive("imageSelect",function(){return{restrict:"A",templateUrl:"/Content/QSNR/image_select_template.html",replace:!0,scope:{owner:"\x3dimageSelect",imageUploadManager:"\x3dimageLib"},controller:"ImageSelectController"}}).controller("ImageSelectController",["$scope","designManager","recordManager",function(c,a,b){var d=angular.element($("#node_editor")).isolateScope();c.handleCurrImageClick=function(a){a.showImageList=!a.showImageList};c.handleImageItemClick=function(d,c,h){if(c!=d.image){var l=d.image;c=d.image=c;d.showImageList=!1;h.stopPropagation();a.markChange();b.register({descript:"\u66f4\u6362\u56fe\u7247",param:{owner:d,oldImage:l,newImage:c},undo:function(){var a=this.param;a.owner.image=a.oldImage},redo:function(){var a=this.param;a.owner.image=a.newImage}})}};c.handleListMouseLeave=function(a){a.showImageList=!1};c.handleAddImageItemClick=function(c){a.isAllowChangeStatus(a.qStatus)?(c.showImageList=!1,d.activeTab=3,a.imageUploadManager.open(function(g){d.activeTab=1;a.imageUploadManager.close(!0);if(g){var h=c.image;g=c.image=g;a.markChange();b.register({descript:"\u66f4\u6362\u56fe\u7247",param:{owner:c,oldImage:h,newImage:g},undo:function(){var a=this.param;a.owner.image=a.oldImage},redo:function(){var a=this.param;a.owner.image=a.newImage}})}}),event.stopPropagation()):ZYDesign.Hinter.hint("\u5f53\u524d\u95ee\u5377\u72b6\u6001\u4e0b\u4e0d\u5141\u8bb8\u64cd\u4f5c\u5a92\u4f53\u5e93")};c.getOwnerFileName=function(a){return a?a:"\u70b9\u51fb\u9009\u62e9\u56fe\u7247"}}]);angular.module("imageUpload",[]).directive("imageUpload",function(){return{restrict:"A",templateUrl:"/Content/QSNR/image_upload_template.html",replace:!0,scope:{imageUploadManager:"\x3dimageUpload"},controller:"ImageUploadController",link:function(c,a){}}}).controller("ImageUploadController",["$scope","recordManager",function(c,a){c.handleImageUploadCloseIconClick=function(){this.imageUploadManager.close()};c.handleUploadIconClick=function(){this.imageUploadManager.uploadImage()};c.handleCancelIconClick=function(a){this.imageUploadManager.cancel();a.stopPropagation()}}]);angular.module("nodeBox",[]).directive("nodeBox",function(){function c(a){l=a.target;$("#chart_content").attr("draggable",!0)}function a(a){l=null;$("#chart_content").attr("draggable",!1)}function b(a){l&&a.preventDefault()}function d(a){a=a.originalEvent;a=k.transCoords(a.pageX,a.pageY,$("#chartLarger"));k.addNode($(l),a.x,a.y);k.digest()}function f(){k.isPinned()||(k.close(),k.digest())}function g(a){$(this).find(".nodes_help").addClass("trans_0_0_dur_200")}function h(a){$(this).find(".nodes_help").removeClass("trans_0_0_dur_200")}var l=null,p=!1,k=null;return{restrict:"A",templateUrl:"/Content/QSNR/node_box_template.html",replace:!0,scope:{nodeBoxManager:"\x3dnodeBox",helpManager:"\x3dcontextHelp"},controller:"NodeBoxController",link:function(l,m){ZYDesign.Config.developMode||m.find(".box_developing").addClass("column_button_disable");k=l.nodeBoxManager;m.find(".column_button ").bind({dragstart:c,dragend:a});m.find("[data-method]").not(".column_button_disable").bind({mouseenter:g,mouseleave:h}).attr("draggable",!0);p||($("#chart_content").bind({dragover:b,drop:d}),$(".click_hide_unpinned").each(function(a){this.addEventListener("mousedown",f,!0)}),p=!0)}}}).controller("NodeBoxController",["$scope","recordManager",function(c,a){c.handleTogglePinClick=function(){this.nodeBoxManager.togglePin()};c.handleAddNodeClick=function(a){this.nodeBoxManager.addNode($(a.currentTarget))};c.handleCloseBoxClick=function(){this.nodeBoxManager.close()};c.handleCloseBoxClick=function(){this.nodeBoxManager.close()};c.handleHelpClick=function(a,d){a.stopPropagation();this.helpManager.help(a,d)}}]);angular.module("nodeEditor",["imageUpload","imageSelect","validateOption","dragOption"]).directive("nodeEditor",function(){function c(){$(this).parent().addClass("design_input_focus")}function a(){$(this).parent().removeClass("design_input_focus")}function b(){$(this).val();$(this).css("height","0px").css("height",this.scrollHeight)}return{restrict:"A",templateUrl:"/Content/QSNR/node_editor_template.html",replace:!0,scope:{node:"\x3dnodeEditor",designManager:"\x3ddesignManager"},controller:"NodeEditorController",link:function(d,f){f.delegate(".option_editor_input",{focus:c,blur:a,input:b})}}}).controller("NodeEditorController",["$scope","$timeout","recordManager",function(c,a,b){var d=ZYDesign.Class,f=ZYDesign.Enum,g=c.designManager;a(function(){c.activeTab=1});c.getNodeIcon=function(){return this.node?"design_icon size_20px margin_r_5px float_l "+this.node.typeIcon:"design_icon size_20px margin_r_5px float_l ic_none"};c.getNodeName=function(){return this.node?this.node.typeName:"\u65e0\u8282\u70b9"};c.handleImageUploadOpenClick=function(){g.imageUploadManager.open()};c.handleImageEditClick=function(a){g.imageUploadManager.editImage(a)};c.handleImageDeleteClick=function(a,b){g.imageUploadManager.deleteImage(a);b.stopPropagation()};c.handleOtherOptionToggleClick=function(a){if(a instanceof d.SelectNode){var c=a.toggleOtherOption();g.markChange();b.register({descript:"\u5f00\u542f/\u5173\u95ed\u5176\u4ed6\u9009\u9879",param:{node:a,rs:c},undo:function(){var b=this.param;"remove"==b.rs.type?a.addOption(b.rs.option):a.removeOtherOption()},redo:function(){var b=this.param;"add"==b.rs.type?a.addOption(b.rs.option):a.removeOtherOption()}})}};c.handleMediaToggleClick=function(a){var d=a.toggleImage();g.markChange();b.register({descript:"\u5f00\u542f/\u5173\u95ed\u5a92\u4f53",param:{node:a,rs:d},undo:function(){var a=this.param;a.node.toggleImage();a.node.image=a.rs.oldImage},redo:function(){var a=this.param;a.node.toggleImage();a.node.image=a.rs.newImage}})};c.handleOtherTypeClick=function(a,d,c){if(d.otherType!=a){var f,n=d.otherType;a=d.otherType=a;2==d.otherType&&d.dest&&(f=g.removeOptionConnOfNode(c,d));g.markChange();b.register({descript:"\u66f4\u6539\u5176\u4ed6\u9009\u9879\u7c7b\u578b",param:{node:c,other:d,oldType:n,newType:a,conns:f||[],manager:g},undo:function(){var a=this.param;a.other.otherType=a.oldType;for(var b=0;b<a.conns.length;b++)a.manager.addConnection(a.conns[b])},redo:function(){var a=this.param;a.other.otherType=a.newType;0<a.conns.length&&a.manager.removeOptionConnOfNode(a.node,a.other)}})}};c.handleFillRequireClick=function(a){a.fillRequired=!a.fillRequired;g.markChange();b.register({descript:"\u6253\u5f00/\u5173\u95ed\u5176\u4ed6\u9009\u9879\u5907\u6ce8\u5fc5\u586b",param:{other:a},undo:function(){var a=this.param;a.other.fillRequired=!a.other.fillRequired},redo:function(){var a=this.param;a.other.fillRequired=!a.other.fillRequired}})};c.handleMultipleMaxChangeClick=function(a,d){var c=parseInt(a.multipleMax)||0,f=c+d,f=f<a.multipleMin?a.multipleMin:f,f=f>a.options.length?a.options.length:f;a.multipleMax=0>f?0:f;c!=a.multipleMax&&(g.markChange(),b.register({descript:"\u66f4\u6539\u591a\u9009\u6700\u5927\u503c",param:{obj:a,key:"multipleMax",oldValue:c,newValue:a.multipleMax}}))};c.handleMultipleMaxChange=function(a,b){if(!b){var d=parseInt(a.multipleMax)||0;a.multipleMax=0>d?0:d}g.recordCommonChange(a,"multipleMin",b,"\u66f4\u6539\u591a\u9009\u6700\u5927\u503c")};c.handleMultipleMinChangeClick=function(a,d){var c=parseInt(a.multipleMin)||0,f=c+d,f=0>f?0:f,f=f>a.multipleMax?a.multipleMax:f;a.multipleMin=f;c!=a.multipleMin&&(g.markChange(),b.register({descript:"\u66f4\u6539\u591a\u9009\u6700\u5c0f\u503c",param:{obj:a,key:"multipleMin",oldValue:c,newValue:a.multipleMin}}))};c.handleMultipleMinChange=function(a,b){if(!b){var d=parseInt(a.multipleMin)||0;a.multipleMin=0>d?0:d}g.recordCommonChange(a,"multipleMin",b,"\u66f4\u6539\u591a\u9009\u6700\u5c0f\u503c")};c.handleMarkMinChange=function(a,b){if(!b){var d=parseInt(a.markMin)||0;a.markMin=0>d?0:d}g.recordCommonChange(a,"markMin",b,"\u66f4\u6539\u6253\u5206\u6700\u5c0f\u503c")};c.handleMarkMaxChange=function(a){if(!type){var b=parseInt(a.markMax)||0;a.markMax=0>b?0:b}g.recordCommonChange(a,"markMax",type,"\u66f4\u6539\u6253\u5206\u6700\u5927\u503c")};c.handleMarkMinChangeClick=function(a,d){var c=parseInt(a.markMin)||0,f=c+d,f=0>f?0:f,f=f>a.markMax?a.markMax:f;a.markMin=f;c!=a.markMin&&(g.markChange(),b.register({descript:"\u66f4\u6539\u6253\u5206\u6700\u5c0f\u503c",param:{obj:a,key:"markMin",oldValue:c,newValue:a.markMin}}))};c.handleMarkMaxChangeClick=function(a,d){var c=parseInt(a.markMax)||0,f=c+d,f=f<a.markMin?a.markMin:f;a.markMax=0>f?0:f;c!=a.markMax&&(g.markChange(),b.register({descript:"\u66f4\u6539\u6253\u5206\u6700\u5927\u503c",param:{obj:a,key:"markMax",oldValue:c,newValue:a.markMax}}))};c.handleOnlyNumberInputKeyDown=function(a){ZYDesign.TextUtil.isNumberInputKey(a.keyCode)&&!a.shiftKey||a.preventDefault()};c.handleMultipleSelectToggleClick=function(a){var d={conns:[],oldMax:void 0,oldMin:void 0,node:a,manager:g};a.multipleSelect=!a.multipleSelect;a.multipleSelect&&a.hasOptionDest()&&(d.conns=g.removeOptionConnOfNode(a));a.multipleSelect||(d.oldMax=a.multipleMax,d.oldMin=a.multipleMin);a.setOptionEnable();g.markChange();b.register({descript:"\u6253\u5f00/\u5173\u95ed\u591a\u9009",param:d,undo:function(){var a=this.param;a.node.multipleSelect=!a.node.multipleSelect;if(a.node.multipleSelect)a.node.multipleMax=a.oldMax,a.node.multipleMin=a.oldMin;else for(var b=0;b<a.conns.length;b++)a.manager.addConnection(a.conns[b])},redo:function(){var a=this.param;a.node.multipleSelect=!a.node.multipleSelect;a.node.multipleSelect&&a.manager.removeOptionConnOfNode(a.node)}})};c.handleToggleAnswerRequireClick=function(a){a instanceof d.SubjectNode&&(a.answerRequired=!a.answerRequired,g.markChange(),b.register({descript:"\u5f00\u542f/\u5173\u95ed\u5fc5\u7b54",param:{node:a},undo:function(){var a=this.param;a.node.answerRequired=!a.node.answerRequired},redo:function(){var a=this.param;a.node.answerRequired=!a.node.answerRequired}}))};c.handleToggleRandomOpenClick=function(a){if(a instanceof d.MatrixNode){var c=a.randomOptionX,f=a.randomOptionY;a.randomOpen=!a.randomOpen;a.randomOpen||(a.randomOptionX=!1,a.randomOptionY=!1);b.register({descript:"\u6253\u5f00/\u5173\u95ed\u77e9\u9635\u9009\u9879\u968f\u673a",param:{node:a,oldX:c,oldY:f},undo:function(){var a=this.param;a.node.randomOpen=!a.node.randomOpen;a.node.randomOpen?(a.node.randomOptionX=a.oldX,a.node.randomOptionY=a.oldY):(a.node.randomOptionX=!1,a.node.randomOptionY=!1)},redo:function(){var a=this.param;a.node.randomOpen=!a.node.randomOpen;a.node.randomOpen||(a.node.randomOptionX=!1,a.node.randomOptionY=!1)}})}};c.handleToggleRandomOptionYClick=function(a){if(a instanceof d.SubjectNode){var c=a.loopOptionY;a.randomOptionY=!a.randomOptionY;a.type==f.NODETYPE.MATRIX&&a.randomOptionY&&(a.loopOptionY=!1);g.markChange();b.register({descript:"\u5f00\u542f/\u5173\u95ed\u6a2a\u9009\u9879\u968f\u673a",param:{node:a,oldLoopY:c},undo:function(){var a=this.param;a.node.randomOptionY=!a.node.randomOptionY;a.node.isTypeOf("MATRIX")&&(a.node.loopOptionY=a.node.randomOptionY?!1:a.oldLoopY)},redo:function(){var a=this.param;a.node.randomOptionY=!a.node.randomOptionY;a.node.isTypeOf("MATRIX")&&a.node.randomOptionY&&(a.node.loopOptionY=!1)}})}};c.handleToggleRandomOptionXClick=function(a){if(a instanceof d.MatrixNode){var c=a.loopOptionX;a.randomOptionX=!a.randomOptionX;a.randomOptionX&&(a.loopOptionX=!1);g.markChange();b.register({descript:"\u5f00\u542f/\u5173\u95ed\u7eb5\u9009\u9879\u968f\u673a",param:{node:a,oldLoopX:c},undo:function(){var a=this.param;a.node.randomOptionX=!a.node.randomOptionX;a.node.loopOptionX=a.node.randomOptionX?!1:a.oldLoopX},redo:function(){var a=this.param;a.node.randomOptionX=!a.node.randomOptionX;a.node.randomOptionX&&(a.node.loopOptionX=!1)}})}};c.handleToggleLoopOpenClick=function(a){if(a instanceof d.MatrixNode){var c=a.loopOptionX,f=a.loopOptionY;a.loopOpen=!a.loopOpen;a.loopOpen||(a.loopOptionX=!1,a.loopOptionY=!1);b.register({descript:"\u6253\u5f00/\u5173\u95ed\u56fa\u5b9a\u4f4d\u5faa\u73af",param:{node:a,oldX:c,oldY:f},undo:function(){var a=this.param;a.node.loopOpen=!a.node.loopOpen;a.node.loopOpen?(a.node.loopOptionX=a.oldX,a.node.loopOptionY=a.oldY):(a.node.loopOptionX=!1,a.node.loopOptionY=!1)},redo:function(){var a=this.param;a.node.loopOpen=!a.node.loopOpen;a.node.loopOpen||(a.node.loopOptionX=!1,a.node.loopOptionY=!1)}})}};c.handleToggleLoopOptionYClick=function(a){if(a instanceof d.MatrixNode){var c=a.randomOptionY;a.loopOptionY=!a.loopOptionY;a.loopOptionY&&(a.randomOptionY=!1);g.markChange();b.register({descript:"\u5f00\u542f/\u5173\u95ed\u884c\u56fa\u5b9a\u4f4d\u5faa\u73af",param:{node:a,oldRandomY:c},undo:function(){var a=this.param;a.node.loopOptionY=!a.node.loopOptionY;a.node.randomOptionY=a.node.loopOptionY?!1:a.oldRandomY},redo:function(){var a=this.param;a.node.loopOptionY=!a.node.loopOptionY;a.node.loopOptionY&&(a.node.randomOptionY=!1)}})}};c.handleToggleLoopOptionXClick=function(a){if(a instanceof d.MatrixNode){var c=a.randomOptionX;a.loopOptionX=!a.loopOptionX;a.loopOptionX&&(a.randomOptionX=!1);g.markChange();b.register({descript:"\u5f00\u542f/\u5173\u95ed\u5217\u56fa\u5b9a\u4f4d\u5faa\u73af",param:{node:a,oldRandomX:c},undo:function(){var a=this.param;a.node.loopOptionX=!a.node.loopOptionX;a.node.randomOptionX=a.node.loopOptionX?!1:a.oldRandomX},redo:function(){var a=this.param;a.node.loopOptionX=!a.node.loopOptionX;a.node.loopOptionX||(a.node.randomOptionX=!1)}})}};c.handleAddOptionBatchClick=function(){g.optionBatchAddManager.open()};c.handleAddOptionClick=function(){g.addOptionForCurrentNode()};c.handleNodeLocateClick=function(a){g.takeToCenter(a)};c.handleImgBorderTypeClick=function(a,d){if(d!=a.borderType&&!a.isDisabledBorderType(d)){var c=a.borderType,f=a.borderType=d;g.markChange();b.register({descript:"\u66f4\u6539\u56fe\u7247\u8fb9\u6846\u7c7b\u578b",param:{node:a,oldType:c,newType:f},undo:function(){var a=this.param;a.node.borderType=a.oldType},redo:function(){var a=this.param;a.node.borderType=a.newType}})}};c.handleImgListTypeClick=function(a,d){if((3!=d||ZYDesign.Config.developMode)&&d!=a.listType){var c=a.borderType,f=a.listType;a.isDisabledListType(d)&&(a.borderType=1);var n=a.borderType,m=a.listType=d;g.markChange();b.register({descript:"\u66f4\u6539\u56fe\u7247\u5217\u8868\u65b9\u5f0f",param:{node:a,oldBorderType:c,oldListType:f,newBorderType:n,newListType:m},undo:function(){var a=this.param;a.node.borderType=a.oldBorderType;a.node.listType=a.oldListType},redo:function(){var a=this.param;a.node.borderType=a.newBorderType;a.node.listType=a.newListType}})}};c.handleUploaderMaskClick=function(){g.imageUploadManager.close()};c.handleMarkTypeClick=function(a,d){if((1!=a&&3!=a||ZYDesign.Config.developMode)&&a!=d.markType){var c=d.markType,f=d.markType=a;d.markType=a;g.markChange();b.register({descript:"\u66f4\u6539\u6253\u5206\u65b9\u5f0f",param:{node:d,oldType:c,newType:f},undo:function(){var a=this.param;a.node.markType=a.oldType},redo:function(){var a=this.param;a.node.markType=a.newType}})}};c.handleMarkImgCodeClick=function(a,d){if(d!=a.markImgCode){var c=a.markImgCode,f=a.markImgCode=d;a.markImgCode=d;g.markChange();b.register({descript:"\u66f4\u6539\u6253\u5206\u56fe\u6807",param:{node:a,oldCode:c,newCode:f},undo:function(){var a=this.param;a.node.markImgCode=a.oldCode},redo:function(){var a=this.param;a.node.markImgCode=a.newCode}})}};c.handleMarkImgCountClick=function(a,d){if(a!=d.markImgCount){var c=d.markImgCount,f=d.markImgCount=a;g.markChange();b.register({descript:"\u66f4\u6539\u6253\u5206\u56fe\u7247\u6570",param:{node:d,oldCount:c,newCount:f},undo:function(){var a=this.param;a.node.markImgCount=a.oldCount},redo:function(){var a=this.param;a.node.markImgCount=a.newCount}})}};c.handleAddMarkItemClick=function(a){a.addMarkItem();g.markChange()};c.handleDeleteMarkItemClick=function(a,b){a.removeMarkItem(b);g.markChange()};c.handleShowMarkValueClick=function(a){a.showMarkValue=!a.showMarkValue;g.markChange();b.register({descript:"\u5f00\u542f/\u5173\u95ed\u663e\u793a\u9ed8\u8ba4\u5206\u503c",param:{node:a},undo:function(){var a=this.param;a.node.showMarkValue=!a.node.showMarkValue},redo:function(){var a=this.param;a.node.showMarkValue=!a.node.showMarkValue}})};c.handleShowMarkValueDescribeClick=function(a){a.showMarkValueDescribe=!a.showMarkValueDescribe;g.markChange();b.register({descript:"\u5f00\u542f/\u5173\u95ed\u4f7f\u7528\u5206\u503c\u63cf\u8ff0",param:{node:a},undo:function(){var a=this.param;a.node.showMarkValueDescribe=!a.node.showMarkValueDescribe},redo:function(){var a=this.param;a.node.showMarkValueDescribe=!a.node.showMarkValueDescribe}})};c.handleDefaultMarkChange=function(a,b){if(!b){var d=parseInt(a.defaultMark);if(d<a.markMin||d>a.markMax)d=a.markMin;a.defaultMark=d}g.recordCommonChange(a,"defaultMark",b,"\u66f4\u6539\u9ed8\u8ba4\u5206\u503c")};c.handleDefaultMarkChangeClick=function(a,d){var c=a.defaultMark,f=c+d;f<a.markMin?f=a.markMin:f>a.markMax&&(f=a.markMax);a.defaultMark=f;c!=a.defaultMark&&(g.markChange(),b.register({descript:"\u66f4\u6539\u9ed8\u8ba4\u5206\u503c",param:{obj:a,key:"defaultMark",oldValue:c,newValue:a.defaultMark}}))};c.handleOtherOptionNumberChange=function(a,b){b||(a.number=parseInt(a.number),a.number=isNaN(a.number)?0:a.number);g.recordCommonChange(a,"number",b,"\u66f4\u6539\u5176\u4ed6\u9009\u9879\u7f16\u53f7")};c.handleNodeDescribeChange=function(a,b){g.recordCommonChange(a,"originText",b,"\u66f4\u6539\u8282\u70b9\u63cf\u8ff0")};c.handleOtherOptionTextChange=function(a,b){g.recordCommonChange(a,"originText",b,"\u66f4\u6539\u5176\u4ed6\u9009\u9879\u63cf\u8ff0")};c.handleNodeNameChange=function(a,b){g.recordCommonChange(a,"nodeName",b,"\u66f4\u6539\u8282\u70b9\u540d")};c.handleMarkMinTextChange=function(a,b){g.recordCommonChange(a,"minText",b,"\u66f4\u6539\u4f4e\u5206\u8bc4\u4ef7")};c.handleMarkMidTextChange=function(a,b){g.recordCommonChange(a,"midText",b,"\u66f4\u6539\u4e2d\u5206\u8bc4\u4ef7")};c.handleMarkMaxTextChange=function(a,b){g.recordCommonChange(a,"maxText",b,"\u66f4\u6539\u9ad8\u5206\u8bc4\u4ef7")};c.handleLinkUrlChange=function(a,b){g.recordCommonChange(a,"linkUrl",b,"\u66f4\u6539\u94fe\u63a5\u5730\u5740")};c.onLogicRelatedSubjectChange=function(a){a.relatedSubject=g.searchSubjectById(a.subjectId);g.markChange()};c.onLogicAddIconClick=function(a){a.addOption({});g.markChange()};c.onLogicDeleteIconClick=function(a,b){for(var d=0;d<b.options.length;d++)if(a==b.options[d]){b.removeOption(d);break}g.markChange()};c.onRequireAddIconClick=function(a){a.addRequire({arithmetic:0,limitType:0,answerFirst:"\u7b54\u6848\u4e00",answerSecond:"\u7b54\u6848\u4e8c"});g.markChange()};c.onRequireDeleteIconClick=function(a,b){b.removeRequire(a);g.markChange()};c.onProvinceIdChange=function(a){a.cityId=null;a.countyId=null;g.markChange()};c.onCityIdChange=function(a){a.countyId=null;g.markChange()};c.onRemoveLoopVariableClick=function(a,b){a.removeVariable(b)};c.onAddLoopVariableClick=function(a){a.addVariable("")};c.handleCommonAttrChange=function(a){g.markChange(a)};c.onCommentChange=function(a){a.type==f.NODETYPE.COMMENT&&a.updateTexts()};c.handleNodeEditorHelpClick=function(a,b){a.stopPropagation();g.helpManager.help(a,b)}}]);angular.module("nodeFlow",["dragging","contextMenu"]).directive("nodeFlow",function(){function c(a){a=$(a.currentTarget).find("circle");var b=a.attr("class")+" mouseover_connector_circle";a.attr("class",b)}function a(a){a=$(a.currentTarget).find("circle");var b=a.attr("class").replace(" mouseover_connector_circle","");a.attr("class",b)}function b(a){$(a.currentTarget).find(".elem_warning_msg").show()}function d(a){$(a.currentTarget).find(".elem_warning_msg").hide()}return{restrict:"A",templateUrl:"/Content/QSNR/node_flow_template.html",replace:!0,scope:{designManager:"\x3dnodeFlow"},controller:"NodeFlowController",link:function(f,g){var h=f.designManager;g.on("contextmenu",function(a){h.contextMenu.open(a.pageX,a.pageY);h.digest();a.preventDefault()});$(document.body).on("mousedown",function(){h.contextMenu.isVisible()&&(h.contextMenu.close(),h.digest())});g.delegate(".flow_connector",{mouseenter:c,mouseleave:a}).delegate(".elem_warn_icon",{mouseenter:b,mouseleave:d})}}}).controller("NodeFlowController",["$scope","dragging","$element","recordManager",function(c,a,b,d){var f=c.designManager,g=ZYDesign.Hinter,h=ZYDesign.Environment,l=null;connOptrType="none";c.handleFlowMouseDown=function(c){$(document.activeElement).blur();f.contextMenu.close();var g,n;a.startDrag(c,{dragStarted:function(a,d,c){c=h.isMac?c.metaKey:c.ctrlKey;f.disableConns();g=n=f.translateCoordinates(a,d,b);c&&f.selectRectManager.start((g.x-f.chartXDiffer)/f.chartZoomRate+f.chartXDiffer,(g.y-f.chartYDiffer)/f.chartZoomRate+f.chartYDiffer);this.options.silent&&f.digest()},dragging:function(a,d,c){c=h.isMac?c.metaKey:c.ctrlKey;a=f.translateCoordinates(a,d,b);c?(f.selectRectManager.resize((a.x-f.chartXDiffer)/f.chartZoomRate+f.chartXDiffer,(a.y-f.chartYDiffer)/f.chartZoomRate+f.chartYDiffer),this.options.silent&&f.selectRectManager.fixPosition()):(f.selectRectManager.reset(),d=a.x-g.x,c=a.y-g.y,0==d&&0==c||f.moveNodes(d,c),this.options.silent&&f.updateNodeFlowPosition());g=a},dragEnded:function(a){a=h.isMac?a.metaKey:a.ctrlKey;f.enableConns();a?f.selectRectManager.finish():(f.selectRectManager.reset(),d.register({descript:"\u753b\u5e03\u79fb\u52a8",param:{deltaX:g.x-n.x,deltaY:g.y-n.y},redo:function(){f.moveNodes(this.param.deltaX,this.param.deltaY);f.checkVisibleOfNodesAndConns();f.markChange(!0)},undo:function(){f.moveNodes(-this.param.deltaX,-this.param.deltaY);f.checkVisibleOfNodesAndConns();f.markChange(!0)}}));f.markChange(!0)},clicked:function(){2!=c.button&&(f.deselectAll(),f.currentNode=null)},options:{silent:ZYDesign.Config.draggingSilent}})};c.handleFlowMouseUp=function(a){f.removeTempConnection()};c.handleNodeMouseDown=function(c,g){var n=h.isMac?c.metaKey:c.ctrlKey;$(document.activeElement).blur();f.contextMenu.close();n?g.isSelected()?g.deselect():g.select():g.isSelected()||f.selectNodeSingle(g);var m,q;a.startDrag(c,{dragStarted:function(a,d){f.disableConns();m=q=f.translateCoordinates(a,d,b);this.options.silent&&f.digest()},dragging:function(a,d){var c=f.translateCoordinates(a,d,b);f.moveNodes(c.x-m.x,c.y-m.y,!0);this.options.silent&&f.updateNodeFlowPosition(!0);m=c},dragEnded:function(){f.enableConns();var a=f.getSelectedNodes();d.register({descript:"\u8282\u70b9\u79fb\u52a8",param:{nodes:a,deltaX:m.x-q.x,deltaY:m.y-q.y},redo:function(){var a=this.param;f.moveSpecifiedNodes(a.nodes,a.deltaX,a.deltaY);f.markChange(!0)},undo:function(){var a=this.param;f.moveSpecifiedNodes(a.nodes,-a.deltaX,-a.deltaY);f.markChange(!0)}});f.markChange(!0)},clicked:function(a){if(h.isMac?a.metaKey:a.ctrlKey)f.currentNode=null},options:{silent:ZYDesign.Config.draggingSilent}})};c.handleConnectorMouseUp=function(a,b){if(f.tempConncetion){var c=f.tempConncetion.source,m=b;c.isFake&&(c=b,m=f.tempConncetion.dest);b.exactType!=ZYDesign.Enum.CONNEXACTTYPE.OPTION||b.parent.isSingleSelect()||f.removeTempConnection();c=f.getConnectPermition(c,m);c.allowConnect?(f.tempConncetion.dest.isFake?f.tempConncetion.dest=b:f.tempConncetion.source=b,c=f.applyTempConnection(),f.markChange(!0),"move"==connOptrType?(d.register({descript:"\u79fb\u52a8\u66f4\u6539\u8fde\u63a5",param:{manager:f,oldConn:l,newConn:c},undo:function(){var a=this.param;a.manager.removeConnection(a.newConn);a.oldConn.disable=!1;a.manager.addConnection(a.oldConn)},redo:function(){var a=this.param;a.manager.removeConnection(a.oldConn);a.manager.addConnection(a.newConn)}}),l=null):"add"==connOptrType&&d.register({descript:"\u6dfb\u52a0\u8fde\u63a5",param:{manager:f,conn:c},undo:function(){var a=this.param;a.manager.removeConnection(a.conn)},redo:function(){var a=this.param;a.manager.addConnection(a.conn)}})):(g.hint(c.message),f.removeTempConnection())}};c.handleConnectorMouseDown=function(d,c){$(document.activeElement).blur();f.contextMenu.close();d.stopPropagation();var h,m;a.startDrag(d,{dragStarted:function(a,d){if(c.exactType!=ZYDesign.Enum.CONNEXACTTYPE.OPTION||c.parent.isSingleSelect())if(c.dest&&c.type==ZYDesign.Enum.CONNTYPE.OUTPUT&&c.exactType!=ZYDesign.Enum.CONNEXACTTYPE.RANDOMSTART)g.hint(Prompt.QSNRD_ConnForbidMultiOutput);else{f.disableConns();h=f.translateCoordinates(a,d,b);m={isFake:!0,circleX:c.getCircleX(),circleY:c.getCircleY(),getCircleX:function(){return this.circleX},getCircleY:function(){return this.circleY},parent:c.parent,type:c.type,dest:c.dest};var u=c,r=m;c.type==ZYDesign.Enum.CONNTYPE.INPUT&&(u=m,r=c);connOptrType="add";f.tempConncetion=f.createConnection(u,r,!0);f.addConnection(f.tempConncetion);this.options.silent&&f.digest()}else g.hint("\u591a\u9009\u9898\u4e0d\u80fd\u4ece\u9009\u9879\u8f93\u51fa\uff01")},dragging:function(a,d){if(m){var c=f.translateCoordinates(a,d,b),g=c.y-h.y;m.circleX+=(c.x-h.x)/f.chartZoomRate;m.circleY+=g/f.chartZoomRate;this.options.silent&&f.tempConncetion.fixPosition();h=c}},dragEnded:function(){f.enableConns();connOptrType="none"},clicked:function(){},options:{silent:ZYDesign.Config.draggingSilent}})};c.handleConnectionMouseDown=function(c,g){$(document.activeElement).blur();f.contextMenu.close();f.deselectAll();g.select&&g.select();var h,m;a.startDrag(c,{dragStarted:function(a,d){f.disableConns();h=f.translateCoordinates(a,d,b);var c=(h.x-f.chartXDiffer*(1-f.chartZoomRate))/f.chartZoomRate,r=(h.y-f.chartYDiffer*(1-f.chartZoomRate))/f.chartZoomRate,w=c-g.sourceCoordX()-f.chartXDiffer,v=r-g.sourceCoordY()-f.chartYDiffer,c=c-g.destCoordX()-f.chartXDiffer,s=r-g.destCoordY()-f.chartYDiffer,y=Math.abs(w)+Math.abs(v),C=Math.abs(c)+Math.abs(s),p=r=null,x=0,A=0;y>C?(r=g.source,p=g.dest,x=p.getCircleX()+c,A=p.getCircleY()+s):(r=g.dest,p=g.source,x=p.getCircleX()+w,A=p.getCircleY()+v);f.removeConnection(g);g.deselect();g.unhover();l=g;connOptrType="move";m={isFake:!0,circleX:x,circleY:A,getCircleX:function(){return this.circleX},getCircleY:function(){return this.circleY},parent:p.parent,type:p.type,dest:p.dest};w=r;v=m;r.type==ZYDesign.Enum.CONNTYPE.INPUT&&(w=m,v=r);f.tempConncetion=f.createConnection(w,v,!0);f.addConnection(f.tempConncetion);this.options.silent&&f.digest()},dragging:function(a,d){var c=f.translateCoordinates(a,d,b),g=c.y-h.y;m.circleX+=(c.x-h.x)/f.chartZoomRate;m.circleY+=g/f.chartZoomRate;this.options.silent&&f.tempConncetion.fixPosition();h=c},dragEnded:function(){f.enableConns();l&&(d.register({descript:"\u62d6\u62fd\u4e22\u5f03\u8fde\u63a5",param:{conn:l,manager:f},undo:function(){var a=this.param;a.conn.disable=!1;a.manager.addConnection(a.conn)},redo:function(){var a=this.param;a.manager.removeConnection(a.conn)}}),l=null);connOptrType="none"},options:{silent:ZYDesign.Config.draggingSilent}});c.stopPropagation()};c.handleConnectionMouseEnter=function(a,b){b.hover instanceof Function&&b.hover()};c.handleConnectionMouseLeave=function(a,b){b.unhover instanceof Function&&b.unhover();a.stopPropagation()};c.handleExpansionClick=function(a,b){var c=0.6<f.chartZoomRate;b.toggleExpansion(c);f.markChange();d.register({descript:"\u6253\u5f00\u5173\u95ed\u8282\u70b9",param:{node:b,changeText:c},undo:function(){var a=this.param;a.node.toggleExpansion(a.changeText)},redo:function(){var a=this.param;a.node.toggleExpansion(a.changeText)}})};c.handleExpansionClickDisable=function(a){a.stopPropagation()};c.handleNodeDbClick=function(a){f.optionBatchAddManager.open()};c.handleOptionXMouseDown=function(a){a.rowHiding=!0};c.handleOptionYMouseDown=function(a){a.rowHiding=!1}}]);angular.module("nodeSearcher",["dragging"]).directive("nodeSearcher",function(){return{restrict:"A",templateUrl:"/Content/QSNR/node_searcher_template.html",replace:!0,scope:{designManager:"\x3dnodeSearcher"},controller:"NodeSearcherController"}}).controller("NodeSearcherController",["$scope","dragging","recordManager",function(c,a,b){c.handleResultMouseDown=function(b){$(document.activeElement).blur();var c,g=this;a.startDrag(b,{dragStarted:function(a,b){g.designManager.disableConns();c={x:a,y:b};this.options.silent&&g.designManager.digest()},dragging:function(a,b){var d={x:a,y:b},k=d.y-c.y;g.designManager.searchManager.x+=d.x-c.x;g.designManager.searchManager.y+=k;this.options.silent&&g.designManager.searchManager.fixPosition();c=d},dragEnded:function(){g.designManager.enableConns()},clicked:function(){},options:{silent:ZYDesign.Config.draggingSilent}})};c.handleResultItemClick=function(a){this.designManager.selectNodeSingle(a);this.designManager.takeToCenter(a)};c.handleCloseResultClick=function(){this.designManager.searchManager.close()}}]);angular.module("nodeValidator",["dragging"]).directive("nodeValidator",function(){return{restrict:"A",templateUrl:"/Content/QSNR/node_validator_template.html",replace:!0,scope:{designManager:"\x3dnodeValidator"},controller:"NodeValidatorController"}}).controller("NodeValidatorController",["$scope","dragging","recordManager",function(c,a,b){c.handleValidatorMouseDown=function(b){$(document.activeElement).blur();var c,g=this;a.startDrag(b,{dragStarted:function(a,b){g.designManager.disableConns();c={x:a,y:b};this.options.silent&&g.designManager.digest()},dragging:function(a,b){var d={x:a,y:b},k=d.y-c.y;g.designManager.validateManager.x+=d.x-c.x;g.designManager.validateManager.y+=k;this.options.silent&&g.designManager.validateManager.fixPosition();c=d},dragEnded:function(){g.designManager.enableConns()},clicked:function(){},options:{silent:ZYDesign.Config.draggingSilent}})};c.handleValidatorItemClick=function(a){this.designManager.selectNodeSingle(a);this.designManager.takeToCenter(a)};c.handleCloseValidatorClick=function(){this.designManager.validateManager.close()}}]);angular.module("themeBox",[]).directive("themeBox",function(){return{restrict:"A",templateUrl:"/Content/QSNR/theme_box_template.html",replace:!0,scope:{themeBoxManager:"\x3dthemeBox"},controller:"ThemeBoxManager",link:function(c,a){var b=c.themeBoxManager,d={layout:"hex",submit:0,color:b.theme.bgColor,onChange:function(a,d,c,l,p){a=$(l).attr("data-id");b.change(a,"#"+d)}};a.find(".color_picker").on("click",function(a){ZYDesign.RecordManager.upgrade();key=$(a.currentTarget).attr("data-id");$(a.currentTarget).colpickSetColor(b.theme[key],!0)});a.find(".color_picker").colpick(d)}}}).controller("ThemeBoxManager",["$scope","recordManager",function(c,a){var b=c.themeBoxManager;c.handleThemeCaseClick=function(a){b.apply(a)};c.handleCloseIconClick=function(){b.close()};c.handleAAddCustomClick=function(){b.saveAsCustom()};c.handleDelCustomClick=function(a){b.removeCustom(a)}}]);angular.module("validateOption",[]).directive("validateOption",function(){return{restrict:"A",templateUrl:"/Content/QSNR/validate_option_template.html",replace:!0,scope:{target:"\x3dvalidateOption"},controller:"ValidateOptionController"}}).controller("ValidateOptionController",["$scope","recordManager",function(c,a){c.dict=ZYDesign.Dict.ValidateTypeDict;var b=ZYDesign.DesignManager;c.handleCurrTypeClick=function(a){a.showValidateList=!a.showValidateList};c.handleTypeItemClick=function(d,c,g){if(d.validateType!=c.id){d.showValidateList=!1;var h=d.validateType,l=d.validateStart,p=d.validateEnd;d.validateType=c.id;3<d.validateType&&(d.validateStart=0,d.validateEnd=50);c=d.validateType;var k=d.validateStart,n=d.validateEnd;b.markChange();g.stopPropagation();a.register({descript:"\u66f4\u6539\u6821\u9a8c\u9009\u9879\u65b9\u5f0f",param:{target:d,oldType:h,oldStart:l,oldEnd:p,newType:c,newStart:k,newEnd:n},undo:function(){var a=this.param;a.target.validateType=a.oldType;a.target.validateStart=a.oldStart;a.target.validateEnd=a.oldEnd},redo:function(){var a=this.param;a.target.validateType=a.newType;a.target.validateStart=a.newStart;a.target.validateEnd=a.newEnd}})}};c.handleValidateEndChangeClick=function(d,c){var g=parseInt(d.validateEnd)||0,h=g+c,h=h<d.validateStart?d.validateStart:h;d.validateEnd=0>h?0:h;d.validateEnd=99999<h?99999:h;g!=d.validateEnd&&(b.markChange(),a.register({descript:"\u66f4\u6539\u6821\u9a8c\u7ed3\u675f\u503c",param:{obj:d,key:"validateEnd",oldValue:g,newValue:d.validateEnd}}))};c.handleValidateEndChange=function(a,c){if(!c){var g=parseInt(a.validateEnd)||0;a.validateEnd=0>g?0:g}b.recordCommonChange(a,"validateEnd",c,"\u66f4\u6539\u6821\u9a8c\u7ed3\u675f\u503c")};c.handleValidateStartChangeClick=function(d,c){var g=parseInt(d.validateStart)||0,h=g+c,h=0>h?0:h,h=h>d.validateEnd?d.validateEnd:h;d.validateStart=h;g!=d.validateStart&&(b.markChange(),a.register({descript:"\u66f4\u6539\u6821\u9a8c\u5f00\u59cb\u503c",param:{obj:d,key:"validateStart",oldValue:g,newValue:d.validateStart}}))};c.handleValidateStartChange=function(a,c){if(!c){var g=parseInt(a.validateStart)||0;a.validateStart=0>g?0:g}b.recordCommonChange(a,"validateStart",c,"\u66f4\u6539\u6821\u9a8c\u5f00\u59cb\u503c")};c.handleOnlyNumberInputKeyDown=function(a){ZYDesign.TextUtil.isNumberInputKey(a.keyCode)&&!a.shiftKey||a.preventDefault()};c.handleListMouseLeave=function(a){a.showValidateList=!1};c.handleErrorMsgChange=function(a,c){b.recordCommonChange(a,"errorMsg",c,"\u66f4\u6539\u6821\u9a8c\u9519\u8bef\u63d0\u793a\u6d88\u606f")};c.handleValidateHelpClick=function(a,c){b.helpManager.help(a,c)}}]);angular.module("versionHistory",[]).directive("versionHistory",function(){return{restrict:"A",templateUrl:"/Content/QSNR/version_history_template.html",replace:!0,scope:{versionHistoryManager:"\x3dversionHistory"},controller:"VersionHistoryController"}}).controller("VersionHistoryController",["$scope","recordManager",function(c,a){c.handleDeleteIconClick=function(a,d){var c=this;confirm(Prompt.QSNRD_ConfirmVersionDelete,function(){c.versionHistoryManager.deleteVersion(a)},null,"\u662f","","\u5426");d.stopPropagation()};c.handleChangeIconClick=function(a){this.versionHistoryManager.changeVersionName(a);event.stopPropagation()};c.handleVersionItemClick=function(a){this.versionHistoryManager.importVersion(a.verID)};c.handleVersionSaveClick=function(){this.versionHistoryManager.saveVersion()}}]);angular.module("versionSave",[]).directive("versionSave",function(){function c(b){9==b.keyCode?b.preventDefault():27==b.keyCode?(a.close(),a.digest()):13==b.keyCode&&(a.save(),a.digest())}var a;return{restrict:"A",templateUrl:"/Content/QSNR/version_save_template.html",replace:!0,scope:{versionSaveManager:"\x3dversionSave"},controller:"VersionSaveController",link:function(b,d){a=b.versionSaveManager;d.find("input").on("keydown",c)}}}).controller("VersionSaveController",["$scope","recordManager",function(c,a){c.handleCancleVersionClick=function(){this.versionSaveManager.close()};c.handleSaveVersionClick=function(){this.versionSaveManager.save()}}]);angular.module("videoSet",[]).directive("videoSet",function(){return{restrict:"A",templateUrl:"/Content/QSNR/video_set_template.html",replace:!0,scope:{},controller:"VideoSetController"}}).controller("VideoSetController","designManager"["$scope","recordManager",function(c,a,b){}]);angular.module("mouseCapture",[]).factory("mouseCapture",["$rootScope",function(c){var a=document,b=null,d=function(a){b&&b.mouseMove&&(b.mouseMove(a),b.options.silent||c.$digest())},f=function(a){b&&b.mouseUp&&(b.mouseUp(a),c.$digest())};return{registerElement:function(b){a=b},acquire:function(c,h){this.release();b=h;a.mousemove(d);a.mouseup(f)},release:function(c){b&&(b.released&&b.released(c),b=null);a.unbind("mousemove",d);a.unbind("mouseup",f)}}}]).directive("mouseCapture",function(){return{restrict:"A",controller:"MouseCaptureController"}}).controller("MouseCaptureController",["$element","mouseCapture",function(c,a){a.registerElement(c)}]);angular.module("dragging",["mouseCapture"]).factory("dragging",["$rootScope","mouseCapture",function(c,a){return{startDrag:function(b,d){var c=!1,g=b.pageX,h=b.pageY;a.acquire(b,{mouseMove:function(a){if(c)d.dragging&&d.dragging(a.pageX,a.pageY,a),g=a.pageX,h=a.pageY;else if(5<Math.abs(a.pageX-g)||5<Math.abs(a.pageY-h))c=!0,d.dragStarted&&d.dragStarted(g,h,a),d.dragging&&d.dragging(a.pageX,a.pageY,a)},mouseUp:function(b){a.release(b);b.stopPropagation();b.preventDefault()},released:function(a){c?d.dragEnded&&d.dragEnded(a):d.clicked&&d.clicked(a)},options:d.options||{}});b.stopPropagation();b.preventDefault()}}}]);angular.module("recordManager",[]).factory("recordManager",[function(){return new function(){function c(b){if(this instanceof c){this.compareId=this.index=-1;this.descript=b.descript||"\u65e0\u63cf\u8ff0";if(this.exclusive=b.exclusive||!1)this.compareId=a;this.param=b.param||{};b.redo instanceof Function&&(this.redo=b.redo);b.undo instanceof Function&&(this.undo=b.undo);b.merge instanceof Function&&(this.merge=b.merge);b.compare instanceof Function&&(this.compare=b.compare);c.prototype.undo||(c.prototype.undo=function(){this.param.obj&&(this.param.obj[this.param.key]=this.param.oldValue)},c.prototype.redo=function(){this.param.obj&&(this.param.obj[this.param.key]=this.param.newValue)},c.prototype.compare=function(a){return this.compareId==a.compareId},c.prototype.merge=function(a){this.compareId==a.compareId&&(this.param.newValue=a.param.newValue)})}}var a=0;this.recordList=[];this.currIndex=-1;this.engaging=!1;this.upgrade=function(){if(0!=this.recordList.length&&(a++,this.currIndex==this.recordList.length-1)){var b=this.recordList[this.currIndex];b.param.oldValue==b.param.newValue&&0<b.compareId&&(this.recordList.pop(),this.currIndex--)}};this.register=function(a){if(ZYDesign.Config.optrRecordEnable&&!this.engaging){a=new c(a);this.recordList.length>this.currIndex+1&&(this.recordList=this.recordList.slice(0,this.currIndex+1));var d=this.recordList[this.currIndex];a.exclusive&&d&&d.compare(a)?d.merge(a):(a.index=this.recordList.length,this.recordList.push(a),this.currIndex++)}};this.clear=function(){this.recordList=[];this.currIndex=-1};this.undo=function(){if(0>this.currIndex)return!1;this.engaging=!0;this.recordList[this.currIndex].undo();this.currIndex--;this.engaging=!1;return!0};this.redo=function(){if(this.currIndex==this.recordList.length-1)return!1;this.engaging=!0;this.currIndex++;this.recordList[this.currIndex].redo();this.engaging=!1;return!0};ZYDesign.RecordManager=this}}]);angular.module("designManager",[]).factory("designManager",["$timeout","$rootScope","$http","recordManager",function(c,a,b,d){return(new function(){function a(b){var d=$(document.body).width()-337,d=687<=d?d:687,c=$(document.body).height()-67;$("#chart_content").css("width",d).css("height",c);$("#chart_eye").css("width",0.15*d).css("height",0.15*c);k.chartXDiffer=d/2;k.chartYDiffer=c/2;k.eyeXDiffer=0.15*(d/2);k.eyeYDiffer=0.15*(c/2);k.getContainerInfo();console.log("container info initialized!");b&&(k.checkVisibleOfNodesAndConns(),k.digest())}function g(){if(ZYDesign.Config.tipsEnable){var a={"#node_box_Select":{side:2,msg:"\x3ch5 class\x3d'TipsTile'\x3e\u9009\u62e9\u9898\u8282\u70b9\x3c/h5\x3e\x3cp class\x3d'TipsTitle2'\x3e \u9009\u62e9\u9898\u7531\u9898\u76ee\u5185\u5bb9\u548c\u9009\u9879\u4e24\u90e8\u5206\u6784\u6210\u3002\x3c/br\x3e         \u9898\u76ee\u5185\u5bb9\u5c31\u662f\u7528\u9648\u8ff0\u53e5\u6216\u7591\u95ee\u53e5\u63cf\u8ff0\u51fa\u95ee\u9898\u7684\u60c5\u666f\u548c\u60f3\u83b7\u5f97\u5f97\u7b54\u6848\u3002\x3c/br\x3e         \u9009\u9879\u662f\u6307\u4e0e\u9898\u76ee\u5185\u5bb9\u6709\u76f4\u63a5\u5173\u8054\u7684\u5907\u9009\u7b54\u6848\u3002\x3c/br\x3e   \u201c\u5176\u4ed6\u201d\u9009\u9879\u6709\u52a9\u4e8e\u83b7\u5f97\u8fdb\u4e00\u6b65\u7684\u4fe1\u606f\uff0c\u7279\u522b\u662f\u5f53\u9009\u9879\u65e0\u6cd5\u8986\u76d6\u6240\u6709\u53ef\u80fd\u7684\u60c5\u51b5\u65f6\u3002\x3c/br\x3e\x3c/p\x3e\x3ch5  class\x3d'TipsTile'\x3e\u53c2\u8003\u793a\u610f\u56fe\x3c/h5\x3e\x3cimg src\x3d'/Images/TipsPics/tips_select.jpg'\x3e\x3ch5 class\x3d'TipsTile'\x3e\u5176\u4ed6\u4fe1\u606f:\x3c/h5\x3e\x3cul class\x3d'TipsTitle2'\x3e   \x3cli\x3e\u9ad8\u7ea7\u8bbe\u7f6e\u9762\u677f\u4e2d\u53ef\u8bbe\u5b9a\u672c\u9898\u662f\u5426\u5fc5\u7b54\u3002\x3c/li\x3e   \x3cli\x3e\u9ad8\u7ea7\u8bbe\u7f6e\u9762\u677f\u4e2d\u53ef\u8bbe\u5b9a\u591a\u9009\u9898\u548c\u9009\u9879\u968f\u673a\u3002\x3c/li\x3e  \x3cli\x3e\u53ef\u4e3a\u9009\u62e9\u9898\u6dfb\u52a0\u201c\u5176\u4ed6\u201d\u9009\u9879\u3002\x3c/li\x3e  \x3cli\x3e\u53ef\u4e3a\u9009\u62e9\u9898\u8282\u70b9\u8bbe\u5b9a\u9898\u76ee\u7684\u56fe\u7247\u3002\x3c/li\x3e  \x3cli\x3e\u9009\u9879\u524d\u7684\u5b57\u6bcd\u4e3a\u952e\u76d8\u5feb\u6377\u952e\uff0c\u5728\u4f7f\u7528\u952e\u76d8\u65f6\uff0c\u76f4\u63a5\u6309\u5b57\u6bcd\u952e\u5b8c\u6210\u9009\u62e9\u3002\x3c/li\x3e\x3c/ul\x3e"},"#node_box_Marking":{side:2,msg:"\u6253\u5206\u9898"},"#node_box_Fillblank":{side:2,msg:"\x3ch5 class\x3d'TipsTile'\x3e\u586b\u7a7a\u9898\u8282\u70b9\x3c/h5\x3e\x3cp class\x3d'TipsTitle2'\x3e\u586b\u7a7a\u9898\u7531\u95ee\u9898\u63cf\u8ff0\u548c\u586b\u7a7a\u9009\u9879\u6784\u6210\u3002\u901a\u5e38\u5148\u7ed9\u51fa\u95ee\u9898\u63cf\u8ff0\uff0c\u5728\u800c\u540e\u7684\u9009\u9879\u8f93\u5165\u6846\u4e2d\u8f93\u5165\u4e0e\u95ee\u9898\u5bf9\u5e94\u7684\u7b54\u6848\u3002\x3c/br\x3e\u95ee\u5377\u8bbe\u8ba1\u8fc7\u7a0b\u4e2d,\u8f93\u5165\u9009\u9879\u4e2d\u7684\u6587\u5b57\u5c06\u4ee5\u63d0\u793a\u4fe1\u606f\u7684\u5f62\u5f0f\u663e\u793a\u5728\u6700\u7ec8\u95ee\u5377\u4e2d,\u63d0\u793a\u53d7\u8bbf\u8005\u8f93\u5165\u6b63\u786e\u7684\u5185\u5bb9.\x3c/br\x3e\u53ef\u5bf9\u6587\u5b57\u5185\u5bb9\u8fdb\u884c\u9a8c\u8bc1,\u4f8b\u5982\u8f93\u5165\u5185\u5bb9\u5fc5\u987b\u4e3a\u6587\u5b57\u3001\u90ae\u7bb1\u5730\u5740\u7b49\u3002\x3c/br\x3e\x3c/p\x3e\x3ch5 class\x3d'TipsTile'\x3e\u53c2\u8003\u793a\u610f\u56fe\x3c/h5\x3e\x3cimg src\x3d'/Images/TipsPics/tips_input.jpg'\x3e\x3ch5 class\x3d'TipsTile'\x3e\u5176\u4ed6\u4fe1\u606f:\x3c/h5\x3e\x3cul class\x3d'TipsTitle2'\x3e\x3cli\x3e\u9ad8\u7ea7\u8bbe\u7f6e\u9762\u677f\u4e2d\u53ef\u8bbe\u5b9a\u672c\u9898\u662f\u5426\u5fc5\u7b54\u3002\x3c/li\x3e\x3cli\x3e\u9ad8\u7ea7\u8bbe\u7f6e\u9762\u677f\u4e2d\u53ef\u5bf9\u8f93\u5165\u7684\u6587\u5b57\u5185\u5bb9\u8fdb\u884c\u9a8c\u8bc1\u3002\x3c/li\x3e\x3cli\x3e\u53ef\u4e3a\u586b\u7a7a\u9898\u8282\u70b9\u8bbe\u5b9a\u9898\u76ee\u7684\u56fe\u7247\u3002\x3c/li\x3e\x3c/ul\x3e"},"#node_box_Sequencing":{side:2,msg:"\u6392\u5e8f4"},"#node_box_Matrix":{side:2,msg:"\u77e9\u96355"},"#node_box_SelectPic":{side:2,msg:"\u56fe\u7247\u9009\u62e9\u9898\u56fe\u7247\u9009\u62e9\u9898\u56fe\u7247\u9009\u62e9\u9898\u56fe\u7247\u9009\u62e9\u9898\u56fe\u7247\u9009\u62e9\u9898\u56fe\u7247\u9009\u62e9\u9898\u56fe\u7247\u9009\u62e9\u9898\u56fe\u7247\u9009\u62e9\u9898\u56fe\u7247\u9009\u62e9\u9898"},"#node_box_Vidio":{side:2,msg:"\u89c6\u9891\u8282\u70b9"},"#node_box_End":{side:2,msg:"\x3ch5 class\x3d'TipsTile'\x3e\u7ed3\u675f\u8282\u70b9\x3c/h5\x3e\x3cp class\x3d'TipsTitle2'\x3e\u7ed3\u675f\u8282\u70b9\u662f\u4e00\u4efd\u95ee\u5377\u7684\u7ec8\u6b62\u8282\u70b9\uff0c\u7b49\u540c\u4e8e\u95ee\u5377\u7684\u5c01\u5e95\u3002\x3c/br\x3e\u5f53\u53d7\u8bbf\u8005\u5b8c\u6210\u95ee\u5377\u65f6\uff0c\u5c06\u770b\u5230\u7ed3\u675f\u63cf\u8ff0\u4e2d\u7684\u6587\u5b57\u3002\x3c/br\x3e\u4e00\u4efd\u95ee\u5377\u53ef\u4ee5\u6709\u591a\u4e2a\u7ed3\u675f\u8282\u70b9,\u5206\u522b\u5bf9\u5e94\u95ee\u5377\u4e0d\u540c\u7684\u7ed3\u675f\u60c5\u51b5\u3002\x3c/br\x3e\x3c/p\x3e\x3ch5 class\x3d'TipsTile'\x3e\u5176\u4ed6\u4fe1\u606f:\x3c/h5\x3e\x3cul class\x3d'TipsTitle2'\x3e\x3cli\x3e\u7ed3\u675f\u8282\u70b9\u4e2d\u8bbe\u7f6e\u7684\u56fe\u7247\u5373\u4e3a\u8be5\u95ee\u5377\u7684\u5c01\u5e95\u3002\x3c/li\x3e\x3cli\x3e\u95ee\u5377\u751f\u6210\u65f6\u7cfb\u7edf\u5c06\u751f\u6210\u4e00\u4e2a\u7ed3\u675f\u8282\u70b9\u3002\x3c/li\x3e\x3c/ul\x3e"},"#node_box_ScreenSelect":{side:2,msg:"\u8d60\u522b\u9009\u62e9\u9898"},"#node_editor_media":{side:4,msg:"\x3ch5 class\x3d'TipsTile'\x3e\u6dfb\u52a0\u5a92\u4f53\x3c/h5\x3e\x3cp class\x3d'TipsTitle2'\x3e\u5728\u95ee\u5377\u9898\u76ee\u4e2d\u6dfb\u52a0\u56fe\u7247\u7b49\u5a92\u4f53\u4e30\u5bcc\u4e86\u95ee\u5377\u7684\u5f62\u5f0f\uff0c\u540c\u65f6\u6709\u52a9\u4e8e\u51c6\u786e\u5730\u8868\u8fbe\u95ee\u9898\u7684\u6838\u5fc3\u3002\x3c/br\x3e\u70b9\u51fb\x3cimg src\x3d'/Images/TipsPics/tips_midia_pic.jpg' style\x3d'margin-left: 10px;margin-right: 10px'\x3e \u4e0a\u4f20\u56fe\u7247\u6309\u94ae\u6dfb\u52a0\u56fe\u7247\u5a92\u4f53\u5230\u8d44\u6e90\u5e93\u3002\x3c/br\x3e\u6dfb\u52a0\u56fe\u7247\u5230\u5a92\u4f53\u5e93\u540e\uff0c\u9009\u62e9\u95ee\u5377\u4e2d\u9898\u76ee\u8282\u70b9\uff0c\u70b9\u9009\x3cimg src\x3d'/Images/TipsPics/tips_addmedia.jpg' style\x3d'margin-left: 10px;margin-right: 10px'\x3e \u6dfb\u52a0\u5a92\u4f53\u6309\u94ae\uff0c\u5373\u53ef\u5728\u4e0b\u62c9\u5217\u8868\u4e2d\u9009\u62e9\u5a92\u4f53\u5e93\u4e2d\u7684\u56fe\u7247\u3002\x3c/p\x3e\x3ch5 class\x3d'TipsTile'\x3e\u5176\u4ed6\u4fe1\u606f:\x3c/h5\x3e\x3cul class\x3d'TipsTitle2'\x3e\x3cli\x3e\u8fd8\u53ef\u4ee5\u9009\u62e9\u8282\u70b9\uff0c\u4e3a\u8be5\u8282\u70b9\u6dfb\u52a0\u5a92\u4f53\uff0c\u5728\u4e0b\u62c9\u5217\u8868\u4e2d\u70b9\u9009\u201c\u6dfb\u52a0\u56fe\u7247\u201d\u3002\x3c/li\x3e\x3c/ul\x3e"},"#node_editor_otherOption":{side:4,msg:"\x3ch5 class\x3d'TipsTile'\x3e\u201c\u5176\u4ed6\u201d\u9009\u9879\x3c/h5\x3e\x3cp class\x3d'TipsTitle2'\x3e\u201c\u5176\u4ed6\u201d\u9009\u9879\u6709\u52a9\u4e8e\u83b7\u5f97\u8fdb\u4e00\u6b65\u7684\u4fe1\u606f\uff0c\u7279\u522b\u662f\u5f53\u9009\u9879\u65e0\u6cd5\u8986\u76d6\u6240\u6709\u53ef\u80fd\u7684\u60c5\u51b5\u65f6\u3002\x3c/br\x3e\u53ef\u8bbe\u5b9a\u4e3a3\u79cd\u72b6\u6001,\u5206\u522b\u4e3a\u9009\u9879\u3001\u5907\u6ce8\u680f\u548c\u4e24\u8005\u3002\x3c/p\x3e\x3ch5 class\x3d'TipsTile'\x3e\u53c2\u8003\u793a\u610f\u56fe\x3c/h5\x3e\x3cul class\x3d'TipsTitle2'\x3e\x3cli\x3e\u9009\u9879:\x3c/li\x3e\x3cimg src\x3d'/Images/TipsPics/tips_select_option.jpg'\x3e\x3cli\x3e\u5907\u6ce8\u680f:\x3c/li\x3e\x3cimg src\x3d'/Images/TipsPics/tips_select_note.jpg'\x3e\x3cli\x3e\u4e24\u8005:\x3c/li\x3e\x3cimg src\x3d'/Images/TipsPics/tips_select_other2.jpg'\x3e\x3c/ul\x3e\x3ch5 class\x3d'TipsTile'\x3e\u5176\u4ed6\u4fe1\u606f:\x3c/h5\x3e\x3cul class\x3d'TipsTitle2'\x3e\x3cli\x3e\u53ef\u4e3a\u5bf9\u201c\u5176\u4ed6\u201d\u9009\u9879\u6240\u586b\u5165\u7684\u5185\u5bb9\u8fdb\u884c\u9a8c\u8bc1,\u907f\u514d\u53d7\u8bbf\u8005\u8f93\u5165\u9519\u8bef\u7684\u5185\u5bb9\u3002\x3c/li\x3e\x3c/ul\x3e"},"#node_editor_verify":{side:4,msg:"\x3ch5 class\x3d'TipsTile'\x3e\u8f93\u5165\u5185\u5bb9\u9a8c\u8bc1\x3c/h5\x3e\x3cp class\x3d'TipsTile2'\x3e\u5f53\u5e0c\u671b\u53d7\u8bbf\u8005\u8f93\u5165\u7279\u5b9a\u5185\u5bb9\u65f6\uff0c\u53ef\u4f7f\u7528\u9a8c\u8bc1\u529f\u80fd\u5bf9\u6587\u5b57\u5185\u5bb9\u8fdb\u884c\u6709\u6548\u6027\u5224\u65ad\u3002\x3c/br\x3e\x3c/p\x3e\x3ch5 class\x3d'TipsTile'\x3e\u9a8c\u8bc1\u9009\u9879:\x3c/h5\x3e\x3cul class\x3d'TipsTile2'\x3e\x3cli\x3e\u5b57\u6570\uff1a\u53ea\u63a5\u53d7\u6587\u5b57\u8f93\u5165\uff0c\u8bbe\u5b9a\u53ef\u8f93\u5165\u6587\u5b57\u5b57\u6570\u7684\u4e0a\u9650\u548c\u4e0b\u9650\u3002\x3c/li\x3e\x3cli\x3e\u6574\u6570\uff1a\u53ea\u63a5\u53d7\u6574\u6570\u8f93\u5165\uff0c\u8bbe\u5b9a\u53ef\u8f93\u5165\u6570\u503c\u7684\u4e0a\u9650\u548c\u4e0b\u9650\u3002\x3c/li\x3e\x3cli\x3e\u5c0f\u6570\uff1a\u53ea\u63a5\u53d7\u6574\u6570\u548c\u5c0f\u6570\u8f93\u5165\uff0c\u8bbe\u5b9a\u53ef\u8f93\u5165\u6570\u503c\u7684\u4e0a\u9650\u548c\u4e0b\u9650\u3002\x3c/li\x3e\x3cli\x3e\u65e5\u671f\uff1a\u9009\u62e9\u5236\u5b9a\u65e5\u671f\u3002\x3c/li\x3e\x3cli\x3e\u90ae\u4ef6\u5730\u5740\uff1a\u53ea\u63a5\u53d7\u90ae\u4ef6\u5730\u5740\u683c\u5f0f\u3002\x3c/li\x3e\x3cli\x3e\u624b\u673a\u53f7\u7801\uff1a\u53ea\u63a5\u53d7\u624b\u673a\u53f7\u7801\u683c\u5f0f\u3002\x3c/li\x3e\x3c/ul\x3e"}};$(document.body).delegate(".nodes_help","mouseover",function(b){var d="#"+b.currentTarget.id,c;for(c in a)c==d&&($($(".jq_tips_box")).remove(),$(this).tips({side:a[c].side,msg:a[c].msg,time:5,ClientX:b.clientX,ClientY:b.clientY}))}).delegate(".jq_tips_box","mouseleave",function(){setTimeout(function(){$($(".jq_tips_box")).remove()},500)})}}function h(){clearTimeout(h.run);h.run=setTimeout(function(){a(!0)},1E3)}function l(a){k.lastMousePos.x=a.pageX;k.lastMousePos.y=a.pageY}function p(a){if(!k.hasModal()){var b=ZYDesign.Environment,c=ZYDesign.HotKey,f=b.isMac?a.metaKey:a.ctrlKey,b=b.isMac?c.DeleteMac:c.Delete,g=a.target.tagName.toUpperCase();if("INPUT"==g||"TEXTAREA"==g){if(!ZYDesign.Config.customInputZY)return;g=arguments.callee;g.nodeEditor||(g.nodeEditor=document.getElementById("node_editor"));var h=(89==a.keyCode||90==a.keyCode)&&f;if(!g.nodeEditor||!g.nodeEditor.contains(a.target)||!h)return}if(a.shiftKey){if(f)switch(a.keyCode){case c.Save:k.versionSaveManager.open(),a.preventDefault(),k.digest()}}else if(f)switch(a.keyCode){case c.Save:k.save("N",null,null,"Y","");k.autoSaveManager.reset();k.digest();a.preventDefault();break;case c.Zoomout:k.zoomOut();k.digest();a.preventDefault();break;case c.Zoomin:k.zoomIn();k.digest();a.preventDefault();break;case c.Undo:d.undo()&&k.digest();a.preventDefault();break;case c.Redo:d.redo()&&k.digest();a.preventDefault();break;case c.Release:this.handleReleaseIconClick();k.digest();a.preventDefault();break;case c.SelectAll:k.selectAll();k.digest();a.preventDefault();break;case c.Test:k.test();k.digest();a.preventDefault();break;case c.ShowDefault:k.showDefault();k.digest();a.preventDefault();break;case c.Copy:k.clipBoard.copy(!1);k.digest();a.preventDefault();break;case c.Paste:k.clipBoard.paste(k.lastMousePos.x,k.lastMousePos.y);k.digest();a.preventDefault();break;case c.Dulplicate:k.clipBoard.dulplicate(0,0);k.digest();a.preventDefault();break;case c.Clip:k.clipBoard.copy(!0);k.digest();a.preventDefault();break;case c.Break:k.breakConnOfSelectedNodes(),k.digest(),a.preventDefault()}else switch(a.keyCode){case b:k.removeSelected();k.digest();a.preventDefault();break;case c.ShowAll:k.showAll(),k.digest(),a.preventDefault()}}}var k=this,n=ZYDesign.Hinter;$(document.body).ready(function(){g();a();console.log("window loaded,start forming chart!");k.chartFormed=!0;console.log("chart forming successed!");$(window).resize(function(){h()});$(document.body).on({mousemove:l,keydown:p});k.useLoadIcon=!!$("#design_loader").length});this.lastMousePos={x:0,y:0};this.borderInfo={left:0,top:0,right:0,bottom:0,width:0,height:0,originLeft:0,originTop:0,originRight:0,originBottom:0,originWidth:0,originHeight:0,nodesTop:0,nodesLeft:0,nodesRight:0,nodesBottom:0,nodesWidth:0,nodesHeight:0};this.containerInfo={width:0,height:0,centerX:0,centerY:0,top:0,left:0,right:0,bottom:0};this.viewLeft=this.viewTop=this.height=this.width=this.left=this.top=this.lastDesignNo=this.lastCheckNo=0;this.viewHeight=this.viewWidth=100;this.auto=this.saving=this.dirty=!1;this.grid="true"==localStorage.getItem("chart_grid")?!0:!1;this.transY=this.transX=0;this.chartZoomRate=1;this.eyeZoomRate=0.2;this.currentNode={};this.tempConncetion=null;this.connections=[];this.qNumber=this.companyId=this.questionnairName=this.questionnairUuid="";this.qStatus=0;this.mixNodes=[];this.vitualNodes=[];this.startNode=null;this.chartXDiffer=$("#chart_content").width()/2;this.chartYDiffer=$("#chart_content").height()/2;this.eyeXDiffer=$("#chart_eye").width()/2;this.eyeYDiffer=$("#chart_eye").height()/2;this.useLoadIcon=this.useLoadIcon||!1;this.chartFormed=!1;this.selectRectManager=new function(){this.parent=k;this.startY=this.startX=this.status=this.height=this.width=this.bottom=this.right=this.top=this.left=0;this.getLeft=function(){return this.left-this.parent.chartXDiffer};this.getTop=function(){return this.top-this.parent.chartYDiffer};this.getRight=function(){return this.right-this.parent.chartXDiffer};this.getBottom=function(){return this.bottom-this.parent.chartYDiffer};this.reset=function(){0!=this.status&&(this.status=this.startY=this.startX=this.status=this.height=this.width=this.bottom=this.right=this.top=this.left=0)};this.start=function(a,b){this.left=this.startX=a;this.top=this.startY=b;this.status=1};this.resize=function(a,b){1!=this.status?this.start(a,b):(a<this.startX?(this.left=a,this.right=this.startX):(this.left=this.startX,this.right=a),b<this.startY?(this.top=b,this.bottom=this.startY):(this.top=this.startY,this.bottom=b),this.width=this.right-this.left,this.height=this.bottom-this.top)};this.finish=function(){if(1==this.status){for(var a=this.parent.mixNodes.length,b=0;b<a;b++){var c=this.parent.mixNodes[b];c.getX()>=this.getLeft()&&c.getY()>=this.getTop()&&c.getRight()<=this.getRight()&&c.getBottom()<=this.getBottom()+14&&(c.select(),this.parent.takeToTop(c),b--,a--)}this.status=2;this.reset()}};this.fixPosition=function(){$("#flow_select_rect").attr({x:this.getLeft(),y:this.getTop(),width:this.width,height:this.height})}};this.searchManager=new function(){this.parent=k;this.nodes=[];this.show=!1;this.y=this.x=-1E3;this.search=function(a){this.nodes=[];for(var b=0;b<this.parent.mixNodes.length;b++){var c=this.parent.mixNodes[b];c.hasKeyword(a)&&this.nodes.push(c)}0==this.nodes.length?n.hint(Prompt.QSNRD_NoSearchInfo):this.open()};this.open=function(){0!=this.nodes.length&&(-1E3==this.x&&-1E3==this.y&&(this.x=window.innerWidth-800,this.y=40),this.show=!0)};this.close=function(){this.show=!1;this.nodes=[]};this.getStyle=function(){return"top:"+this.y+"px;left:"+this.x+"px;position:absolute;"};this.wrapSearcher=function(){$("#search_txt").val()||$("#searcher .search_symbol").removeClass("width_222px").addClass("width_1px")};this.releaseSearcher=function(){$("#searcher .search_symbol").removeClass("width_1px").addClass("width_222px")};this.fixPosition=function(){$("#node_search_result").attr("style",this.getStyle())};this.remove=function(a){a=this.nodes.indexOf(a);0<=a&&this.nodes.splice(a,1)}};this.validateManager=new function(){this.parent=k;this.invalidList=[];this.show=!1;this.y=this.x=-1E3;this.valid=!1;this.getStyle=function(){return"top:"+this.y+"px;left:"+this.x+"px;position:absolute;"};this.validate=function(a){this.invalidList=[];for(var b=!0,c=0;c<this.parent.mixNodes.length;c++){var d=this.parent.mixNodes[c],f=d.validate();f.isValid||(f.node=d,this.invalidList.push(f),this.valid=b=!1)}a&&(a=k.startNode.validateResult,a.isValid&&(a.message=Prompt.QSNRD_QuesNameExist,a.isValid=b=!1,a.node=k.startNode,this.invalidList.push(a)));return b};this.open=function(a){this.show=!0;this.valid=a;-1E3==this.x&&-1E3==this.y&&(this.x=window.innerWidth-500,this.y=40);a&&($("#qrcode_renderer").attr("src",""),$("#text_renderer").text("").attr("href",""),this.getPreviewInfoAjax(function(a){$("#qrcode_renderer").attr("src",a.StrPath);$("#text_renderer").text(a.QRlink).attr("href",a.QRlink)}))};this.getPreviewInfoAjax=function(a){b.post("/QM/DownLoadQRCode",{quesID:this.parent.questionnairUuid,linkSuffix:this.parent.questionnairUuid}).success(function(b){a instanceof Function&&a(b)}).error(function(a){RestLoginForDesign(a.Message);n.hint(Prompt.QSNRD_GetPreviewFailed)})};this.close=function(){this.show=!1;this.invalidList=[]};this.fixPosition=function(){$("#node_validate_result").attr("style",this.getStyle())};this.update=function(){this.validate()}};this.optionBatchAddManager=new function(){var a=!1,b=1,c=function(a,c){var m=a.length>c.length?a.length:c.length,f=k.currentNode,t=!1,g="options",h=!1;3==b?g="optionsY":2==b&&(t=!0,g="optionsX");var n=f[g],x=n.length,p=[];f.isTypeOf("SELECT")&&f.hasOtherOption()&&(x-=1);for(var l=0;l<m;l++){var z=c[l]||"",B=n[l];l<x?B.originText!=z&&(p.push({option:B,type:"change",oldValue:B.originText||"",newValue:z}),n[l].originText=z,h=!0):(h=f.addOption({text:z},t),p.push({option:h,type:"add"}),h=!0)}if(m<x){m=f.removeOptionInRange(m-1,x-1,t);for(l=0;l<m.length;l++)h=m[l],p.push({option:h,type:"remove"});h=!0}h&&(k.markChange(),d.register({descript:"\u6279\u91cf\u7f16\u8f91\u9009\u9879",param:{key:g,isX:t,node:f,changeList:p},undo:function(){for(var a=this.param,b=0;b<a.changeList.length;b++){var c=a.changeList[b];switch(c.type){case "change":c.option.originText=c.oldValue;break;case "add":a.node.removeOption(c.option);break;case "remove":a.node.addOption(c.option,a.isX)}}},redo:function(){for(var a=this.param,b=0;b<a.changeList.length;b++){var c=a.changeList[b];switch(c.type){case "change":c.option.originText=c.newValue;break;case "add":a.node.addOption(c.option,a.isX);break;case "remove":a.node.removeOption(c.option)}}}}))};this.isVisible=function(){return a};this.open=function(){var c=k.currentNode;if(c instanceof ZYDesign.Class.SubjectNode){var d=c.options;c.isTypeOf("SELECT")&&(d=c.getNormalOptions());c.type==ZYDesign.Enum.NODETYPE.MATRIX?c.rowHiding?(b=2,d=c.optionsX):(b=3,d=c.optionsY):b=1;for(var f="",t=c=0;t<d.length;t++){var g=d[t].originText;g&&(f+=g,c=f.length);t<d.length-1&&(f+="\n")}var f=f.substr(0,c),h=setInterval(function(){var a=$("#option_batch_add_text");0<a.length&&(clearInterval(h),a.text(f))});a=!0;$(document.body).addClass("modal-open")}};this.apply=function(){var a;if(a=$("#option_batch_add_text").val()){a=a.split("\n");for(var b=-1,d=0;d<a.length;d++)a[d]&&(b=d);a=a.slice(0,b+1)}else a=[];0!=a.length&&(b=(b=$("#option_batch_add_number").val())?b.split("\n"):[],c(b,a),this.close())};this.close=function(){a=!1;b=1;$("#option_batch_add_number").text("");$("#option_batch_add_text").text("");$(document.body).removeClass("modal-open")};this.digest=function(){k.digest()}};this.versionSaveManager=new function(){var a=k,c=!1,d=null;this.defaultName="";this.isVisible=function(){return c};this.open=function(b){a.isAllowSave()&&(c=!0,this.defaultName=(d=b)?d.verName:a.generateVersionName(),$(document.body).addClass("modal-open"))};this.save=function(){if(a.isAllowSave()){var b=$("#ver_name_input").val(),b=b?b:a.generateVersionName(),c=this;a.isExistVerNameAjax(b,function(f){f?(c.close(),a.digest(function(){n.hint(Prompt.QSNRD_VerNameExist)})):d?c.changeVersionNameAjax(b,d.verID):(a.save("N",null,null,"N",b),a.autoSaveManager.reset(),c.close())},function(){n.hint(Prompt.QSNRD_JudgeRepaeatFailed)});c.close()}};this.changeVersionNameAjax=function(a,c){var m=this;b.post("/QD/EditDesignBakName",{bakID:c,verName:a}).success(function(b){b.returnError||(d.verName=a);n.hint(Prompt.QSNRD_ChangeNameSuccess);m.close()}).error(function(a){var b="";if(a||a.returnMessage)b=a||a.returnMessage;RestLoginForDesign(b);n.hint(Prompt.QSNRD_ChangeNameFauled)})};this.close=function(){c=!1;$(document.body).removeClass("modal-open")};this.getTitle=function(){return d?"\u66f4\u6539\u7248\u672c\u540d\u5b57":"\u4fdd\u5b58\u4e00\u4e2a\u7248\u672c"};this.getBtnName=function(){return d?"\u66f4\u6539\u5e76\u5173\u95ed":"\u4fdd\u5b58\u5e76\u5173\u95ed"};this.digest=function(){k.digest()}};this.autoSaveManager=new function(){var a=k,b=null;this.start=function(){if(!b){var c=this;b=setTimeout(function(){a.save("N",function(){c.reset()},null,"Y",a.generateVersionName())},3E5)}};this.reset=function(){this.stop();this.start()};this.stop=function(){b&&(clearTimeout(b),b=null)}};this.versionHistoryManager=new function(){function a(m){b.post("/QD/GetDesignBakByBakID",{bakID:m}).success(function(a){a.returnError||(c.showLoader(),c.importJson({nodeList:JSON.parse(a.val.DesignText),mediaLib:JSON.parse(a.val.MediaLibrary),imageUrl:a.URL,theme:JSON.parse(a.val.theme)},!0),c.selectNodeSingle(c.startNode),n.hint(Prompt.QSNRD_ImportVersionsFinish),d.clear())}).error(function(a){var b="";if(a||a.returnMessage)b=a||a.returnMessage;RestLoginForDesign(b);n.hint(Prompt.QSNRD_ImportVersionsFauled)})}var c=k,f=!1,g=[],h=[],w=!0,v=!1;this.open=function(){f=!0;w&&(h=[],v=!1,b.post("/QD/GetDesignBak",{quesID:c.questionnairUuid}).success(function(a){if(a instanceof Array){for(var b=0;b<a.length;b++){var c=a[b];h.push({verName:c.BakupName,verID:c.DesignBakID})}v=!0;w=!1}}).error(function(a){RestLoginForDesign(a);n.hint(Prompt.QSNRD_GetVersionsListFauled)}))};this.close=function(){f=!1};this.deleteVersion=function(a){b.post("/QD/DelDesignBak",{bakID:a.verID}).success(function(b){if(!b.returnError){for(b=0;b<h.length;b++)if(a==h[b]){h.splice(b,1);break}n.hint(Prompt.QSNRD_DeleteVersionsSuccess)}}).error(function(a){var b="";if(a||a.returnMessage)b=a||a.returnMessage;RestLoginForDesign(b);n.hint(Prompt.QSNRD_DeleteVersionsFauled)})};this.changeVersionName=function(a){c.versionSaveManager.open(a)};this.importVersion=function(b){c.getQuesStatusAjax(function(d){c.isAllowChangeStatus(d)?confirm(Prompt.QSNRD_ConfirmVersionImport,function(){a(b)},null,"\u8f7d\u5165","","\u53d6\u6d88"):n.hint(QSNRD_NoChangeForOnLine)},function(){n.hint(Prompt.QSNRD_GetQuesStatusFauledImportFauled)})};this.saveVersion=function(){c.versionSaveManager.open()};this.isVisible=function(){return f};this.getAutoSaveList=function(){return g};this.getBackupList=function(){return h};this.setUpdateNextTime=function(){w=!0};this.isDataReady=function(){return v};this.isAllowSave=function(){return c.isAllowSave()}};this.imageUploadManager=new function(){function a(b){y=!1;$("#"+g.image.id+" #upload_canceller").hide();var m=g.image;g.image=null;g.editMode?c.startNode.image==m&&(c.startNode.dirty=!0):(m.index=d.imageList.length,d.imageList.push(m),s=!0);m.reCut=!0;m.size=b.size;m.fileName=b.name;m.serverFileName=b.serverName;m.url=d.imageUrl;f=$("#uploaded_image");f.unbind().bind({load:function(a){a=a.currentTarget;m.originWidth=a.naturalWidth;m.originHeight=a.naturalHeight;m.fitAuto();d.digest()},error:function(){console.log("image loading failed!")}});f.attr("src",m.getBigImageStyle());c.markChange(!0);h instanceof Function&&(h(m),h=null)}function b(a){y=!0;$("#"+g.image.id+" #upload_canceller").show();$("#"+g.image.id+" #upload_progressor").css("width",a+"%")}var c=k,d=this,f=$(document.createElement("img")),g={image:null,editMode:!0},h=null,s=!1,y=!1,l=null,p=!1;this.dropArrow=!1;this.currentImage=null;this.imageList=[];this.imageUrl="";this.import=function(a,b){this.imageUrl=b;if(a instanceof Array){var c=0<this.imageList.length?!0:!1;this.imageList=[];for(var d=0;d<a.length;d++){var m=new ZYDesign.Class.ImageModel,f=a[d],q;for(q in f)m[q]=f[q];m.id||(m.id=ZYDesign.UuidUtil.generate());m.url=this.imageUrl;m.reCut=c;this.imageList.push(m)}}};this.export=function(){for(var a=[],b="",c=0;c<this.imageList.length;c++){var d=this.imageList[c];a.push({id:d.id,index:d.index,size:d.size,fileName:d.fileName,serverFileName:d.serverFileName,cutX:d.cutX,cutY:d.cutY,originWidth:d.originWidth,originHeight:d.originHeight,settingWidth:d.settingWidth,settingHeight:d.settingHeight});d.reCut&&(b&&(b+=","),b+=d.id)}return{list:a,cutList:b}};this.isVisible=function(){return p};this.open=function(a){c.isAllowSave()?(h=a,p=!0,this.currentImage=g.image&&!g.editMode?g.image:new ZYDesign.Class.ImageModel,s=!1):n.hint(Prompt.QSNRD_OperationMediaDisable)};this.close=function(a){this.currentImage=null;p=!1;h instanceof Function&&!a&&(h(),h=null)};this.editImage=function(a){c.isAllowSave()?(h=null,this.currentImage=a,s=p=!0):n.hint(Prompt.QSNRD_OperationMediaDisable)};this.uploadImage=function(){y?n.hint(Prompt.UploadPrompt):(g.image=this.currentImage,g.editMode=s,$("#btn_Upload").click())};this.deleteImage=function(a){if(c.isAllowSave())if(this.getImageEngagement(a).isEngaged)n.hint(Prompt.QSNRD_ImageDeleteDisable);else for(var b=!1,d=0;d<this.imageList.length;d++){var m=this.imageList[d];m==a&&(this.imageList.splice(d--,1),b=!0,c.markChange(!0));b&&(m.index-=1)}else n.hint(Prompt.QSNRD_OperationMediaDisable)};this.getImageEngagement=function(a){if(!(a instanceof ZYDesign.Class.ImageModel))return{isEngaged:!1};for(var b=0;b<c.mixNodes.length;b++){var d=c.mixNodes[b];if(d.image==a)return{isEngaged:!0,nodeId:d.id}}return{isEngaged:!1}};this.getStyle=function(){var a=0;this.currentImage&&(a=42+47*this.currentImage.index);a+295+100>window.innerHeight?(this.dropArrow=!0,a-=295):this.dropArrow=!1;a+250+100>window.innerHeight&&(a=window.innerHeight-295-100);return"top:"+a+"px"};this.getImageById=function(a){if(a)for(var b=0;b<this.imageList.length;b++){var c=this.imageList[b];if(c.id==a)return c}};this.cancel=function(){l&&(l.cancel(),$("#"+g.image.id+" #upload_canceller").hide(),$("#"+g.image.id+" #upload_progressor").css("width","0%"),y=!1,uploadingImage=null)};this.initUploader=function(){l||(l=$("#uploadDiv").InitUpload({parentfolder:"\\UploadFiles\\Photo\\",CompanyID:c.companyId,QuesID:c.questionnairUuid,UType:"3",complete:a,progress:b}))};this.clearCutList=function(){for(var a=0;a<this.imageList.length;a++)this.imageList[a].reCut=!1};this.digest=function(){c.digest()}};this.pageManager=new function(){};this.clipBoard=new function(){var a=k,b=[],c=0,f=0;this.copy=function(g){f=c=0;for(var h=[],v=[],s=a.mixNodes,n=s.length-1;0<=n;n--){var l=s[n];if(!l.copyDisabled&&l.isSelected()){if(c>l.x||0==h.length)c=l.x;if(f>l.y||0==h.length)f=l.y;l={node:l,x:l.x,y:l.y};h.push(l);g&&(l=a.removeNode(l.node))&&v.push(l)}}0<v.length&&d.register({descript:"\u526a\u5207\u8282\u70b9",param:{manager:k,changeList:v},undo:function(){for(var a=this.param,b=0;b<a.changeList.length;b++){var c=a.changeList[b];a.manager.mixNodes.push(c.node);for(var d=0;d<c.conns.length;d++)a.manager.addConnection(c.conns[d])}},redo:function(){for(var a=this.param,b=0;b<a.changeList.length;b++)a.manager.removeNode(a.changeList[b].node)}});b=h};this.paste=function(g,h,l){if(0!=b.length){var s=[];if(l)for(h=0;h<b.length;h++){var n=b[h];(n=a.copyNode(n.node,0,0,!0))&&s.push(n)}else for(l=$("#chartLarger"),h=a.translateCoordinates(g,h,l),h.x=(h.x-a.chartXDiffer)/a.chartZoomRate+a.chartXDiffer,h.y=(h.y-a.chartYDiffer)/a.chartZoomRate+a.chartYDiffer,g=h.x-c,l=h.y-f,h=0;h<b.length;h++)n=b[h],(n=a.copyNode(n.node,g+(n.x-n.node.x),l+(n.y-n.node.y),!0))&&s.push(n);a.selectNodeSingle(a.mixNodes[a.mixNodes.length-1]);0<s.length&&d.register({descript:"\u590d\u5236\u8282\u70b9",param:{manager:k,changeList:s},undo:function(){for(var a=this.param,b=0;b<a.changeList.length;b++)a.manager.removeNode(a.changeList[b].copy)},redo:function(){for(var a=this.param,b=0;b<a.changeList.length;b++)a.manager.mixNodes.push(a.changeList[b].copy)}})}};this.dulplicate=function(a,b){this.copy();this.paste(a,b,!0)};this.isEmpty=function(){return!b.length}};this.contextMenu=new function(){var a=k,b=ZYDesign.ContextMenu,c=0,d=0,f=!1;this.list=[];for(var g in b)this.list.push(b[g]);var h=24*this.list.length;this.getStyle=function(){return"position:absolute;top:"+d+"px;left:"+c+"px;"};this.isVisible=function(){return f};this.checkEnable=function(){var c=!1;batchEnable=breEnable=delEnable=clipEnable=!1;nodes=a.mixNodes;for(var d=0;d<nodes.length;d++){var f=nodes[d];if(f.isSelected()&&(f.optionbatchDisabled||(batchEnable=!0),f.copyDisabled||(c=!0),0<f.relatedConnections.length&&(breEnable=!0),f.removeDisabled||(clipEnable=delEnable=!0),c&&clipEnable&&delEnable&&breEnable))break}if(!delEnable)for(f=a.connections,d=0;d<f.length;d++)if(f[d].isSelected()){delEnable=!0;break}b.copy.enable=c;b.paste.enable=!a.clipBoard.isEmpty();b.duplicate.enable=c;b.clip.enable=clipEnable;b.del.enable=delEnable;b.bre.enable=breEnable;b.optionbatch.enable=batchEnable};this.open=function(a,b){var m=window.innerWidth,q=window.innerHeight;c=a+240<=m?a:m-240;d=b+h<=q?b:b-h;this.checkEnable();f=!0};this.close=function(){f=!1};this.executeItem=function(b){if(b.enable){switch(b.operation){case "COPY":a.clipBoard.copy(!1);break;case "PASTE":a.clipBoard.paste(c,d);break;case "DUPLICATE":a.clipBoard.dulplicate(c,d);break;case "CLIP":a.clipBoard.copy(!0);break;case "DELETE":a.removeSelected();break;case "BREAK":a.breakConnOfSelectedNodes();break;case "OPTIONBATCH":a.optionBatchAddManager.open()}this.close()}}};this.nodeBoxManager=new function(){var a=k,b=!0,c=!0;this.toolNodeHide=this.checkNodeHide=this.baseNodeHide=!1;this.pin=function(){b=!0};this.canclePin=function(){b=!1};this.open=function(){c=!0};this.close=function(){c=!1};this.toggleShow=function(){c=!c};this.isPinned=function(){return b};this.isVisible=function(){return c};this.togglePin=function(){b=!b};this.addNode=function(b,c,f){if(!b.hasClass("column_button_disable")){var q=b.attr("data-method");b=b.attr("data-check")?1:null;c=a[q](null,b,c,f);a.markChange(!0);d.register({descript:"\u6dfb\u52a0\u8282\u70b9",param:{node:c,manager:k},undo:function(){var a=this.param;a.manager.removeNode(a.node)},redo:function(){var a=this.param;a.manager.mixNodes.push(a.node)}})}};this.transCoords=function(b,c,d){return a.translateCoordinates(b,c,d)};this.digest=function(){a.digest()}};this.themeBoxManager=new function(){function a(b){this instanceof a&&(b=b||{},this.bgColor=b.bgColor||"white",this.quesColor=b.quesColor||"black",this.btnBgColor=b.btnBgColor||"green",this.btnColor=b.btnColor||"white",this.selColor=b.selColor||"green",this.isSelected=!1,this.isCustom=b.isCustom||!1,a.prototype.getColorStyle||(a.prototype.getColorStyle=function(a){return"background-color:"+this[a]}))}var b=k,c=this,f=ZYDesign.Theme,g=["bgColor","quesColor","btnBgColor","btnColor","selColor"],h=!1;this.themeList=[];this.customList=[];for(var l=0;l<f.length;l++)c.themeList.push(new a(f[l]));this.dirty=!1;this.theme=new a;this.theme.themeIndex=-1;this.open=function(){h=!0};this.close=function(){h=!1};this.apply=function(c,f,g){if(!c.isSelected){g&&(c=new a(c),c.isCustom=!0,this.customList.push(c));var t=null,t=0<=this.theme.themeIndex?this.theme.isCustom?this.customList[this.theme.themeIndex]:this.themeList[this.theme.themeIndex]:this.theme;this.theme.bgColor=c.bgColor;this.theme.btnBgColor=c.btnBgColor;this.theme.btnColor=c.btnColor;this.theme.quesColor=c.quesColor;this.theme.selColor=c.selColor;this.theme.isCustom=c.isCustom;for(var h=0;h<this.themeList.length;h++){var u=this.themeList[h];u==c?(this.theme.themeIndex=h,u.isSelected=!0):u.isSelected=!1}for(h=0;h<this.customList.length;h++)u=this.customList[h],u==c?(this.theme.themeIndex=h,u.isSelected=!0):u.isSelected=!1;f||(this.dirty=!0,b.markChange(),this.rerender(),d.register({descript:g?"\u6dfb\u52a0\u81ea\u5b9a\u4e49\u4e3b\u9898":"\u66f4\u6539\u4e3b\u9898\u989c\u8272\u65b9\u6848",param:{oldTheme:t,newTheme:c,themeBox:this,addMode:g},undo:function(){var a=this.param;a.themeBox.apply(a.oldTheme);a.addMode&&a.themeBox.customList.pop()},redo:function(){var a=this.param;a.themeBox.apply(a.newTheme);a.addMode&&a.themeBox.customList.push(a.newTheme)}}))}};this.change=function(a,f){var m=this.theme[a],g=this.theme[a]=f,h=null,u=-1;if(m.toUpperCase()!=g.toUpperCase()){this.theme.themeIndex=-1;for(var r=!1,k=0;k<this.themeList.length;k++){var l=this.themeList[k];if(l.isSelected){h=l;u=k;l.isSelected=!1;r=!0;break}}if(!r)for(k=0;k<this.customList.length;k++)if(l=this.customList[k],l.isSelected){h=l;u=k;l.isSelected=!1;break}this.dirty=!0;b.markChange(a);this.rerender(a);d.register({descript:"\u66f4\u6539\u4e3b\u9898\u989c\u8272",exclusive:!0,param:{oldValue:m,newValue:g,obj:this.theme,key:a,former:h,formerIndex:u,themeBox:c},undo:function(){var a=this.param;a.obj[a.key]=a.oldValue;a.former&&(a.former.isSelected=!0,a.obj.themeIndex=a.formerIndex);a.themeBox.rerender(a.key)},redo:function(){var a=this.param;a.obj[a.key]=a.newValue;a.former&&(a.former.isSelected=!1,a.obj.themeIndex=-1);a.themeBox.rerender(a.key)}})}};this.import=function(a,b){var c=null;a?(a.customs&&this.importCustom(JSON.parse(a.customs)),0<=a.themeIndex?(c=null,c=a.isCustom?this.customList:this.themeList,c=c[a.themeIndex]):c=a):c=this.themeList[0];c&&this.apply(c,b)};this.importCustom=function(b){this.customList=[];for(var c=0;c<b.length;c++)this.customList.push(new a(b[c]))};this.saveAsCustom=function(){5<=this.customList.length||this.apply(this.theme,!1,!0)};this.removeCustom=function(a){for(var c=-1,f=-1,m=0;m<this.customList.length;m++)if(this.customList[m]==a){c=m;this.customList.splice(m,1);a.isSelected&&(f=m,this.theme.themeIndex=-1);break}-1!=c&&(b.markChange(),b.digest(),d.register({descript:"\u79fb\u9664\u81ea\u5b9a\u4e49\u4e3b\u9898\u65b9\u6848",param:{custom:a,index:c,themeIndex:f,themeBox:this},undo:function(){var a=this.param;a.themeBox.customList.splice(a.index,0,a.custom);0<=a.themeIndex&&(a.themeBox.theme.themeIndex=a.themeIndex)},redo:function(){var a=this.param;a.themeBox.customList.splice(a.index,1);0<=a.themeIndex&&(a.themeBox.theme.themeIndex=-1)}}))};this.export=function(){this.theme.needCompile=this.dirty;this.dirty=!1;return{bgColor:this.theme.bgColor,btnBgColor:this.theme.btnBgColor,btnColor:this.theme.btnColor,needCompile:this.theme.needCompile,quesColor:this.theme.quesColor,selColor:this.theme.selColor,themeIndex:this.theme.themeIndex,isCustom:this.theme.isCustom,customs:JSON.stringify(this.customList)}};this.isVisible=function(){return h};this.toggleShow=function(){h=!h};this.rerender=function(a){var b=c.theme;document.getElementById("show_phone").contentWindow.postMessage({name:"response color",bgColor:b.bgColor,quesColor:b.quesColor,btnColor:b.btnColor,btnBgColor:b.btnBgColor,selColor:b.selColor},"*");if(a)$("[data-id\x3d'"+a+"']").attr("style",this.theme.getColorStyle(a));else for(a=0;a<g.length;a++)b=g[a],$("[data-id\x3d'"+b+"']").attr("style",this.theme.getColorStyle(b))};this.digest=function(){b.digest()};window.addEventListener("message",function(a){(a=a.data)&&"request color"==a.name&&c.rerender()})};this.helpManager=new function(){this.y=this.x=0;this.show=!1;this.currentHelpText="";this.helpWidth=300;this.help=function(a,b){this.currentHelpText=ZYDesign.HelpMessage[b].text;this.open(a.pageX)};this.getHelpText=function(){$("#context_help_text").html(this.currentHelpText)};this.open=function(a){if(0==this.x&&0==this.y){var b;a+300>window.innerWidth?(b=parseInt($(".size_299_250").css("width")),this.x=a-b-this.helpWidth):(b=parseInt($(".nodes_kit").css("width"))+parseInt($(".design_toolbar").css("width")),this.x=a+(b-a+10));this.y=40}this.show=!0};this.close=function(){this.show=!1};this.getStyle=function(){return"top:"+this.y+"px;left:"+this.x+"px;position:absolute;width: "+this.helpWidth+"px"};this.fixPosition=function(){$("#node_help_result").attr("style",this.getStyle())}};this.getOnline=function(){return navigator.onLine};this.markChange=function(a){this.dirty=!0;this.currentNode&&!a&&this.currentNode.markChange()};this.clearChange=function(){this.dirty=!1;for(var a=0;a<this.mixNodes.length;a++)this.mixNodes[a].dirty=!1};this.getChartZoomRateText=function(){return Math.round(1E4*this.chartZoomRate)/100+"%"};this.init=function(){var a=$("#quesIDEx").val();if(a){this.questionnairUuid=a;this.questionnairName=$("#quesName").val();this.qNumber=$("#QuesNumber").val();this.companyId=$("#companyId").val();var c=this;b.post("/QD/GetDesignByQuesID",{quesID:this.questionnairUuid}).success(function(a){if(c.chartFormed)console.log("chart detected, directly import data."),c.importData(a),console.log("data imported.");else{console.log("chart not detected, waiting for chart forming... data will be imported after chart formed.");var b=setInterval(function(){console.log("waiting...");c.chartFormed&&(console.log("chart formed, importing data."),c.importData(a),clearInterval(b),console.log("data imported."))})}}).error(function(a){RestLoginForDesign(a);n.hint(Prompt.QSNRD_GetDesignDataFauled)});this.imageUploadManager.initUploader();return this}};this.importData=function(a){if(a){if(a.IsValue||a.val){if("new"!=a.val&&a.val.nodeText){var b={};b.nodeList=JSON.parse(a.val.nodeText);b.mediaLib=a.val.MediaLibrary?JSON.parse(a.val.MediaLibrary):{};b.theme=JSON.parse(a.val.theme);b.imageUrl=a.URL;this.qStatus=a.val.QStatus;this.isAllowSave()||alert(Prompt.QSNRD_CurrentQuesSaveDisable);this.importJson(b)}else this.addStartNode(null,null,null,null,this.questionnairName),this.addEndNode(),this.addVitualNodes(),this.imageUploadManager.import(null,a.URL);this.selectNodeSingle(this.startNode)}else console.log("invalid questionnaire!"),location.href="/Home";this.digest();this.autoSaveManager.start()}};this.importJson=function(a,b){if(a&&a.nodeList instanceof Array&&(!a.questionnairUuid||this.questionnairUuid==a.questionnairUuid)){this.reset();this.importJson.destList=[];this.addVitualNodes();this.imageUploadManager.import(a.mediaLib.imageList,a.imageUrl);this.themeBoxManager.import(a.theme,!b);for(var c="",d=null,f=0;f<a.nodeList.length;f++){var g=a.nodeList[f];if(g.destList)for(var h=0;h<g.destList.length;h++)this.importJson.destList.push(g.destList[h]);switch(g.type){case 1:d=this.addSelectNode(g);break;case 2:d=this.addMarkingNode(g);break;case 3:d=this.addSequencingNode(g);break;case 4:d=this.addFillblankNode(g);break;case 5:d=this.addMatrixNode(g);break;case 6:d=this.addStartNode(g,null,null,null,this.questionnairName);break;case 7:d=this.addLogicNode(g);break;case 8:d=this.addLoopNode(g);break;case 9:d=this.addCheckNode(g);break;case 10:d=this.addEndNode(g);break;case 11:d=this.addCommentNode(g);break;case 12:d=this.addRandomNode(g);break;case 13:d=this.addRegionNode(g);break;case 14:d=this.addGenderNode(g);break;case 15:d=this.addAgeGroupNode(g);break;case 16:d=this.addMaritalStatusNode(g);break;case 17:d=this.addEduStatusNode(g);break;case 18:d=this.addOccupationNode(g);break;case 19:d=this.addProfessionNode(g);break;case 20:d=this.addJobTitleNode(g);break;case 21:d=this.addIncomeNode(g);break;case 22:d=this.addFamilyIncomeNode(g);break;case 23:d=this.addSelectPicNode(g)}!c&&d.visible&&(c=d.nodeUuid)}this.importConnection(this.importJson.destList);this.hideLoader(c)}};this.getChartTransform=function(){return"translate("+(this.transX+this.chartXDiffer)+","+(this.transY+this.chartYDiffer)+") scale("+this.chartZoomRate+")"};this.getEyeTransform=function(){var a=this.getBorderInfo(),b=this.getContainerInfo();if(a.originHeight>b.height||a.originWidth>b.width){var b=2*this.eyeXDiffer/a.originWidth,c=2*this.eyeYDiffer/a.originHeight;this.eyeZoomRate=b<c?b:c}else this.eyeZoomRate=0.15;return"translate("+(this.transX+this.eyeXDiffer-(a.originLeft+a.originRight)*this.eyeZoomRate/2)+","+(this.transY+this.eyeYDiffer-(a.originTop+a.originBottom)*this.eyeZoomRate/2)+") scale("+this.eyeZoomRate+")"};this.moveCurrentNode=function(a,b){this.currentNode&&(this.currentNode.x+=a/this.chartZoomRate,this.currentNode.y+=b/this.chartZoomRate)};this.reset=function(){this.tempConncetion=this.currentNode=null;this.connections=[];this.chartZoomRate=1;this.lastDesignNo=this.lastCheckNo=0;this.saving=this.dirty=!1;this.mixNodes=[];this.startNode=null};this.deselectAll=function(){for(var a=0;a<this.mixNodes.length;a++)this.mixNodes[a].deselect();for(a=0;a<this.connections.length;a++)this.connections[a].deselect();this.currentNode=null};this.selectAll=function(){for(var a=0;a<this.mixNodes.length;a++)this.mixNodes[a].select();for(a=0;a<this.connections.length;a++)this.connections[a].select()};this.addConnection=function(a){a&&(a.ApplyTwowayRelationship(),this.connections.push(a))};this.removeConnection=function(a){if(!(a instanceof ZYDesign.Class.ConnectionModel))return!1;for(var b=0;b<this.connections.length;b++)if(this.connections[b]==a)return this.connections.splice(b,1),a.removeTwowayRelationship(),this.markChange(!0),a};this.removeSelected=function(){var a,b=this.removeSelectedNode(),c=this.removeSelectedConnection();if(0<b.nodes.length||0<c.length)a={nodes:b.nodes,conns:b.conns.concat(c)},d.register({descript:"\u79fb\u9664\u9879\u76ee",param:{manager:k,nodes:a.nodes,conns:a.conns},undo:function(){for(var a=this.param,b=0;b<a.nodes.length;b++)a.manager.mixNodes.push(a.nodes[b]);for(b=0;b<a.conns.length;b++)a.manager.addConnection(a.conns[b])},redo:function(){for(var a=this.param,b=0;b<a.nodes.length;b++)a.manager.removeNode(a.nodes[b]);for(b=0;b<a.conns.length;b++)a.manager.removeConnection(a.conns[b])}});return a};this.removeSelectedConnection=function(){for(var a=[],b=this.connections.length-1;0<=b;b--){var c=this.connections[b];c.isSelected()&&(this.connections.splice(b--,1),a.push(c),c.removeTwowayRelationship(),this.markChange(!0))}return a};this.removeSelectedNode=function(){for(var a=[],b=[],c=0;c<this.mixNodes.length;c++){var d=this.mixNodes[c];if(d.isSelected()&&!d.removeDisabled){this.mixNodes.splice(c--,1);a.push(d);this.currentNode==d&&(this.currentNode=null);var f=this.removeConnOfNode(d);f&&(b=b.concat(f));this.searchManager.remove(d);this.markChange(!0)}}0<a.length&&this.validateManager.update();return{nodes:a,conns:b}};this.removeCurrentNode=function(){var a=this.removeNode(this.currentNode);a&&(this.currentNode=null);return a};this.removeNode=function(a){if(a instanceof ZYDesign.Class.NodeBase&&!a.removeDisabled)for(var b=0;b<this.mixNodes.length;b++)if(this.mixNodes[b]==a)return this.mixNodes.splice(b,1).length,b=this.removeConnOfNode(a),this.markChange(!0),this.searchManager.remove(a),this.validateManager.update(),{node:a,conns:b}};this.breakConnOfSelectedNodes=function(){for(var a=[],b=0;b<this.mixNodes.length;b++){var c=this.mixNodes[b];c.isSelected()&&(a=a.concat(this.removeConnOfNode(c)))}0<a.length&&d.register({descript:"\u65ad\u5f00\u8fde\u63a5",param:{manager:k,conns:a},undo:function(){for(var a=this.param,b=0;b<a.conns.length;b++)a.manager.addConnection(a.conns[b])},redo:function(){for(var a=this.param,b=0;b<a.conns.length;b++)a.manager.removeConnection(a.conns[b])}});return a};this.removeConnOfOption=function(a,b){var c=[];if(!(a instanceof ZYDesign.Class.NodeBase&&b instanceof ZYDesign.Class.OptionConnector&&b.parent==a))return c;if("options"==b.belong){if(a instanceof ZYDesign.Class.MatrixNode)return c;for(var d=0;d<a.relatedConnections.length;d++){var f=a.relatedConnections[d];f.source==b&&(f=this.removeConnection(f))&&c.push(f)}}else{var g="xIndex";"optionsY"==b.belong&&(g="yIndex");for(d=0;d<a.options.length;d++){var h=a.options[d];if(h[g]==b.index)for(var k=0;k<a.relatedConnections.length;k++)f=a.relatedConnections[k],f.source==h&&(f=this.removeConnection(f))&&c.push(f)}}return c};this.removeConnOfNode=function(a){if(a instanceof ZYDesign.Class.NodeBase){for(var b=[],c=0;c<a.relatedConnections.length;c++){var d=this.removeConnection(a.relatedConnections[c--]);d&&b.push(d)}return b}};this.removeTempConnection=function(){0!=this.connections.length&&(this.connections[this.connections.length-1].temp&&this.connections.pop(),this.temmpConnection=null)};this.applyTempConnection=function(){if(0!=this.connections.length){var a=this.connections[this.connections.length-1];a.temp=!1;a.ApplyTwowayRelationship();this.temmpConnection=null;return a}};this.getConnectPermition=function(a,b){var c={allowConnect:!0,message:Prompt.QSNRD_ConnPermit};if(a==b)return c.message=Prompt.QSNRD_ConnForbidToSelf,c.allowConnect=!1,c;if(a.parent==b.parent)return c.message=Prompt.QSNRD_ConnForbidSameParent,c.allowConnect=!1,c;if(a.type==b.type)return c.message=Prompt.QSNRD_ConnForbidSameType,c.allowConnect=!1,c;if(null!=a.dest)return c.message=Prompt.QSNRD_ConnForbidMultiOutput,c.allowConnect=!1,c;if(0==a.parent.mode&&1==b.parent.mode||0==b.parent.mode&&1==a.parent.mode&&b.exactType!=ZYDesign.Enum.CONNEXACTTYPE.INPUTBASE)return c.message="\u7504\u522b\u8282\u70b9\u53ea\u80fd\u5904\u4e8e\u8bbe\u8ba1\u8282\u70b9\u524d\u9762",c.allowConnect=!1,c;if(a.exactType==ZYDesign.Enum.CONNEXACTTYPE.RANDOMSTART&&a.containDest(b))return c.message=Prompt.QSNRD_ConnForbidAlreadyExist,c.allowConnect=!1,c;if(this.isTryToOutputToAncestor(a,b))return c.message=Prompt.QSNRD_ConnForbidBack,c.allowConnect=!1,c;if((a.exactType==ZYDesign.Enum.CONNEXACTTYPE.RANDOMSTART||a.exactType==ZYDesign.Enum.CONNEXACTTYPE.LOOPSTART)&&0<b.sources.length)return c.message=Prompt.QSNRD_ConnForbidNoTool,c.allowConnect=!1,c;if(0<b.sources.length&&(b.sources[0].exactType==ZYDesign.Enum.CONNEXACTTYPE.RANDOMSTART||b.sources[0].exactType==ZYDesign.Enum.CONNEXACTTYPE.LOOPSTART))return c.message=Prompt.QSNRD_ConnForbidNoInput,c.allowConnect=!1,c;if(!(a.exactType!=ZYDesign.Enum.CONNEXACTTYPE.RANDOMSTART&&a.parent.getEngageStatus()!=ZYDesign.Enum.NODESTATE.RANDOM||b.parent.commonType==ZYDesign.Enum.NODECOMMONTYPE.SUBJECT&&b.parent.getEngageStatus()!=ZYDesign.Enum.NODESTATE.FREEWITHTOOL))return c.message=Prompt.QSNRD_ConnForbidOnlySubjectAdd,c.allowConnect=!1,c;if(!(a.parent.commonType==ZYDesign.Enum.NODECOMMONTYPE.SUBJECT&&a.parent.getEngageStatus()!=ZYDesign.Enum.NODESTATE.FREEWITHTOOL||b.exactType!=ZYDesign.Enum.CONNEXACTTYPE.RANDOMSTART&&b.parent.getEngageStatus()!=ZYDesign.Enum.NODESTATE.RANDOM))return c.message=Prompt.QSNRD_ConnForbidOnlySubjectOutput,c.allowConnect=!1,c;if(a.parent.getEngageStatus()==ZYDesign.Enum.NODESTATE.RANDOM&&b.parent.getEngageStatus()==ZYDesign.Enum.NODESTATE.RANDOM&&!a.parent.hasRouteTo(b.parent))return c.message=Prompt.QSNRD_ConnForbidCrossRandomGroup,c.allowConnect=!1,c;if(a.parent.getEngageStatus()==ZYDesign.Enum.NODESTATE.NORMAL&&b.parent.getEngageStatus()==ZYDesign.Enum.NODESTATE.RANDOM||a.parent.getEngageStatus()==ZYDesign.Enum.NODESTATE.RANDOM&&b.parent.getEngageStatus()==ZYDesign.Enum.NODESTATE.NORMAL)return c.message=Prompt.QSNRD_ConnForbidNormalToRandom,c.allowConnect=!1,c;if((a.parent.getEngageStatus()==ZYDesign.Enum.NODESTATE.NORMAL&&b.parent.getEngageStatus()==ZYDesign.Enum.NODESTATE.LOOP||a.parent.getEngageStatus()==ZYDesign.Enum.NODESTATE.LOOP&&b.parent.getEngageStatus()==ZYDesign.Enum.NODESTATE.NORMAL)&&a.exactType!=ZYDesign.Enum.CONNEXACTTYPE.LOOPSTART&&b.exactType!=ZYDesign.Enum.CONNEXACTTYPE.LOOPEND)return c.message=Prompt.QSNRD_ConnForbidNormalToLoop,c.allowConnect=!1,c;if(a.parent.getEngageStatus()==ZYDesign.Enum.NODESTATE.RANDOM&&b.parent.getEngageStatus()==ZYDesign.Enum.NODESTATE.LOOP||a.parent.getEngageStatus()==ZYDesign.Enum.NODESTATE.LOOP&&b.parent.getEngageStatus()==ZYDesign.Enum.NODESTATE.RANDOM)return c.message=Prompt.QSNRD_ConnForbidLoopToRandom,c.allowConnect=!1,c;if(a.exactType==ZYDesign.Enum.CONNEXACTTYPE.RANDOMSTART&&(b.parent.getEngageStatus()==ZYDesign.Enum.NODESTATE.LOOP||b.parent.getEngageStatus()==ZYDesign.Enum.NODESTATE.NORMAL))return c.message=Prompt.QSNRD_ConnForbidNoRandomStart,c.allowConnect=!1,c;if(a.exactType==ZYDesign.Enum.CONNEXACTTYPE.LOOPSTART&&(b.parent.getEngageStatus()==ZYDesign.Enum.NODESTATE.RANDOM||b.parent.getEngageStatus()==ZYDesign.Enum.NODESTATE.NORMAL))return c.message=Prompt.QSNRD_ConnForbidNoLoopStart,c.allowConnect=!1,c;if(b.exactType==ZYDesign.Enum.CONNEXACTTYPE.LOOPEND&&(a.parent.getEngageStatus()==ZYDesign.Enum.NODESTATE.RANDOM||a.parent.getEngageStatus()==ZYDesign.Enum.NODESTATE.NORMAL))return c.message=Prompt.QSNRD_ConnForbidNoLoopEnd,c.allowConnect=!1,c;if(a.exactType==ZYDesign.Enum.CONNEXACTTYPE.LOOPSTART&&b.parent.commonType==ZYDesign.Enum.NODECOMMONTYPE.TERMINAL||b.exactType==ZYDesign.Enum.CONNEXACTTYPE.LOOPEND&&a.parent.commonType==ZYDesign.Enum.NODECOMMONTYPE.TERMINAL)return c.message=Prompt.QSNRD_ConnForbidNoTerminal,c.allowConnect=!1,c;if(b.parent.hasRouteTo(a.parent.getEngageDueToNode())&&b.exactType!=ZYDesign.Enum.CONNEXACTTYPE.LOOPEND)return c.message=Prompt.QSNRD_ConnForbidToolToOut,c.allowConnect=!1,c;if(a.parent.hasRouteTo(b.parent.getEngageDueToNode())&&a.exactType!=ZYDesign.Enum.CONNEXACTTYPE.LOOPSTART&&a.exactType!=ZYDesign.Enum.CONNEXACTTYPE.RANDOMSTART)return c.message=Prompt.QSNRD_ConnForbidOutToTool,c.allowConnect=!1,c;if(a.parent.getEngageStatus()==ZYDesign.Enum.NODESTATE.LOOP&&b.parent.getEngageStatus()==ZYDesign.Enum.NODESTATE.LOOP&&a.parent.getEngageDueToNode()!=b.parent.getEngageDueToNode()&&b.parent!=a.parent.getEngageDueToNode()&&a.parent!=b.parent.getEngageDueToNode())return c.message=Prompt.QSNRD_ConnForbidCrossLoop,c.allowConnect=!1,c;if(a.exactType==ZYDesign.Enum.CONNEXACTTYPE.LOOPSTART&&b.parent.getEngageStatus()==ZYDesign.Enum.NODESTATE.LOOP&&b.parent.getEngageDueToNode()!=a.parent)return c.message=Prompt.QSNRD_ConnForbidCrossLoopStart,c.allowConnect=!1,c;b.exactType==ZYDesign.Enum.CONNEXACTTYPE.LOOPEND&&a.parent.getEngageStatus()==ZYDesign.Enum.NODESTATE.LOOP&&a.parent.getEngageDueToNode()!=b.parent&&(c.message=Prompt.QSNRD_ConnForbidCrossLoopEnd,c.allowConnect=!1);return c};this.createConnection=function(a,b,c){if(a&&b){var d=new ZYDesign.Class.ConnectionModel;d.source=a;d.dest=b;d.temp=c;return d}};this.isTryToOutputToAncestor=function(a,b){return this.isAncestor(a,b)};this.isAncestor=function(a,b){if(!a.parent.input)return!1;for(var c=a.parent.input.sources,d=null,f=0;f<c.length;f++){var g=c[f],h=g.parent.input;if(h!=d&&(d=h,h==b||this.isAncestor(g,b)))return!0}return!1};this.copyNode=function(a,b,c,d){if(!(a instanceof ZYDesign.Class.NodeBase)||a.copyDisabled)return!1;var f={};d&&(f.noSingleSelect=d);a.cloneNodeJson(f,b||30,c||30);if(!f||!f.addFnKey)return!1;b=this[f.addFnKey](f);this.markChange(!0);return{originNode:a,copy:b}};this.addVitualNodes=function(){var a=new ZYDesign.Class.VitualNode;a.x=0;a.y=0;this.vitualNodes.push(a);a=new ZYDesign.Class.VitualNode;a.x=2*this.chartXDiffer;a.y=2*this.chartYDiffer;this.vitualNodes.push(a)};this.handleNewNode=function(a,b){this.mixNodes.push(a);a.originData.isInit?(a.originData.noSingleSelect?(a.select(),delete a.originData.noSingleSelect):this.selectNodeSingle(a),1==a.mode?(a.sortNo=++this.lastCheckNo,a.nodeName="S"+a.sortNo):0==a.mode&&a.isSubject()&&(a.sortNo=++this.lastDesignNo,a.nodeName="Q"+a.sortNo)):(a.sortNo=a.originData.sortNo,1==a.mode&&this.lastCheckNo<a.sortNo?this.lastCheckNo=a.sortNo:0==a.mode&&a.isSubject()&&this.lastDesignNo<a.sortNo&&(this.lastDesignNo=a.sortNo));a.checkVisible()};this.importConnection=function(a){for(var b=0;b<a.length;b++){var c=a[b],d=this.searchConnectorById(c.selfPortId),c=this.searchConnectorById(c.destInputId),d=this.createConnection(d,c,!1);this.addConnection(d);d.checkVisible()}};this.searchConnectorById=function(a){for(var b=0;b<this.mixNodes.length;b++){var c=this.mixNodes[b].searchConnectorById(a);if(c)return c}return null};this.showAll=function(){this.showLoader();var a=this;setTimeout(function(){a.showAllDo();a.digest()});d.register({descript:"\u663e\u793a\u5168\u90e8",param:{manager:k},undo:function(){this.param.manager.showAll()},redo:function(){this.param.manager.showAll()}})};this.showAllDo=function(){var a=arguments.callee;if(a.done)this.chartZoomRate=a.oldZoomRate,this.moveNodes(a.deltaX*this.chartZoomRate,a.deltaY*this.chartZoomRate),a.done=!1,this.controlText();else{a.oldZoomRate=this.chartZoomRate;var b=this.startNode.x,c=this.startNode.y,d=this.getBorderInfo(),f=this.getContainerInfo(),g=!1;if(d.nodesWidth<=f.width&&d.nodesHeight<=f.height){if(d.nodesLeft>=f.left&&d.nodesTop>=f.top&&d.nodesRight<=f.right&&d.nodesBottom<=f.bottom&&1<=this.chartZoomRate)return;g=!0}var h=1,k=1,l=!1;if(d.nodesWidth>f.width||g)h=f.width/d.nodesWidth,l=!0;if(d.nodesHeight>f.height||g)k=f.height/d.nodesHeight,l=!0;this.chartZoomRate=h<k?h*this.chartZoomRate:k*this.chartZoomRate;g&&1<this.chartZoomRate&&(this.chartZoomRate=1);l&&(d=this.getBorderInfo());this.moveNodes(-(this.chartXDiffer+d.nodesLeft-6),-(this.chartYDiffer+d.nodesTop-24));this.controlText();d=this.checkVisibleOfNodesAndConns();this.hideLoader(d);d=this.startNode.y;a.deltaX=b-this.startNode.x;a.deltaY=c-d;a.done=!0}};this.getContainerInfo=function(){this.containerInfo.width=2*this.chartXDiffer;this.containerInfo.height=2*this.chartYDiffer;this.containerInfo.centerX=0;this.containerInfo.centerY=0;if(0>=this.containerInfo.width||0>=this.containerInfo.height)this.containerInfo.width=0,this.containerInfo.height=0;this.containerInfo.left=-this.containerInfo.width/2;this.containerInfo.top=-this.containerInfo.height/2;this.containerInfo.right=this.containerInfo.width/2;this.containerInfo.bottom=this.containerInfo.height/2;return this.containerInfo};this.getBorderInfo=function(){for(var a in this.borderInfo)this.borderInfo[a]=0;a=!0;for(var b=0;b<this.mixNodes.length;b++){var c=this.mixNodes[b];this.adjustBorderInfoByNode(this.borderInfo,c,a);a=!1}for(b=0;b<this.vitualNodes.length;b++)c=this.vitualNodes[b],this.adjustBorderInfoByNode(this.borderInfo,c,!1);this.borderInfo.width=this.borderInfo.right-this.borderInfo.left;this.borderInfo.height=this.borderInfo.bottom-this.borderInfo.top;this.borderInfo.originWidth=this.borderInfo.originRight-this.borderInfo.originLeft;this.borderInfo.originHeight=this.borderInfo.originBottom-this.borderInfo.originTop;this.borderInfo.nodesWidth=this.borderInfo.nodesRight-this.borderInfo.nodesLeft;this.borderInfo.nodesHeight=this.borderInfo.nodesBottom-this.borderInfo.nodesTop;this.top=this.borderInfo.originTop;this.left=this.borderInfo.originLeft;this.width=this.borderInfo.originWidth;this.height=this.borderInfo.originHeight;a=this.getContainerInfo();this.viewTop=a.top/this.chartZoomRate;this.viewLeft=a.left/this.chartZoomRate;this.viewHeight=a.height/this.chartZoomRate;this.viewWidth=a.width/this.chartZoomRate;return this.borderInfo};this.adjustBorderInfoByNode=function(a,b,c){if(a.left>b.getX()*this.chartZoomRate||c)a.left=b.getX()*this.chartZoomRate,a.originLeft=b.getX(),b.isVitual||(a.nodesLeft=a.left);if(a.top>b.getY()*this.chartZoomRate||c)a.top=b.getY()*this.chartZoomRate,a.originTop=b.getY(),b.isVitual||(a.nodesTop=a.top);var d=b.getRight()+16;if(a.right<d*this.chartZoomRate||c)a.right=d*this.chartZoomRate,a.originRight=d,b.isVitual||(a.nodesRight=a.right);d=b.getBottom()+34;if(a.bottom<d*this.chartZoomRate||c)a.bottom=d*this.chartZoomRate,a.originBottom=d,b.isVitual||(a.nodesBottom=a.bottom)};this.selectNodeSingle=function(a){this.deselectAll();a.select();this.currentNode=a;this.takeToTop(a);setTimeout(function(){$(".option_editor_input").each(function(){$(this).css("height",this.scrollHeight)});ZYDesign.Config.developMode||k.currentNode.isTypeIn("MARK,SELECTPIC")&&$(".editor_developing").addClass("image_type_disabled")})};this.addSelectNode=function(a,b,c,d){a=a?a:ZYDesign.Initial.selectNodeJson;var f=new ZYDesign.Class.SelectNode;f.init(a,c,d);1==b&&(f.mode=b);this.handleNewNode(f);return f};this.addSelectPicNode=function(a,b,c,d){a=a?a:ZYDesign.Initial.selectPicNodeJson;b=new ZYDesign.Class.SelectPicNode;b.init(a,c,d);this.handleNewNode(b);return b};this.addMarkingNode=function(a,b,c,d){a=a?a:ZYDesign.Initial.markingNodeJson;var f=new ZYDesign.Class.MarkingNode;f.init(a,c,d);1==b&&(f.mode=b);this.handleNewNode(f);return f};this.addSequencingNode=function(a,b,c,d){a=a?a:ZYDesign.Initial.sequencingNodeJson;var f=new ZYDesign.Class.SequencingNode;f.init(a,c,d);1==b&&(f.mode=b);this.handleNewNode(f);return f};this.addFillblankNode=function(a,b,c,d){a=a?a:ZYDesign.Initial.fillblankNodeJson;b=new ZYDesign.Class.FillblankNode;b.init(a,c,d);this.handleNewNode(b);return b};this.addMatrixNode=function(a,b,c,d){a=a?a:ZYDesign.Initial.matrixNodeJson;b=new ZYDesign.Class.MatrixNode;b.init(a,c,d);this.handleNewNode(b);return b};this.addLogicNode=function(a,b,c,d){this.addLogicNode.lastSortNo||(this.addLogicNode.lastSortNo=0);a=a?a:ZYDesign.Initial.logicNodeJson;b=new ZYDesign.Class.LogicNode;b.init(a,c,d);this.handleNewNode(b);b.originData.isInit?(b.sortNo=++this.addLogicNode.lastSortNo,b.nodeName="Logic"+b.sortNo):(b.sortNo=b.originData.sortNo,this.addLogicNode.lastSortNo<b.sortNo&&(this.addLogicNode.lastSortNo=b.sortNo));return b};this.initLogicNodeSubject=function(a){for(var b=0;b<a.options.length;b++)for(var c=a.options[b],d=0;d<c.requires.length;d++){var f=c.requires[d];f.relatedSubject=this.searchSubjectById(f.subjectId)}};this.searchSubjectById=function(a){for(var b=0;b<this.mixNodes.length;b++){var c=this.mixNodes[b];if(c.nodeUuid==a)return c}return null};this.addLoopNode=function(a,b,c,d){this.addLoopNode.lastSortNo||(this.addLoopNode.lastSortNo=0);a=a?a:ZYDesign.Initial.loopNodeJson;b=new ZYDesign.Class.LoopNode;b.init(a,c,d);this.handleNewNode(b);b.originData.isInit?(b.sortNo=++this.addLoopNode.lastSortNo,b.nodeName="Loop"+b.sortNo):(b.sortNo=b.originData.sortNo,this.addLoopNode.lastSortNo<b.sortNo&&(this.addLoopNode.lastSortNo=b.sortNo));return b};this.addRandomNode=function(a,b,c,d){this.addRandomNode.lastSortNo||(this.addRandomNode.lastSortNo=0);a=a?a:ZYDesign.Initial.randomNodeJson;b=new ZYDesign.Class.RandomNode;b.init(a,c,d);this.handleNewNode(b);b.originData.isInit?(b.sortNo=++this.addRandomNode.lastSortNo,b.nodeName="Random"+b.sortNo):(b.sortNo=b.originData.sortNo,this.addRandomNode.lastSortNo<b.sortNo&&(this.addRandomNode.lastSortNo=b.sortNo));return b};this.addCheckNode=function(a,b,c,d){};this.addEndNode=function(a,b,c,d){this.addEndNode.lastSortNo||(this.addEndNode.lastSortNo=0);a=a?a:ZYDesign.Initial.endNodeJson;b=new ZYDesign.Class.EndNode;b.init(a,c,d);this.handleNewNode(b);b.originData.isInit?(b.sortNo=++this.addEndNode.lastSortNo,b.nodeName="End"+b.sortNo):(b.sortNo=b.originData.sortNo,this.addEndNode.lastSortNo<b.sortNo&&(this.addEndNode.lastSortNo=b.sortNo));return b};this.addCommentNode=function(a,b,c,d){this.addCommentNode.lastSortNo||(this.addCommentNode.lastSortNo=0);a=a?a:ZYDesign.Initial.commentNodeJson;b=new ZYDesign.Class.CommentNode;b.init(a,c,d);this.handleNewNode(b);b.originData.isInit?(b.sortNo=++this.addCommentNode.lastSortNo,b.nodeName="End"+b.sortNo):(b.sortNo=b.originData.sortNo,this.addCommentNode.lastSortNo<b.sortNo&&(this.addCommentNode.lastSortNo=b.sortNo));return b};this.addStartNode=function(a,b,c,d,f){if(!this.startNode)return a=a?a:ZYDesign.Initial.startNodeJson,b=new ZYDesign.Class.StartNode,b.init(a,c,d),f&&(b.nodeName=f),this.startNode=b,this.handleNewNode(b),b};this.addRegionNode=function(a,b,c,d){if(this.hasNodesByType(ZYDesign.Enum.NODETYPE.REGION))n.hint(Prompt.QSNRD_OnlyOneSuchNode);else return a=a?a:ZYDesign.Initial.regionNodeJson,b=new ZYDesign.Class.RegionNode,b.init(a,c,d),this.handleNewNode(b),b};this.addGenderNode=function(a,b,c,d){if(this.hasNodesByType(ZYDesign.Enum.NODETYPE.GENDER))n.hint(Prompt.QSNRD_OnlyOneSuchNode);else return a=a?a:ZYDesign.Initial.genderNodeJson,b=new ZYDesign.Class.GenderNode,b.init(a,c,d),this.handleNewNode(b),b};this.addAgeGroupNode=function(a,b,c,d){if(this.hasNodesByType(ZYDesign.Enum.NODETYPE.AGEGROUP))n.hint(Prompt.QSNRD_OnlyOneSuchNode);else return a=a?a:ZYDesign.Initial.ageGroupNodeJson,b=new ZYDesign.Class.AgeGroupNode,b.init(a,c,d),this.handleNewNode(b),b};this.addMaritalStatusNode=function(a,b,c,d){if(this.hasNodesByType(ZYDesign.Enum.NODETYPE.MARITALSTATUS))n.hint(Prompt.QSNRD_OnlyOneSuchNode);else return a=a?a:ZYDesign.Initial.maritalStatusNodeJson,b=new ZYDesign.Class.MaritalStatusNode,b.init(a,c,d),this.handleNewNode(b),b};this.addEduStatusNode=function(a,b,c,d){if(this.hasNodesByType(ZYDesign.Enum.NODETYPE.EDUSTATUS))n.hint(Prompt.QSNRD_OnlyOneSuchNode);else return a=a?a:ZYDesign.Initial.eduStatusNodeJson,b=new ZYDesign.Class.EduStatusNode,b.init(a,c,d),this.handleNewNode(b),b};this.addOccupationNode=function(a,b,c){if(this.hasNodesByType(ZYDesign.Enum.NODETYPE.OCCUPATION))n.hint(Prompt.QSNRD_OnlyOneSuchNode);else{a=a?a:ZYDesign.Initial.occupationNodeJson;var d=new ZYDesign.Class.OccupationNode;d.init(a,b,c);this.handleNewNode(d);return d}};this.addProfessionNode=function(a,b,c,d){if(this.hasNodesByType(ZYDesign.Enum.NODETYPE.PROFESSION))n.hint(Prompt.QSNRD_OnlyOneSuchNode);else return a=a?a:ZYDesign.Initial.professionNodeJson,b=new ZYDesign.Class.ProfessionNode,b.init(a,c,d),this.handleNewNode(b),b};this.addJobTitleNode=function(a,b,c,d){if(this.hasNodesByType(ZYDesign.Enum.NODETYPE.JOBTITLE))n.hint(Prompt.QSNRD_OnlyOneSuchNode);else return a=a?a:ZYDesign.Initial.jobTitleNodeJson,b=new ZYDesign.Class.JobTitleNode,b.init(a,c,d),this.handleNewNode(b),b};this.addIncomeNode=function(a,b,c,d){if(this.hasNodesByType(ZYDesign.Enum.NODETYPE.INCOME))n.hint(Prompt.QSNRD_OnlyOneSuchNode);else return a=a?a:ZYDesign.Initial.incomeNodeJson,b=new ZYDesign.Class.IncomeNode,b.init(a,c,d),this.handleNewNode(b),b};this.addFamilyIncomeNode=function(a,b,c,d){if(this.hasNodesByType(ZYDesign.Enum.NODETYPE.FAMILYINCOME))n.hint(Prompt.QSNRD_OnlyOneSuchNode);else return a=a?a:ZYDesign.Initial.familyIncomeNodeJson,b=new ZYDesign.Class.FamilyIncomeNode,b.init(a,c,d),this.handleNewNode(b),b};this.getNodesByType=function(a){for(var b=[],c=0;c<this.mixNodes.length;c++){var d=this.mixNodes[c];d.isTypeOf(a)&&b.push(d)}return b};this.hasNodesByType=function(a){for(var b=0;b<this.mixNodes.length;b++)if(this.mixNodes[b].isTypeOf(a))return!0;return!1};this.exportJson=function(a,b,c){"N"==b&&this.generateNodeOrder();var d=this.imageUploadManager.export();a.textHolder={questionnairUuid:this.questionnairUuid,qNumber:this.qNumber,nodeText:null,errorInclude:b,tested:c,nodeCount:0,MediaLibrary:JSON.stringify({imageList:d.list}),cutList:d.cutList,StartNode:{IsSave:!1},theme:this.themeBoxManager.export()};this.startNode.dirty&&(a.textHolder.StartNode={IsSave:!0,Title:this.startNode.nodeName,Descript:this.startNode.question.originText,MediaID:this.startNode.image?this.startNode.image.id:""});a.fieldHolder=[];b=[];for(c=0;c<this.mixNodes.length;c++){d=this.mixNodes[c];d.type!=ZYDesign.Enum.NODETYPE.COMMENT&&a.textHolder.nodeCount++;var f={};d.exportJson(this.questionnairUuid,f);b.push(f);a.fieldHolder.push(f)}a.textHolder.nodeText=JSON.stringify(b)};this.save=function(a,b,c,d,f,g){if(this.isAllowSave()&&this.getOnline())if(!this.dirty&&"Y"==d)b instanceof Function&&b(),this.digest();else if(!this.saving){this.auto="Y"==d?!0:!1;this.saving=!0;this.digest();var h=this;this.isExistQuesNameAjax(function(k){k?(alert(Prompt.QSNRD_QuesNameExist),h.saving=!1,h.digest(),g instanceof Function&&g()):h.getQuesStatusAjax(function(k){h.isAllowChangeStatus(k)?h.getQuotaInfoAjax(function(k){k?(n.hint(Prompt.QSNRD_NoChangeForQuota),h.saving=!1,h.digest(),g instanceof Function&&g()):h.saveAjax(a,b,c,d,f,g)},function(){n.hint(Prompt.QSNRD_GetQuotaInfoFauled);h.saving=!1;h.digest();g instanceof Function&&g()}):(n.hint(Prompt.QSNRD_NoChangeForOnLine),h.saving=!1,h.digest(),g instanceof Function&&g())},function(){n.hint(Prompt.QSNRD_GetQuesInfoFauled);h.saving=!1;h.digest();g instanceof Function&&g()})},function(a){n.hint(Prompt.QSNRD_CheckQuesNameFauled);h.saving=!1;h.digest();g instanceof Function&&g()})}};this.saveAjax=function(a,b,c,d,f,g){var h=(new Date).getTime();c||(c=this.validate()?"N":"Y");f||(f=this.generateVersionName());var k={};this.exportJson(k,c,a);var l=this;$.ajax({type:"POST",url:"/QD/saveDesign",data:{dataText:JSON.stringify(k.textHolder),dataField:JSON.stringify(k.fieldHolder),isAuto:d,verName:f,cutList:k.textHolder.cutList},dataType:"json",error:function(a){var b="";if(a||a.errorMessage)b=a||a.errorMessage;RestLoginForDesign(b);n.hint(Prompt.QSNRD_SaveFailed);l.saving=!1;l.digest();g instanceof Function&&g(e)},success:function(a){var c=(new Date).getTime(),c=Math.round((c-h)/1E3);a.returnError?n.hint(Prompt.QSNRD_SaveFailed):(l.clearChange(),n.hint("\u4fdd\u5b58\u6210\u529f:"+f+" \u6d88\u8017\u65f6\u95f4:"+c+"s"),"N"==d&&l.versionHistoryManager.setUpdateNextTime());l.saving=!1;l.imageUploadManager.clearCutList();b instanceof Function&&b();l.digest()}})};this.test=function(){if(this.getOnline()&&!this.testing){this.testing=!0;var a=this;this.getQuesStatusAjax(function(b,c){a.isAllowChangeStatus(b)?a.testWithValidate(c):(a.validateManager.open(!0),a.testing=!1,a.digest())},function(){n.hint(Prompt.QSNRD_GetQuesStatusFauledDeBugFauled);a.testing=!1})}};this.testWithValidate=function(a){var b=this;this.validate(a)?(b.save("Y",function(){b.validateManager.open(!0);b.testing=!1},"N","Y",this.generateVersionName(),function(){b.testing=!1}),b.autoSaveManager.reset()):(b.validateManager.open(),b.testing=!1,b.digest())};this.generateVersionName=function(){var a=(new Date).toString(),b=a.indexOf(" ")+1,c=a.indexOf("GMT")-1;return a.substring(b,c)};this.validate=function(a){return this.validateManager.validate(a)};this.moveNodes=function(a,b,c){for(var d=0;d<this.mixNodes.length;d++){var f=this.mixNodes[d];if(!c||f.isSelected())f.x+=a/this.chartZoomRate,f.y+=b/this.chartZoomRate}if(!c)for(d=0;d<this.vitualNodes.length;d++)f=this.vitualNodes[d],f.x+=a/this.chartZoomRate,f.y+=b/this.chartZoomRate};this.moveSpecifiedNodes=function(a,b,c){if(a instanceof Array)for(var d=0;d<a.length;d++){var f=a[d];f.x+=b/this.chartZoomRate;f.y+=c/this.chartZoomRate}};this.getSelectedNodes=function(){for(var a=[],b=0;b<this.mixNodes.length;b++){var c=this.mixNodes[b];c.isSelected()&&a.push(c)}return a};this.takeToTop=function(a){if(this.mixNodes[this.mixNodes.length-1]!=a)for(var b=0;b<this.mixNodes.length;b++)this.mixNodes[b]==a&&(this.mixNodes.splice(b,1),this.mixNodes.push(a))};this.removeOptionConnOfNode=function(a,b){if(!(a instanceof ZYDesign.Class.SubjectNode))return[];for(var c=[],d=0;d<a.relatedConnections.length;d++){var f=a.relatedConnections[d];if(b){if(f.source==b){(f=this.removeConnection(f))&&c.push(f);break}}else f.source.parent==a&&f.source instanceof ZYDesign.Class.OptionConnector&&((f=this.removeConnection(f))&&c.push(f),d--)}return c};this.addOptionForCurrentNode=function(){if(this.currentNode instanceof ZYDesign.Class.SubjectNode){var a=!1;this.currentNode.type==ZYDesign.Enum.NODETYPE.MATRIX&&this.currentNode.rowHiding&&(a=!0);a=this.currentNode.addOption({},a);this.markChange();d.register({descript:"\u6dfb\u52a0\u9009\u9879",param:{node:this.currentNode,option:a},undo:function(){var a=this.param;a.node.removeOption(a.option)},redo:function(){var a=this.param;a.node.addOption(a.option)}})}};this.hasModal=function(){return $(document.body).hasClass("modal-open")};this.getQuesStatusAjax=function(a,c){b.post("/QD/GetPMQuestionnaireStateByQuesID",{quesID:this.questionnairUuid,quesTitle:this.startNode.nodeName}).success(function(b){a instanceof Function&&(k.qStatus=b.QStatus,a(b.QStatus,b.isQuesTitleExits))}).error(function(a){RestLoginForDesign(a);c instanceof Function&&c(a)})};this.getQuotaInfoAjax=function(a,c){var d=this;b.post("/QD/GetQuotaNodeOption",{quesid:this.questionnairUuid}).success(function(b){a instanceof Function&&a(d.isQuotaInfoChanged(b))}).error(function(a){RestLoginForDesign(a);c instanceof Function&&c(a)})};this.isQuotaInfoChanged=function(a){if(!a)return!1;var b=a.NodeList;a=a.OptionList;if(!(b instanceof Array&&a instanceof Array)||0==a.length&&0==b.length)return!1;for(var c=this.getNodesAndOptionsOfCheckMode(),d=0;d<b.length;d++){for(var f=b[d],g=!0,h=0;h<c.nodeList.length;h++)if(c.nodeList[h].nodeUuid.toUpperCase()==f.toUpperCase()){g=!1;break}if(g)return!0}for(d=0;d<a.length;d++){b=a[d];f=!0;for(h=0;h<c.optionList.length;h++)c.optionList[h].outputId.toUpperCase()==b.toUpperCase()&&(f=!1);if(f)return!0}return!1};this.getNodesAndOptionsOfCheckMode=function(){for(var a={nodeList:[],optionList:[]},b=0;b<this.mixNodes.length;b++){var c=this.mixNodes[b];1==c.mode&&(a.nodeList.push(c),c.options instanceof Array&&(a.optionList=a.optionList.concat(c.options)))}return a};this.isExistVerNameAjax=function(a,c,d){b.post("/QD/IsExisVerName",{verName:a,quesID:this.questionnairUuid}).success(function(a){c instanceof Function&&c("\u540d\u79f0\u91cd\u590d\u3002"==a?!0:!1)}).error(function(a){RestLoginForDesign(a);d instanceof Function&&d(a)})};this.isExistQuesNameAjax=function(a,c){b.post("/QD/IsExisQuesName",{title:this.startNode.nodeName,quesID:this.questionnairUuid}).success(function(b){a instanceof Function&&a(b.returnError)}).error(function(a){var b="";if(a||a.errorMessage)b=a||a.errorMessage;RestLoginForDesign(b);c instanceof Function&&c(b)})};this.leavePage=function(a){var b=k;this.hasChange()?this.saving?n.hint(Prompt.QSNRD_PleaseWaitSaving):confirm(Prompt.QSNRD_GiveupChange,function(){b.save(null,function(){window.location.href=a},null,"Y",null,function(){window.location.href=a})},function(){window.location.href=a},"\u662f","","\u5426"):window.location.href=a};this.isAllowChangeStatus=function(a){return 4==a||5==a||6==a||9==a?!1:!0};this.zoomOut=function(){if(!(0.1>=this.chartZoomRate)){this.showLoader();var a=this.chartZoomRate;this.zoomOutDo();d.register({descript:"\u7f29\u5c0f",param:{manager:k,oldRate:a,newRate:this.chartZoomRate},undo:function(){var a=this.param;a.manager.chartZoomRate=a.oldRate;a.manager.controlText()},redo:function(){var a=this.param;a.manager.chartZoomRate=a.newRate;a.manager.controlText()}})}};this.zoomOutDo=function(){if(!(0.1>=this.chartZoomRate)){this.chartZoomRate=(Math.ceil(10*this.chartZoomRate)-1)/10;this.controlText();var a=this.checkVisibleOfNodesAndConns();this.hideLoader(a)}};this.zoomIn=function(){if(!(2<=this.chartZoomRate)){var a=this.chartZoomRate,b=this.chartZoomRate=(Math.floor(10*this.chartZoomRate)+1)/10;this.controlText();this.checkVisibleOfNodesAndConns();d.register({descript:"\u653e\u5927",param:{manager:k,oldRate:a,newRate:b},undo:function(){var a=this.param;a.manager.chartZoomRate=a.oldRate;a.manager.controlText()},redo:function(){var a=this.param;a.manager.chartZoomRate=a.newRate;a.manager.controlText()}})}};this.controlText=function(){if(0.6>=this.chartZoomRate){if(!(0<$("#text_style_tag").length)){var a=document.head||document.getElementsByTagName("head")[0],b=document.createElement("style");b.type="text/css";b.setAttribute("id","text_style_tag");b.styleSheet?b.styleSheet.cssText="text { display: none; }":b.appendChild(document.createTextNode("text { display: none; }"));a.appendChild(b)}}else $("#text_style_tag").remove()};this.toggleGrid=function(){this.grid=!this.grid;localStorage.setItem("chart_grid",this.grid)};this.translateCoordinates=function(a,b,c){var d=c.get(0);c=d.getScreenCTM();d=d.createSVGPoint();d.x=a;d.y=b;return d.matrixTransform(c.inverse())};this.showDefault=function(){this.chartZoomRate=1};this.digest=function(a,b){c(a||function(){},b)};this.dislocateOptOfCurrNode=function(a,b,c){var f=this.currentNode;f instanceof ZYDesign.Class.SubjectNode&&(f.dislocateOption(a,b,c),d.register({descript:"\u9009\u9879\u9519\u4f4d",param:{node:f,srcIndex:b,tarIndex:c,belong:a},undo:function(){var a=this.param;a.node.dislocateOption(a.belong,a.tarIndex,a.srcIndex)},redo:function(){var a=this.param;a.node.dislocateOption(a.belong,a.srcIndex,a.tarIndex)}}))};this.generateNodeOrder=function(){this.startNode.order=0;var a=[this.startNode],b=[this.startNode],c=0,d=b.length;do{for(;c<d;c++){for(var f=b[c].searchNextNodesByOrder(),g=0;g<f.resultList.length;g++){var h=f.resultList[g];0>a.indexOf(h)&&(h.order=a.length,a.push(h))}for(g=0;g<f.seedList.length;g++)h=f.seedList[g],0>b.indexOf(h)&&b.push(h)}c=d;d=b.length}while(d>c)};this.disableConns=function(){for(var a=0;a<this.connections.length;a++)this.connections[a].disable=!0};this.enableConns=function(){for(var a=0;a<this.connections.length;a++)this.connections[a].disable=!1};this.updateNodeFlowPosition=function(a){for(var b=[],c=[],d=!1,f=0;f<this.mixNodes.length;f++){var g=this.mixNodes[f];if(!a||g.isSelected()){g.checkVisible()&&(d=!0);c.push(g);for(var h=0;h<g.relatedConnections.length;h++){var k=g.relatedConnections[h];k.checkVisible()&&(d=!0);0>b.indexOf(k)&&b.push(k)}}}if(d)this.digest(),console.log("refreshed by angular");else{for(f=0;f<c.length;f++)c[f].fixPosition();for(f=0;f<b.length;f++)b[f].fixPosition();$("#eyeSvg").attr("transform",this.getEyeTransform());console.log("refreshed by self")}};this.checkVisibleOfNodesAndConns=function(){for(var a="",b=0;b<this.mixNodes.length;b++){var c=this.mixNodes[b],d=c.checkVisible();!a&&d&&c.visible&&(a=c.nodeUuid)}for(b=0;b<this.connections.length;b++){var f=this.connections[b],d=f.checkVisible();!a&&d&&c.visible&&(a=f.uuid)}return a};this.getEyeRectWidth=function(){return Math.round(0.8/this.eyeZoomRate)};this.takeToCenter=function(a){if(a instanceof ZYDesign.Class.NodeBase){var b=(this.chartXDiffer-a.x)*this.chartZoomRate,c=(this.chartYDiffer-a.y)*this.chartZoomRate;this.moveNodes(b,c);this.checkVisibleOfNodesAndConns();d.register({descript:"\u8282\u70b9\u5b9a\u4f4d\u79fb\u52a8\u753b\u5e03",param:{deltaX:b,deltaY:c,manager:k},undo:function(){this.param.manager.moveNodes(-b,-c)},redo:function(){this.param.manager.moveNodes(b,c)}})}};this.showLoader=function(){this.useLoadIcon&&($("#design_loader").show(),$(document.body).addClass("modal-open"))};this.hideLoader=function(a){if(this.useLoadIcon)if(a)var b=setInterval(function(){0<$("#"+a).length&&(clearInterval(b),$("#design_loader").hide(),$(document.body).removeClass("modal-open"))});else $("#design_loader").hide(),$(document.body).removeClass("modal-open")};this.isAutoSaving=function(){return this.saving&&this.auto};this.isManaulSaving=function(){return this.saving&&!this.auto};this.isAllowSave=function(){return this.isAllowChangeStatus(this.qStatus)};this.hasChange=function(){return this.dirty&&this.isAllowSave()};this.recordCommonChange=function(a,b,c,f){if(ZYDesign.Config.customInputZY){var g=arguments.callee;-1==c?(g.oldValue=a[b],g.changed=!1):1==c?g.changed&&d.upgrade():a[b]!=g.oldValue&&(g.changed=!0,this.markChange(),d.register({descript:f,exclusive:!0,param:{obj:a,key:b,oldValue:g.oldValue,newValue:a[b]}}))}else c||this.designManager.markChange()}}).init()}]);