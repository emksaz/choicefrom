var isCheck=1;$(function(){var a=$("#Type").val();localStorage.MyFolder=0;localStorage.OtherFolder=0;"1"==a&&($("#Register").hide(),$("#Login").show());"2"==a&&($("#Register").show(),$("#Login").hide(),$("#REmail").val(""),$("#RName").val(""),$("#RPassWord").val(""),$("#RInviteCode").val(""));-1==document.cookie.indexOf("EmailCookie")?($("#checkboxG1").removeAttr("checked"),isCheck=0):($("#checkboxG1").attr("checked","checked"),isCheck=1)});var zyApp=angular.module("myapp",["ui.router"]);zyApp.controller("LoginCtrl",["$scope","$stateParams","$http","$location",function(a,d,c,e){function b(a,b){var c=arguments.callee;c.doing||(alert(a,b),c.doing=!0,setTimeout(function(){c.doing=!1},3E3))}a.Email=$("#name").val();a.loginSubmitFlag=!1;a.loginInputChange=function(b,c){a.loginSubmitFlag=b&&c?!0:!1};a.login=function(){a.ValiaCodeFlag=!0;a.EmailFlag=!0;if(0==$("#name").val().length||0==$("#password").val().length)a.loginSubmitFlag=!1;a.loginSubmitFlag&&($("#Submit_Button").text("\u8bf7\u7a0d\u7b49\u2026\u2026"),loadingStart(),c.post("/Home/ValidateUser",{email:$("#name").val(),password:$("#password").val(),isCheck:isCheck}).success(function(a){a.Islogin?location.href=a.Url:($("#Submit_Button").text("\u767b\u5f55"),b(a.Message,"red"));loadingEnd()}).error(function(a,b,c,d){$("#Submit_Button").text("\u767b\u5f55");loadingEnd()}))};a.Enter=function(){13==window.event.keyCode&&a.login()}}]);function turnToIndex(){window.location.href="/Home/index"}function changeCheck(){isCheck=0==isCheck?1:0}function ChangeToLogin(){$("#Login").show();$("#Register").hide()}function ChangeToRegister(){$("#Register").show();$("#Login").hide();$("#REmail").val("");$("#RPassWord").val("");$("#RName").val("");$("#RInviteCode").val("")}function ChangeToForget(){$("#ForgetPassword").show();$("#Login").hide();$("#ForgetEmail").val("");$("#ForgetValidCode").val("");$("#SendAgainDiv").hide()}function ForgetPW(){this.EmailFlag=this.ValiaCodeFlag=!0;this.SubmitFlag=!1;this.SendTime=60;this.IsSendAgainFlag=!1}zyApp.controller("FindPWCtrl",["$scope","$stateParams","$http","$location",function(a,d,c,e){a.ForgetPW=new ForgetPW;a.ForgetPW.SubmitFlag=!1;a.reloadimg=function(a){$("#"+a).attr("src","/Home/GetCode?"+new Date)};a.findPwInfoChange=function(b,c){a.ForgetPW.SubmitFlag=b&&c?!0:!1;a.ForgetPW.ValiaCodeFlag=!0;a.ForgetPW.EmailFlag=!0};a.findPassword=function(){a.ForgetPW.ValiaCodeFlag=!0;a.ForgetPW.EmailFlag=!0;if(0==$("#ForgetEmail").val().length||0==$("#ForgetValidCode").val().length)a.ForgetPW.SubmitFlag=!1;a.ForgetPW.SubmitFlag&&(loadingStart(),c.post("/UM/ForgetPassword",{email:a.ForgetPW.Email,validCode:a.ForgetPW.VaildCode}).success(function(b){0<=b.indexOf("\u9a8c\u8bc1\u7801\u4e0d\u6b63\u786e\u3002")?(a.ForgetPW.ValiaCodeFlag=!1,a.ForgetPW.IsSendAgainFlag=!1,a.InputFieldArea=!0):0<=b.indexOf("\u7528\u6237\u540d\u4e0d\u5b58\u5728\u3002")?(a.ForgetPW.EmailFlag=!1,a.ForgetPW.IsSendAgainFlag=!1):($("#SendAgainDiv").show(),a.ForgetPW.IsSendAgainFlag=!0,$("#GmailSite").text(a.ForgetPW.Email));loadingEnd()}).error(function(a,c,d,f){loadingEnd()}))};a.enterOper=function(){13==window.event.keyCode&&a.findPassword()};a.sendAgain=function(b){0==a.ForgetPW.SendTime?($(b).removeAttr("disabled"),$(b).text("\u91cd\u65b0\u53d1\u9001"),a.ForgetPW.SendTime=60):(60==a.ForgetPW.SendTime&&(loadingStart(),c.post("/UM/SendEmailAgain",{email:a.ForgetPW.Email}).success(function(a){""!=a&&alert(a,"red");loadingEnd()}).error(function(a,b,c,d){loadingEnd()})),$(b).attr("disabled",!0),$(b).text(a.ForgetPW.SendTime+"\u79d2\u540e\u53ef\u4ee5\u91cd\u65b0\u53d1\u9001"),a.ForgetPW.SendTime--,setTimeout(function(){a.sendAgain(b)},1E3))};a.forgetToLogin=function(){$("#ForgetPassword").hide();$("#Login").show();$("#name").val("");$("#password").val("")}}]);zyApp.controller("RegisterCtrl",["$scope","$stateParams","$http","$location",function(a,d,c,e){a.enter=function(){13==window.event.keyCode&&this.Register()};a.Register=function(){0==$("#REmail").val().length?a.RegisterBtnFlag=!1:a.RegisterBtnFlag=!0;0==$("#RPassWord").val().length?a.RegisterBtnFlag=!1:a.RegisterBtnFlag=!0;0==$("#RInviteCode").val().length?a.RegisterBtnFlag=!1:a.RegisterBtnFlag=!0;a.RegisterBtnFlag&&(loadingStart(),$("#RegisterBtn").text("\u8bf7\u7a0d\u540e..."),c.post("/Home/RegisteredUser",{email:a.Reg.Email,name:a.Reg.Name,password:a.Reg.PassWord,inviteCode:$("#RInviteCode").val()}).success(function(b){$("#RegisterBtn").text("\u6ce8 \u518c");b.IsCodeError?a.Reg.CheckInviteCodeFlag=!0:"\u6ce8\u518c\u6210\u529f\uff01"==b.Message?c.post("/Home/ValidateUser",{email:$("#REmail").val(),password:$("#RPassWord").val(),isCheck:2}).success(function(a){location.href=a.Url}).error(function(a,b,c,d){loadingEnd();RestLogin(a)}):(alert(b.Message,"red"),a.Reg.CheckInviteCodeFlag=!1);loadingEnd()}).error(function(a,c,d,e){$("#RegisterBtn").text("\u6ce8 \u518c");loadingEnd();RestLogin(a)}))};a.registerInputChange=function(b,c){a.RegisterBtnFlag=b&&c?!0:!1;a.Reg.CheckInviteCodeFlag=!1};a.ChangeToLogin=function(){$("#Login").show();$("#Register").hide()}}]);function SetPw(){this.SetSubmitFlag=this.IsSameFlag=!1}zyApp.controller("SetPwCtrl",["$scope","$stateParams","$http","$location",function(a,d,c,e){a.SetPw=new SetPw;a.setPassword=function(){a.SetPw.SetSubmitFlag&&(loadingStart(),c.post("/UM/SetPassword",{email:$("#Email").val(),password:a.SetPw.Password}).success(function(b){a.SetPw.Password="";a.SetPw.ConfirmPassword="";a.SetPwForm.$setPristine();""!=b.Message&&(alert(b.Message,"green"),setTimeout(function(){window.location.href="/Home/SignIn"},2500));loadingEnd()}).error(function(a,c,d,e){loadingEnd()}))};a.ValidPwdConsistency=function(b,c){b&&c?a.SetPw.Password!=a.SetPw.ConfirmPassword?(a.SetPw.SomeFlag=!0,a.SetPw.SetSubmitFlag=!1):(a.SetPw.SomeFlag=!1,a.SetPw.SetSubmitFlag=!0):a.SetPw.SetSubmitFlag=!1}}]);