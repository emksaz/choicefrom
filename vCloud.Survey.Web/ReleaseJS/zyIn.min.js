function loadingStart(){$("#LoadingDiv").show();$(".main-wrapper").prepend('\x3cdiv class\x3d"background_opacity"  \x3e\x3c/div\x3e')}function loadingEnd(){$("#LoadingDiv").hide();$(".background_opacity").remove()}function QDloadingStart(){$(".design_group_block").prepend('\x3cdiv class\x3d"wiat_for_assets_load" data-ix\x3d"wait-for-assets-load"\x3e\x3c/div\x3e');$("#QDLoad").append('\x3cdiv class\x3d"loading"\x3e\x3cimg src\x3d"/images/loading2_1.gif" alt\x3d"54beb0156df32c81653dc36f_loading2.gif" data-ix\x3d"loading-pictures"\x3e\x3c/div\x3e')}function QDloadingEnd(){$(".loading").remove();$(".wiat_for_assets_load").remove()}$.extend({loaddingShow:function(a){$.extend({},a);a='\x3cdiv id\x3d"lodingDIV" class\x3d"tips_bg alert_bg_show"\x3e\x3cdiv id\x3d"loading"\x3e\x3c/div\x3e\x3c/div\x3e';$("body").append(a)},loaddingHide:function(){$("#lodingDIV").remove()}});$(function(){FastClick.attach(document.body)});function isTouchDevice(){var a=!1,e=!1,b=navigator.platform,a=0<=b.indexOf("Win"),e=0<=b.indexOf("Mac");"X11"==b||b.indexOf("Linux");if(a||e){document.removeEventListener("touchend",touchendFunc,!1);try{document.createEvent("TouchEvent"),click_bt(".dropdown-bt","ul.downul"),console.log("pc\u53ef\u89e6\u6478")}catch(c){console.log("pc\u4e0d\u53ef\u89e6\u6478"),pchover("div.dropdown-event","ul.downul"),clickempty("dropdown-bt","ul.downul")}}else document.addEventListener("touchend",touchendFunc,!1),click_bt(".dropdown-bt","ul.downul")}$(function(){isTouchDevice()});function pchover(a,e){$(e).css("visibility","hidden");$(e).children().css({visibility:"hidden",display:"none",height:""});$(a).unbind("mouseenter").unbind("mouseleave");$(a).hover(function(){$(e,this).css("visibility","visible");$(e,this).children().css({visibility:"visible",display:"",height:""});$(e,this).stop(!0).fadeTo(200,1)},function(){$(e,this).css("visibility","hidden");$(e,this).children().css({visibility:"hidden",display:"none",height:"0px"});$(e,this).stop(!0).fadeTo("fast",0)})}var Pe_selectindex;function click_bt(a,e){$(a).unbind("click");$(a).click(function(){Pe_selectindex=$(a).index(this);console.log("Pe_selectindex\x3d"+Pe_selectindex);$(e).slice(0,Pe_selectindex).css("visibility","hidden");$(e).slice(Pe_selectindex+1).css("visibility","hidden");"hidden"==$(e).eq(Pe_selectindex).css("visibility")?open_option(e,Pe_selectindex):close_option(e,Pe_selectindex)})}function touchendFunc(){try{clickempty("dropdown-bt","ul.downul")}catch(a){console.log("touchMoveFunc\uff1a"+a.message)}}$(function(){clickempty("dropdown-bt","ul.downul");which_browser()});function clickempty(a,e){$(document).click(function(b){var c=$(b.target).parents().map(function(){return this.className}).get().join(", ");b=$(b.target).map(function(){return this.className}).get().join(", ");0>=c.indexOf(a)&&0>=b.indexOf(a)&&closeAll(e)})}function open_option(a,e){$(a).eq(e).css("visibility","visible");$(a).eq(e).fadeTo("fast",1);$(a).eq(e).children().css({visibility:"visible",display:"",height:""})}function close_option(a,e){$(a).eq(e).css("visibility","hidden");$(a).eq(e).fadeTo("fast",0);$(a).eq(e).children().css({visibility:"hidden",display:"none",height:"0px"})}function closeAll(a){$(a).children().css({visibility:"hidden",display:"none"});$(a).css("visibility","hidden")}var click_mun=1;$(function(){menuButton()});function menuButton(){$("a.menu-button").click(function(){click_mun++;0==click_mun%2?($(".menu").css("visibility","visible"),$(".menu").fadeTo("fast",1)):($(".menu").css("visibility","hidden"),$(".menu").fadeTo("fast",0))})}$(window).bind("resize",resizeWindow);function resizeWindow(){991<window.innerWidth?(click_mun=1,"hidden"==$(".menu").css("visibility")&&($(".menu").css("visibility","visible"),$(".menu").fadeTo("fast",1))):"visible"==$(".menu").css("visibility")&&1==click_mun&&($(".menu").css("visibility","hidden"),$(".menu").fadeTo("fast",0))}var system_event={animation_remove:function(){$("body").addClass("RemoveBgAnimation")}};function which_browser(){var a=navigator.userAgent.toLowerCase(),e=navigator.appName,b=parseFloat(navigator.appVersion);(0<a.indexOf("msie")||("Netscape"==e||"Microsoft Internet Explorer"==e)&&4>=b)&&system_event.animation_remove()}(function(a){a.fn.extend({InitUpload:function(e){_options=e;var b;b="\x3cdiv class\x3d'panelext'\x3e\x3cdiv class\x3d'closebtnext'\x3e";b+="\x3cdiv onclick\x3d'$(\"this\").CloseUpload()'\x3e\x3c/div\x3e";b+="\x3c/div\x3e";b+="\x3cdiv\x3e";b+="\x3cdiv class\x3d'uploadpaneel'\x3e";b+="\x3cdiv id\x3d'i_select_files'\x3e";b+="\x3c/div\x3e";b+="\x3cdiv id\x3d'i_stream_files_queue'\x3e";b+="\x3c/div\x3e";b+="\x3cbutton class\x3d'custombtn' onclick\x3d'javascript:_t.upload();'\x3e\u5f00\u59cb\u4e0a\u4f20\x3c/button\x3e\x3cbutton onclick\x3d'javascript:_t.cancel();' class\x3d'custombtn'\x3e\u53d6\u6d88\x3c/button\x3e";b+="\x3cdiv id\x3d'i_stream_message_container' class\x3d'stream-main-upload-box none' style\x3d'overflow: auto;height:200px;'\x3e";b+="\x3c/div\x3e";b+="\x3c/div\x3e";b+="\x3c/div\x3e";b+="\x3c/div\x3e";a(".panelext").remove();a("#uploadDiv").append(b);a(".btnUpload").click(function(){_IsComplated?(_input=a(".custom_btn").index(a(this).parent()),a("#btn_Upload").click()):alert(Prompt.UploadPrompt,"green")});_IsComplated=!0;var c={parentfolder:"\\",childfolder:"\\",width:"72",height:"72",iscrop:!1,CompanyID:"",QuesID:"",UType:"",LoadingName:"",Scope:null,Http:null,browseFileId:"i_select_files",browseFileBtn:"\x3cdiv\x3e\u4e0a\u4f20\u56fe\u7247\x3c/div\x3e",dragAndDropArea:"i_select_files",dragAndDropTips:"\x3cspan\x3e\x3c/span\x3e",filesQueueId:"i_stream_files_queue",filesQueueHeight:200,messagerId:"i_stream_message_container",multipleFiles:!1,autoUploading:!0,autoRemoveCompleted:!0,maxSize:2097152,swfURL:"swf/FlashUploader.swf",tokenURL:"/UploadRoot/UploadFile.aspx?action\x3dgettoken",frmUploadURL:"/UploadRoot/upload.php?action\x3dfd;",uploadURL:"/UploadRoot/UploadFile.aspx?action\x3dupext",extFilters:[".jpg",".gif",".png",".jpeg",".bmp"],onSelect:function(a){try{isselectfile="1"}catch(b){}_IsComplated=!1},onMaxSizeExceed:function(a,b,c){alert("\u6587\u4ef6\u8d85\u8fc7\u6700\u5927\u4e0a\u9650\u3002");_IsComplated=!0},onExtNameMismatch:function(a,b){alert("\u9009\u62e9\u7684\u6587\u4ef6\u7c7b\u578b\u4e0d\u6b63\u786e\u3002");_IsComplated=!0},onComplete:function(a){_IsComplated=!0;c.iscrop&&("2"==c.UType&&(c.Scope.UUserInfo.FileName=a.token),c.Http.post("/Upload/CropBitmap",{fileName:a.token,uplaodPath:c.parentfolder,companyID:c.CompanyID,uType:c.UType,quesID:c.QuesID}).success(function(a){a.IsSuccess&&("1"==c.UType&&(c.Scope.QSummary.SummaryQFacePpicture=a.FileUrl,c.Scope.QSummary.FileSize=a.FileSize+"MB",c.Scope.QSummary.FileName=a.FileName),"2"==c.UType&&(c.Scope.UUserInfo.Portrait=a.FileUrl))}))},onUploadProgress:function(b){"2"==c.UType?a("#RadioProgressBar").data("radialIndicator").value(b):a("#"+c.LoadingName).css({width:b+"%"})}},c=a.extend(c,e);return new Stream(c)}})})(jQuery);function SubStringThree(a){return 20<a.length?a.substring(0,20)+"...":a}function isDigit(a){return/^[0-9]+.?[0-9]*$/.test(a)?!0:!1}function isInteger(a){return/^[1-9]+[0-9]*]*$/.test(a)?!0:!1}function CheckInteger(a){return/^[-]?\d+$/.test(a)?!0:!1}function ErrAlert(a,e){var b=a.responseText;-1<b.indexOf("\u767b\u5f55")||-1<b.indexOf("SignIn")?window.open("/home/SignIn","_top"):alert(e)}function CloseDiv(){$("body").removeClass("srcollHide");$("#PopupsBg").remove()}function loginAgain(){$("#LoginBtn").text("\u8bf7\u7a0d\u7b49\u2026\u2026");$.ajax({type:"POST",url:"/Home/ValidateUser",data:{email:tmptestemailvalue,password:tmptestpasswordvalue,isCheck:2},dataType:"json",error:function(a){$("#LoginBtn").text("\u767b\u5f55");ErrAlert(a,"\u83b7\u53d6\u5217\u8868\u5931\u8d25!")},success:function(a){a.Islogin?(CloseDiv(),RestLogin.isTurnTo||RestLoginForDesign.isTurnTo?window.location.reload():scopeObj.Init()):($("#LoginBtn").text("\u767b\u5f55"),alert(a.Message,"red"))}})}function ShowPopup(a){a.stopPropagation()}function Enter(){13==window.event.keyCode&&loginAgain()}var tmptestemailvalue="",tmptestpasswordvalue="",scopeObj;RestLogin.isTurnTo=!1;function RestLogin(a,e){null==e&&(RestLogin.isTurnTo=!0);scopeObj=e;if("string"==typeof a){var b="";(-1<a.indexOf("\u767b\u5f55\u8d85\u65f6\u3002")||-1<a.indexOf("\u8fd0\u884c\u65f6\u9519\u8bef")||-1<a.indexOf("SignIn"))&&!$("#PopupsBg").html()&&(b+='\x3cdiv class\x3d"pop-ups-background" style\x3d"z-index:9000" id\x3d\'PopupsBg\'\x3e    \x3cdiv class\x3d"pop-ups" id\x3d"login_again"\x3e',b+="        \x3cdiv\x3e",b+='            \x3ci class\x3d"ic ic-user-f"\x3e\x3c/i\x3e',b+="            \x3cspan\x3e\u91cd\u65b0\u767b\u5f55\x3c/span\x3e",b+="        \x3c/div\x3e",b+="        \x3cform autocomplete\x3d'off'\x3e",b+='            \x3ch3\x3e\x3cmark class\x3d"form-message"\x3e\u767b\u5f55\u8d85\u65f6,\u8bf7\u91cd\u65b0\u767b\u5f55!\x3c/mark\x3e\x3c/h3\x3e',b+="            \x3cinput type\x3d\"text\" name\x3d\"LoginAgainEmail\" id \x3d'LoginAgainEmail' placeholder\x3d\"\u6ce8\u518c\u90ae\u7bb1\" onchange\x3d \"GetInputValue(this,'1')\" onkeyup\x3d'Enter()' maxlength\x3d'50' style\x3d'margin-bottom: 20px;'\x3e",b+='            \x3cinput type\x3d"password" style\x3d"display:none" /\x3e',b+="            \x3cinput type\x3d\"password\" name\x3d\"LoginAgainPassword\" id\x3d'LoginAgainPassword' placeholder\x3d\"\u5bc6\u7801\" onchange\x3d \"GetInputValue(this,'2')\" onkeyup\x3d'Enter()' maxlength \x3d '12'\x3e",b+='            \x3cbutton class\x3d"green" type \x3d \'button\' onclick\x3d"loginAgain()"\x3e',b+='                \x3cspan id\x3d"LoginBtn"\x3e\u91cd\u65b0\u767b\u5f55\x3c/span\x3e',b+="            \x3c/button\x3e",b+="        \x3c/form\x3e",b+="    \x3c/div\x3e",b+="\x3c/div\x3e",$("body").append(b),$("body").addClass("srcollHide"),tmptestpasswordvalue=tmptestemailvalue="")}}function GetInputValue(a,e){"1"==e&&(tmptestemailvalue=a.value);"2"==e&&(tmptestpasswordvalue=a.value)}RestLoginForDesign.isTurnTo=!1;function RestLoginForDesign(a,e){null==e&&(RestLoginForDesign.isTurnTo=!0);scopeObj=e;var b="",c="";if(a.responseText||a)c=a.responseText||a,(-1<c.indexOf("\u767b\u5f55\u8d85\u65f6\u3002")||-1<c.indexOf("\u8fd0\u884c\u65f6\u9519\u8bef")||-1<c.indexOf("SignIn"))&&!$("#PopupsBg").html()&&(b+='\x3cdiv class\x3d"popup-background" style\x3d"z-index: 1000;" ng-show\x3d"1\x3d\x3d1"  id\x3d\'PopupsBg\'\x3e\x3cdiv class\x3d"center"\x3e',b+='    \x3cdiv class\x3d"popup-windows absolute-center folder" ng-show\x3d"1\x3d\x3d1" id\x3d"login_again"\x3e',b+='        \x3cdiv class\x3d"w-clearfix popup-header"\x3e',b+='           \x3cdiv class\x3d"ic ic-user-f float-left margin-right-5px"\x3e\x3c/div\x3e',b+='           \x3ch5 class\x3d"popup-title" id\x3d"myModalLabel"\x3e\u91cd\u65b0\u767b\u5f55\x3c/h5\x3e',b+="      \x3c/div\x3e",b+="        \x3cform autocomplete\x3d'off'\x3e",b+='            \x3ch3\x3e\x3cmark class\x3d"form-message"\x3e\u767b\u5f55\u8d85\u65f6,\u8bf7\u91cd\u65b0\u767b\u5f55!\x3c/mark\x3e\x3c/h3\x3e',b+='            \x3cinput type\x3d"password" style\x3d"display:none" /\x3e',b+="            \x3cinput type\x3d\"text\" name\x3d\"LoginAgainEmail\" id \x3d'LoginAgainEmail' placeholder\x3d\"\u6ce8\u518c\u90ae\u7bb1\" onchange\x3d \"GetInputValue(this,'1')\" onkeyup\x3d'Enter()' maxlength\x3d'50' style\x3d'margin-bottom: 20px;'\x3e",b+="            \x3cinput type\x3d\"password\" name\x3d\"LoginAgainPassword\" id\x3d'LoginAgainPassword' placeholder\x3d\"\u5bc6\u7801\" onchange\x3d \"GetInputValue(this,'2')\" onkeyup\x3d'Enter()' maxlength \x3d '12'\x3e",b+='            \x3cbutton class\x3d"green" type \x3d \'button\' onclick\x3d"loginAgain()"\x3e',b+='                \x3cspan id\x3d"LoginBtn"\x3e\u91cd\u65b0\u767b\u5f55\x3c/span\x3e',b+="            \x3c/button\x3e",b+="        \x3c/form\x3e",b+="   \x3c/div\x3e",b+=" \x3c/div\x3e",b+="\x3c/div\x3e",b+=" \x3c/div\x3e",$("body").append(b),$("body").addClass("srcollHide"),tmptestpasswordvalue=tmptestemailvalue="")}function checkSessionLost(){$.ajax({type:"post",url:"/Home/CheckSessionLost",data:{},dataType:"json",error:function(a){},success:function(a){a.IsSessionLost&&(0<=window.location.href.indexOf("/QD/QuestionnairDesign")?RestLoginForDesign(a.Message,null):RestLogin(a.Message,null),clearInterval(sessionInterval))}})}var sessionInterval;$(function(){sessionInterval=setInterval(checkSessionLost,36E5)});function isZip(a){return/^[0-9]{6}$/.test(a)?!0:(alert("\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u90ae\u7f16\uff01"),!1)}function isPhone(a){return/((\d{11})|^((\d{7,8})|(\d{4}|\d{3})-(\d{7,8})|(\d{4}|\d{3})-(\d{7,8})-(\d{4}|\d{3}|\d{2}|\d{1})|(\d{7,8})-(\d{4}|\d{3}|\d{2}|\d{1}))$)/.test(a)?!0:(alert("\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u7535\u8bdd\u53f7\u7801\uff01"),!1)}function isCord(a){return/\d{18}|\d{15} /.test(a)?!0:(alert("\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u8eab\u4efd\u8bc1\u7801\uff01"),!1)}function isMobel(a){return 11!=a.length?(alert("\u624b\u673a\u53f7\u7801\u4f4d\u6570\u4e0d\u6b63\u786e\uff01"),!1):/^(((13[0-9]{1})|15[0-9]{1}|18[0-9]{1}|)+\d{8})$/.test(a)?!0:(alert("\u624b\u673a\u53f7\u7801\u683c\u5f0f\u4e0d\u6b63\u786e\uff01"),!1)}function checkemail(a){return""==a?(alert("\u8bf7\u8f93\u5165\u90ae\u7bb1\u5730\u5740\uff01"),!1):/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i.test(a)?!0:(alert("\u63d0\u793a\n\n\u8bf7\u8f93\u5165\u6709\u6548\u7684E_mail\uff01"),!1)}function notifyTextLength(a,e){a.value.replace(/[^\x00-\xff]/g,"**").length>e&&(a.value=autoAddEllipsis(a.value,e))}function autoAddEllipsis(a,e){return cutString(a,e).cutstring}function cutString(a,e){var b=a.length,c,k="1",h=0,l=!1;b<=e/2&&(c=a,l=!0);if(!l)for(var g=0;g<b;g++)if(h=isFull(a.charAt(g))?h+2:h+1,h>e){c=a.substring(0,g);l=!0;break}else if(h==e){c=a.substring(0,g+1);l=!0;break}l||(c=a);c.length==b&&(k="0");return{cutstring:c,cutflag:k}}function isFull(a){return 128<a.charCodeAt(0)?!0:!1}function daysBetween(a,e){var b=a.substring(5,a.lastIndexOf("-")),c=a.substring(a.length,a.lastIndexOf("-")+1),k=a.substring(0,a.indexOf("-")),h=e.substring(5,e.lastIndexOf("-")),l=e.substring(e.length,e.lastIndexOf("-")+1),g=e.substring(0,e.indexOf("-")),b=(Date.parse(b+"/"+c+"/"+k)-Date.parse(h+"/"+l+"/"+g))/864E5;return Math.abs(b)}function StringToDate(a){var e=Date.parse(a),e=new Date(e);isNaN(e)&&(a=a.split("-"),e=new Date(a[0],--a[1],a[2]));return e}function ChangeDateToString(a){var e=0,b=0,c=0,e="",e=a.getFullYear(),b=a.getMonth()+1,c=a.getDate(),e=e+"-",e=10<=b?e+b+"-":e+"0"+b+"-";return 10<=c?e+c:e+"0"+c}function GoHtmlTop(){document.documentElement.scrollTop=document.body.scrollTop=0}var zyApp=angular.module("myapp",["ui.router"]);zyApp.factory("QuesEidtData",["$http",function(a){return{QuesInfoData:{},SaveMethodsArgs:{},SavePublishSetArgs:{}}}]).factory("SelectModule",function(){return{ModuleStateFlag:0,SaveMethods:function(){}}}).factory("UserInfo",function(){return{InfoData:{},SaveUserInfoArgs:{},SavePwdArgs:{}}}).factory("publishManager",function(){return new function(){this.Reset=function(){this.CollectorID="";this.preview=this.PublishPageFlag=this.PublishPageFlagBtn=!1;this.QuesID="";this.DisableAll=!1;this.publishDisable=this.publishFlag=!0;this.downFlag=this.cancelFlag=!1;this.downLock=this.cancelLock=!0;this.otherFlag1;this.otherFlag2;this.otherFlag2=this.otherFlag1=this.SaveSetFlag=!0;this.onLineFlag=this.otherFlag5=this.otherFlag4=this.otherFlag3=!1;this.publishCountFlag=this.publishDisable=!0;this.publishCount=100;this.QuotaName="\u8bf7\u9009\u62e9\u914d\u989d";this.InitQuotaName="\u53d6\u6d88\u914d\u989d";this.CancelQuotaFlag=this.QuotaExits=!1;this.QuotaID="";this.quotaStyle=this.QuotaFlag=!1;this.PublishDays=30;this.NoTimeLimit=!1;this.planTime="";this.ReleaseType="1";this.planHourFlag=!0;this.planHour=(new Date).getHours()+1;this.planHourName=(new Date).getHours()+1+"\u65f6";this.planHourStyle=!1;this.TerLimitReply="Y";this.parameterFlag=this.microLetterChannel="N";this.parameterCheck=!1;this.WeChatAppSecret=this.WeChatNameId=this.WeChatNameAppID=this.WeChatName="";this.WeChatBtnFlag=this.collectionEnable=!1;this.redirect_uri=this.logoImg="";this.daysLock=this.WeichatOauthFlag=!1;this.quotaChangeStyle={visibility:"hidden"};this.designErrorStyle={color:"green"}};this.publishNumChange=function(a){if(!this.DisableAll&&this.publishCountFlag){if(""==this.publishCount||isNaN(this.publishCount))this.publishCount=0;""!=this.publishCount&&!isNaN(this.publishCount)||-1!=a||(this.publishCount=2);a=parseInt(a)+parseInt(this.publishCount);if(1>a||99999999<a)a=this.publishCount;this.publishCount=a;this.QuotaID="";this.QuotaName="\u8bf7\u9009\u62e9\u914d\u989d";this.SaveSetFlag=!0}};this.publishNumChangeForOnChange=function(a){!this.DisableAll&&this.publishCountFlag&&(this.publishCount=a,this.QuotaID="",this.QuotaName="\u8bf7\u9009\u62e9\u914d\u989d",this.SaveSetFlag=!0)};this.quotaStyleChange=function(){this.quotaChangeStyle={visibility:"visible"}};this.quotaChange=function(a){""==a?(this.QuotaName="\u8bf7\u9009\u62e9\u914d\u989d",this.QuotaID="",this.publishCountFlag=!0,this.publishCount=100,this.SaveSetFlag=!0,this.CancelQuotaFlag=this.QuotaFlag=!1):(a.QuotaTableID!=this.QuotaID&&(this.QuotaName=a.QuotaTableName,this.QuotaID=a.QuotaTableID,this.publishCount=a.QuotaNum,this.SaveSetFlag=!0),this.CancelQuotaFlag=!0,this.publishCountFlag=!1,this.QuotaFlag=!0)};this.PublishDaysChange=function(a){if(!this.DisableAll&&!this.NoTimeLimit){""==this.PublishDays&&(this.PublishDays=0);""==this.PublishDays&&-1==a&&(this.PublishDays=2);a=parseInt(a)+parseInt(this.PublishDays);if(1>a||999<a)a=this.PublishDays;this.PublishDays=a;this.NoTimeLimitFlag=!1;this.SaveSetFlag=!0}};this.PublishDaysChangeForOnChange=function(a){this.DisableAll||this.NoTimeLimit||(this.PublishDays=a,this.NoTimeLimitFlag=!1,this.SaveSetFlag=!0)};this.NoTimeLimitSelect=function(){(this.NoTimeLimit=!this.NoTimeLimit)?(this.PublishDays=1E3,this.daysLock=!0):(this.PublishDays=30,this.daysLock=!1);this.SaveSetFlag=!0};this.ReleaseSelect=function(a){if("1"==a)this.ReleaseType=a,$("#PlanTime").val(""),this.planHourFlag=!0;else if(this.ReleaseType=a,this.otherFlag2){this.planHourFlag=!1;var e=new Date;a=e.getFullYear();var b=1==(e.getMonth()+1).toString().length?"0"+(e.getMonth()+1):e.getMonth()+1,c=1==e.getDate().toString().length?"0"+e.getDate():e.getDate(),k=1==e.getHours().toString().length?"0"+e.getHours():e.getHours(),e=1==e.getMinutes().toString().length?"0"+e.getMinutes():e.getMinutes();a=a+"/"+b+"/"+c+" "+k+":"+e;$("#PlanTime").val(a)}this.SaveSetFlag=!0};this.planHourStyleChange=function(){this.DisableAll||(this.planHourStyle=!this.planHourStyle)};this.planHourChange=function(){this.SaveSetFlag=!0};this.TerLimitSelect=function(a){this.TerLimitReply="Y"==a?"Y":"N";this.SaveSetFlag=!0};this.toggleCollectionEnable=function(){this.microLetterChannel=(this.collectionEnable=!this.collectionEnable)?"Y":"N";this.SaveSetFlag=!0};this.parameterSelect=function(){this.parameterFlag=(this.parameterCheck=!this.parameterCheck)?"Y":"N";this.SaveSetFlag=!0};this.QuesSetWebChatBtnChange=function(a,e){a&&e?this.SaveSetFlag=this.WeChatBtnFlag=!0:this.WeChatBtnFlag=!1};this.Reset()}}).factory("UserPageText",function(){return new function(){this.InitPageText=function(){this.Summary_QTileMaximum=pagePromptText.Summary_QTileMaximum;this.Summary_QDescribeMaximum=pagePromptText.Summary_QDescribeMaximum;this.Summary_QFacePpicture=pagePromptText.Summary_QFacePpicture;this.Summary_QCommitment=pagePromptText.Summary_QCommitment;this.Publish_publishCount=pagePromptText.Publish_publishCount;this.Publish_publishDays=pagePromptText.Publish_publishDays;this.Publish_publishTime=pagePromptText.Publish_publishTime;this.Publish_publishIntervieweeInfo=pagePromptText.Publish_publishIntervieweeInfo;this.Publish_publishWeiXinInfo=pagePromptText.Publish_publishWeiXinInfo;this.Publish_publishAppInfo=pagePromptText.Publish_publishAppInfo;this.Publish_publishValidateSave=pagePromptText.Publish_publishValidateSave;this.Publish_publishOauthConfig=pagePromptText.Publish_publishOauthConfig;this.Publish_publishImmediatelyVerify=pagePromptText.Publish_publishImmediatelyVerify;this.Quota_PromptMessage=pagePromptText.Quota_PromptMessage;this.UserInfo_UserPicForm=pagePromptText.UserInfo_UserPicForm;this.UserInfo_UserPicSize=pagePromptText.UserInfo_UserPicSize;this.UserInfo_UserName=pagePromptText.UserInfo_UserName;this.UserInfo_Email=pagePromptText.UserInfo_Email;this.Password_CurrentPwd=pagePromptText.Password_CurrentPwd;this.Password_NewPwd=pagePromptText.Password_NewPwd;this.Password_NewPwdAgain=pagePromptText.Password_NewPwdAgain;this.LoginAndRegister_Register=pagePromptText.LoginAndRegister_Register}}}).factory("Unify",["$http",function(a){return new function(){this.QuesChange=function(e){a.post("/QM/GetQuestionInfoByQuesID",{quesID:e}).success(function(a){document.getElementById("quesTile").innerText=a.QTitle;5==a.QStatus?$("#delQuesaIcon").css("display","none"):$("#delQuesaIcon").css("display","inline-block");a.PreViewFlag?$("#preView").css("display","inline-block"):$("#preView").css("display","none");$("#quesIconDIV").css("display","block")})};this.QuesPreview=function(e,b,c){$(e).text("").attr("href","");$(b).attr("src","");a.post("/QM/DownLoadQRCode",{quesID:c,linkSuffix:c,redirect_uri:""}).success(function(a){a.returnError?alert(a.Message,"red"):($(e).text(a.QRlink).attr("href",a.QRlink),$(b).attr("src",a.StrPath))}).error(function(a,b,c,g){})}}}]).factory("DataOutputInfo",["$http",function(a){return new function(){this.dataOutputList}}]).factory("QuesQuotaInfo",function(){return new function(){this.QuesQuotaReset=function(){this.SourceNodes=null;this.Row1Nodes=[];this.Row2Nodes=[];this.CellNodes=[];this.CelName=this.Row2Name=this.Row1Name=this.QuotaTableID=this.StrCelNodes=this.StrRow2Nodes=this.StrRow1Nodes="";this.SelectGroup=null;this.SelectChangeName="";this.SelectChangeType=0;this.ShowRow2=this.ShowTable=this.ShowCel=this.ShowRow=!1;this.Popupbackground=0;this.ShowCreateTableBtn=!1;this.RowGroup=[];this.CelGroup=[];this.RowGroupNum=0;this.TableData=this.HtmlMinSize=this.TableInfoHtml="";this.ShowSet="\u9690\u85cf\u8bbe\u7f6e";this.IsShowSidebar=!0;this.GridWidth={width:"75%"}};this.QuesQuotaReset()}}).factory("QQuesSet",function(){return new function(){this.QQuesSetReset=function(){this.QuesSetSelectFID=this.QuesSetInitFolder=this.QuesSetFolderList=this.QMSetAction="";this.QuesBtnFlag=0;this.DelPassWord=this.QuesSetFolderSelect="";this.QuesSetBackIndex=!1};this.QQuesSetReset()}}).factory("UserImageURL",function(){return new function(){this.ImgUrl}});zyApp.directive("top",function(){return{restrict:"E",templateUrl:"/Content/template/Top.html",replace:!0,controller:"TopController"}});zyApp.directive("pwCheck",[function(){return{require:"ngModel",link:function(a,e,b,c){var k="#"+b.pwCheck;e.add(k).on("keyup",function(){a.$apply(function(){var a=e.val()===$(k).val();c.$setValidity("pwmatch",a)})})}}}]);zyApp.controller("TopController",["$scope","$stateParams","$http","UserInfo","$location","$timeout","UserImageURL",function(a,e,b,c,k,h,l){a.setLineStyle=function(){$("#Selectques").addClass("nav-current")};a.UserImageURL=l;a.IsDemo=$("#hiddendemotype").val();b.post("/UM/GetUserInfo",{}).success(function(b){a.UserImageURL.ImgUrl=b.Portrait});a.navOverLayFlag=!1;a.navOverLayClick=function(){a.navOverLayFlag=!a.navOverLayFlag};a.HrefClick=function(b){a.navOverLayFlag=!1;k.path(b)};isTouchDevice();menuButton();a.GoToUrl=function(a){""!=a&&k.path(a);closeAll("ul.downul")};a.SignOut=function(){b.post("/Home/SignOut",{}).success(function(a){window.location.href="/Home/Index"})};$(window).resize(function(){var b=document.body.clientWidth;h(function(){768<parseInt(b)+6&&(a.navOverLayFlag=!1)},10)})}]);zyApp.config(["$stateProvider","$urlRouterProvider",function(a,e){e.when("","/QM").when("/QMSet","/QMSet/Publish/").when("/QMSet/AnalyzeResults/:qid","/QMSet/AnalyzeResults/:qid/DataTrends").when("/UC","/UC/User_info").otherwise("/QM");a.state("QM",{url:"/QM",templateUrl:"/Content/template/QM/QuestionnairList.html",controller:"QuestionnairList"}).state("I",{url:"/I/:inboxId/:idx",templateUrl:"/Content/template/QuestionnairSettings.html",controller:"QuestionnairSettingsInfo"}).state("QMCreate",{url:"/QMCreate/:fid",templateUrl:"/Content/template/QM/QuestionnaireCreate.html",controller:"QuesCreateCtrl"}).state("QMSet",{url:"/QMSet",templateUrl:"/Content/template/QM/QuestionnairSettings.html",controller:"QuesSettingsCtrl"}).state("QMSet.Preview",{url:"/Preview/:qid",templateUrl:"/Content/template/QM/Preview.html"}).state("QMSet.Quota",{url:"/Quota/:qid",templateUrl:"/Content/template/QM/Quota.html",controller:"QuotaCtrl"}).state("QMSet.Publish",{url:"/Publish/:qid",templateUrl:"/Content/template/QM/Publish.html",controller:"PublishManagerCtrl"}).state("QMSet.Publish1",{url:"/Publish1/:qid",templateUrl:"/Content/template/QM/Publish2.html",controller:PublishCtrl}).state("QMSet.AnalyzeResults",{url:"/AnalyzeResults/:qid",templateUrl:"/Content/template/QM/AnalyzeResults.html",controller:"AnalyzeResultsCtrl"}).state("QMSet.AnalyzeResults.DataTrends",{url:"/DataTrends",templateUrl:"/Content/template/QM/AnalyzeResults_DataTrends.html",controller:"DataTrendsCtrl"}).state("QMSet.AnalyzeResults.QuestionSummaries",{url:"/QuestionSummaries",templateUrl:"/Content/template/QM/AnalyzeResults_QuestionSummaries.html",controller:"QuestionSummariesCtrl"}).state("QMSet.Backups",{url:"/Backups/:qid",templateUrl:"/Content/template/QM/Backups.html"}).state("UC",{url:"/UC",templateUrl:"/Content/template/UC/Usercenter.html",controller:"UsercenterCtrl"}).state("UC.User_info",{url:"/User_info",templateUrl:"/Content/template/UC/User_info.html",controller:"User_infoCtrl"}).state("UC.Password",{url:"/Password",templateUrl:"/Content/template/UC/Password.html",controller:"PasswordCtrl"})}]);function DataTrends(){this.ProgressWidth="0";this.ProgressWidthStyle=null;this.TableHtml="";this.RowNum=this.CelNum=0;this.EndTime=this.StartTime=this.FirstReturnTime="";this.XLableList=[];this.XValueList=[];this.GridShow=!1}function ProgressWidthStyle(){this.width="0%"}function dataZoom(){this.realtime=this.show=!0;this.start=0;this.end=50}zyApp.controller("AnalyzeResultsCtrl",["$scope","$stateParams","$http","$location","QuesEidtData","$window","publishManager","Unify","DataOutputInfo",function(a,e,b,c,k,h,l,g,m){a.Unify=g;a.Unify.QuesChange(e.qid);k.QuesInfoData.qid=e.qid;a.DataOutputInfo=m;a.InitAnalyzeResultCss=function(){var f=window.location.href;0<=f.indexOf("/DataTrends")?(a.AnalyzeResultTabFlag=!0,a.IsShowDownLoad=!1,c.path("/QMSet/AnalyzeResults/"+k.QuesInfoData.qid+"/DataTrends")):0<=f.indexOf("/QuestionSummaries")&&(a.AnalyzeResultTabFlag=!1,a.IsShowDownLoad=!0,c.path("/QMSet/AnalyzeResults/"+k.QuesInfoData.qid+"/QuestionSummaries"))};a.InitAnalyzeResultCss();a.DownLoadAll=function(){confirm(Prompt.AnalyticResult_IsExportData,function(){loadingStart();b.post("/QM/CreateFile",{quesID:k.QuesInfoData.qid,dataViewname:"",dataviewID:""}).success(function(f){f.IsTrue?(loadingStart(),b.get("/QM/GetQuestionSummariesViewByDataOutputInfo",{params:{quesID:k.QuesInfoData.qid}}).success(function(d,f,b,c){d.IsTrue?a.DataOutputInfo.dataOutputList=d.DataOutputList:alert(d.Message,"red");loadingEnd()}).error(function(d,f,b,c){loadingEnd();RestLogin(d,a)})):alert(f.Message,"red");loadingEnd()}).error(function(f,d,n,b){loadingEnd();RestLogin(f,a)});a.$digest()},function(){},"\u662f","","\u5426")}}]);zyApp.controller("DataTrendsCtrl",["$scope","$stateParams","$http","$location","QuesEidtData","$timeout","Unify",function(a,e,b,c,k,h,l){GoHtmlTop();loadingStart();a.IsDemo=$("#hiddendemotype").val();var g=new DataTrends;a.DataTrends=g;a.DataTrends.ProgressWidthStyle=new ProgressWidthStyle;a.DataTrends.ProgressWidthStyle.width="0%";isTouchDevice();a.Init=function(){b.post("/QM/VerifyRight",{quesID:e.qid}).success(function(c){"NoRight"==c?location.href="/Error/Error?type\x3ddashboard":(a.Unify=l,a.Unify.QuesChange(e.qid),k.QuesInfoData.qid=e.qid,$("#divminshow").hide(),a.DataTrends.GridShow=!1,b.get("/QM/GetDataTrendsView",{params:{quesID:k.QuesInfoData.qid}}).success(function(f,d,n,b){a.DataTrends.ProgressWidth=f.ProgressWidth;a.DataTrends.ProgressWidthStyle=new ProgressWidthStyle;a.DataTrends.ProgressWidthStyle.width=f.ProgressWidth+"%";0==f.LableList.length?alert(Prompt.AnalyticResult_CurrentQuesNoData,"red"):(""!=f.TableHtml&&(a.DataTrends.GridShow=!0),a.DataTrends.TableHtml=f.TableHtml,a.DataTrends.RowNum=f.RowCount,a.DataTrends.CelNum=f.CelCount,a.DataTrends.LableList=f.LableList,a.DataTrends.ValueList=f.ValueList,0<f.TableHtml.length&&h(function(){a.ChangeTableSize($("#div-quota-grid").width())},500),a.ShowViewDate("7"));loadingEnd()}).error(function(f,d,n,b){loadingEnd();RestLogin(f,a)}))}).error(function(b,f,d,n){loadingEnd();RestLogin(b,a)})};a.Init();a.AnalyzeResultTabSelect=function(){c.path("/QMSet/AnalyzeResults/"+k.QuesInfoData.qid+"/QuestionSummaries")};a.ShowViewDate=function(b){if(0<a.DataTrends.LableList.length){var f=[],d=[];a.DataTrends.FirstReturnTime=a.DataTrends.LableList[0];a.DataTrends.EndTime=a.DataTrends.LableList[a.DataTrends.LableList.length-1];if(1<a.DataTrends.LableList.length)for(var n=daysBetween(ChangeDateToString(StringToDate(a.DataTrends.LableList[a.DataTrends.LableList.length-1])),ChangeDateToString(StringToDate(a.DataTrends.LableList[0])))+1,c=0;c<n;c++){var g=StringToDate(a.DataTrends.LableList[a.DataTrends.LableList.length-1]);g.setDate(g.getDate()-c);for(var g=ChangeDateToString(g),h=0,e=0;e<a.DataTrends.LableList.length;e++)a.DataTrends.LableList[e]==g&&(h=a.DataTrends.ValueList[e]);f.push(g);d.push(h)}else a.DataTrends.StartTime=a.DataTrends.EndTime,f.push(a.DataTrends.LableList[0]),d.push(a.DataTrends.ValueList[0]);a.DataTrends.XLableList=f.reverse();a.DataTrends.XValueList=d.reverse();"7"==b?7>=a.DataTrends.XLableList.length?a.DataTrends.dataZoom=null:(a.DataTrends.dataZoom=new dataZoom,a.DataTrends.dataZoom.end=700/a.DataTrends.XLableList.length):"30"==b?30>=a.DataTrends.XLableList.length?a.DataTrends.dataZoom=null:(a.DataTrends.dataZoom=new dataZoom,a.DataTrends.dataZoom.end=3E3/a.DataTrends.XLableList.length):"0"==b&&(a.DataTrends.dataZoom=null);a.DataTrends.StartTime=a.DataTrends.XLableList[0];a.BindChart()}};a.BindChart=function(){require.config({paths:{echarts:"/Script/Echarts"}});require(["echarts","echarts/chart/bar"],function(b){var f=b.init(document.getElementById("main"));option={title:{text:"\u95ee\u5377\u63d0\u4ea4\u6570\u91cf"},tooltip:{trigger:"axis"},legend:{selectedMode:!1,data:["\u63d0\u4ea4\u6570\u91cf"]},toolbox:{show:!0,feature:{saveAsImage:{show:!0}}},grid:{x:40,x2:0},dataZoom:a.DataTrends.dataZoom,calculable:!1,xAxis:[{type:"category",data:a.DataTrends.XLableList}],yAxis:[{type:"value"}],series:[{name:"\u63d0\u4ea4\u6570\u91cf",type:"bar",barMaxWidth:"50",data:a.DataTrends.XValueList,itemStyle:{normal:{color:"#97E6B8"}}}]};f.setOption(option);h(function(){window.onresize=function(){f.resize()}},200)})};$(window).resize(function(){h(function(){a.ChangeTableSize($("#div-quota-grid").width())},500)});a.ChangeTableSize=function(b){var f=$("#div_questionViewWidth").width();a.RestoreValue();600<=b&&800>b&&(a.DataTrends.HtmlMinSize=676,a.SetChangeTableSize(f,7));800<=b&&1110>b&&(a.DataTrends.HtmlMinSize=889,a.SetChangeTableSize(f,9));1110<=b&&a.SetChangeTableSize(f,12)};a.RestoreValue=function(){$("#div-quota-grid").html(a.DataTrends.TableHtml)};a.SetChangeTableSize=function(b,f){a.DataTrends.CelNum>f?($("#reportTable").css("width",100*a.DataTrends.CelNum+"px"),30<a.DataTrends.RowNum?SetTableRowCel(b,933,-1):($("#div-quota-grid").css("height",$("#reportTable").height()+0+"px"),SetTableRowCel(b,$("#reportTable").height()+0,-1))):($("#reportTable").css("width",b+"px"),30<a.DataTrends.RowNum&&SetTableRowCel(b,933,-1))}}]);zyApp.controller("PublishManagerCtrl",["$scope","$stateParams","$http","QuesEidtData","publishManager","UserPageText","$location","Unify","QQuesSet",function(a,e,b,c,k,h,l,g,m){a.IsDemo=$("#hiddendemotype").val();$("#PlanTime").datetimepicker({dayOfWeekStart:1,lang:"ch",onSelectDate:function(){a.publishManager.SaveSetFlag=!0}});GoHtmlTop();a.Init=function(f){0!=f&&loadingStart();b.post("/QM/VerifyRight",{quesID:e.qid}).success(function(d){"NoRight"==d?location.href="/Error/Error?type\x3ddashboard":(a.Unify=g,a.Unify.QuesChange(e.qid),a.UserPageText=h,a.UserPageText.InitPageText(),a.publishManager=k,a.publishManager.Reset(),c.QuesInfoData.qid=e.qid,a.publishManager.QuesID=e.qid,a.publishManager.PublishPageFlag=!1,a.publishManager.PublishPageFlagBtn=!1,$("#publishtext").html(""),b.post("/QM/GetPublishInfo",{quesID:a.publishManager.QuesID}).success(function(d){a.QuotaList=d.QuotaList;0<d.QuotaList.length&&(a.publishManager.QuotaExits=!0);""!=d.errorMessage?($("#publishtext").html(d.errorMessage),a.publishManager.designErrorStyle={color:"red"}):0<d.collChannel.length?($("#publishtext").html("\u5f53\u524d\u6536\u96c6\u5668\u72b6\u6001\uff1a"+d.collChannel[0].PublishStatusName),a.publishManager.designErrorStyle={color:"green"},"\u5728\u7ebf"==d.collChannel[0].PublishStatusName?1E3==d.collChannel[0].PublishDays?$("#RestTime").html("\u65e0\u671f\u9650"):$("#RestTime").html("\u5269\u4f59\u65f6\u95f4\uff1a"+d.collChannel[0].RestTime):"\u4e0b\u7ebf"==d.collChannel[0].PublishStatusName?$("#RestTime").html("\u4e0b\u7ebf\u539f\u56e0\uff1a"+d.collChannel[0].RestTime):$("#RestTime").html("")):($("#publishtext").html(""),$("#RestTime").html(""));0!=f&&loadingEnd();a.Unify.QuesChange(e.qid);a.publishManager.DisableAll=d.DisableAll;a.publishManager.publishFlag=d.publishFlag;a.publishManager.publishDisable=d.publishDisable;a.publishManager.cancelFlag=d.cancelFlag;a.publishManager.downFlag=d.downFlag;a.publishManager.otherFlag1=d.otherFlag1;a.publishManager.otherFlag2=d.otherFlag2;a.publishManager.otherFlag3=d.otherFlag3;a.publishManager.otherFlag4=d.otherFlag4;a.publishManager.onLineFlag=d.onLineFlag;a.publishManager.otherFlag5=d.otherFlag5;a.publishManager.planHourFlag=!d.otherFlag2;if(0<d.collChannel.length){a.publishManager.SaveSetFlag=!1;c.QuesInfoData.publishStateFlag=!1;a.publishManager.CollectorID=d.collChannel[0].CollectorID;""!=d.collChannel[0].QuotaTableName&&(a.publishManager.QuotaID=d.collChannel[0].QuotaTableID,a.publishManager.QuotaName=d.collChannel[0].QuotaTableName,a.publishManager.QuotaFlag=!0,a.publishManager.CancelQuotaFlag=!0);a.publishManager.publishCount=d.collChannel[0].PublishCount;a.publishManager.PublishDays=d.collChannel[0].PublishDays;1E3!=d.collChannel[0].PublishDays?a.publishManager.daysLock=!1:(a.publishManager.NoTimeLimit=!0,a.publishManager.daysLock=!0);if("2"==d.collChannel[0].PublishType){var b=new Date(d.collChannel[0].StartDate.replace(/-/g,"/")),g=b.getFullYear(),h=1==(b.getMonth()+1).toString().length?"0"+(b.getMonth()+1):b.getMonth()+1,l=1==b.getDate().toString().length?"0"+b.getDate():b.getDate(),k=1==b.getHours().toString().length?"0"+b.getHours():b.getHours(),b=1==b.getMinutes().toString().length?"0"+b.getMinutes():b.getMinutes(),g=g+"/"+h+"/"+l+" "+k+":"+b;document.getElementById("PlanTime").value=g;$("#PublishTime").html("")}else $("#PublishTime").html(d.collChannel[0].DirectPublishDate);$("#webShortLink").val(d.collChannel[0].webPublishHref);$("#qrCodeStr").attr("src","");$("#qrCodeStr").attr("src",d.collChannel[0].QRCodImageSrc);"Y"==d.collChannel[0].ParameterFlag&&(a.publishManager.parameterCheck=!0);a.publishManager.parameterFlag=d.collChannel[0].ParameterFlag;a.publishManager.ReleaseType=d.collChannel[0].PublishType;a.publishManager.TerLimitReply=d.collChannel[0].TerLimitFlag;for(g=0;g<d.collChannel.length;g++)""!=d.collChannel[g].Attribute4&&null!=d.collChannel[g].Attribute4&&("Y"==d.collChannel[g].Attribute2&&(a.publishManager.collectionEnable=!0),a.publishManager.microLetterChannel=d.collChannel[g].Attribute2,a.publishManager.WeChatName=d.collChannel[g].Attribute3,a.publishManager.WeChatNameAppID=d.collChannel[g].Attribute4,a.publishManager.WeChatNameId=d.collChannel[g].Attribute5,a.publishManager.WeChatAppSecret=d.collChannel[g].Attribute6,""!=d.collChannel[g].Attribute6&&$("#weichat-oauth").val(d.collChannel[g].Attribute7))}else a.publishManager.SaveSetFlag=!0;a.publishManager.DisableAll&&(a.publishManager.QuotaFlag=!0,a.publishManager.SaveSetFlag=!1,a.publishManager.publishDisable=!1,a.publishManager.cancelLock=!1,a.publishManager.downLock=!1,a.publishManager.WeichatOauthFlag=!1,a.publishManager.daysLock=!0,a.publishManager.planHourFlag=!0);a.publishManager.PublishPageFlag=!0;a.publishManager.PublishPageFlagBtn=!0}).error(function(d,f,b,c){loadingEnd();RestLogin(d,a)}))}).error(function(d,f,b,c){loadingEnd();RestLogin(d,a)});ChangePlanDateCssWidth()};a.Init();a.SavePublishSet=function(){!this.publishManager.DisableAll&&this.publishManager.SaveSetFlag&&(""==a.publishManager.publishCount?alert("\u53d1\u5e03\u603b\u6570\u4e0d\u80fd\u4e3a\u7a7a\u3002","red"):""==a.publishManager.PublishDays||isNaN(a.publishManager.PublishDays)?alert("\u95ee\u5377\u6536\u96c6\u65f6\u9650\u4e0d\u80fd\u4e3a\u7a7a\u3002","red"):""==$("#PlanTime").val()&&"2"==a.publishManager.ReleaseType?alert("\u8ba1\u5212\u53d1\u5e03\u65f6\u95f4\u4e0d\u80fd\u4e3a\u7a7a\u3002","red"):(loadingStart(),b.post("/QM/SavePublishInfo",{collID:a.publishManager.CollectorID,quesID:a.publishManager.QuesID,auotaID:a.publishManager.QuotaID,publishCount:this.publishManager.publishCount,startDate:$("#PlanTime").val(),publishDays:this.publishManager.PublishDays,publishType:this.publishManager.ReleaseType,terLinmitFlag:this.publishManager.TerLimitReply,anonymousFalg:"",returnPreFlag:"Y",microLetterChannel:this.publishManager.microLetterChannel,microServiceName:this.publishManager.WeChatName,appID:this.publishManager.WeChatNameAppID,microNum:this.publishManager.WeChatNameId,appSecrt:this.publishManager.WeChatAppSecret,oauth:"",isFocus:"",collect:this.publishManager.microLetterChannel,btnType:"",parameterFlag:this.publishManager.parameterFlag}).success(function(f){void 0==f.errorMessage?(alert(f,"green"),a.LoadingIsEnd=0,a.Init(a.LoadingIsEnd),loadingEnd()):""==f.errorMessage?(alert(Prompt.SaveOK,"green"),a.LoadingIsEnd=0,a.Init(a.LoadingIsEnd),loadingEnd(),a.publishManager.SaveSetFlag=!1,c.QuesInfoData.publishStateFlag=!1):(alert(f.errorMessage,"red"),loadingEnd())}).error(function(f,d,b,c){loadingEnd();RestLogin(f,a)})))};a.Publish=function(){this.publishManager.DisableAll||this.publishManager.publishDisable&&(0==this.publishManager.publishCount?alert("\u95ee\u5377\u53d1\u884c\u6570\u4e3a0\uff0c\u4e0d\u5141\u8bb8\u53d1\u5e03\uff01","red"):""==a.publishManager.publishCount?alert("\u53d1\u5e03\u603b\u6570\u4e0d\u80fd\u4e3a\u7a7a\u3002","red"):""==a.publishManager.PublishDays||isNaN(a.publishManager.PublishDays)?alert("\u95ee\u5377\u6536\u96c6\u65f6\u9650\u4e0d\u80fd\u4e3a\u7a7a\u3002","red"):""==$("#PlanTime").val()&&"2"==a.publishManager.ReleaseType?alert("\u8ba1\u5212\u53d1\u5e03\u65f6\u95f4\u4e0d\u80fd\u4e3a\u7a7a\u3002","red"):confirm("\u662f\u5426\u53d1\u5e03\u6b64\u6536\u96c6\u5668\uff1f",function(){loadingStart();b.post("/QM/SavePublishInfo",{collID:a.publishManager.CollectorID,quesID:a.publishManager.QuesID,auotaID:a.publishManager.QuotaID,publishCount:a.publishManager.publishCount,startDate:$("#PlanTime").val(),publishDays:a.publishManager.PublishDays,publishType:a.publishManager.ReleaseType,terLinmitFlag:a.publishManager.TerLimitReply,anonymousFalg:"",returnPreFlag:"Y",microLetterChannel:a.publishManager.microLetterChannel,microServiceName:a.publishManager.WeChatName,appID:a.publishManager.WeChatNameAppID,microNum:a.publishManager.WeChatNameId,appSecrt:a.publishManager.WeChatAppSecret,oauth:"",isFocus:"",collect:a.publishManager.microLetterChannel,btnType:"publish",parameterFlag:a.publishManager.parameterFlag}).success(function(f){void 0==f.errorMessage?(alert(f,"green"),a.Unify.QuesChange(e.qid),a.LoadingIsEnd=0,a.Init(a.LoadingIsEnd),loadingEnd()):""==f.errorMessage?(alert(Prompt.ReleaseOK,"green"),a.Unify.QuesChange(e.qid),a.LoadingIsEnd=0,a.Init(a.LoadingIsEnd),loadingEnd(),a.publishManager.SaveSetFlag=!1,c.QuesInfoData.publishStateFlag=!1):(alert(f.errorMessage,"red"),loadingEnd())}).error(function(f,d,b,c){loadingEnd();RestLogin(f,a)});a.$digest()},function(){},"\u662f","\u53d1\u5e03\u6536\u96c6\u5668","\u5426"))};a.publishNumChange=function(a){this.publishManager.DisableAll||this.publishManager.QuotaFlag||(this.publishManager.publishNumChange(a),c.QuesInfoData.publishStateFlag=!0)};a.publishNumChangeForOnChange=function(a){this.publishManager.DisableAll||this.publishManager.QuotaFlag||(this.publishManager.publishNumChangeForOnChange(a),c.QuesInfoData.publishStateFlag=!0)};a.quotaStyleChange=function(){this.publishManager.DisableAll||this.publishManager.otherFlag2&&this.publishManager.quotaStyleChange()};a.quotaChange=function(a){this.publishManager.quotaChange(a);c.QuesInfoData.publishStateFlag=!0};a.redQuotaUrl=function(f){f.stopPropagation();c.QuesInfoData.publishStateFlag?confirm(Prompt.SaveTheCurrentPublishChanges,function(){SaveQuesPublishMethod(a,b,l,"Quota","","",c,k,m)},function(){c.QuesInfoData.publishStateFlag=!1;a.publishManager.SaveSetFlag=!1;l.path("/QMSet/Quota/"+a.publishManager.QuesID);a.$apply()},"\u662f","","\u5426"):(c.QuesInfoData.publishStateFlag=!1,a.publishManager.SaveSetFlag=!1,l.path("/QMSet/Quota/"+a.publishManager.QuesID))};a.getQuotaSttyle=function(){return"quotaChangeStyle\x3d{visibility: 'visible'}"};a.PublishDaysChange=function(a){this.publishManager.DisableAll||(this.publishManager.PublishDaysChange(a),c.QuesInfoData.publishStateFlag=!0)};a.PublishDaysChangeForOnChange=function(a){this.publishManager.DisableAll||(this.publishManager.PublishDaysChangeForOnChange(a),c.QuesInfoData.publishStateFlag=!0)};a.NoTimeLimitSelect=function(){!this.publishManager.DisableAll&&this.publishManager.otherFlag2&&(this.publishManager.NoTimeLimitSelect(),c.QuesInfoData.publishStateFlag=!0)};a.ReleaseSelect=function(a){!this.publishManager.DisableAll&&this.publishManager.otherFlag2&&(this.publishManager.ReleaseSelect(a),c.QuesInfoData.publishStateFlag=!0)};a.planHourChange=function(){!this.publishManager.DisableAll&&this.publishManager.otherFlag1&&(this.publishManager.planHourChange(),c.QuesInfoData.publishStateFlag=!0)};a.TerLimitSelect=function(a){this.publishManager.DisableAll||(this.publishManager.TerLimitSelect(a),c.QuesInfoData.publishStateFlag=!0)};a.parameterSelect=function(){this.publishManager.DisableAll||(this.publishManager.parameterSelect(),c.QuesInfoData.publishStateFlag=!0)};a.toggleCollectionEnable=function(){this.publishManager.DisableAll||(this.publishManager.toggleCollectionEnable(),c.QuesInfoData.publishStateFlag=!0)};a.QuesSetWebChatBtnChange=function(a,d){this.publishManager.QuesSetWebChatBtnChange(a,d);c.QuesInfoData.publishStateFlag=!0};a.WeiChatVerify=function(){this.publishManager.WeChatBtnFlag&&b.post("/QM/WechatSave",{collID:a.publishManager.CollectorID,quesID:a.publishManager.QuesID,microServiceName:this.publishManager.WeChatName,appID:this.publishManager.WeChatNameAppID,microNum:this.publishManager.WeChatNameId,appSecrt:this.publishManager.WeChatAppSecret,oauth:"",isFocus:"",collect:this.publishManager.microLetterChannel}).success(function(f){""==f.error?(a.publishManager.CollectorID=f.collID,a.WeCharValidation(f.wechatChannelID)):(loadingEnd(),alert(f.error,"red"))}).error(function(f,d,b,c){loadingEnd();RestLogin(f,a)})};a.WeCharValidation=function(f){b.post("/WeChat/WeCharValidation",{appid:a.publishManager.WeChatNameAppID,secret:a.publishManager.WeChatAppSecret,collID:a.publishManager.CollectorID,channelID:f}).success(function(d){""==d.errorMessage?(alert("\u9a8c\u8bc1\u5e76\u4fdd\u5b58\u6210\u529f\uff01","green"),a.publishManager.redirect_uri=d.redirect_uri,a.publishManager.WeichatOauthFlag=!0,a.publishManager.WeChatBtnFlag=!1,c.QuesInfoData.publishStateFlag=!1):alert("\u4fdd\u5b58\u6210\u529f\uff0c\u4f46"+d.errorMessage,"red");$("#weichat-oauth").val(d.Oauth);loadingEnd()}).error(function(d,f,b,c){loadingEnd();RestLogin(d,a)})};a.QuesSetWebChatOauthBtn=function(){a.publishManager.WeichatOauthFlag&&b.post("/Home/CheckSessionLost",{}).success(function(f){f.IsSessionLost?RestLogin(f.Message,a):(a.CollDown=2,$("body").addClass("srcollHide"),$("#WeixinPreviewURl").attr("src",""),b.post("/QM/DownLoadQRCode",{quesID:e.qid,linkSuffix:e.qid,redirect_uri:a.publishManager.redirect_uri}).success(function(a){a.returnError?alert(a.Message,"red"):$("#WeixinPreviewURl").attr("src",a.StrPath)}).error(function(a,f,b,c){RestLogin(a.Message)}))})};a.CanclePublish=function(){this.publishManager.DisableAll||this.publishManager.cancelLock&&confirm("\u53d6\u6d88\u540e\u95ee\u5377\u6536\u96c6\u5668\u5c06\u6062\u590d\u4e3a\u672a\u53d1\u5e03\u72b6\u6001\uff0c\u662f\u5426\u53d6\u6d88\u53d1\u5e03\u5f53\u524d\u6536\u96c6\u5668\uff1f",function(){loadingStart();b.post("/QM/CanclePublish",{collID:a.publishManager.CollectorID}).success(function(f){""==f?(alert(Prompt.CancelPublishOK,"green"),a.Init()):alert(f,"red");loadingEnd()}).error(function(f,d,b,c){loadingEnd();RestLogin(f,a)});a.$digest()},function(){},"\u662f","\u53d6\u6d88\u53d1\u5e03\u6b64\u6536\u96c6\u5668","\u5426")};a.CollDown=0;a.DownClick=function(){!this.publishManager.DisableAll&&this.publishManager.downLock&&($("#reason").val(""),a.CollDown=1,$("body").addClass("srcollHide"))};a.Down=function(){""==$("#reason").val()?alert(Prompt.InputOfflineReason,"red"):(loadingStart(),b.post("/QM/Down",{collID:a.publishManager.CollectorID,reason:$("#reason").val()}).success(function(f){""==f?(a.cancelClose(),alert(Prompt.DownAuditSubmit,"green"),a.Init()):alert(f,"red");loadingEnd()}).error(function(f,d,b,c){loadingEnd();RestLogin(f,a)}))};a.cancelClose=function(){$("body").removeClass("srcollHide");a.CollDown=0};a.CancelPopup=function(a){a.stopPropagation()}}]);function ChangeCalendarCssWidth(){var a=parseInt($(".input-number").css("width"));200==parseInt($(".input-number").css("width"))&&(a+=62);$(".ui-datepicker").css("width",a+"px")}function ChangePlanDateCssWidth(){var a=(parseInt($(".input-number").css("width"))-20)/2,e=a;768>window.innerWidth?$(".HourSelect").css("margin-left","0px"):$(".HourSelect").css("margin-left","10px");200==parseInt($(".input-number").css("width"))&&(a=100,e=a+40);$("#planDateDIV").css("width",e+"px");$(".HourSelect").css("width",a+"px")}$(window).resize(function(){setTimeout(function(){ChangeCalendarCssWidth();ChangePlanDateCssWidth()},100)});function SaveQuesPublishMethod(a,e,b,c,k,h,l,g,m){a.publishManager=g;loadingStart();e.post("/QM/SavePublishInfo",{collID:a.publishManager.CollectorID,quesID:a.publishManager.QuesID,auotaID:a.publishManager.QuotaID,publishCount:a.publishManager.publishCount,startDate:$("#PlanTime").val(),publishDays:a.publishManager.PublishDays,publishType:a.publishManager.ReleaseType,terLinmitFlag:a.publishManager.TerLimitReply,anonymousFalg:"",returnPreFlag:"Y",microLetterChannel:a.publishManager.microLetterChannel,microServiceName:a.publishManager.WeChatName,appID:a.publishManager.WeChatNameAppID,microNum:a.publishManager.WeChatNameId,appSecrt:a.publishManager.WeChatAppSecret,oauth:"",isFocus:"",collect:a.publishManager.microLetterChannel,btnType:"",parameterFlag:a.publishManager.parameterFlag}).success(function(f){""==f.errorMessage?(""!=c&&(QuesSetTabCssActive(a,c,m),b.path("/QMSet/"+c+"/"+a.publishManager.QuesID)),""!=k&&("Design"==k?window.location.href="/QD/QuestionnairDesign?quesID\x3d"+a.publishManager.QuesID:(b.path("/QMSet/"+k+"/"+a.publishManager.QuesID),a.QQuesSet.QMSetAction="Publish")),loadingEnd(),a.publishManager.SaveSetFlag=!1,l.QuesInfoData.publishStateFlag=!1):(alert(f.errorMessage,"red"),loadingEnd())}).error(function(f,d,b,c){loadingEnd();RestLogin(f,a)})}function QCreate(){this.newFolderID="";this.QFBtnSubmitFlag=!0;this.InitFolderName=this.QueTitle="";this.nullFolder=!0;this.newFolderName="";this.CreateFolderFlag="hide";this.CurrentModelName=this.DataFolderList="";this.IsSelectFlag=!1;this.QuesID="";this.AddMoreFlag=!0}zyApp.controller("QuesCreateCtrl",["$scope","$stateParams","$http","QuesEidtData","UserPageText","Unify","$timeout","$location",function(a,e,b,c,k,h,l,g){function m(d){b.post("/QM/GetModelTypeByValueSetId",{valuesetId:"61129f64-c3d7-4429-bc45-a368663f888a"}).success(function(b){a.ModelTypeList=b.ModelTypeList;for(b=0;b<a.ModelTypeList.length;b++)"\u5168\u90e8"==a.ModelTypeList[b].ModelTypeName&&(f=a.ModelTypeList[b],a.selectModel(a.ModelTypeList[b],a.ModelTypeList,d,0,!1))}).error(function(d,f,b,n){loadingEnd();RestLogin(d,a)})}a.UserPageText=k;a.UserPageText.InitPageText();a.IsDemo=$("#hiddendemotype").val();GoHtmlTop();a.Unify=h;a.QCreate=new QCreate;a.QCreate.newFolderID=e.fid;a.QCreate.QueTitle="";a.GoToQM=function(){g.path("/QM")};a.QCreate.CreateFolderFlag="hide";a.QFbtnSubmitCssChange=function(){a.QCreate.QFBtnSubmitFlag=null==a.QCreate.QueTitle||""==a.QCreate.QueTitle?!0:!1};l(function(){isTouchDevice()},100);a.QuesSubmit=function(){a.QCreate.IsSelectFlag?(loadingStart(),b.post("/QM/CopyQues",{quesID:a.QCreate.QuesID,title:a.QCreate.QueTitle,folderID:a.QCreate.newFolderID}).success(function(d){console.log(d);""==d.returnValue.returnMessage?(a.QCreate.QFBtnSubmitFlag=!1,loadingEnd(),window.location.href="/QD/QuestionnairDesign?quesID\x3d"+d.returnValue.quesId):(alert(d.returnValue.returnMessage,"red"),loadingEnd())}).error(function(d,f,b,c){loadingEnd();RestLogin(d.sessionLost,a)})):(loadingStart(),b.post("/QM/QuestionnaireEdit",{questionID:"",title:a.QCreate.QueTitle,descript:"",folderID:a.QCreate.newFolderID,templateID:""}).success(function(d){""==d.Message?(a.QCreate.QFBtnSubmitFlag=!1,loadingEnd(),window.location.href="/QD/QuestionnairDesign?quesID\x3d"+d.quesID):(alert(d.Message,"red"),loadingEnd())}).error(function(d,f,b,c){loadingEnd();RestLogin(d,a)}))};a.Init=function(d,f){0!=f&&loadingStart();b.get("/QM/GetFolder",{}).success(function(f,b,c,g){a.QCreate.DataFolderList=f.FolderList;if(void 0!=f.FolderList){if("newIndex"==d){for(b=0;b<a.QCreate.DataFolderList.length;b++)a.QCreate.DataFolderList[b].IsSelect=!1;b=f.FolderList.length;a.QCreate.InitFolderName=f.FolderList[b-1].FolderName;a.QCreate.newFolderID=f.FolderList[b-1].FolderID;a.QCreate.DataFolderList[b-1].IsSelect=!0;a.QCreate.nullFolder=!1}if(""!=a.QCreate.newFolderID)for(b=0;b<f.FolderList.length;b++){if(f.FolderList[b].FolderID==a.QCreate.newFolderID){a.QCreate.InitFolderName=f.FolderList[b].FolderName;a.QCreate.DataFolderList[b].IsSelect=!0;a.QCreate.nullFolder=!1;break}}else a.MineFolder()}else a.MineFolder()}).error(function(d,f,b,c){loadingEnd();RestLogin(d,a)});m()};a.Init("");a.CreateFolder=function(){a.QCreate.newFolderName="";a.QCreate.CreateFolderFlag="Show";$("body").addClass("srcollHide");a.QCreate.ShowDownFolder={visibility:"hidden"};a.FolderForm.$setPristine()};a.MineFolder=function(){a.QCreate.InitFolderName="\u6211\u7684\u6587\u4ef6\u5939";a.QCreate.nullFolder=!0;a.QCreate.newFolderID="";for(var d=0;d<a.QCreate.DataFolderList.length;d++)a.QCreate.DataFolderList[d].IsSelect=!1};a.ChangeFolderCss=function(d){if(""==d)a.MineFolder();else if(d.FolderName!=a.QCreate.InitFolderName){for(var f=0;f<a.QCreate.DataFolderList.length;f++)a.QCreate.DataFolderList[f].IsSelect=!1;a.QCreate.nullFolder=!1;d.IsSelect=!0;a.QCreate.InitFolderName=d.FolderName;a.QCreate.newFolderID=d.FolderID;a.ChangeFolderStyle={display:"none"}}console.log(a.QCreate.newFolderID)};a.SaveNewFolder=function(d){d&&(loadingStart(),b.post("/QM/SaveFolder",{title:a.QCreate.newFolderName,folderid:"",isnewsave:1}).success(function(d){""==d.Message?(alert(Prompt.SaveOK,"green"),a.QCreate.CreateFolderFlag="hide",$("body").removeClass("srcollHide"),a.LoadingIsEnd=0,a.Init("newIndex",a.LoadingIsEnd)):alert(d.Message,"red");loadingEnd()}).error(function(d,f,b,c){loadingEnd();RestLogin(d,a)}))};a.enterOrEscOper=function(d){13==window.event.keyCode&&1==d&&a.SaveNewFolder(FolderForm.$valid);27==window.event.keyCode&&a.concelWin()};a.concelWin=function(){a.QCreate.CreateFolderFlag="hide";$("body").removeClass("srcollHide")};a.showSelectDiv=function(d,f){for(var b=0;b<f.length;b++)f[b].IsSelectFlag=!1,f[b].SelectClass="";d.IsSelectFlag=!0;d.SelectClass="select-sample";d==f[0]?(a.QCreate.IsSelectFlag=!1,a.QCreate.QuesID=""):(a.QCreate.IsSelectFlag=d.IsSelectFlag,a.QCreate.QuesID=d.QuesID)};var f,d=0;a.addMoreQues=function(){d+=1;a.selectModel(f,a.ModelTypeList,1,d,!1)};a.selectModel=function(c,g,h,e,l){0!=h&&loadingStart();l&&(d=0,a.QCreate.AddMoreFlag=!0);b.post("/QM/GetModelInfoByModelId",{valueId:c.ValueId,index:e}).success(function(d){console.log(d);a.QuesList=d.QuesList;d.IsEnd&&(a.QCreate.AddMoreFlag=!1);for(d=0;d<g.length;d++)g[d].IsSelect=!1;c.IsSelect=!0;f=c;a.QCreate.CurrentModelName=c.ModelTypeName;loadingEnd()}).error(function(d,f,b,c){loadingEnd();RestLogin(d,a)})};a.PreViewModel=function(d,f){f.stopPropagation();b.post("/Home/CheckSessionLost",{}).success(function(f){f.IsSessionLost?RestLogin(f.Message,a):(a.Unify.QuesPreview("#QuesPreviewHref","#QuesPreviewURl",d),a.QCreate.CreateFolderFlag="Preview",$("body").addClass("srcollHide"))})};a.QuesCreateClose=function(){$("body").removeClass("srcollHide");a.QCreate.CreateFolderFlag="hide"};a.QuesCreatePopup=function(a){a.stopPropagation()};a.QuesMouseover=function(a,d){for(var f=0;f<d.length;f++)d[f].MoveOver={opacity:0};a.MoveOver={opacity:1}};a.QuesMouseleave=function(a){for(var d=0;d<a.length;d++)a[d].MoveOver={opacity:0}}}]);function QSummary(){this.FileName=this.FileSize=this.SummaryNodeNum=this.SummaryUpdateDate=this.SummaryUpdateName=this.SummaryCreateDate=this.SummaryCreateName=this.SummaryQFacePpicture=this.SummaryQuesDescribe=this.SummaryQuesTitle=this.CompanyID="";this.SFSubmitFlag=!1}zyApp.controller("SummaryCtrl",["$scope","$stateParams","$http","$location","QuesEidtData","UserPageText","Unify",function(a,e,b,c,k,h,l){a.UserPageText=h;a.UserPageText.InitPageText();GoHtmlTop();k.QuesInfoData.qid=e.qid;a.QSummary=new QSummary;$("html,body").animate({scrollTop:0},0);a.InitQuesData=function(c){0!=c&&loadingStart();b.post("/QM/VerifyRight",{quesID:k.QuesInfoData.qid}).success(function(h){"NoRight"==h?location.href="/Error/Error?type\x3ddashboard":b.post("/QM/GetQuestionInfoByQuesID",{quesID:k.QuesInfoData.qid}).success(function(f){console.log("\u8282\u70b9\u65701\uff1a"+f.NodeNum);void 0==f.QTitle?(alert(f,"red"),a.QSummary.SummaryQuesTitle="",a.QSummary.SummaryQuesDescribe=""):(a.QSummary.CompanyID=f.CompanyID,a.QSummary.SummaryQuesTitle=f.QTitle,a.QSummary.SummaryQuesDescribe=f.QDescript,a.QSummary.SummaryQFacePpicture=f.QFacePpicture,a.QSummary.SummaryCreateName=f.CreateName,a.QSummary.SummaryCreateDate=f.CreateDate,a.QSummary.SummaryUpdateName=f.UpdateName,a.QSummary.SummaryUpdateDate=f.UpdateDate,a.QSummary.SummaryNodeNum=f.NodeNum,a.QSummary.FileSize="",a.QSummary.FileName="",a.Unify=l,a.Unify.QuesChange(e.qid),$("#uploadDiv").InitUpload({parentfolder:"\\UploadFiles\\Photo",CompanyID:a.QSummary.CompanyID,QuesID:k.QuesInfoData.qid,UType:"1",iscrop:!0,LoadingName:"progressbar",Scope:a,Http:b,onQueueComplete:function(d){loadingStart();b.post("/QM/SetQFacePpicture",{quesID:k.QuesInfoData.qid,filename:a.QSummary.FileName}).success(function(a){a.IsSuccess&&alert(Prompt.QuesPicUploadSuccess,"green");loadingEnd()}).error(function(d,f,b,c){loadingEnd();RestLogin(d,a)})}}));0!=c&&loadingEnd()}).error(function(f,d,b,c){loadingEnd();RestLogin(f,a)})}).error(function(b,f,d,c){loadingEnd();RestLogin(b,a)})};a.InitQuesData();a.SFBtnSubmitCssChange=function(b,c){b&&c?(a.QSummary.SFSubmitFlag=!0,k.QuesInfoData.EditStateFlag=!0,k.SaveMethodsArgs.qtitle=a.QSummary.SummaryQuesTitle,k.SaveMethodsArgs.qdescribe=a.QSummary.SummaryQuesDescribe):a.QSummary.SFSubmitFlag=!1};a.SummarySubmit=function(){a.QSummary.SFSubmitFlag&&(loadingStart(),b.post("/QM/QuestionnaireEdit",{questionID:k.QuesInfoData.qid,title:a.QSummary.SummaryQuesTitle,descript:a.QSummary.SummaryQuesDescribe,folderID:"",templateID:""}).success(function(b){""==b.Message?(alert(Prompt.SaveOK,"green"),a.LoadingIsEnd=0,a.InitQuesData(a.LoadingIsEnd),loadingEnd(),a.QSummary.SFSubmitFlag=!1,k.QuesInfoData.EditStateFlag=!1):(alert(b.Message,"red"),loadingEnd())}).error(function(b,c,f,d){loadingEnd();RestLogin(b,a)}))}}]);zyApp.controller("QuesSettingsCtrl",["$scope","$stateParams","$http","$location","QuesEidtData","$window","publishManager","Unify","QuesQuotaInfo","QQuesSet",function(a,e,b,c,k,h,l,g,m,f){a.Unify=g;a.QQuesSet=f;a.QQuesSet.QQuesSetReset();a.QSummary=new QSummary;a.QuesQuota=m;a.publishManager=l;isTouchDevice();GoHtmlTop();a.InitTabCss=function(){var d=window.location.href;0<=d.indexOf("/QMSet/Publish/")?a.QQuesSet.QMSetAction="Publish":0<=d.indexOf("/QMSet/Summary/")?a.QQuesSet.QMSetAction="Summary":0<=d.indexOf("/QMSet/Quota/")?a.QQuesSet.QMSetAction="Quota":0<=d.indexOf("/QMSet/AnalyzeResults/")?a.QQuesSet.QMSetAction="AnalyzeResults":0<=d.indexOf("/QMSet/Backups/")&&(a.QQuesSet.QMSetAction="Backups")};a.InitTabCss();a.TabCsss=function(d){QuesSetTabCssActive(a,d,f)};a.judgeQuesSaveState=function(d,n,g){"DeleteQues"==g?c.path("/QM"):k.QuesInfoData.EditStateFlag?confirm(Prompt.SaveTheCurrentQuesChanges,function(){""!=d?SaveQuesMethod(a,b,c,d,"","",k,f):""!=n?SaveQuesMethod(a,b,c,"",n,"",k,f):"moveQues"==g?(a.MoveToFolderMethod(),SaveQuesMethod(a,b,c,"","",g,k,f)):"copyQues"==g&&(SaveQuesMethod(a,b,c,"","",g,k,f),a.CopyQuesMethod());a.$digest()},function(){k.QuesInfoData.EditStateFlag=!1;a.QSummary.SFSubmitFlag=!1;""!=d&&(a.TabCsss(d),c.path("/QMSet/"+d+"/"+k.QuesInfoData.qid),a.$parent.$digest());""!=n&&("Design"==n?window.location.href="/QD/QuestionnairDesign?quesID\x3d"+k.QuesInfoData.qid:(c.path("/QMSet/"+n+"/"+k.QuesInfoData.qid),a.$parent.$digest(),a.QQuesSet.QMSetAction="Publish"));a.$digest()},"\u662f","","\u5426"):k.QuesInfoData.publishStateFlag?confirm(Prompt.SaveTheCurrentPublishChanges,function(){""!=d?SaveQuesPublishMethod(a,b,c,d,"","",k,l,f):""!=n?SaveQuesPublishMethod(a,b,c,"",n,"",k,l,f):"moveQues"==g?(a.MoveToFolderMethod(),SaveQuesPublishMethod(a,b,c,"","",g,k,l,f)):"copyQues"==g&&(SaveQuesPublishMethod(a,b,c,"","",g,k,l,f),a.CopyQuesMethod());a.$digest()},function(){k.QuesInfoData.publishStateFlag=!1;a.publishManager.SaveSetFlag=!1;""!=d&&(a.TabCsss(d),c.path("/QMSet/"+d+"/"+k.QuesInfoData.qid),a.$parent.$digest());""!=n&&("Design"==n?window.location.href="/QD/QuestionnairDesign?quesID\x3d"+k.QuesInfoData.qid:(c.path("/QMSet/"+n+"/"+k.QuesInfoData.qid),a.$parent.$digest(),a.QQuesSet.QMSetAction="Publish"));a.$digest()},"\u662f","","\u5426"):a.QuesQuota.ShowCreateTableBtn||SaveQuotaFlag?confirm(Prompt.SaveTheCurrentQuotaChanges,function(){""!=d?SaveQuotaInfoByTab(a,b,c,d,"","",k,m,f):""!=n?SaveQuotaInfoByTab(a,b,c,"",n,"",k,m,f):"moveQues"==g?(a.MoveToFolderMethod(),SaveQuotaInfoByTab(a,b,c,"","",g,k,m,f)):"copyQues"==g&&(SaveQuotaInfoByTab(a,b,c,"","",g,k,m,f),a.CopyQuesMethod());a.$digest()},function(){SaveQuotaFlag=a.QuesQuota.ShowCreateTableBtn=!1;""!=d&&(a.TabCsss(d),c.path("/QMSet/"+d+"/"+k.QuesInfoData.qid),a.$parent.$digest());""!=n&&("Design"==n?window.location.href="/QD/QuestionnairDesign?quesID\x3d"+k.QuesInfoData.qid:(c.path("/QMSet/"+n+"/"+k.QuesInfoData.qid),a.$parent.$digest(),a.QQuesSet.QMSetAction="Publish"));a.$digest()},"\u662f","","\u5426"):(""!=d&&(a.TabCsss(d),c.path("/QMSet/"+d+"/"+k.QuesInfoData.qid)),""!=n&&("Design"==n?window.location.href="/QD/QuestionnairDesign?quesID\x3d"+k.QuesInfoData.qid:(c.path("/QMSet/"+n+"/"+k.QuesInfoData.qid),a.QQuesSet.QMSetAction="Publish")),""!=g&&("moveQues"==g?a.MoveToFolderMethod():"copyQues"==g&&a.CopyQuesMethod()))};a.MoveToFolderMethod=function(){b.post("/QM/GetQuestionInfoByQuesID",{quesID:k.QuesInfoData.qid}).success(function(d){a.CurrentQuesFolder=d.FolderMark}).error(function(d,f,b,c){loadingEnd();RestLogin(d,a)});var d=[];b.get("/QM/GetFolder",{}).success(function(f){if(void 0!=f.FolderList)if("00000000-0000-0000-0000-000000000000"!=a.CurrentQuesFolder){a.MyFolderFlag=!0;for(var b=0;b<f.FolderList.length;b++)f.FolderList[b].FolderID!=a.CurrentQuesFolder&&d.push(f.FolderList[b]);a.QQuesSet.QuesSetInitFolder="\u6211\u7684\u6587\u4ef6\u5939";a.QQuesSet.QuesSetSelectFID="";a.QQuesSet.QuesSetFolderList=d;a.QQuesSet.QuesBtnFlag=1;$("body").addClass("srcollHide")}else a.MyFolderFlag=!1,a.QQuesSet.QuesSetFolderList=f.FolderList,0<f.FolderList.length?(a.QQuesSet.QuesSetInitFolder=f.FolderList[0].FolderName,a.QQuesSet.QuesSetSelectFID=f.FolderList[0].FolderID,a.QQuesSet.QuesBtnFlag=1,$("body").addClass("srcollHide")):alert("\u8bf7\u5148\u521b\u5efa\u6587\u4ef6\u5939\u3002","red")}).error(function(d,f,b,c){loadingEnd();RestLogin(d,a)})};a.QuesSettTab=function(d){a.judgeQuesSaveState(d,"","")};a.PreViewCode=function(d){d.stopPropagation();b.post("/Home/CheckSessionLost",{}).success(function(d){d.IsSessionLost?RestLogin(d.Message,a):(a.Unify.QuesPreview("#QuesPreviewHref","#QuesPreviewURl",k.QuesInfoData.qid),a.QQuesSet.QuesBtnFlag=3,$("body").addClass("srcollHide"))})};a.QuesSettBtn=function(d){a.judgeQuesSaveState("",d,"")};a.enterOrEscOper=function(d){13==window.event.keyCode&&1==d&&a.QuesSetDelQuesByPwd();27==window.event.keyCode&&a.cancelCon()};a.QQuesSet.QuesBtnFlag=0;a.QuesSetMoveQues=function(){a.judgeQuesSaveState("","","moveQues")};a.SelectMoveFolder=function(d,f){a.QQuesSet.QuesSetInitFolder=f;a.QQuesSet.QuesSetSelectFID=d;a.QQuesSet.QuesSetFolderSelect={display:"none"};closeAll("ul.downul")};a.SaveMoveFolderData=function(){b.post("/QM/MoveQuesToFolder",{quesID:k.QuesInfoData.qid,targeid:a.QQuesSet.QuesSetSelectFID}).success(function(d){""==d.Message?(a.cancelCon(),alert(Prompt.QuotaSuccessfulOperation,"green")):alert(d.Message,"red")}).error(function(d,f,b,c){loadingEnd();RestLogin(d,a)})};a.CopyQuesMethod=function(){loadingStart();b.post("/QM/CopyQues",{quesID:k.QuesInfoData.qid}).success(function(a){""==a.returnValue.returnMessage?alert(Prompt.QuesCopyOK,"green"):alert(a.returnValue.returnMessage,"red");loadingEnd()}).error(function(d,f,b,c){loadingEnd();RestLogin(d.sessionLost,a)})};a.QuesSetCopyQues=function(){a.judgeQuesSaveState("","","copyQues")};a.OpenDelQues=function(){a.QQuesSet.QuesBtnFlag=2;$("body").addClass("srcollHide");a.QQuesSet.DelPassWord="";$("#delMessage").css("display","none")};a.QuesSetDelQuesByPwd=function(){"choiceform"!=$("#delete-survey").val()?$("#delMessage").css("display","block"):b.post("/QM/DelQues",{quesID:k.QuesInfoData.qid}).success(function(a){""==a.Message?($("body").removeClass("srcollHide"),alert(Prompt.QuotaSuccessfulOperation,"green"),c.path("/QM")):alert(a.Message,"red")})};a.cancelCon=function(){a.QQuesSet.QuesBtnFlag=0;$("body").removeClass("srcollHide")};a.CancelPopup=function(a){a.stopPropagation()}}]);function QuesSetTabCssActive(a,e,b){a.QQuesSet=b;"Summary"==e?a.QQuesSet.QMSetAction="Summary":"Preview"==e?a.QQuesSet.QMSetAction="Preview":"Quota"==e?a.QQuesSet.QMSetAction="Quota":"Publish"==e?a.QQuesSet.QMSetAction="Publish":"AnalyzeResults"==e?a.QQuesSet.QMSetAction="AnalyzeResults":"Backups"==e&&(a.QQuesSet.QMSetAction="Backups")}function SaveQuesMethod(a,e,b,c,k,h,l,g){a.QQuesSet=g;a.QSummary=new QSummary;e.post("/QM/QuestionnaireEdit",{questionID:l.QuesInfoData.qid,title:l.SaveMethodsArgs.qtitle,descript:l.SaveMethodsArgs.qdescribe,folderID:"",templateID:""}).success(function(h){""==h.Message?(""!=c&&(QuesSetTabCssActive(a,c,g),b.path("/QMSet/"+c+"/"+l.QuesInfoData.qid)),""!=k&&("Design"==k?window.location.href="/QD/QuestionnairDesign?quesID\x3d"+l.QuesInfoData.qid:(b.path("/QMSet/"+k+"/"+l.QuesInfoData.qid),a.QQuesSet.QMSetAction="Publish")),a.QSummary.SFSubmitFlag=!1,l.QuesInfoData.EditStateFlag=!1):alert(h.Message,"red")}).error(function(b,f,d,c){loadingEnd();RestLogin(b,a)})}function QPublish(){this.publishCount="";this.publishSetFlag=!1;this.QuotaID="";this.QuotaName="\u9009\u62e9\u914d\u989d";this.NoTimeLimit=this.publishCountFlag=this.auotaSetFlag=!1;this.PublishDays="";this.PublishDaysFlag=!1;this.TerLimitReply=this.ReleaseType="";this.NextTopicFlag="Y";this.NextTopic=!0;this.AnonymousFlag="N";this.isFocusCss=this.collectCss=this.Anonymous=!1;this.WeichatOauth=this.WeChatAppSecret=this.WeChatNameId=this.WeChatNameAppID=this.WeChatName="";this.WeichatOauthBtnFlag=this.WeChatBtnFlag=!1;this.QuotaList="";this.DisableAll;this.saveSetFlag;this.publishFlag;this.publishDisable;this.cancelFlag;this.downFlag;this.otherFlag1;this.otherFlag2;this.CollDown=0;this.webPublishHref=this.webLinkDIV=this.publishErrorMessage="";this.publishtextDIV=!1}function PublishCtrl(a,e,b,c,k){BindQuesTtile(a,b,e.qid);a.QPublish=QPublish;a.UserPageText=k;a.UserPageText.InitPageText();c.QuesInfoData.qid=e.qid;a.InitPublishData=function(h){0!=h&&loadingStart();b.post("/QM/GetPublishInfo",{quesID:c.QuesInfoData.qid,quotaID:c.SavePublishSetArgs.QuotaID}).success(function(b){console.log(b);if(void 0!=b.DisableAll)if("disable"==b.DisableAll&&(a.QPublish.publishSetFlag=!1,a.quotaStyle="display:none"),!1==b.otherFlag2&&(a.quotaStyle="display:none"),a.QPublish.publishErrorMessage=b.errorMessage,a.QPublish.DisableAll=b.DisableAll,a.QPublish.saveSetFlag=b.saveSetFlag,a.QPublish.publishFlag=b.publishFlag,a.QPublish.cancelFlag=b.cancelFlag,a.QPublish.downFlag=b.downFlag,a.QPublish.otherFlag1=b.otherFlag1,a.QPublish.otherFlag2=b.otherFlag2,a.QPublish.publishDisable=b.publishDisable,""!=b.errorMessage&&(a.QPublish.publishtextDIV=!0,$("#publishtext").html(b.errorMessage)),a.QPublish.QuotaList=b.QuotaList,0<b.collChannel.length){a.QPublish.publishSetFlag=!1;""==b.errorMessage&&(a.QPublish.publishtextDIV=!0,$("#publishtext").html("\u5f53\u524d\u6536\u96c6\u5668\u72b6\u6001\uff1a"+b.collChannel[0].PublishStatusName));"00000000-0000-0000-0000-000000000000"==b.collChannel[0].QuotaTableID?(a.QPublish.publishCountFlag=!0,a.QPublish.QuotaName="\u9009\u62e9\u914d\u989d",c.SavePublishSetArgs.QuotaID=a.QPublish.QuotaID="",a.QPublish.auotaSetFlag=!1):(a.QPublish.QuotaName=b.collChannel[0].QuotaTableName,c.SavePublishSetArgs.QuotaID=a.QPublish.QuotaID=b.collChannel[0].QuotaTableID,a.QPublish.publishCountFlag=!1);c.SavePublishSetArgs.publishCount=a.QPublish.publishCount=b.collChannel[0].PublishCount;1E3==b.collChannel[0].PublishDays?(c.SavePublishSetArgs.PublishDays=a.QPublish.PublishDays="",a.QPublish.PublishDaysFlag=!1,a.QPublish.NoTimeLimit=!0):(c.SavePublishSetArgs.PublishDays=a.QPublish.PublishDays=b.collChannel[0].PublishDays,a.QPublish.PublishDaysFlag=!0,a.QPublish.NoTimeLimit=!1);1==b.collChannel[0].PublishType?(a.QPublish.ReleaseType="Direct",$("#PlanTime").html(""),$("#PlanTime").addClass("w-input input disabled")):(a.QPublish.ReleaseType="Plans",$("#PlanTime").html(b.collChannel[0].StartDate),$("#PlanTime").removeClass("w-input input disabled"));c.SavePublishSetArgs.PublishType=b.collChannel[0].PublishType;a.QPublish.TerLimitReply="Y"==b.collChannel[0].TerLimitFlag?"TerLimitATime":"TerLimitManyTimes";c.SavePublishSetArgs.TerLimitFlag=b.collChannel[0].TerLimitFlag;"Y"==b.collChannel[0].ReturnPreFlag&&(a.QPublish.NextTopic=!0);c.SavePublishSetArgs.NextTopicFlag=b.collChannel[0].ReturnPreFlag;"Y"==b.collChannel[0].AnonymousFlag&&(a.QPublish.Anonymous=!0);if(1<b.collChannel[0].PublishStatus){if(""!=b.collChannel[0].webPublishHref){a.QPublish.webLinkDIV="Show";a.QPublish.webPublishHref=b.collChannel[0].webPublishHref;$("#QRCodeDIV").empty();jQuery("#QRCodeDIV").qrcode({width:150,height:150,text:a.QPublish.webPublishHref});var g=$("#codeImge"),e=document.getElementsByTagName("canvas");console.log(e);e.getContext&&e.getContext("2d").drawImage(g,50,50,100,100)}}else a.QPublish.webLinkDIV="hide";c.SavePublishSetArgs.AnonymousFlag=a.QPublish.AnonymousFlag=b.collChannel[0].AnonymousFlag;if(2==b.collChannel.length)for(g=0;g<b.collChannel.length;g++)""!=b.collChannel[g].Attribute2&&null!=b.collChannel[g].Attribute2&&(a.QPublish.isFocusCss="Y"==b.collChannel[g].Attribute1?!0:!1,c.SavePublishSetArgs.isFocusFlag=b.collChannel[g].Attribute1,"Y"==b.collChannel[g].Attribute2?(a.QPublish.collectCss=!0,$("#weichat-name").removeAttr("readonly"),$("#weichat-id").removeAttr("readonly"),$("#weichat-app-id").removeAttr("readonly"),$("#weichat-app-secret").removeAttr("readonly"),$("#weichat-name").removeClass("disabled"),$("#weichat-id").removeClass("disabled"),$("#weichat-app-id").removeClass("disabled"),$("#weichat-app-secret").removeClass("disabled")):(a.QPublish.collectCss=!1,$("#weichat-name").attr("readonly","true"),$("#weichat-id").attr("readonly","true"),$("#weichat-app-id").attr("readonly","true"),$("#weichat-app-secret").attr("readonly","true"),$("#weichat-name").addClass("disabled"),$("#weichat-id").addClass("disabled"),$("#weichat-app-id").addClass("disabled"),$("#weichat-app-secret").addClass("disabled")),c.SavePublishSetArgs.collectFlag=b.collChannel[g].Attribute2,""!=b.collChannel[g].Attribute3&&null!=b.collChannel[g].Attribute3&&(c.SavePublishSetArgs.WeChatName=a.QPublish.WeChatName=b.collChannel[g].Attribute3,c.SavePublishSetArgs.microLetterChannel="Y"),""!=b.collChannel[g].Attribute4&&null!=b.collChannel[g].Attribute4&&(c.SavePublishSetArgs.WeChatNameAppID=a.QPublish.WeChatNameAppID=b.collChannel[g].Attribute4),""!=b.collChannel[g].Attribute5&&null!=b.collChannel[g].Attribute5&&(c.SavePublishSetArgs.WeChatNameId=a.QPublish.WeChatNameId=b.collChannel[g].Attribute5),""!=b.collChannel[g].Attribute6&&null!=b.collChannel[g].Attribute6&&(c.SavePublishSetArgs.WeChatAppSecret=a.QPublish.WeChatAppSecret=b.collChannel[g].Attribute6),""!=b.collChannel[g].Attribute7&&null!=b.collChannel[g].Attribute7&&(c.SavePublishSetArgs.WeichatOauth=a.QPublish.WeichatOauth=b.collChannel[g].Attribute7));else c.SavePublishSetArgs.collectFlag="N",$("#weichat-name").attr("readonly","true"),$("#weichat-id").attr("readonly","true"),$("#weichat-app-id").attr("readonly","true"),$("#weichat-app-secret").attr("readonly","true"),$("#weichat-name").addClass("disabled"),$("#weichat-id").addClass("disabled"),$("#weichat-app-id").addClass("disabled"),$("#weichat-app-secret").addClass("disabled"),c.SavePublishSetArgs.WeChatName=a.QPublish.WeChatName="",c.SavePublishSetArgs.WeChatNameAppID=a.QPublish.WeChatNameAppID="",c.SavePublishSetArgs.WeChatNameId=a.QPublish.WeChatNameId="",c.SavePublishSetArgs.WeChatAppSecret=a.QPublish.WeChatAppSecret="",c.SavePublishSetArgs.WeichatOauth=a.QPublish.WeichatOauth="",a.WeChatForm.$setPristine()}else a.QPublish.publishSetFlag=!0,a.QPublish.webLinkDIV="hide",c.SavePublishSetArgs.publishCount=a.QPublish.publishCount=100,a.QPublish.publishCountFlag=!0,a.QPublish.QuotaName="\u9009\u62e9\u914d\u989d",a.QPublish.QuotaID="",a.QPublish.auotaSetFlag=!1,c.SavePublishSetArgs.PublishDays=a.QPublish.PublishDays=30,a.QPublish.NoTimeLimit=!1,a.QPublish.PublishDaysFlag=!0,c.SavePublishSetArgs.PublishType=1,a.QPublish.ReleaseType="Direct",$("#PlanTime").addClass("w-input input disabled"),a.QPublish.PlansRelease=!1,a.QPublish.TerLimitReply="TerLimitATime",c.SavePublishSetArgs.TerLimitFlag="Y",c.SavePublishSetArgs.NextTopicFlag=a.QPublish.NextTopicFlag="Y",a.QPublish.NextTopic=!0,c.SavePublishSetArgs.AnonymousFlag=a.QPublish.AnonymousFlag="N",a.QPublish.Anonymous=!1,a.QPublish.collectCss=!1,c.SavePublishSetArgs.collectFlag="N",$("#weichat-name").attr("readonly","true"),$("#weichat-id").attr("readonly","true"),$("#weichat-app-id").attr("readonly","true"),$("#weichat-app-secret").attr("readonly","true"),$("#weichat-name").addClass("disabled"),$("#weichat-id").addClass("disabled"),$("#weichat-app-id").addClass("disabled"),$("#weichat-app-secret").addClass("disabled"),c.SavePublishSetArgs.WeChatName=a.QPublish.WeChatName="",c.SavePublishSetArgs.WeChatNameAppID=a.QPublish.WeChatNameAppID="",c.SavePublishSetArgs.WeChatNameId=a.QPublish.WeChatNameId="",c.SavePublishSetArgs.WeChatAppSecret=a.QPublish.WeChatAppSecret="",c.SavePublishSetArgs.WeichatOauth=a.QPublish.WeichatOauth="",a.WeChatForm.$setPristine(),a.QPublish.isFocusCss=!1,c.SavePublishSetArgs.isFocusFlag="N";else alert(b);0!=h&&loadingEnd()})};a.InitPublishData();a.authority=function(b){if("disable"==a.QPublish.DisableAll)return!1;if(""==b)return!0;if("saveSetFlag"==b)return a.QPublish.saveSetFlag;if("publishFlag"==b)return a.QPublish.publishFlag;if("cancelFlag"==b)return a.QPublish.cancelFlag;if("downFlag"==b)return a.QPublish.downFlag;if("otherFlag1"==b)return a.QPublish.otherFlag1;if("otherFlag2"==b)return a.QPublish.otherFlag2};a.publishNumChange=function(b){if(a.authority("")&&a.QPublish.publishCountFlag){b=parseInt(b)+parseInt(a.QPublish.publishCount);if(1>b||99999999<b)b=a.QPublish.publishCount;a.QPublish.publishCount=b;c.SavePublishSetArgs.QuotaID=a.QPublish.QuotaID="";a.QPublish.QuotaName="\u9009\u62e9\u914d\u989d";a.QPublish.publishSetFlag=!0;c.QuesInfoData.publishStateFlag=!0;c.SavePublishSetArgs.publishCount=a.QPublish.publishCount}};a.auotaChange=function(b){""==b?(a.QPublish.QuotaName="\u9009\u62e9\u914d\u989d",a.QPublish.QuotaID="",a.QPublish.publishCountFlag=!0,a.QPublish.publishCount=100,a.QPublish.publishSetFlag=!0,c.QuesInfoData.publishStateFlag=!0):(b.QuotaTableID!=a.QPublish.QuotaID&&(a.QPublish.QuotaName=b.QuotaTableName,a.QPublish.QuotaID=b.QuotaTableID,a.QPublish.publishCount=b.QuotaNum,a.QPublish.publishSetFlag=!0,c.QuesInfoData.publishStateFlag=!0),a.QPublish.publishCountFlag=!1);c.SavePublishSetArgs.publishCount=a.QPublish.publishCount;c.SavePublishSetArgs.QuotaID=a.QPublish.QuotaID};a.PublishDaysChange=function(b){if(a.authority("")&&a.QPublish.PublishDaysFlag){b=parseInt(b)+parseInt(a.QPublish.PublishDays);if(1>b||999<b)b=a.QPublish.PublishDays;a.QPublish.PublishDays=b;a.QPublish.NoTimeLimit=!1;a.QPublish.publishSetFlag=!0;c.QuesInfoData.publishStateFlag=!0;c.SavePublishSetArgs.PublishDays=a.QPublish.PublishDays}};a.NoTimeLimitSelect=function(){a.authority("otherFlag1")?(a.QPublish.NoTimeLimit=!a.QPublish.NoTimeLimit,a.QPublish.NoTimeLimit?(a.QPublish.PublishDays="",a.QPublish.PublishDaysFlag=!1,$("#PublishDays").addClass("w-input input disabled")):(a.QPublish.PublishDays=30,a.QPublish.PublishDaysFlag=!0,$("#PublishDays").removeClass("w-input input disabled")),a.QPublish.publishSetFlag=!0,c.QuesInfoData.publishStateFlag=!0,c.SavePublishSetArgs.PublishDays=a.QPublish.PublishDays):$("#PublishDays").addClass("w-input input disabled")};a.ReleaseSelect=function(b){if("Direct"==b)a.authority("otherFlag1")&&(a.QPublish.ReleaseType="Direct",$("#PlanTime").html(""),$("#PlanTime").addClass("w-input input disabled"),c.SavePublishSetArgs.PublishType=1,a.QPublish.publishSetFlag=!0,c.QuesInfoData.publishStateFlag=!0);else if(a.authority("otherFlag2")){a.QPublish.ReleaseType="Plans";b=new Date;var e="",e=b.getFullYear()+"-",e=e+(b.getMonth()+1)+"- ",e=e+b.getDate()+" ",e=e+b.getHours()+":",e=e+b.getMinutes();$("#PlanTime").html(e);$("#PlanTime").removeClass("w-input input disabled");c.SavePublishSetArgs.PlanTime=e;c.SavePublishSetArgs.PublishType=2;a.QPublish.publishSetFlag=!0;c.QuesInfoData.publishStateFlag=!0}};a.Calendar=function(){a.authority("")&&"Plans"==a.QPublish.ReleaseType&&($(".ui-datepicker").removeClass("none"),$("#LoadCalendar").datetimepicker({minDate:new Date,onSelect:function(b,e){$("#PlanTime").html("");$("#PlanTime").html(b);a.QPublish.publishSetFlag=!0;c.QuesInfoData.publishStateFlag=!0;c.SavePublishSetArgs.PlanTime=b}}))};a.TerLimitSelect=function(b){a.authority("")&&("TerLimitATime"==b?(a.QPublish.TerLimitReply="TerLimitATime",c.SavePublishSetArgs.TerLimitFlag="Y",a.QPublish.publishSetFlag=!0,c.QuesInfoData.publishStateFlag=!0):"TerLimitManyTimes"==b&&(a.QPublish.TerLimitReply="TerLimitManyTimes",c.SavePublishSetArgs.TerLimitFlag="N",a.QPublish.publishSetFlag=!0,c.QuesInfoData.publishStateFlag=!0))};a.NextTopicSelect=function(){a.authority("otherFlag2")&&(a.QPublish.NextTopic=!a.QPublish.NextTopic,a.QPublish.NextTopicFlag=a.QPublish.NextTopic?"Y":"N",a.QPublish.publishSetFlag=!0,c.QuesInfoData.publishStateFlag=!0,c.SavePublishSetArgs.NextTopicFlag=a.QPublish.NextTopicFlag)};a.AnonymousFlagSelect=function(){a.authority("")&&(a.QPublish.Anonymous=!a.QPublish.Anonymous,a.QPublish.AnonymousFlag=a.QPublish.Anonymous?"Y":"N",a.QPublish.publishSetFlag=!0,c.QuesInfoData.publishStateFlag=!0,c.SavePublishSetArgs.AnonymousFlag=a.QPublish.AnonymousFlag)};a.CollectSelect=function(){a.authority("")&&(a.QPublish.collectCss=!a.QPublish.collectCss,a.QPublish.collectCss?(c.SavePublishSetArgs.collectFlag="Y",$("#weichat-name").removeAttr("readonly"),$("#weichat-id").removeAttr("readonly"),$("#weichat-app-id").removeAttr("readonly"),$("#weichat-app-secret").removeAttr("readonly"),$("#weichat-name").removeClass("disabled"),$("#weichat-id").removeClass("disabled"),$("#weichat-app-id").removeClass("disabled"),$("#weichat-app-secret").removeClass("disabled"),c.SavePublishSetArgs.microLetterChannel="Y"):(c.SavePublishSetArgs.collectFlag="N",$("#weichat-name").attr("readonly","true"),$("#weichat-id").attr("readonly","true"),$("#weichat-app-id").attr("readonly","true"),$("#weichat-app-secret").attr("readonly","true"),$("#weichat-name").addClass("disabled"),$("#weichat-id").addClass("disabled"),$("#weichat-app-id").addClass("disabled"),$("#weichat-app-secret").addClass("disabled")))};a.QuesSetWebChatBtnChange=function(b,e){b&&e?(a.QPublish.WeChatBtnFlag=!0,a.QPublish.publishSetFlag=!0,c.QuesInfoData.publishStateFlag=!0,c.SavePublishSetArgs.WeChatName=a.QPublish.WeChatName,c.SavePublishSetArgs.WeChatNameId=a.QPublish.WeChatNameId,c.SavePublishSetArgs.WeChatNameAppID=a.QPublish.WeChatNameAppID,c.SavePublishSetArgs.WeChatAppSecret=a.QPublish.WeChatAppSecret):a.QPublish.WeChatBtnFlag=!1};a.QuesSetWebChatOauthBtn=function(){a.QPublish.WeichatOauthBtnFlag&&(a.QPublish.CollDown=2,$("#weichatURl").empty(),jQuery("#weichatURl").qrcode({width:200,height:150,text:c.SavePublishSetArgs.RedirectUri}))};a.WeiChatVerify=function(){a.QPublish.WeChatBtnFlag&&(loadingStart(),b.post("/WeChat/WeCharValidation",{appid:a.QPublish.WeChatNameAppID,secret:a.QPublish.WeChatAppSecret}).success(function(b){""==b.errorMessage?(console.log(b.redirect_uri),alert("\u9a8c\u8bc1\u6210\u529f\uff01"),c.SavePublishSetArgs.RedirectUri=b.redirect_uri,c.SavePublishSetArgs.WeichatOauth=a.QPublish.WeichatOauth=b.Oauth,a.QPublish.WeichatOauthBtnFlag=!0,a.QPublish.WeChatBtnFlag=!1):alert(b.errorMessage);loadingEnd()}))};a.SavePublishSet=function(){a.authority("")&&a.QPublish.publishSetFlag&&(console.log(c.SavePublishSetArgs),loadingStart(),b.post("/QM/SavePublishInfo",{quesID:c.QuesInfoData.qid,auotaID:c.SavePublishSetArgs.QuotaID,publishCount:c.SavePublishSetArgs.publishCount,startDate:c.SavePublishSetArgs.PlanTime,publishDays:c.SavePublishSetArgs.PublishDays,publishType:c.SavePublishSetArgs.PublishType,terLinmitFlag:c.SavePublishSetArgs.TerLimitFlag,anonymousFalg:c.SavePublishSetArgs.AnonymousFlag,returnPreFlag:c.SavePublishSetArgs.NextTopicFlag,microLetterChannel:c.SavePublishSetArgs.microLetterChannel,microServiceName:c.SavePublishSetArgs.WeChatName,appID:c.SavePublishSetArgs.WeChatNameAppID,microNum:c.SavePublishSetArgs.WeChatNameId,appSecrt:c.SavePublishSetArgs.WeChatAppSecret,oauth:c.SavePublishSetArgs.WeichatOauth,isFocus:c.SavePublishSetArgs.isFocusFlag,collect:c.SavePublishSetArgs.collectFlag,btnType:""}).success(function(b){console.log("\u53d1\u5e03\u8bbe\u7f6e\u63d0\u4ea4");console.log(b);""==b.errorMessage?(alert(Prompt.SaveOK),a.InitPublishData(),a.QPublish.publishSetFlag=!1,c.QuesInfoData.publishStateFlag=!1):alert(b.errorMessage);loadingEnd()}))};a.Publish=function(){a.authority("")&&a.QPublish.publishDisable&&(0==c.SavePublishSetArgs.publishCount?alert("\u95ee\u5377\u53d1\u884c\u6570\u4e3a0\uff0c\u4e0d\u5141\u8bb8\u53d1\u5e03\uff01"):confirm("\u662f\u5426\u786e\u8ba4\u53d1\u5e03\u6b64\u6536\u96c6\u5668\uff1f",function(){loadingStart();b.post("/QM/SavePublishInfo",{quesID:c.QuesInfoData.qid,auotaID:c.SavePublishSetArgs.QuotaID,publishCount:c.SavePublishSetArgs.publishCount,startDate:c.SavePublishSetArgs.PlanTime,publishDays:c.SavePublishSetArgs.PublishDays,publishType:c.SavePublishSetArgs.PublishType,terLinmitFlag:c.SavePublishSetArgs.TerLimitFlag,anonymousFalg:c.SavePublishSetArgs.AnonymousFlag,returnPreFlag:c.SavePublishSetArgs.NextTopicFlag,microLetterChannel:c.SavePublishSetArgs.microLetterChannel,microServiceName:c.SavePublishSetArgs.WeChatName,appID:c.SavePublishSetArgs.WeChatNameAppID,microNum:c.SavePublishSetArgs.WeChatNameId,appSecrt:c.SavePublishSetArgs.WeChatAppSecret,oauth:c.SavePublishSetArgs.WeichatOauth,isFocus:c.SavePublishSetArgs.isFocusFlag,collect:c.SavePublishSetArgs.collectFlag,btnType:"publish"}).success(function(b){console.log("\u53d1\u5e03");console.log(b);""==b.errorMessage?(alert(Prompt.ReleaseOK),a.QPublish.publishSetFlag=!1,c.QuesInfoData.publishStateFlag=!1,a.LoadingIsEnd,a.InitPublishData(a.LoadingIsEnd)):alert(b.errorMessage);loadingEnd()})},function(){},"\u53d1 \u5e03","\u53d1\u5e03\u6536\u96c6\u5668"))};a.CanclePublish=function(){confirm("\u53d6\u6d88\u540e\u95ee\u5377\u6536\u96c6\u5668\u5c06\u6062\u590d\u4e3a\u672a\u53d1\u5e03\u72b6\u6001\uff0c\u8bf7\u786e\u8ba4\u662f\u5426\u53d6\u6d88\u53d1\u5e03\u5f53\u524d\u6536\u96c6\u5668\uff1f",function(){loadingStart();b.post("/QM/CanclePublish",{quesID:c.QuesInfoData.qid}).success(function(b){""==b&&(alert(Prompt.CancelPublishOK),a.LoadingIsEnd=0,a.InitPublishData(a.LoadingIsEnd),loadingEnd())})},function(){},"\u786e  \u5b9a","\u53d6\u6d88\u53d1\u5e03\u6b64\u6536\u96c6\u5668")};a.QPublish.CollDown=0;a.DownClick=function(){a.QPublish.CollDown=1;$("body").addClass("srcollHide")};a.Down=function(){""==$("#reason").val()?alert(Prompt.InputOfflineReason):(loadingStart(),b.post("/QM/Down",{quesID:c.QuesInfoData.qid,reason:$("#reason").val()}).success(function(b){""==b&&(alert(Prompt.DownAuditSubmit),a.QPublish.CollDown=0,a.LoadingIsEnd=0,a.InitPublishData(a.LoadingIsEnd),loadingEnd())}))};a.cancelClose=function(){a.QPublish.CollDown=0;$("body").removeClass("srcollHide")}}function CloseDIV(){$(".ui-datepicker").addClass("none")}function GroupInfo(){this.Name="";this.IsSet=!1;this.SetOpacity={opacity:0.5};this.SortNo=0;this.Nodes=[];this.Type=0;this.Open={display:"none"}}function InputValue(){this.ID="";this.Value=this.SortNo=0}function OptionValue(){this.ID="";this.NumValue=0}var InValue=[],OptionList=[],allquota=0,SaveQuotaFlag=!1;zyApp.controller("QuotaCtrl",["$scope","$stateParams","$http","$location","QuesEidtData","$timeout","Unify","QuesQuotaInfo","QQuesSet",function(a,e,b,c,k,h,l,g,m){GoHtmlTop();a.IsDemo=$("#hiddendemotype").val();a.QuesQuotaInfo=g;a.QuesQuotaInfo.Popupbackground=0;a.InitTabCss=function(){var b=window.location.href;0<=b.indexOf("/QMSet/Publish/")?a.QQuesSet.QMSetAction="Publish":0<=b.indexOf("/QMSet/Summary/")?a.QQuesSet.QMSetAction="Summary":0<=b.indexOf("/QMSet/Quota/")?a.QQuesSet.QMSetAction="Quota":0<=b.indexOf("/QMSet/AnalyzeResults/")?a.QQuesSet.QMSetAction="AnalyzeResults":0<=b.indexOf("/QMSet/Backups/")&&(a.QQuesSet.QMSetAction="Backups")};a.InitTabCss();a.Init=function(){loadingStart();b.post("/QM/VerifyRight",{quesID:e.qid}).success(function(f){"NoRight"==f?(loadingEnd(),location.href="/Error/Error?type\x3ddashboard"):(a.Unify=l,a.Unify.QuesChange(e.qid),a.QQuesSet=m,a.QQuesSet.QMSetAction="Quota",k.QuesInfoData.qid=e.qid,a.QuesQuotaInfo.ShowRow=!1,a.QuesQuotaInfo.ShowCel=!1,a.QuesQuotaInfo.ShowTable=!1,a.QuesQuotaInfo.ShowCreateTableBtn=!1,a.QuesQuotaInfo.RowGroup=[],a.QuesQuotaInfo.CelGroup=[],a.QuesQuotaInfo.RowGroupNum=0,InValue=[],SaveQuotaFlag=!1,OptionList=[],allquota=0,b.get("/QM/GetQDNodeIdentifyflagByQuesID",{params:{quesID:k.QuesInfoData.qid}}).success(function(b,f,c,g){loadingEnd();a.QuesQuotaInfo.SourceNodes=b.NodeList;a.QuesQuotaInfo.QuotaTableID=b.LoadList.QuotaTableID;c=!1;if(b.LoadList.IsChangeQuota&&1==b.LoadList.ChangeType)alert(Prompt.ResetQuotaInfo,"red");else{if(0<b.LoadList.Row1list.length)for(a.AddRowGroup(b.LoadList.Row1Name),f=0;f<b.LoadList.Row1list.length;f++){a.AddSelect(a.QuesQuotaInfo.RowGroup[0],3);a.QuesQuotaInfo.RowGroup[0].Nodes[f].SelectID=b.LoadList.Row1list[f];for(c=0;c<b.NodeList.Nodes.length;c++)if(b.LoadList.Row1list[f]==b.NodeList.Nodes[c].NodeID){a.QuesQuotaInfo.RowGroup[0].Nodes[f].SelectName=b.NodeList.Nodes[c].Title;break}c=!0}if(0<b.LoadList.Row2list.length)for(a.AddRowGroup(b.LoadList.Row2Name),f=0;f<b.LoadList.Row2list.length;f++){a.AddSelect(a.QuesQuotaInfo.RowGroup[1],3);a.QuesQuotaInfo.RowGroup[1].Nodes[f].SelectID=b.LoadList.Row2list[f];for(c=0;c<b.NodeList.Nodes.length;c++)if(b.LoadList.Row2list[f]==b.NodeList.Nodes[c].NodeID){a.QuesQuotaInfo.RowGroup[1].Nodes[f].SelectName=b.NodeList.Nodes[c].Title;break}c=!0}if(0<b.LoadList.Cellist.length)for(a.AddCelGroup(b.LoadList.CelName),f=0;f<b.LoadList.Cellist.length;f++){a.AddSelect(a.QuesQuotaInfo.CelGroup[0],2);a.QuesQuotaInfo.CelGroup[0].Nodes[f].SelectID=b.LoadList.Cellist[f];for(c=0;c<b.NodeList.Nodes.length;c++)if(b.LoadList.Cellist[f]==b.NodeList.Nodes[c].NodeID){a.QuesQuotaInfo.CelGroup[0].Nodes[f].SelectName=b.NodeList.Nodes[c].Title;break}c=!0}a.QuesQuotaInfo.ShowCreateTableBtn=!1;c&&(a.BindQuotaTable(),GetallNum())}}).error(function(b,f,c,g){loadingEnd();RestLogin(b,a)}))}).error(function(a,b,c,g){loadingEnd()})};a.Init();a.SetDivShow=function(){a.QuesQuotaInfo.IsShowSidebar?(a.QuesQuotaInfo.IsShowSidebar=!1,a.QuesQuotaInfo.ShowSet="\u663e\u793a\u8bbe\u7f6e",a.QuesQuotaInfo.GridWidth={width:"100%"}):(a.QuesQuotaInfo.IsShowSidebar=!0,a.QuesQuotaInfo.ShowSet="\u9690\u85cf\u8bbe\u7f6e",a.QuesQuotaInfo.GridWidth={width:"75%"});h(function(){a.ChangeTableSize($("#div-quota-input-parent").width())},100)};a.DelQuotaTable=function(){confirm(Prompt.IsDeleteCurrQuota,function(){b.post("/QM/DelQuotaInfo",{quesid:k.QuesInfoData.qid,quotaTableID:a.QuesQuotaInfo.QuotaTableID}).success(function(b){b.IsTrue?(a.Init(),$("#QuesQuotaDisabled").attr("disabled","disabled"),SaveQuotaFlag=!1,$("#minimize").click()):alert(b.mmessage,"red")}).error(function(b,d,c,g){loadingEnd();RestLogin(b,a)});a.$digest()})};a.AddRowGroup=function(b){if(2>a.QuesQuotaInfo.RowGroup.length){var d=new GroupInfo;d.Name=""!=b?b:"\u914d\u989d\u7ec4"+(a.QuesQuotaInfo.RowGroupNum+1);a.QuesQuotaInfo.RowGroupNum+=1;d.Nodes=[];a.QuesQuotaInfo.RowGroup.push(d);a.QuesQuotaInfo.ShowRow=!0;for(b=0;b<a.QuesQuotaInfo.RowGroup.length;b++)a.QuesQuotaInfo.RowGroup[b].SortNo=b,a.QuesQuotaInfo.RowGroup[b].Type=b+1}else alert(Prompt.MaxQuotaGroup,"red");h(function(){isTouchDevice()},100)};a.AddCelGroup=function(b){if(1>a.QuesQuotaInfo.CelGroup.length){var d=new GroupInfo;d.Name=""!=b?b:"\u914d\u989d\u7ec4";d.Nodes=[];d.Type=3;a.QuesQuotaInfo.CelGroup.push(d);a.QuesQuotaInfo.ShowCel=!0}h(function(){isTouchDevice()},100)};a.DelGroup=function(b,d){confirm(Prompt.IsDeleteQuotaGroup,function(){0<b.Nodes.length&&(a.QuesQuotaInfo.ShowCreateTableBtn=!0);if(0==d){a.QuesQuotaInfo.RowGroup.splice(b.SortNo,1);0==a.QuesQuotaInfo.RowGroup.length&&(a.QuesQuotaInfo.ShowRow=!1);for(var c=0;c<a.QuesQuotaInfo.RowGroup.length;c++)a.QuesQuotaInfo.RowGroup[c].SortNo=c,a.QuesQuotaInfo.RowGroup[c].Type=c+1}else a.QuesQuotaInfo.CelGroup.splice(0,1),a.QuesQuotaInfo.ShowCel=!1;a.$digest()},function(){},"\u662f","","\u5426")};a.AddSelect=function(b,d){if(0==a.QuesQuotaInfo.SourceNodes.Nodes.length)alert(Prompt.CantSetQuota,"red");else{var c=angular.copy(a.QuesQuotaInfo.SourceNodes);if(b.Nodes.length>=d)alert("\u95ee\u5377"+b.Name+"\u6700\u591a\u53ea\u80fd\u8bbe\u7f6e"+d+"\u7ec4\u6761\u4ef6\u3002","red");else{b.Nodes.push(c);for(c=0;c<b.Nodes.length;c++)b.Nodes[c].SortNo=c;a.QuesQuotaInfo.ShowCreateTableBtn=!0;h(function(){isTouchDevice()},100)}}};a.OpenSelect=function(a){a.Open="none"==a.Open.display?{display:"block"}:{display:"none"}};a.SelectNode=function(b,d,c){b.SelectID=c;b.SelectName=d;b.visibility={visibility:"hidden"};b.Opacity={Opacity:0.5};a.QuesQuotaInfo.ShowCreateTableBtn=!0};a.DelSelect=function(b,d){confirm(Prompt.DeleteQuotaLine,function(){a.QuesQuotaInfo.ShowCreateTableBtn=!0;d.splice(b,1);a.$parent.$digest()},function(){},"\u662f","","\u5426")};a.ShowPopup=function(a){a.stopPropagation()};a.CloseDiv=function(){$("body").removeClass("srcollHide");a.QuesQuotaInfo.Popupbackground=0};a.OpenEditName=function(b){$("body").addClass("srcollHide");a.QuesQuotaInfo.Popupbackground=1;a.QuesQuotaInfo.SelectGroup=b;a.QuesQuotaInfo.SelectChangeName=b.Name};a.EditQuotaName=function(f){f&&b.post("/QM/EditQuotaSetupName",{type:a.QuesQuotaInfo.SelectGroup.Type,name:a.QuesQuotaInfo.SelectChangeName,quotaTableID:a.QuesQuotaInfo.QuotaTableID}).success(function(b){b.IsTrue&&(a.CloseDiv(),alert(Prompt.QuotaSuccessfulOperation,"green"),a.QuesQuotaInfo.SelectGroup.Name=a.QuesQuotaInfo.SelectChangeName,a.ChangeTableSize($("#div-quota-input-parent").width()))})};a.CreateTable=function(){if(0==a.QuesQuotaInfo.RowGroup.length)alert(Prompt.PleaseSetQuotaRow,"red");else if(0==a.QuesQuotaInfo.RowGroup[0].Nodes.length)alert("\u8bf7\u5148\u8bbe\u7f6e"+a.QuesQuotaInfo.RowGroup[0].Name+"\u3002","red");else{a.QuesQuotaInfo.StrRow1Nodes="";a.QuesQuotaInfo.StrRow2Nodes="";a.QuesQuotaInfo.StrCelNodes="";var f=!1;if(0<a.QuesQuotaInfo.RowGroup.length){for(var d=0;d<a.QuesQuotaInfo.RowGroup[0].Nodes.length;d++){if(0<a.QuesQuotaInfo.StrRow1Nodes.indexOf(a.QuesQuotaInfo.RowGroup[0].Nodes[d].SelectID)){alert(Prompt.QuotaCantRepeat,"red");return}a.QuesQuotaInfo.StrRow1Nodes+=","+a.QuesQuotaInfo.RowGroup[0].Nodes[d].SelectID}a.QuesQuotaInfo.Row1Name=a.QuesQuotaInfo.RowGroup[0].Name}if(1<a.QuesQuotaInfo.RowGroup.length){for(d=0;d<a.QuesQuotaInfo.RowGroup[1].Nodes.length;d++){if(0<a.QuesQuotaInfo.StrRow2Nodes.indexOf(a.QuesQuotaInfo.RowGroup[1].Nodes[d].SelectID)){alert(Prompt.QuotaCantRepeat,"red");return}a.QuesQuotaInfo.StrRow2Nodes+=","+a.QuesQuotaInfo.RowGroup[1].Nodes[d].SelectID;f=!0}a.QuesQuotaInfo.Row2Name=a.QuesQuotaInfo.RowGroup[1].Name}if(0<a.QuesQuotaInfo.CelGroup.length){for(d=0;d<a.QuesQuotaInfo.CelGroup[0].Nodes.length;d++){if(0<a.QuesQuotaInfo.StrCelNodes.indexOf(a.QuesQuotaInfo.CelGroup[0].Nodes[d].SelectID)){alert(Prompt.QuotaCantRepeat,"red");return}a.QuesQuotaInfo.StrCelNodes+=","+a.QuesQuotaInfo.CelGroup[0].Nodes[d].SelectID}a.QuesQuotaInfo.CelName=a.QuesQuotaInfo.CelGroup[0].Name}var c=!0;if(f&&a.QuesQuotaInfo.RowGroup[0].Nodes.length==a.QuesQuotaInfo.RowGroup[1].Nodes.length&&0<a.QuesQuotaInfo.RowGroup[0].Nodes.length){for(d=0;d<a.QuesQuotaInfo.RowGroup[0].Nodes.length;d++)0>a.QuesQuotaInfo.StrRow2Nodes.indexOf(a.QuesQuotaInfo.RowGroup[0].Nodes[d].SelectID)&&(c=!1);if(c){alert(Prompt.AutoLineCantSame,"red");return}}c=!1;if(0<a.QuesQuotaInfo.CelGroup.length&&0<a.QuesQuotaInfo.CelGroup[0].Nodes.length&&0<a.QuesQuotaInfo.RowGroup[0].Nodes.length){for(d=0;d<a.QuesQuotaInfo.RowGroup[0].Nodes.length;d++)0<a.QuesQuotaInfo.StrCelNodes.indexOf(a.QuesQuotaInfo.RowGroup[0].Nodes[d].SelectID)&&(c=!0);if(c){alert(Prompt.AutoLine1AndColumnCantSame,"red");return}}c=!1;if(f&&0<a.QuesQuotaInfo.CelGroup.length&&0<a.QuesQuotaInfo.CelGroup[0].Nodes.length&&0<a.QuesQuotaInfo.RowGroup[1].Nodes.length){for(d=0;d<a.QuesQuotaInfo.RowGroup[1].Nodes.length;d++)0<a.QuesQuotaInfo.StrCelNodes.indexOf(a.QuesQuotaInfo.RowGroup[1].Nodes[d].SelectID)&&(c=!0);if(c){alert(Prompt.AutoLine2AndColumnCantSame,"red");return}}loadingStart();b.get("/QM/IsCanSaveQDQuotaSetupManager",{params:{questionnairID:k.QuesInfoData.qid,quotaTableID:a.QuesQuotaInfo.QuotaTableID}}).success(function(b,d,f,c){a.LoadingIsEnd=0;b.IsTrue?b.Isconfirm?confirm(Prompt.IsRebuild,function(){a.SaveQDQSM(a.LoadingIsEnd);a.$parent.$digest()},function(){},"\u662f","","\u5426"):a.SaveQDQSM(a.LoadingIsEnd):alert(b.message,"red");loadingEnd()}).error(function(b,d,f,c){loadingEnd();RestLogin(b,a)})}};a.SaveQDQSM=function(f){0!=f&&loadingsStart();b.post("/QM/SaveQDQuotaSetupManager",{trrow1value:a.QuesQuotaInfo.StrRow1Nodes,trrow2value:a.QuesQuotaInfo.StrRow2Nodes,trcelvalue:a.QuesQuotaInfo.StrCelNodes,questionnairID:k.QuesInfoData.qid,quotaTableID:a.QuesQuotaInfo.QuotaTableID,row1name:a.QuesQuotaInfo.Row1Name,row2name:a.QuesQuotaInfo.Row2Name,celname:a.QuesQuotaInfo.CelName}).success(function(b){b.IsTrue?(a.QuesQuotaInfo.ShowCreateTableBtn=!1,a.QuesQuotaInfo.QuotaTableID=b.QuotaTableID,InValue=[],SaveQuotaFlag=!1,a.BindQuotaTable(f),alert(Prompt.CreateSuccess,"green")):alert(b.message,"red");0!=f&&loadingsEnd()}).error(function(b,f,c,g){loadingsEnd();RestLogin(b,a)})};a.BindQuotaTable=function(f){OptionList=[];0!=f&&loadingStart();a.QuesQuotaInfo.ShowTable=!0;b.get("/QM/GetQuestionnairQuotaTableInfo",{params:{questionnairID:k.QuesInfoData.qid,quotaTableID:a.QuesQuotaInfo.QuotaTableID}}).success(function(b,c,g,e){a.QuesQuotaInfo.TableData=b;a.QuesQuotaInfo.TableInfoHtml=b.TableInfo;a.QuesQuotaInfo.RowNum=b.RowNum;a.QuesQuotaInfo.CelNum=b.CelNum;OptionList=b.OptionList;$("#IsChange").val("0");2==a.QuesQuotaInfo.RowGroup.length&&0<a.QuesQuotaInfo.RowGroup[1].Nodes.length?$("#IsexisRow2").val("1"):$("#IsexisRow2").val("0");InValue=[];SaveQuotaFlag=!1;for(c=0;c<b.InputValue.length;c++)g=new InputValue,g.ID=b.InputValue[c].ID,g.Value=b.InputValue[c].Value,InValue.push(g);for(c=0;c<InValue.length;c++)InValue[c].SortNo=c;a.ChangeTableSize($("#div-quota-input-parent").width());0!=f&&loadingEnd()}).error(function(a,b,f,c){loadingEnd()})};a.SaveQuota=function(){if(2==a.QuesQuotaInfo.RowGroup.length){for(var f=[],d=[],c=0;c<InValue.length;c++)for(var g=InValue[c].ID.split(","),e=(g[2]+g[3]).split("_"),g=0;g<e.length;g++)if(""!=e[g]){var h=!1;if(0==InValue[c].ID.indexOf("input_Num,1,")){for(var m=0;m<f.length;m++)f[m].ID==e[g]&&(f[m].NumValue=1*f[m].NumValue+1*InValue[c].Value,h=!0);h||(h=new OptionValue,h.ID=e[g],h.NumValue=1*InValue[c].Value,f.push(h))}else if(0==InValue[c].ID.indexOf("input_Num,2,")){for(m=0;m<d.length;m++)d[m].ID==e[g]&&(d[m].NumValue=1*d[m].NumValue+1*InValue[c].Value,h=!0);h||(h=new OptionValue,h.ID=e[g],h.NumValue=1*InValue[c].Value,d.push(h))}}for(c=0;c<OptionList.length;c++){for(g=h=e=0;g<f.length;g++)OptionList[c]==f[g].ID&&(e=f[g].NumValue);for(g=0;g<d.length;g++)OptionList[c]==d[g].ID&&(h=d[g].NumValue);if(e>h){alert(Prompt.QuotaCountMisMatching,"red");return}if(e<h){alert(Prompt.QuotaCountMisMatching,"red");return}}}if(-1<$("#spanQuotaNum").html().indexOf('color\x3d"red"'))alert(Prompt.Auto1AndAuto2NumInconsistent,"red");else if(1>1*allquota)alert(Prompt.QuesAutoNotBeLessThanOneHundred,"red");else{f=[];for(c=0;c<InValue.length;c++)0==InValue[c].ID.indexOf("input_Num,")&&"0"!=InValue[c].Value&&""!=InValue[c].Value&&isNumber(InValue[c].Value)&&f.push(InValue[c].ID+","+InValue[c].Value);loadingStart();b.post("/QM/SaveQuota",{quotavalue:f,trSetrow1value:a.QuesQuotaInfo.StrRow1Nodes,trSetrow2value:a.QuesQuotaInfo.StrRow2Nodes,trSetcelvalue:a.QuesQuotaInfo.StrCelNodes,questionnairID:k.QuesInfoData.qid,quotaTableID:a.QuesQuotaInfo.QuotaTableID}).success(function(a){a.IsTrue?(loadingEnd(),$("#QuesQuotaDisabled").attr("disabled","disabled"),SaveQuotaFlag=!1,alert(Prompt.QuotaSuccessfulOperation,"green")):(loadingEnd(),alert(a.message,"red"))})}};$(window).resize(function(){h(function(){a.ChangeTableSize($("#div-quota-input-parent").width())},500)});a.RestoreValue=function(){$("#div-quota-input").html(a.QuesQuotaInfo.TableInfoHtml);var b;if(document.all||document.getElementById)b=document.getElementsByTagName("td");for(var d=0;d<b.length;d++)0<a.QuesQuotaInfo.RowGroup.length&&("tdrow1"==b[d].id&&(b[d].innerHTML="\x3cnobr\x3e\x26nbsp;\x26nbsp;"+a.QuesQuotaInfo.RowGroup[0].Name+"\x3c/nobr\x3e"),1<a.QuesQuotaInfo.RowGroup.length&&"tdrow2"==b[d].id&&(b[d].innerHTML="\x3cnobr\x3e\x26nbsp;\x26nbsp;"+a.QuesQuotaInfo.RowGroup[1].Name+"\x3c/nobr\x3e"));for(d=0;d<InValue.length;d++)document.getElementById(InValue[d].ID).value=InValue[d].Value;GetallNum()};a.ChangeTableSize=function(b){var d=$("#div-quota-input-parent").width(),c=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;a.RestoreValue();a.QuesQuotaInfo.GridWidth=991<c?a.QuesQuotaInfo.IsShowSidebar?1200>c?{width:"70%"}:{width:"75%"}:{width:"100%"}:{width:"100%"};600<=b&&700>b&&(a.QuesQuotaInfo.HtmlMinSize=656,a.SetChangeTableSize(d,7));700<=b&&800>b&&(a.QuesQuotaInfo.HtmlMinSize=726,a.SetChangeTableSize(d,8));800<=b&&900>b&&(a.QuesQuotaInfo.HtmlMinSize=875,a.SetChangeTableSize(d,9));900<=b&&1100>b&&(a.QuesQuotaInfo.HtmlMinSize=938,a.SetChangeTableSize(d,10));1100<=b&&a.SetChangeTableSize(d,12)};a.SetChangeTableSize=function(b,d){if(a.QuesQuotaInfo.CelNum>d)if(30<a.QuesQuotaInfo.RowNum){for(var c=document.getElementsByTagName("input"),g=0;g<c.length&&c[g];g++)0==c[g].id.indexOf("input_Num,")&&(c[g].width="100px");SetTableRowCel(b,933,1)}else{$("#div-quota-input").css("height",$("#reportTable").height()+17+"px");c=document.getElementsByTagName("input");for(g=0;g<c.length&&c[g];g++)0==c[g].id.indexOf("input_Num,")&&(c[g].width="100px");SetTableRowCel(b,$("#reportTable").height()+17,1)}else $("#reportTable").css("width",b+"px"),30<a.QuesQuotaInfo.RowNum&&SetTableRowCel(b,933,1)};$("#maximize").click(function(){$("#minimize").css("display","block");$("#maximize").hide();$("#sidebar-quota").hide();$(".quota-grid-position").removeClass("quota-grid-position").addClass("quota-grid-position-maximize");a.ChangeTableSize($("#div-quota-input-parent").width())});$("#minimize").click(function(){$("#minimize").hide();$("#maximize").css("display","block");$("#sidebar-quota").css("display","block");$(".quota-grid-position-maximize").removeClass("quota-grid-position-maximize").addClass("quota-grid-position");a.ChangeTableSize($("#div-quota-input-parent").width())})}]);function sleep(a){for(var e=Date.now();Date.now()-e<=a;);}function SetTableRowCel(a,e,b){var c=$("#reportTable"),k=c.attr("id"),h=c.attr("freezeRowNum"),l=c.attr("freezeColumnNum");if("undefined"!=typeof h||"undefined"!=typeof l){freezeTable(c,h||0,l||0,a,e,b);var g=!1;$(window).resize(function(){g||(setTimeout(function(){adjustTableSize(k,a,e,b);g=!1},100),g=!0)})}}function ChangeText(a){SaveQuotaFlag=!0;$("#QuesQuotaDisabled").removeAttr("disabled");var e=a.value;""==e||isNumber(e)?($("#IsChange").val("1"),GetallNum()):a.value=""}function isNumber(a){return a&&/^\d+$/.test(a)?!0:!1}function GetallNum(){var a=0,e=0;InValue=[];for(var b=document.getElementsByTagName("input"),c=0;c<b.length;c++)if(0==b[c].id.indexOf("input_Num,")&&(0==b[c].id.indexOf("input_Num,1,")?""!=b[c].value&&(a+=parseInt(b[c].value)):0==b[c].id.indexOf("input_Num,2,")&&""!=b[c].value&&(e+=parseInt(b[c].value)),""!=b[c].value&&0!=1*b[c].value)){var k=new InputValue;k.ID=b[c].id;k.Value=b[c].value;InValue.push(k)}if("0"==$("#IsexisRow2").val())allquota=a,$("#spanQuotaNum").html('\x3cspan\x3e\u914d\u989d\u6536\u96c6\u6570\u5408\u8ba1\uff1a\x3c/span\x3e\x3cp\x3e\x3cfont color\x3d"#9b59b6"\x3e'+ChangeNumShow(a)+"\x3c/font\x3e\x3c/p\x3e");else if("1"==$("#IsexisRow2").val()){b=[];k=[];for(c=0;c<InValue.length;c++)for(var h=InValue[c].ID.split(","),l=(h[2]+h[3]).split("_"),h=0;h<l.length;h++)if(""!=l[h]){var g=!1;if(0==InValue[c].ID.indexOf("input_Num,1,")){for(var m=0;m<b.length;m++)b[m].ID==l[h]&&(b[m].NumValue=1*b[m].NumValue+1*InValue[c].Value,g=!0);g||(g=new OptionValue,g.ID=l[h],g.NumValue=1*InValue[c].Value,b.push(g))}else if(0==InValue[c].ID.indexOf("input_Num,2,")){for(m=0;m<k.length;m++)k[m].ID==l[h]&&(k[m].NumValue=1*k[m].NumValue+1*InValue[c].Value,g=!0);g||(g=new OptionValue,g.ID=l[h],g.NumValue=1*InValue[c].Value,k.push(g))}}for(var f=m=g=l="",c=0;c<OptionList.length;c++){for(var d=0,n=0,h=0;h<b.length;h++)OptionList[c]==b[h].ID&&(d=b[h].NumValue);for(h=0;h<k.length;h++)OptionList[c]==k[h].ID&&(n=k[h].NumValue);d>n?(m='\x3cfont color\x3d"red"\x3e',f="\x3c/font\x3e"):d<n&&(l='\x3cfont color\x3d"red"\x3e',g="\x3c/font\x3e")}a!=e?a>e?(allquota=a,$("#spanQuotaNum").html('\x3cspan\x3e\u914d\u989d\u6536\u96c6\u6570\u5408\u8ba1\uff1a\x3c/span\x3e\x3cp\x3e\x3cfont color\x3d"red"\x3e'+ChangeNumShow(a)+"\x3c/font\x3e\x3c/p\x3e  \x3cspan\x3e\uff08"+document.getElementById("tdrow1").innerHTML+"\u6536\u96c6\u6570\u5408\u8ba1\uff1a"+l+ChangeNumShow(a)+g+"    "+document.getElementById("tdrow2").innerHTML+"\u6536\u96c6\u6570\u5408\u8ba1\uff1a"+m+ChangeNumShow(e)+f+"\uff09\x3c/span\x3e")):(allquota=e,$("#spanQuotaNum").html('\x3cspan\x3e\u914d\u989d\u6536\u96c6\u6570\u5408\u8ba1\uff1a\x3c/span\x3e\x3cp\x3e\x3cfont color\x3d"red"\x3e'+ChangeNumShow(e)+"\x3c/font\x3e\x3c/p\x3e  \x3cspan\x3e\uff08"+document.getElementById("tdrow1").innerHTML+"\u6536\u96c6\u6570\u5408\u8ba1\uff1a"+l+ChangeNumShow(a)+g+"    "+document.getElementById("tdrow2").innerHTML+"\u6536\u96c6\u6570\u5408\u8ba1\uff1a"+m+ChangeNumShow(e)+f+"\uff09\x3c/span\x3e")):(allquota=a,$("#spanQuotaNum").html('\x3cspan\x3e\u914d\u989d\u6536\u96c6\u6570\u5408\u8ba1\uff1a\x3c/span\x3e\x3cp\x3e\x3cfont color\x3d"#9b59b6"\x3e'+ChangeNumShow(a)+"\x3c/font\x3e\x3c/p\x3e  \x3cspan\x3e\uff08"+document.getElementById("tdrow1").innerHTML+"\u6536\u96c6\u6570\u5408\u8ba1\uff1a"+l+ChangeNumShow(a)+g+"    "+document.getElementById("tdrow2").innerHTML+"\u6536\u96c6\u6570\u5408\u8ba1\uff1a"+m+ChangeNumShow(e)+f+"\uff09\x3c/span\x3e"))}}function freezeTable(a,e,b,c,k,h){"string"==typeof e&&(e=parseInt(e));"string"==typeof b&&(b=parseInt(b));var l;"string"==typeof a?(l=a,a=$("#"+l)):l=a.attr("id");var g=$("#"+l+"_tableLayout");0!=g.length?(g.before(a),g.empty()):(a.after("\x3cdiv id\x3d'"+l+"_tableLayout' style\x3d'overflow:hidden;height:"+k+"px; width:"+c+"px;'\x3e\x3c/div\x3e"),g=$("#"+l+"_tableLayout"));var m="";0<e&&0<b&&(m+='\x3cdiv id\x3d"'+l+'_tableFix" style\x3d"padding: 0px;"\x3e\x3c/div\x3e');0<e&&(m+='\x3cdiv id\x3d"'+l+'_tableHead" style\x3d"padding: 0px;"\x3e\x3c/div\x3e');0<b&&(m+='\x3cdiv id\x3d"'+l+'_tableColumn" style\x3d"padding: 0px;"\x3e\x3c/div\x3e');$(m+('\x3cdiv id\x3d"'+l+'_tableData" style\x3d"padding: 0px;"\x3e\x3c/div\x3e')).appendTo("#"+l+"_tableLayout");var m=0<e&&0<b?$("#"+l+"_tableFix"):null,f=0<e?$("#"+l+"_tableHead"):null,d=0<b?$("#"+l+"_tableColumn"):null,n=$("#"+l+"_tableData");n.append(a);if(null!=m){var p=a.clone(!0);p.attr("id",l+"_tableFixClone");m.append(p);p=document.getElementById(l+"_tableFix").getElementsByTagName("input");for(i=0;i<p.length;i++)p[i].disabled=!0,p[i].value=""}if(null!=f)for(p=a.clone(!0),p.attr("id",l+"_tableHeadClone"),f.append(p),p=document.getElementById(l+"_tableHead").getElementsByTagName("input"),i=0;i<p.length;i++)p[i].disabled=!0,p[i].value="";if(null!=d)for(a=a.clone(!0),a.attr("id",l+"_tableColumnClone"),d.append(a),a=document.getElementById(l+"_tableColumn").getElementsByTagName("input"),i=0;i<a.length;i++)a[i].value="",a[i].disabled=!0;$("#"+l+"_tableLayout table").css("margin","0");if(0<e){var q=0,r=0;$("#"+l+"_tableHead tr:lt("+e+")").each(function(){if(0<r)r--;else{var a=$(this).find("td:first, th:first");q+=a.outerHeight(!0);r=a.attr("rowSpan");r="undefined"==typeof r?0:parseInt(r)-1}});q+=2;f.css("height",q);null!=m&&m.css("height",q)}if(0<b){var s=0,t=0;$("#"+l+"_tableColumn tr:eq("+e+")").find("td:lt("+b+"), th:lt("+b+")").each(function(){t>=b||(s+=$(this).outerWidth(!0),t+=$(this).attr("colSpan")?parseInt($(this).attr("colSpan")):1)});s+=2;d.css("width",s);null!=m&&m.css("width",s)}n.scroll(function(){null!=f&&f.scrollLeft(n.scrollLeft());null!=d&&d.scrollTop(n.scrollTop())});null!=m&&m.css({overflow:"hidden",position:"absolute","z-index":"50"});933<=k?(null!=f&&f.css({overflow:"hidden",width:c-8,position:"absolute","z-index":"45"}),null!=d&&d.css({overflow:"hidden",height:k,position:"absolute","z-index":"40"}),n.css({overflow:"scroll",width:c,height:k+8,position:"absolute"})):(null!=f&&f.css({overflow:"hidden",width:c-8,position:"absolute","z-index":"45"}),null!=d&&d.css({overflow:"hidden",height:k,position:"absolute","z-index":"40"}),n.css({overflow:"scroll",width:c,height:k+-9*h,position:"absolute"}));null!=m&&m.offset(g.offset());null!=f&&f.offset(g.offset());null!=d&&d.offset(g.offset());n.offset(g.offset())}function adjustTableSize(a,e,b,c){a="string"==typeof a?a:a.attr("id");$("#"+a+"_tableLayout").width(e).height(b);$("#"+a+"_tableHead").width(e);933<=b?($("#"+a+"_tableColumn").height(b),$("#"+a+"_tableData").width(e).height(b+8)):($("#"+a+"_tableColumn").height(b),$("#"+a+"_tableData").width(e).height(b+-9*c))}function SaveQuotaInfoByTab(a,e,b,c,k,h,l,g,m){a.QuesQuotaInfo=g;if(a.QuesQuotaInfo.ShowCreateTableBtn){if(0==a.QuesQuotaInfo.RowGroup.length){alert(Prompt.PleaseSetQuotaRow,"red");return}if(0==a.QuesQuotaInfo.RowGroup[0].Nodes.length){alert("\u8bf7\u5148\u8bbe\u7f6e"+a.QuesQuotaInfo.RowGroup[0].Name+"\u3002","red");return}a.QuesQuotaInfo.StrRow1Nodes="";a.QuesQuotaInfo.StrRow2Nodes="";a.QuesQuotaInfo.StrCelNodes="";g=!1;if(0<a.QuesQuotaInfo.RowGroup.length){for(h=0;h<a.QuesQuotaInfo.RowGroup[0].Nodes.length;h++){if(0<a.QuesQuotaInfo.StrRow1Nodes.indexOf(a.QuesQuotaInfo.RowGroup[0].Nodes[h].SelectID)){alert(Prompt.QuotaCantRepeat,"red");return}a.QuesQuotaInfo.StrRow1Nodes+=","+a.QuesQuotaInfo.RowGroup[0].Nodes[h].SelectID}a.QuesQuotaInfo.Row1Name=a.QuesQuotaInfo.RowGroup[0].Name}if(1<a.QuesQuotaInfo.RowGroup.length){for(h=0;h<a.QuesQuotaInfo.RowGroup[1].Nodes.length;h++){if(0<a.QuesQuotaInfo.StrRow2Nodes.indexOf(a.QuesQuotaInfo.RowGroup[1].Nodes[h].SelectID)){alert(Prompt.QuotaCantRepeat,"red");return}a.QuesQuotaInfo.StrRow2Nodes+=","+a.QuesQuotaInfo.RowGroup[1].Nodes[h].SelectID;g=!0}a.QuesQuotaInfo.Row2Name=a.QuesQuotaInfo.RowGroup[1].Name}if(0<a.QuesQuotaInfo.CelGroup.length){for(h=0;h<a.QuesQuotaInfo.CelGroup[0].Nodes.length;h++){if(0<a.QuesQuotaInfo.StrCelNodes.indexOf(a.QuesQuotaInfo.CelGroup[0].Nodes[h].SelectID)){alert("\u5728\u540c\u4e00\u914d\u989d\u884c\u4e2d\u4e0d\u53ef\u4ee5\u6709\u76f8\u540c\u7504\u9009\u9898","red");return}a.QuesQuotaInfo.StrCelNodes+=","+a.QuesQuotaInfo.CelGroup[0].Nodes[h].SelectID}a.QuesQuotaInfo.CelName=a.QuesQuotaInfo.CelGroup[0].Name}var f=!0;if(g&&a.QuesQuotaInfo.RowGroup[0].Nodes.length==a.QuesQuotaInfo.RowGroup[1].Nodes.length&&0<a.QuesQuotaInfo.RowGroup[0].Nodes.length){for(h=0;h<a.QuesQuotaInfo.RowGroup[0].Nodes.length;h++)0>a.QuesQuotaInfo.StrRow2Nodes.indexOf(a.QuesQuotaInfo.RowGroup[0].Nodes[h].SelectID)&&(f=!1);if(f){alert(Prompt.AutoLineCantSame,"red");return}}f=!1;if(0<a.QuesQuotaInfo.CelGroup.length&&0<a.QuesQuotaInfo.CelGroup[0].Nodes.length&&0<a.QuesQuotaInfo.RowGroup[0].Nodes.length){for(h=0;h<a.QuesQuotaInfo.RowGroup[0].Nodes.length;h++)0<a.QuesQuotaInfo.StrCelNodes.indexOf(a.QuesQuotaInfo.RowGroup[0].Nodes[h].SelectID)&&(f=!0);if(f){alert(Prompt.AutoLine1AndColumnCantSame,"red");return}}f=!1;if(g&&0<a.QuesQuotaInfo.CelGroup.length&&0<a.QuesQuotaInfo.CelGroup[0].Nodes.length&&0<a.QuesQuotaInfo.RowGroup[1].Nodes.length){for(h=0;h<a.QuesQuotaInfo.RowGroup[1].Nodes.length;h++)0<a.QuesQuotaInfo.StrCelNodes.indexOf(a.QuesQuotaInfo.RowGroup[1].Nodes[h].SelectID)&&(f=!0);if(f){alert(Prompt.AutoLine2AndColumnCantSame,"red");return}}loadingStart();e.get("/QM/IsCanSaveQDQuotaSetupManager",{params:{questionnairID:l.QuesInfoData.qid,quotaTableID:a.QuesQuotaInfo.QuotaTableID}}).success(function(d,f,g,h){a.LoadingIsEnd=0;d.IsTrue?e.post("/QM/SaveQDQuotaSetupManager",{trrow1value:a.QuesQuotaInfo.StrRow1Nodes,trrow2value:a.QuesQuotaInfo.StrRow2Nodes,trcelvalue:a.QuesQuotaInfo.StrCelNodes,questionnairID:l.QuesInfoData.qid,quotaTableID:a.QuesQuotaInfo.QuotaTableID,row1name:a.QuesQuotaInfo.Row1Name,row2name:a.QuesQuotaInfo.Row2Name,celname:a.QuesQuotaInfo.CelName}).success(function(d){d.IsTrue?(a.QuesQuotaInfo.ShowCreateTableBtn=!1,a.QuesQuotaInfo.QuotaTableID=d.QuotaTableID,InValue=[],SaveQuotaFlag||(""!=c&&(QuesSetTabCssActive(a,c,m),b.path("/QMSet/"+c+"/"+l.QuesInfoData.qid)),""!=k&&("Design"==k?window.location.href="/QD/QuestionnairDesign?quesID\x3d"+l.QuesInfoData.qid:(b.path("/QMSet/"+k+"/"+l.QuesInfoData.qid),a.QQuesSet.QMSetAction="Publish")))):alert(d.message,"red")}).error(function(a,b,d,c){loadingsEnd()}):alert(d.message,"red");loadingEnd()}).error(function(a,b,d,c){loadingEnd()})}if(SaveQuotaFlag){if(2==a.QuesQuotaInfo.RowGroup.length){g=[];f=[];for(h=0;h<InValue.length;h++)for(var d=InValue[h].ID.split(","),n=(d[2]+d[3]).split("_"),d=0;d<n.length;d++)if(""!=n[d]){var p=!1;if(0==InValue[h].ID.indexOf("input_Num,1,")){for(var q=0;q<g.length;q++)g[q].ID==n[d]&&(g[q].NumValue=1*g[q].NumValue+1*InValue[h].Value,p=!0);p||(p=new OptionValue,p.ID=n[d],p.NumValue=1*InValue[h].Value,g.push(p))}else if(0==InValue[h].ID.indexOf("input_Num,2,")){for(q=0;q<f.length;q++)f[q].ID==n[d]&&(f[q].NumValue=1*f[q].NumValue+1*InValue[h].Value,p=!0);p||(p=new OptionValue,p.ID=n[d],p.NumValue=1*InValue[h].Value,f.push(p))}}for(h=0;h<OptionList.length;h++){for(d=p=n=0;d<g.length;d++)OptionList[h]==g[d].ID&&(n=g[d].NumValue);for(d=0;d<f.length;d++)OptionList[h]==f[d].ID&&(p=f[d].NumValue);if(n>p){alert(Prompt.QuotaCountMisMatching,"red");return}if(n<p){alert(Prompt.QuotaCountMisMatching,"red");return}}}if(-1<$("#spanQuotaNum").html().indexOf('color\x3d"red"'))alert(Prompt.Auto1AndAuto2NumInconsistent,"red");else if(1>1*allquota)alert(Prompt.QuesAutoNotBeLessThanOneHundred,"red");else{g=[];for(h=0;h<InValue.length;h++)0==InValue[h].ID.indexOf("input_Num,")&&"0"!=InValue[h].Value&&""!=InValue[h].Value&&isNumber(InValue[h].Value)&&g.push(InValue[h].ID+","+InValue[h].Value);loadingStart();e.post("/QM/SaveQuota",{quotavalue:g,trSetrow1value:a.QuesQuotaInfo.StrRow1Nodes,trSetrow2value:a.QuesQuotaInfo.StrRow2Nodes,trSetcelvalue:a.QuesQuotaInfo.StrCelNodes,questionnairID:l.QuesInfoData.qid,quotaTableID:a.QuesQuotaInfo.QuotaTableID}).success(function(d){d.IsTrue?(loadingEnd(),$("#QuesQuotaDisabled").attr("disabled","disabled"),SaveQuotaFlag=!1,""!=c&&(QuesSetTabCssActive(a,c,m),b.path("/QMSet/"+c+"/"+l.QuesInfoData.qid)),""!=k&&("Design"==k?window.location.href="/QD/QuestionnairDesign?quesID\x3d"+l.QuesInfoData.qid:(b.path("/QMSet/"+k+"/"+l.QuesInfoData.qid),a.QQuesSet.QMSetAction="Publish"))):(loadingEnd(),alert(d.message,"red"))})}}}function ChangeNumShow(a){if(isNaN(a))return a;a=Math.round(100*(a-0))/100;a=a==Math.floor(a)?a+"":10*a==Math.floor(10*a)?a+"0":a;a=String(a);var e=a.split(".");a=e[0];for(var e=e[1]?"."+e[1]:"",b=/(\d+)(\d{3})/;b.test(a);)a=a.replace(b,"$1,$2");return a+e}function QList(){this.Popupbackground=0;this.Sorts=null;this.CompanyImg=this.CompanyName=this.SortType=this.SortName="";this.FolderList=null;this.FolderName="";this.OtherQuesHide=!1;this.FolderID="";this.FolderSetShow=!1;this.SelectFolderID="";this.OtherAddQues=this.MyAddQues=!0}var QuestionnairListloadstart=0,QuestionnairListloadend=0;zyApp.controller("QuestionnairList",["$scope","$stateParams","$http","QuesEidtData","$location","Unify","QuesQuotaInfo",function(a,e,b,c,k,h,l){isTouchDevice();GoHtmlTop();a.IsDemo=$("#hiddendemotype").val();clickempty("dropdown-bt","ul.downul");a.Init=function(){a.QuesQuota=l;SaveQuotaFlag=a.QuesQuota.ShowCreateTableBtn=!1;c.QuesInfoData.EditStateFlag=!1;c.QuesInfoData.publishStateFlag=!1;a.Unify=h;QuestionnairListloadstart=2;QuestionnairListloadend=0;$("#selectques").attr("class","w-nav-link nav-button w--current");a.QList=QList;a.QList.Popupbackground=0;loadingStart();b.get("/QM/QuestionnaireList",{}).success(function(b,c,f,d){a.QList.Companys=b.Company;a.QList.Sorts=b.SortList;a.QList.SortName=b.SortName;a.QList.SortClass=b.SortClass;a.QList.SortType=b.SortType;a.QList.CompanyName=b.CompanyName;a.QList.CompanyImg=b.CompanyImg;$("#liCompanyImg").css("background-image"," url("+b.CompanyImg+")");QuestionnairListloadend+=1;QuestionnairListloadstart==QuestionnairListloadend&&loadingEnd()}).error(function(b,c,f,d){QuestionnairListloadend+=1;QuestionnairListloadstart==QuestionnairListloadend&&loadingEnd();RestLogin(b,a)});null==localStorage.MyFolder||0==localStorage.MyFolder?Folder_GetMyFolderQuesByFolderID(a,b,a.LoadingIsEnd,0,8):Folder_GetMyFolderQuesByFolderID(a,b,a.LoadingIsEnd,0,localStorage.MyFolder);b.get("/QM/GetFolder",{}).success(function(c,e,f,d){a.QList.FolderList=c.FolderList;a.QList.FolderName="\u521b\u5efa\u65b0\u7684\u6587\u4ef6\u5939";a.QList.OtherQuesHide=!1;a.QList.FolderID="";if(0<c.FolderList.length){a.QList.FolderSetShow=!0;a.QList.OtherQuesHide=!0;for(c=0;c<a.QList.FolderList.length;c++)a.QList.FolderList[c].IsSelect&&(a.QList.FolderName=a.QList.FolderList[c].FolderName,a.QList.FolderID=a.QList.FolderList[c].FolderID);null==localStorage.OtherFolder||0==localStorage.OtherFolder?Folder_GetFolderQuesByFolderID(a,b,a.QList.LoadingIsEnd,0,8):Folder_GetFolderQuesByFolderID(a,b,a.QList.LoadingIsEnd,0,localStorage.OtherFolder)}else a.QList.FolderSetShow=!1,a.QList.OtherQuesHide=!1;QuestionnairListloadend+=1;QuestionnairListloadstart==QuestionnairListloadend&&loadingEnd()}).error(function(a,b,c,d){loadingEnd()})};a.Init();a.CloseDiv=function(){$("body").removeClass("srcollHide");a.QList.Popupbackground=0};a.QuesMouseover=function(a,b){for(var c=0;c<b.length;c++)b[c].MoveOver={opacity:0};a.MoveOver={opacity:1}};a.QuesMouseleave=function(a){for(var b=0;b<a.length;b++)a[b].MoveOver={opacity:0}};a.ChangeCompany=function(c){a.ChangeCompanyStyle={display:"none"};if(a.QList.CompanyName!=c.CompanyName){for(var e=0;e<a.QList.Companys.length;e++)a.QList.Companys[e].IsCurrent=!1;c.IsCurrent=!0;a.QList.CompanyName=c.CompanyName;a.QList.CompanyImg=c.BackgroundImg;loadingStart();QuestionnairListloadstart=1;QuestionnairListloadend=0;b.post("/QM/ChangeCompany",{id:c.CompanyID}).success(function(c){""==c.Message?(Folder_GetMyFolderQuesByFolderID(a,b,a.LoadingIsEnd,0,8),b.get("/QM/GetFolder",{}).success(function(d,c,f,g){a.QList.FolderList=d.FolderList;a.QList.FolderName="\u521b\u5efa\u65b0\u7684\u6587\u4ef6\u5939";a.QList.OtherQuesHide=!1;a.QList.FolderID="";if(0<d.FolderList.length){a.QList.FolderSetShow=!0;a.QList.OtherQuesHide=!0;for(d=0;d<a.QList.FolderList.length;d++)a.QList.FolderList[d].IsSelect&&(a.QList.FolderName=a.QList.FolderList[d].FolderName,a.QList.FolderID=a.QList.FolderList[d].FolderID);Folder_GetFolderQuesByFolderID(a,b,a.LoadingIsEnd,0,8)}else a.QList.FolderSetShow=!1,a.QList.OtherQuesHide=!1;QuestionnairListloadend+=1;QuestionnairListloadstart==QuestionnairListloadend&&loadingEnd()}).error(function(b,c,f,g){QuestionnairListloadend+=1;QuestionnairListloadstart==QuestionnairListloadend&&loadingEnd();RestLogin(b,a)})):alert(c.Message,"red");QuestionnairListloadend+=1;QuestionnairListloadstart==QuestionnairListloadend&&loadingEnd()})}};a.ChangeQuesSort=function(c){a.QuesSortStyle={display:"none"};for(var e=0;e<a.QList.Sorts.length;e++)a.QList.Sorts[e].IsSelect=!1;c.IsSelect=!0;a.QList.SortName=c.Name;a.QList.SortClass=c.SortClass;a.QList.SortType=c.SortType;loadingStart();QuestionnairListloadstart=1;QuestionnairListloadend=0;b.post("/QM/ChangeSort",{type:c.SortType,name:c.Name}).success(function(c){Folder_GetFolderQuesByFolderID(a,b,a.LoadingIsEnd,0,8);Folder_GetMyFolderQuesByFolderID(a,b,a.LoadingIsEnd,0,8);QuestionnairListloadend+=1;QuestionnairListloadstart==QuestionnairListloadend&&loadingEnd();a.LoadingIsEnd=0}).error(function(b,d,c,g){QuestionnairListloadend+=1;QuestionnairListloadstart==QuestionnairListloadend&&loadingEnd();a.LoadingIsEnd=0;RestLogin(b,a)})};a.ChangeFolder=function(c){a.FolderStyle={display:"none"};a.QList.ShowDownFolder={visibility:"hidden"};if(c.FolderName!=a.QList.FolderName){for(var e=0;e<this.QList.FolderList.length;e++)this.QList.FolderList[e].IsSelect=!1;c.IsSelect=!0;a.QList.FolderName=c.FolderName;a.QList.FolderID=c.FolderID;loadingStart();b.post("/QM/ChangeFolder",{id:c.FolderID}).success(function(a){}).error(function(b,d,c,g){loadingEnd();RestLogin(b,a)});QuestionnairListloadend=QuestionnairListloadstart=0;Folder_GetFolderQuesByFolderID(a,b,a.LoadingIsEnd,0,8)}};a.OpenAddFolder=function(){a.QList.ShowDownFolder1={visibility:"hidden"};$("body").addClass("srcollHide");a.QList.Popupbackground=1;a.EFolder={};a.EFolder.Name="";a.AddFolderForm.$setPristine();a.QList.SelectFolderID=""};a.OpenEditFolder=function(){$("body").addClass("srcollHide");a.QList.Popupbackground=2;a.QList.SelectFolderID=a.QList.FolderID;a.NewFolderName=a.QList.FolderName};a.SaveFolder=function(c){c&&(loadingStart(),QuestionnairListloadstart=1,QuestionnairListloadend=0,b.post("/QM/SaveFolder",{title:a.EFolder.Name,folderid:a.QList.SelectFolderID,isnewsave:1}).success(function(c){""==c.Message?(a.CloseDiv(),alert("\u64cd\u4f5c\u6210\u529f\u3002","green"),QuestionnairListloadstart+=1,b.get("/QM/GetFolder",{}).success(function(b,d,c,g){a.QList.FolderList=b.FolderList;0<b.FolderList.length?(a.QList.OtherQuesHide=!0,a.QList.FolderSetShow=!0):(a.QList.OtherQuesHide=!1,a.QList.FolderSetShow=!1);a.ChangeFolder(a.QList.FolderList[a.QList.FolderList.length-1]);QuestionnairListloadend+=1;QuestionnairListloadstart==QuestionnairListloadend&&loadingEnd()}).error(function(b,d,c,g){QuestionnairListloadend+=1;QuestionnairListloadstart==QuestionnairListloadend&&loadingEnd();RestLogin(b,a)})):alert(c.Message,"red");QuestionnairListloadend+=1;QuestionnairListloadstart==QuestionnairListloadend&&loadingEnd()}).error(function(b,c,d,g){QuestionnairListloadend+=1;QuestionnairListloadstart==QuestionnairListloadend&&loadingEnd();RestLogin(b,a)}))};a.EditFolder=function(c){c&&(loadingStart(),b.post("/QM/SaveFolder",{title:a.NewFolderName,folderid:a.QList.SelectFolderID,isnewsave:0}).success(function(b){if(""==b.Message)for(a.CloseDiv(),alert("\u64cd\u4f5c\u6210\u529f\u3002","green"),b=0;b<a.QList.FolderList.length;b++)a.QList.FolderList[b].FolderID==a.QList.FolderID&&(a.QList.FolderList[b].FolderName=a.NewFolderName,a.QList.FolderName=a.NewFolderName);else alert(b.Message,"red");loadingEnd()}).error(function(b,c,d,g){loadingEnd();RestLogin(b,a)}))};a.DelFolder=function(){loadingStart();QuestionnairListloadstart=1;QuestionnairListloadend=0;b.post("/QM/DelPMFolder",{id:a.QList.FolderID}).success(function(c){""==c.Message?(a.CloseDiv(),alert("\u64cd\u4f5c\u6210\u529f\u3002","green"),Folder_GetMyFolderQuesByFolderID(a,b,a.LoadingIsEnd,0,a.QList.MyQuesList.length),QuestionnairListloadstart+=1,b.get("/QM/GetFolder",{}).success(function(c,f,d,g){a.QList.FolderList=c.FolderList;a.QList.FolderName="\u521b\u5efa\u65b0\u7684\u6587\u4ef6\u5939";a.QList.OtherQuesHide=!1;a.QList.FolderID="";if(0<c.FolderList.length){a.QList.OtherQuesHide=!0;a.QList.FolderSetShow=!0;for(c=0;c<a.QList.FolderList.length;c++)a.QList.FolderList[c].IsSelect&&(a.QList.FolderName=a.QList.FolderList[c].FolderName,a.QList.FolderID=a.QList.FolderList[c].FolderID);Folder_GetFolderQuesByFolderID(a,b,a.LoadingIsEnd,0,8)}else a.QList.FolderSetShow=!1,a.QList.OtherQuesHide=!1;QuestionnairListloadend+=1;QuestionnairListloadstart==QuestionnairListloadend&&loadingEnd()}).error(function(b,c,d,g){QuestionnairListloadend+=1;QuestionnairListloadstart==QuestionnairListloadend&&loadingEnd();RestLogin(b,a)})):alert(c.Message,"red");QuestionnairListloadend+=1;QuestionnairListloadstart==QuestionnairListloadend&&loadingEnd()}).error(function(b,c,f,d){QuestionnairListloadend+=1;QuestionnairListloadstart==QuestionnairListloadend&&loadingEnd();RestLogin(b,a)})};a.GoToDataTrends=function(a,b){b.stopPropagation();k.path("/QMSet/Publish/"+a.QuestionnaireID+"")};a.CopyQues=function(c,e,f){f.stopPropagation();loadingStart();QuestionnairListloadstart=1;QuestionnairListloadend=0;b.post("/QM/CopyQues",{quesID:c.QuestionnaireID,title:"",folderID:""}).success(function(d){a.LoadingIsEnd=0;""==d.returnValue.returnMessage?(alert(Prompt.QuesCopyOK,"green"),1==e?Folder_GetFolderQuesByFolderID(a,b,a.LoadingIsEnd,0,a.QList.OtherQuesList.length):Folder_GetMyFolderQuesByFolderID(a,b,a.LoadingIsEnd,0,a.QList.MyQuesList.length)):alert(d.returnValue.returnMessage,"red");QuestionnairListloadend+=1;QuestionnairListloadstart==QuestionnairListloadend&&loadingEnd()}).error(function(b,c,f,e){QuestionnairListloadend+=1;QuestionnairListloadstart==QuestionnairListloadend&&loadingEnd();RestLogin(b,a)})};a.PreViewClick=function(c,e){e.stopPropagation();loadingStart();b.post("/Home/CheckSessionLost",{}).success(function(b){b.IsSessionLost?RestLogin(b.Message,a):(a.Unify.QuesPreview("#QuesPreviewHref","#QuesPreviewURl",c),loadingEnd(),$("body").addClass("srcollHide"),a.QList.Popupbackground=6)})};a.OpenDelQues=function(c,e,f){f.stopPropagation();b.post("/Home/CheckSessionLost",{}).success(function(b){b.IsSessionLost?RestLogin(b.Message,a):($("body").addClass("srcollHide"),a.QList.Popupbackground=4,a.QList.DelQ=c,a.QList.DelT=e,a.QList.DelPassWord="",$("#delMessage").css("display","none"))})};a.enterOrEscOper=function(b){13==window.event.keyCode&&(1==b&&a.DelQuesByPassword(),3==b&&a.EditFolder(EditFForm.$valid),4==b&&a.SaveFolder(AddFolderForm.$valid));27==window.event.keyCode&&a.CloseDiv()};a.DelQuesByPassword=function(){console.log(a.QList.DelPassWord);"choiceform"!=$("#delete-survey").val()?$("#delMessage").css("display","block"):(loadingStart(),QuestionnairListloadstart=1,QuestionnairListloadend=0,b.post("/QM/DelQues",{quesID:a.QList.DelQ.QuestionnaireID}).success(function(c){""==c.Message?(a.CloseDiv(),a.LoadingIsEnd=0,alert("\u5220\u9664\u6210\u529f\u3002","green"),1==a.QList.DelT?Folder_GetFolderQuesByFolderID(a,b,a.LoadingIsEnd,0,a.QList.OtherQuesList.length):Folder_GetMyFolderQuesByFolderID(a,b,a.LoadingIsEnd,0,a.QList.MyQuesList.length)):alert(c.Message,"red");QuestionnairListloadend+=1;QuestionnairListloadstart==QuestionnairListloadend&&loadingEnd()}).error(function(b,c,f,d){QuestionnairListloadend+=1;QuestionnairListloadstart==QuestionnairListloadend&&loadingEnd();RestLogin(b,a)}))};a.OpenMoveQues=function(c,e,f){f.stopPropagation();b.post("/Home/CheckSessionLost",{}).success(function(b){if(b.IsSessionLost)RestLogin(b.Message,a);else if(0==a.QList.FolderList.length)alert("\u8bf7\u5148\u521b\u5efa\u6587\u4ef6\u5939\u3002","red");else if($("body").addClass("srcollHide"),a.QList.Popupbackground=5,a.QList.ShowMoveSelectFolderInfoNum=0,a.QList.MoveQ=c,a.QList.MoveT=e,b=[],1==e){for(var f=0;f<this.QList.FolderList.length;f++)a.QList.FolderList[f].FolderID!=a.QList.FolderID&&b.push(this.QList.FolderList[f]);a.QList.MoveQuesFolder="\u6211\u7684\u6587\u4ef6\u5939";a.QList.ShowMoveFolderList=b;a.QList.SelectMoveFolderID=""}else a.QList.ShowMoveFolderList=angular.copy(a.QList.FolderList),a.QList.MoveQuesFolder=a.QList.ShowMoveFolderList[0].FolderName,a.QList.SelectMoveFolderID=a.QList.ShowMoveFolderList[0].FolderID})};a.ChangeMoveFolder=function(b,c){a.QList.MoveQuesFolder=c;a.QList.SelectMoveFolderID=b;a.QList.ShowMoveSelectFolderInfo={display:"none"};closeAll("ul.downul")};a.MoveFolder=function(){loadingStart();QuestionnairListloadstart=1;QuestionnairListloadend=0;b.post("/QM/MoveQuesToFolder",{quesID:a.QList.MoveQ.QuestionnaireID,targeid:a.QList.SelectMoveFolderID}).success(function(c){""==c.Message?(a.CloseDiv(),a.LoadingIsEnd=0,alert("\u64cd\u4f5c\u6210\u529f\u3002","green"),1==a.QList.MoveT?(""==a.QList.SelectMoveFolderID&&Folder_GetMyFolderQuesByFolderID(a,b,a.LoadingIsEnd,0,a.QList.MyQuesList.length),Folder_GetFolderQuesByFolderID(a,b,a.LoadingIsEnd,0,a.QList.OtherQuesList.length)):(Folder_GetMyFolderQuesByFolderID(a,b,a.LoadingIsEnd,0,a.QList.MyQuesList.length),a.QList.SelectMoveFolderID==a.QList.FolderID&&Folder_GetFolderQuesByFolderID(a,b,a.LoadingIsEnd,0,a.QList.OtherQuesList.length))):alert(c.Message,"red");QuestionnairListloadend+=1;QuestionnairListloadstart==QuestionnairListloadend&&loadingEnd()}).error(function(b,c,f,d){QuestionnairListloadend+=1;QuestionnairListloadstart==QuestionnairListloadend&&loadingEnd();RestLogin(b,a)})};a.ReturnQuestionnairDesign=function(a){window.location.href="/QD/QuestionnairDesign?quesID\x3d"+a.QuestionnaireID};a.turnToAnalyzeResults=function(c){b.post("/Home/CheckSessionLost",{}).success(function(b){b.IsSessionLost?RestLogin(b.Message,a):window.location.href="/Home/DashBoard#/QMSet/AnalyzeResults/"+c+"/DataTrends"})};a.turnToPublish=function(c){b.post("/Home/CheckSessionLost",{}).success(function(b){b.IsSessionLost?RestLogin(b.Message,a):window.location.href="/Home/DashBoard#/QMSet/Publish/"+c})};a.ShowPopup=function(a){a.stopPropagation()};a.GoToUrl=function(c,e){b.post("/Home/CheckSessionLost",{}).success(function(b){b.IsSessionLost?RestLogin(b.Message,a):(e&&(c+=e),k.path(c))})};a.AddMoreQues=function(c){"0"==c?Folder_GetMyFolderQuesByFolderID(a,b,a.LoadingIsEnd,a.QList.MyQuesList.length,8):Folder_GetFolderQuesByFolderID(a,b,a.LoadingIsEnd,a.QList.OtherQuesList.length,8)}}]);function Folder_GetFolderQuesByFolderID(a,e,b,c,k){8>k&&(k=8);QuestionnairListloadstart+=1;e.get("/QM/GetQuestionInfoByFolderID",{params:{id:a.QList.FolderID,sorttype:a.QList.SortType,skip:c,take:k}}).success(function(b,l,g,m){l=[];if(0==c)for(a.QList.OtherQuesList=b.QuesList,g=0;g<a.QList.OtherQuesList.length;g++)l.push(a.QList.OtherQuesList[g].QuestionnaireID);else for(g=0;g<b.QuesList.length;g++)a.QList.OtherQuesList.push(b.QuesList[g]),l.push(b.QuesList[g].QuestionnaireID);localStorage.OtherFolder=c+k;a.QList.OtherAddQues=b.IsEnd?!1:!0;QuestionnairListloadend+=1;QuestionnairListloadstart==QuestionnairListloadend&&loadingEnd();e.get("/QM/GetQuesProgressWidthByids",{params:{ids:l}}).success(function(b,c,e,g){if(b.IsTrue)for(c=0;c<a.QList.OtherQuesList.length;c++)for(e=0;e<b.QuesList.length;e++)a.QList.OtherQuesList[c].QuestionnaireID==b.QuesList[e].QuesID&&(a.QList.OtherQuesList[c].QuesSubmitNum=b.QuesList[e].QuesSubmitNum,a.QList.OtherQuesList[c].ProgressWidth.width=b.QuesList[e].ProgressWidth+"%")}).error(function(a,b,c,e){})}).error(function(b,c,e,k){QuestionnairListloadend+=1;QuestionnairListloadstart==QuestionnairListloadend&&loadingEnd();RestLogin(b,a)})}function Folder_GetMyFolderQuesByFolderID(a,e,b,c,k){QuestionnairListloadstart+=1;8>k&&(k=8);e.get("/QM/GetQuestionInfoByFolderID",{params:{id:"",sorttype:a.QList.SortType,skip:c,take:k}}).success(function(b,l,g,m){l=[];if(0==c)for(a.QList.MyQuesList=b.QuesList,g=0;g<a.QList.MyQuesList.length;g++)l.push(a.QList.MyQuesList[g].QuestionnaireID);else for(g=0;g<b.QuesList.length;g++)a.QList.MyQuesList.push(b.QuesList[g]),l.push(b.QuesList[g].QuestionnaireID);localStorage.MyFolder=c+k;a.QList.MyAddQues=b.IsEnd?!1:!0;QuestionnairListloadend+=1;QuestionnairListloadstart==QuestionnairListloadend&&loadingEnd();l=[];for(g=0;g<a.QList.MyQuesList.length;g++)l.push(a.QList.MyQuesList[g].QuestionnaireID);e.get("/QM/GetQuesProgressWidthByids",{params:{ids:l}}).success(function(b,c,e,g){if(b.IsTrue)for(c=0;c<a.QList.MyQuesList.length;c++)for(e=0;e<b.QuesList.length;e++)a.QList.MyQuesList[c].QuestionnaireID==b.QuesList[e].QuesID&&(a.QList.MyQuesList[c].QuesSubmitNum=b.QuesList[e].QuesSubmitNum,a.QList.MyQuesList[c].ProgressWidth.width=b.QuesList[e].ProgressWidth+"%")}).error(function(a,b,c,e){})}).error(function(b,c,e,k){QuestionnairListloadend+=1;QuestionnairListloadstart==QuestionnairListloadend&&loadingEnd();RestLogin(b,a)})}function QuestionSummaries(){this.SummariesList=[];this.DataViewInfoList=[];this.DataOutputList=[];this.InitDataListList=[];this.DataListList=[];this.IsShowView=this.AddShowRule=!1;this.InitNodeList=[];this.ShowNodeList=[];this.ShowNodeReverseSelect=this.ShowNodeAllSelect=!1;this.SelectViewID=this.EditShowID="";this.AddSelectRule=!1;this.FilterType=0;this.ShowSetName="\u663e\u793a\u8bbe\u7f6e";this.IsShowAddButton=!0;this.ChartList=[];this.IsShowOutView=!1;this.QNumber=""}function QuestionSummariesNode(){this.NodeTitle=this.NodeName=this.NodeID="";this.IsSelect=!1;this.CheckClass="checkbox-none"}zyApp.controller("QuestionSummariesCtrl",["$scope","$stateParams","$http","$location","QuesEidtData","$timeout","Unify","DataOutputInfo",function(a,e,b,c,k,h,l,g){loadingStart();GoHtmlTop();a.IsDemo=$("#hiddendemotype").val();var m=new QuestionSummaries;a.QuestionSummaries=m;a.QuestionSummaries.Popupbackground=0;b.post("/QM/VerifyRight",{quesID:e.qid}).success(function(b){"NoRight"==b?location.href="/Error/Error?type\x3ddashboard":(a.Unify=l,a.DataOutputInfo=g,a.Unify.QuesChange(e.qid),k.QuesInfoData.qid=e.qid,a.QuestionSummaries.DataOutputList=a.DataOutputInfo.dataOutputList,a.QuestionSummaries.IsShowOutView=null!=a.DataOutputInfo.dataOutputList&&0<a.DataOutputInfo.dataOutputList.length?!0:!1,loadingEnd(),a.BindDataViewInfo(),a.BindDataOutputInfo())}).error(function(a,b,c,e){loadingEnd();RestLogin(a)});a.AnalyzeResultTabSelect=function(){c.path("/QMSet/AnalyzeResults/"+k.QuesInfoData.qid+"/DataTrends")};a.BindDataViewInfo=function(){loadingStart();b.get("/QM/GetQuestionSummariesViewByDataViewInfo",{params:{quesID:k.QuesInfoData.qid}}).success(function(b,c,e,g){b.IsTrue?(a.QuestionSummaries.IsShowView=!0,a.QuestionSummaries.InitNodeList=b.NodeList,a.QuestionSummaries.InitDataListList=b.DataListList,a.QuestionSummaries.SelectViewID=b.SelectViewID,a.QuestionSummaries.QNumber=b.QNumber,a.ChangeShowRule(),a.BindData()):(alert(b.Message,"red"),loadingEnd())}).error(function(a,b,c,e){loadingEnd();RestLogin(a)})};a.ChangeShowRule=function(){a.QuestionSummaries.DataListList=[];for(var b=0;b<a.QuestionSummaries.InitDataListList.length;b++)a.QuestionSummaries.DataListList.push(angular.copy(a.QuestionSummaries.InitDataListList[b]));h(function(){isTouchDevice()},100)};a.OpenEditViewRule=function(b){$("body").addClass("srcollHide");a.QuestionSummaries.EditViewID=b.ID;a.QuestionSummaries.Popupbackground=2;a.QuestionSummaries.SelectViewChangeName=b.Name};a.AddViewRule=function(){loadingStart();b.post("/QM/SavePMDataView",{id:"",quesID:k.QuesInfoData.qid,viewname:""}).success(function(b){if(b.IsTrue){a.QuestionSummaries.DataViewInfoList=b.DataViewList;a.QuestionSummaries.SelectViewID=b.SelectViewID;for(var c=0;c<b.DataViewList.length;c++)"radio-check"==b.DataViewList[c].RadioCss&&(a.QuestionSummaries.IsShowView=""==b.DataViewList[c].ID?!1:!0);a.ChangeShowRule();a.BindData()}else alert(b.Message,"red");loadingEnd()}).error(function(a,b,c,e){loadingEnd();RestLogin(a)})};a.SelectDataViewInfo=function(b){for(var c=0;c<a.QuestionSummaries.DataViewInfoList.length;c++)b.ID==a.QuestionSummaries.DataViewInfoList[c].ID?(a.QuestionSummaries.DataViewInfoList[c].IsSelect=!0,a.QuestionSummaries.DataViewInfoList[c].RadioCss="radio-check",a.QuestionSummaries.SelectViewID=a.QuestionSummaries.DataViewInfoList[c].ID,a.QuestionSummaries.IsShowView=""==a.QuestionSummaries.DataViewInfoList[c].ID?!1:!0):(a.QuestionSummaries.DataViewInfoList[c].IsSelect=!1,a.QuestionSummaries.DataViewInfoList[c].RadioCss="radio-none");a.ChangeShowRule();a.BindData()};a.EditViewChangeName=function(c){c&&b.post("/QM/ChangeViewRuleName",{id:a.QuestionSummaries.EditViewID,name:a.QuestionSummaries.SelectViewChangeName}).success(function(b){if(b.IsTrue)for(a.CloseDiv(),alert(Prompt.AnalyticResult_SuccessfulOperation,"green"),b=0;b<a.QuestionSummaries.DataViewInfoList.length;b++)a.QuestionSummaries.DataViewInfoList[b].ID==a.QuestionSummaries.EditViewID&&(a.QuestionSummaries.DataViewInfoList[b].Name=a.QuestionSummaries.SelectViewChangeName)}).error(function(a,b,c,f){loadingEnd();RestLogin(a)})};a.DelDataView=function(c){confirm(Prompt.AnalyticResult_IsDeleteOutRule,function(){for(var d=[],e=0;e<a.QuestionSummaries.DataViewInfoList.length;e++)c.ID!=a.QuestionSummaries.DataViewInfoList[e].ID&&d.push(a.QuestionSummaries.DataViewInfoList[e]);a.QuestionSummaries.DataViewInfoList=d;if(c.IsSelect){for(e=0;e<a.QuestionSummaries.DataViewInfoList.length;e++)""==a.QuestionSummaries.DataViewInfoList[e].ID?(a.QuestionSummaries.IsShowView=!1,a.QuestionSummaries.DataViewInfoList[e].IsSelect=!0,a.QuestionSummaries.DataViewInfoList[e].RadioCss="radio-check"):(a.QuestionSummaries.DataViewInfoList[e].IsSelect=!1,a.QuestionSummaries.DataViewInfoList[e].RadioCss="radio-none");alert("\u5220\u9664\u6210\u529f","green");a.ChangeShowRule();a.BindData()}b.post("/QM/DeleteViewRule",{id:c.ID}).success(function(a){}).error(function(a,b,c,d){loadingEnd();RestLogin(a)});a.$digest()},function(){},"\u662f","","\u5426")};a.OpenDownLoadInfo=function(){$("body").addClass("srcollHide");a.QuestionSummaries.Popupbackground=2;a.QuestionSummaries.DataTabClass=1;a.QuestionSummaries.DataViewType=1;a.QuestionSummaries.DataAnalysisViewType=1;a.QuestionSummaries.DataAnalysisViewFileType=1;a.QuestionSummaries.DataViewSelectText=!0;a.QuestionSummaries.DataViewSelectValue=!1;var b=new Date,c=b.getFullYear(),e=b.getMonth()+1,g=b.getDate(),h=b.getHours(),k=b.getMinutes(),b=b.getSeconds();a.QuestionSummaries.DataViewTypeDownLoadFileName=a.QuestionSummaries.QNumber+"\u7ed3\u679c\u6570\u636e"+c+e+g+h+k+b;a.QuestionSummaries.DataAnalysisViewTypeDownLoadFileName=a.QuestionSummaries.QNumber+"\u6c47\u603b\u6570\u636e"+c+e+g+h+k+b};a.CreateFileInfo=function(){if(1==a.QuestionSummaries.DataTabClass){if(!a.QuestionSummaries.DataViewSelectText&&!a.QuestionSummaries.DataViewSelectValue){alert("\u8bf7\u9009\u62e9\u6570\u636e\u5185\u5bb9\u3002","red");return}if(""==a.QuestionSummaries.DataViewTypeDownLoadFileName){alert("\u8bf7\u8f93\u5165\u6587\u4ef6\u540d\u3002","red");return}a.QuestionSummaries.DataViewTypeDownLoadFileName+=".xlsx";a.DownLoadAll(a.QuestionSummaries.DataViewType)}else{if(""==a.QuestionSummaries.DataAnalysisViewTypeDownLoadFileName){alert("\u8bf7\u8f93\u5165\u6587\u4ef6\u540d\u3002","red");return}1==a.QuestionSummaries.DataAnalysisViewFileType?(a.QuestionSummaries.DataAnalysisViewTypeDownLoadFileName+=".pdf",a.DownLoadAllPDF(a.QuestionSummaries.DataAnalysisViewType)):(a.QuestionSummaries.DataAnalysisViewTypeDownLoadFileName+=".xlsx",a.DownLoadAllExcelByDataAnalysis(a.QuestionSummaries.DataAnalysisViewType))}a.CloseDiv()};a.DownLoadAllExcelByDataAnalysis=function(c){loadingStart();b.post("/QM/CreateExcelFileDataAnalysis",{quesID:k.QuesInfoData.qid,dataViewname:"",dataviewID:"",isallinfo:c,downloadFile:a.QuestionSummaries.DataAnalysisViewTypeDownLoadFileName}).success(function(c){c.IsTrue?(loadingStart(),a.CloseDiv(),alert("\u8f93\u51fa\u7ed3\u679c\u751f\u6210\u5b8c\u6210\u3002","green"),b.get("/QM/GetQuestionSummariesViewByDataOutputInfo",{params:{quesID:k.QuesInfoData.qid}}).success(function(b,c,d,f){b.IsTrue?(a.DataOutputInfo.dataOutputList=b.DataOutputList,a.QuestionSummaries.IsShowOutView=null!=a.DataOutputInfo.dataOutputList&&0<a.DataOutputInfo.dataOutputList.length?!0:!1,h(function(){isTouchDevice()},100)):alert(b.Message,"red");loadingEnd()}).error(function(a,b,c,d){loadingEnd();RestLogin(a)})):alert(c.Message,"red");loadingEnd()}).error(function(a,b,c,f){loadingEnd();RestLogin(a)})};a.DownLoadAllPDF=function(c){loadingStart();for(var d=[],e=0;e<a.QuestionSummaries.ChartList.length;e++)d.push(a.QuestionSummaries.ChartList[e].getDataURL("jpeg"));b.post("/QM/CreatePDFFileDataAnalysis",{quesID:k.QuesInfoData.qid,dataViewname:"",dataviewID:"",imageinfolist:d,isallinfo:c,downloadFile:a.QuestionSummaries.DataAnalysisViewTypeDownLoadFileName}).success(function(c){c.IsTrue?(loadingStart(),a.CloseDiv(),alert("\u8f93\u51fa\u7ed3\u679c\u751f\u6210\u5b8c\u6210\u3002","green"),b.get("/QM/GetQuestionSummariesViewByDataOutputInfo",{params:{quesID:k.QuesInfoData.qid}}).success(function(b,c,d,f){b.IsTrue?(a.DataOutputInfo.dataOutputList=b.DataOutputList,a.QuestionSummaries.IsShowOutView=null!=a.DataOutputInfo.dataOutputList&&0<a.DataOutputInfo.dataOutputList.length?!0:!1,h(function(){isTouchDevice()},100)):alert(b.Message,"red");loadingEnd()}).error(function(a,b,c,d){loadingEnd();RestLogin(a)})):alert(c.Message,"red");loadingEnd()}).error(function(a,b,c,d){loadingEnd();RestLogin(a)})};a.DownLoadAll=function(c){loadingStart();var d="0";a.QuestionSummaries.DataViewSelectText&&a.QuestionSummaries.DataViewSelectValue?d="3":a.QuestionSummaries.DataViewSelectText?d="1":a.QuestionSummaries.DataViewSelectValue&&(d="2");b.post("/QM/CreateFile",{quesID:k.QuesInfoData.qid,dataViewname:"",dataviewID:"",isallinfo:c,downloadFile:a.QuestionSummaries.DataViewTypeDownLoadFileName,dataType:d}).success(function(c){c.IsTrue?(loadingStart(),a.CloseDiv(),alert("\u8f93\u51fa\u7ed3\u679c\u751f\u6210\u5b8c\u6210\u3002","green"),b.get("/QM/GetQuestionSummariesViewByDataOutputInfo",{params:{quesID:k.QuesInfoData.qid}}).success(function(b,c,d,f){b.IsTrue?(a.DataOutputInfo.dataOutputList=b.DataOutputList,a.QuestionSummaries.IsShowOutView=null!=a.DataOutputInfo.dataOutputList&&0<a.DataOutputInfo.dataOutputList.length?!0:!1,h(function(){isTouchDevice()},100)):alert(b.Message,"red");loadingEnd()}).error(function(a,b,c,d){loadingEnd();RestLogin(a)})):alert(c.Message,"red");loadingEnd()}).error(function(a,b,c,d){loadingEnd();RestLogin(a)})};a.BindDataOutputInfo=function(){loadingStart();b.get("/QM/GetQuestionSummariesViewByDataOutputInfo",{params:{quesID:k.QuesInfoData.qid}}).success(function(b,c,e,g){b.IsTrue?(a.DataOutputInfo.dataOutputList=b.DataOutputList,a.QuestionSummaries.IsShowOutView=null!=a.DataOutputInfo.dataOutputList&&0<a.DataOutputInfo.dataOutputList.length?!0:!1,h(function(){isTouchDevice()},100)):alert(b.Message,"red");loadingEnd()}).error(function(a,b,c,e){loadingEnd();RestLogin(a)})};a.ShowDataOutputInfo=function(b){for(var c=0;c<a.DataOutputInfo.dataOutputList.length;c++)b.ID==a.DataOutputInfo.dataOutputList[c].ID&&(a.DataOutputInfo.dataOutputList[c].IsShowDownLoad=!1,a.DataOutputInfo.dataOutputList[c].IsShowInfo?(a.DataOutputInfo.dataOutputList[c].IsShowInfo=!1,a.DataOutputInfo.dataOutputList[c].ShowFileName="\u663e\u793a\u6587\u4ef6\u8be6\u60c5"):(a.DataOutputInfo.dataOutputList[c].IsShowInfo=!0,a.DataOutputInfo.dataOutputList[c].ShowFileName="\u9690\u85cf\u6587\u4ef6\u8be6\u60c5"))};a.GotoUrl=function(a,c){b.post("/QM/IsExisFile",{url:a}).success(function(b){b.IsTrue?window.location.href="/QM/PDFDownLoad?name\x3d"+escape(c)+"\x26url\x3d"+escape(a):alert("\u6587\u4ef6\u4e0d\u5b58\u5728\u3002","red")}).error(function(a,b,c,d){alert("\u6587\u4ef6\u4e0d\u5b58\u5728\u3002","red")})};a.DelDataOutput=function(c,d){confirm(Prompt.AnalyticResult_IsDeleteOutResult,function(){loadingStart();b.post("/QM/DelDataOutput",{dataoutputid:c,url:d}).success(function(b){b.IsTrue?(a.BindDataOutputInfo(),alert("\u5220\u9664\u6210\u529f","green")):alert(b.Message,"red");loadingEnd()}).error(function(a,b,c,d){loadingEnd();RestLogin(a)});a.$digest()},function(){},"\u662f","","\u5426")};a.CreateFile=function(){confirm(Prompt.AnalyticResult_IsDeleteOutFile,function(){loadingStart();b.post("/QM/CreateFile",{quesID:k.QuesInfoData.qid,dataViewname:"",dataviewID:""}).success(function(b){b.IsTrue?a.BindDataOutputInfo():alert(b.Message,"red");loadingEnd()}).error(function(a,b,c,e){loadingEnd();RestLogin(a)});a.$digest()},function(){},"\u662f","","\u5426")};a.AddShowRuleClick=function(){a.QuestionSummaries.AddShowRule=!0;a.QuestionSummaries.ShowNodeAllSelect=!1;a.QuestionSummaries.ShowNodeReverseSelect=!1;a.QuestionSummaries.EditShowID="";a.QuestionSummaries.ShowSetName=Prompt.AnalyticResult_SelectOptionToShow;a.QuestionSummaries.IsShowAddButton=!1;a.QuestionSummaries.ShowNodeList=angular.copy(a.QuestionSummaries.InitNodeList)};a.EditShowRuleClick=function(b){a.QuestionSummaries.AddShowRule=!0;a.QuestionSummaries.ShowNodeAllSelect=!1;a.QuestionSummaries.ShowNodeReverseSelect=!1;a.QuestionSummaries.EditShowID=b.ID;a.QuestionSummaries.ShowNodeList=angular.copy(a.QuestionSummaries.InitNodeList);a.QuestionSummaries.ShowSetName=Prompt.AnalyticResult_SelectOptionToShow;a.QuestionSummaries.IsShowAddButton=!1;for(var c=0;c<a.QuestionSummaries.ShowNodeList.length;c++)0>b.ListCondition.indexOf(a.QuestionSummaries.ShowNodeList[c].NodeID)&&(a.QuestionSummaries.ShowNodeList[c].IsSelect=!1,a.QuestionSummaries.ShowNodeList[c].CheckClass="checkbox-none")};a.SaveShowRuleClick=function(){for(var c=[],d=[],e=0;e<a.QuestionSummaries.ShowNodeList.length;e++)a.QuestionSummaries.ShowNodeList[e].IsSelect&&(c.push(a.QuestionSummaries.ShowNodeList[e].NodeID),d.push(a.QuestionSummaries.ShowNodeList[e].NodeName));0==c.length?alert(Prompt.AnalyticResult_SelectOneQuestion,"red"):(a.QuestionSummaries.ShowSetName=Prompt.AnalyticResult_ShowSet,a.QuestionSummaries.IsShowAddButton=!0,loadingStart(),b.post("/QM/SavePMDataList",{id:a.QuestionSummaries.EditShowID,quesID:k.QuesInfoData.qid,dataviewID:a.QuestionSummaries.SelectViewID,nodelist:c,nodenamelist:d}).success(function(b){b.IsTrue?(a.QuestionSummaries.InitDataListList=b.DataListList,a.ChangeShowRule(),a.SetShowQues(),a.QuestionSummaries.AddShowRule=!1,isTouchDevice()):alert(b.Message,"red");loadingEnd()}).error(function(a,b,c,d){loadingEnd();RestLogin(a)}))};a.CloseShowRuleClick=function(){a.QuestionSummaries.AddShowRule=!1;a.QuestionSummaries.IsShowAddButton=!0;a.QuestionSummaries.ShowSetName=Prompt.AnalyticResult_ShowSet};a.SelectShowNode=function(b){b.IsSelect?(b.IsSelect=!1,b.CheckClass="checkbox-none",a.QuestionSummaries.ShowNodeAllSelect=!1):(b.IsSelect=!0,b.CheckClass="checkbox-check");a.QuestionSummaries.ShowNodeReverseSelect=!1};a.SelectAllNode=function(){a.QuestionSummaries.ShowNodeAllSelect=a.QuestionSummaries.ShowNodeAllSelect?!1:!0;for(var b=0;b<a.QuestionSummaries.ShowNodeList.length;b++)a.QuestionSummaries.ShowNodeList[b].IsSelect=a.QuestionSummaries.ShowNodeAllSelect,a.QuestionSummaries.ShowNodeList[b].CheckClass=a.QuestionSummaries.ShowNodeAllSelect?"checkbox-check":"checkbox-none"};a.ReverseSelectNode=function(){for(var b=a.QuestionSummaries.ShowNodeReverseSelect,c=0;c<a.QuestionSummaries.ShowNodeList.length;c++)a.SelectShowNode(a.QuestionSummaries.ShowNodeList[c]);a.QuestionSummaries.ShowNodeReverseSelect=b?!1:!0};a.SelectDataListInfo=function(c){for(var d=0;d<a.QuestionSummaries.DataListList.length;d++)a.QuestionSummaries.DataListList[d].ID==c.ID?(a.QuestionSummaries.DataListList[d].IsSelect=!0,a.QuestionSummaries.DataListList[d].RadioCss="radio-check",b.post("/QM/ChangePMDataListSelectStatue",{id:a.QuestionSummaries.DataListList[d].ID,quesID:k.QuesInfoData.qid,dataviewID:a.QuestionSummaries.DataListList[d].DataViewID}).success(function(a){}).error(function(a,b,c,d){loadingEnd();RestLogin(a)})):(a.QuestionSummaries.DataListList[d].IsSelect=!1,a.QuestionSummaries.DataListList[d].RadioCss="radio-none");for(d=0;d<a.QuestionSummaries.InitDataListList.length;d++)a.QuestionSummaries.InitDataListList[d].DataViewID==c.DataViewID&&(a.QuestionSummaries.InitDataListList[d].ID==c.ID?(a.QuestionSummaries.InitDataListList[d].IsSelect=!0,a.QuestionSummaries.InitDataListList[d].RadioCss="radio-check"):(a.QuestionSummaries.InitDataListList[d].IsSelect=!1,a.QuestionSummaries.InitDataListList[d].RadioCss="radio-none"));a.SetShowQues()};a.DeleteDataListInfo=function(c){confirm(Prompt.AnalyticResult_IsDeleteCurrentCondition,function(){loadingStart();b.post("/QM/DeletePMDataList",{id:c.ID,quesID:k.QuesInfoData.qid,dataviewID:c.DataViewID}).success(function(b){b.IsTrue?(a.QuestionSummaries.InitDataListList=b.DataListList,a.ChangeShowRule(),a.SetShowQues(),alert("\u5220\u9664\u6210\u529f","green"),a.QuestionSummaries.AddShowRule=!1):alert(b.Message,"red");loadingEnd()}).error(function(a,b,c,e){loadingEnd();RestLogin(a)});a.$digest()})};a.EditShowRuleName=function(b){$("body").addClass("srcollHide");a.QuestionSummaries.EditShowID=b.ID;a.QuestionSummaries.Popupbackground=1;a.QuestionSummaries.SelectShowChangeName=b.Name};a.EditShowChangeName=function(c){c&&b.post("/QM/ChangeShowRuleName",{id:a.QuestionSummaries.EditShowID,name:a.QuestionSummaries.SelectShowChangeName}).success(function(b){if(b.IsTrue){a.CloseDiv();alert(Prompt.AnalyticResult_SuccessfulOperation,"green");for(b=0;b<a.QuestionSummaries.InitDataListList.length;b++)a.QuestionSummaries.InitDataListList[b].ID==a.QuestionSummaries.EditShowID&&(a.QuestionSummaries.InitDataListList[b].Name=a.QuestionSummaries.SelectShowChangeName);for(b=0;b<a.QuestionSummaries.DataListList.length;b++)a.QuestionSummaries.DataListList[b].ID==a.QuestionSummaries.EditShowID&&(a.QuestionSummaries.DataListList[b].Name=a.QuestionSummaries.SelectShowChangeName)}}).error(function(a,b,c,e){loadingEnd();RestLogin(a)})};a.AddSelectRuleClick=function(){a.QuestionSummaries.AddSelectRule=!0;a.QuestionSummaries.FilterType=0};a.BindData=function(){loadingStart();b.get("/QM/GetQuestionSummariesView",{params:{quesID:k.QuesInfoData.qid,dataViewID:a.QuestionSummaries.SelectViewID}}).success(function(b,c,e,g){b.IsTrue?(a.QuestionSummaries.SummariesList=b.NodeList,h(function(){a.BindImage()},1E3)):alert(b.Message,"red");loadingEnd()}).error(function(a,b,c,e){loadingEnd()})};a.BindImage=function(){require.config({paths:{echarts:"/Script/Echarts"}});require(["echarts","echarts/chart/bar"],function(b){a.QuestionSummaries.ChartList=[];for(var c=0;c<a.QuestionSummaries.SummariesList.length;c++){var e=b.init(document.getElementById("div_"+a.QuestionSummaries.SummariesList[c].NodeID)),g=null;10<a.QuestionSummaries.SummariesList[c].OptionNameList.length&&(g=new dataZoom,g.end=1E3/a.QuestionSummaries.SummariesList[c].OptionNameList.length,g.height=20);option={tooltip:{trigger:"axis"},legend:{selectedMode:!1,data:[a.QuestionSummaries.SummariesList[c].EchartName]},toolbox:{show:!0,feature:{saveAsImage:{show:!0}}},dataZoom:g,calculable:!1,grid:{x:40,x2:0},xAxis:[{type:"category",data:a.QuestionSummaries.SummariesList[c].OptionNameList,axisLabel:{textStyle:{fontSize:10},interval:0,rotate:30,formatter:function(a){a.split("");var b=8;8>a.length&&(b=a.length);for(var c="",d=0;d<b;d++)c+=a[d],4==d%5&&(c+="\n");8<a.length&&(c+="...");return c}}}],yAxis:[{type:"value"}],series:[{name:a.QuestionSummaries.SummariesList[c].EchartName,type:"bar",barMaxWidth:"50",data:a.QuestionSummaries.SummariesList[c].OptionNumList,itemStyle:{normal:{color:"#97E6B8"}}}]};e.setOption(option);a.QuestionSummaries.ChartList.push(e);a.ChangeTableWidth();a.SetShowQues()}h(function(){window.onresize=function(){for(var b=0;b<a.QuestionSummaries.SummariesList.length;b++)a.QuestionSummaries.SummariesList[b].NodeShow&&a.QuestionSummaries.ChartList[b].resize()}},200);loadingEnd()})};a.SetShowQues=function(){for(var b="",c="",e=0;e<a.QuestionSummaries.DataListList.length;e++)a.QuestionSummaries.DataListList[e].IsSelect&&(b=a.QuestionSummaries.DataListList[e].ListCondition,c=a.QuestionSummaries.DataListList[e].ID);for(e=0;e<a.QuestionSummaries.SummariesList.length;e++)""==c?a.QuestionSummaries.SummariesList[e].NodeShow=!0:-1<b.indexOf(a.QuestionSummaries.SummariesList[e].NodeID)?a.QuestionSummaries.SummariesList[e].NodeShow=!0:a.QuestionSummaries.SummariesList[e].NodeShow=!1};a.ChangeTableWidth=function(){var b;if(document.all||document.getElementById)b=document.getElementsByTagName("div");for(var c=0;c<b.length;c++)if(0==b[c].id.indexOf("div_"))for(var e=0;e<a.QuestionSummaries.SummariesList.length;e++)b[c].id=="div_"+a.QuestionSummaries.SummariesList[e].NodeID&&a.QuestionSummaries.SummariesList[e].NodeShow&&$("#"+b[c].id.replace("div","table")).css("width",$("#"+b[c].id).width()+24+"px")};$(window).resize(function(){h(function(){a.ChangeTableWidth()},500)});a.ShowPopup=function(a){a.stopPropagation()};a.CloseDiv=function(){$("body").removeClass("srcollHide");a.QuestionSummaries.Popupbackground=0}}]);function Usercenter(){this.UserSetAction=""}zyApp.controller("UsercenterCtrl",["$scope","$http","$location","UserInfo",function(a,e,b,c){a.Usercenter=Usercenter;a.UUserInfo=UUserInfo;a.Password=Password;var k=window.location.href;0<=k.indexOf("/UC/User_info")&&(a.Usercenter.UserSetAction="User_info");0<=k.indexOf("/UC/Password")&&(a.Usercenter.UserSetAction="Password");a.UserSetTabCss=function(b){UserSetTabCssActive(a,b)};a.judgeUserSet=function(h,k){c.InfoData.EditSateFlag?confirm(Prompt.SaveTheCurrentChanges,function(){""!=h&&SaveUserInfo(a,e,b,c,h,"")},function(){c.InfoData.EditSateFlag=!1;a.UUserInfo.UserInfoSubmitFlag=!1;""!=h&&(a.UserSetTabCss(h),b.path("/UC/"+h),a.$parent.$digest())},"\u662f","","\u5426"):c.InfoData.EditPwdState?confirm(Prompt.SaveTheCurrentChanges,function(){""!=h&&SavePwdInfo(a,e,b,c,h,"")},function(){c.InfoData.EditPwdState=!1;a.Password.pwdSubmitFlag=!1;""!=h&&(a.UserSetTabCss(h),b.path("/UC/"+h),a.$parent.$digest())},"\u662f","","\u5426"):""!=h&&(a.UserSetTabCss(h),b.path("/UC/"+h))};a.UserSetTab=function(b){a.judgeUserSet(b,"")}}]);function UUserInfo(){this.UserInfoSubmitFlag=!1;this.CompanyID=this.Portrait=this.FileName=this.PublishSum=this.CreateSum=this.CreateDate=this.accountEmail=this.accountName=""}zyApp.controller("User_infoCtrl",["$scope","$http","UserInfo","$location","UserPageText","UserImageURL",function(a,e,b,c,k,h){a.IsDemo=$("#hiddendemotype").val();var l;$(function(){l=$("#RadioProgressBar").radialIndicator({initValue:0,displayNumber:!1}).data("radialIndicator")});a.UserImageURL=h;-1==c.path().indexOf("/QM")&&$("#Selectques").removeClass("nav-current");a.UserPageText=k;a.UserPageText.InitPageText();a.UUserInfo=UUserInfo;a.InitUserData=function(b){0!=b&&loadingStart();e.post("/UM/GetUserInfo",{}).success(function(c){console.log(c);""!=c.UserEmail&&(a.UUserInfo.CompanyID=c.CompanyID,a.UUserInfo.accountName=c.Name,a.UUserInfo.accountEmail=c.UserEmail,a.UUserInfo.CreateDate=c.CreateDate,a.UUserInfo.CreateSum=c.CreateSum,a.UUserInfo.PublishSum=c.PublishSum,a.UUserInfo.Portrait=c.Portrait,a.UserImageURL.ImgUrl=c.Portrait,$("#uploadDiv").InitUpload({parentfolder:"\\UploadFiles\\Photo",CompanyID:a.UUserInfo.CompanyID,QuesID:"",UType:"2",iscrop:!0,LoadingName:"progressbar",Scope:a,Http:e,extFilters:[".jpg",".png",".jpeg",".bmp"],onQueueComplete:function(b){l.value(0);loadingStart();e.post("/UC/ModifyComPortrait",{filename:a.UUserInfo.FileName}).success(function(b){b.IsSuccess&&($("#accountImg").css("background-image","url("+a.UUserInfo.Portrait+")"),a.UserImageURL.ImgUrl=a.UUserInfo.Portrait,alert(Prompt.SaveOK,"green"));loadingEnd()}).error(function(a,b,c,e){loadingEnd();RestLogin(a)})}}));0!=b&&loadingEnd()}).error(function(a,b,c,e){loadingEnd();RestLogin(a)})};a.InitUserData();a.emailCheck=function(c,e,f){var d=/^(\w-*\.*)+@(\w-?)+(\.\w{2,})+$/;c&&e&&d.test(f)?(a.UUserInfo.UserInfoSubmitFlag=!0,a.emailCheckFlag=!1,b.InfoData.EditSateFlag=!0,b.SaveUserInfoArgs.accountName=a.UUserInfo.accountName,b.SaveUserInfoArgs.accountEmail=a.UUserInfo.accountEmail):(a.UUserInfo.UserInfoSubmitFlag=!1,a.emailCheckFlag=!0)};a.userInfoEditChange=function(c,e){c&&e?(a.UUserInfo.UserInfoSubmitFlag=!0,b.InfoData.EditSateFlag=!0,b.SaveUserInfoArgs.accountName=a.UUserInfo.accountName,b.SaveUserInfoArgs.accountEmail=a.UUserInfo.accountEmail):a.UUserInfo.UserInfoSubmitFlag=!1};a.enter=function(){13==window.event.keyCode&&this.SubmitUserInfo()};a.SubmitUserInfo=function(){a.UUserInfo.UserInfoSubmitFlag&&(loadingStart(),e.post("/UM/ModifyUserInfo",{name:a.UUserInfo.accountName,email:a.UUserInfo.accountEmail}).success(function(c){""==c?(alert(Prompt.SaveOK,"green"),a.UUserInfo.UserInfoSubmitFlag=!1,b.InfoData.EditSateFlag=!1,a.LoadingIsEnd=0,a.InitUserData(a.LoadingIsEnd)):(alert(c,"red"),a.UUserInfo.UserInfoSubmitFlag=!0,b.InfoData.EditSateFlag=!0);loadingEnd()}).error(function(a,b,c,d){loadingEnd();RestLogin(a)}))}}]);function Password(){this.pwdSubmitFlag=!1;this.verificationpassword=this.NewPwd=this.CurrentPwd="";this.SomeFlag=!1}zyApp.controller("PasswordCtrl",["$scope","$http","UserInfo","UserPageText",function(a,e,b,c){a.IsDemo=$("#hiddendemotype").val();a.UserPageText=c;a.Password=Password;a.Password.SomeFlag=!1;a.Password.CurrentPwd="";a.Password.NewPwd="";a.Password.verificationpassword="";a.UserPageText=c;a.UserPageText.InitPageText();a.pwdSubmitChange=function(c,e){c&&e?(a.Password.pwdSubmitFlag=!0,b.SavePwdArgs.CurrentPwd=a.Password.CurrentPwd,b.InfoData.EditPwdState=!0):a.Password.pwdSubmitFlag=!1};a.ValidPwdConsistency=function(c,e){c&&e?a.Password.NewPwd!=a.Password.verificationpassword?(a.Password.SomeFlag=""==a.Password.NewPwd||""==a.Password.verificationpassword?!1:!0,a.Password.pwdSubmitFlag=!1):(a.Password.SomeFlag=!1,a.Password.pwdSubmitFlag=!0,b.SavePwdArgs.NewPwd=a.Password.NewPwd,b.SavePwdArgs.CurrentPwd=a.Password.CurrentPwd,b.InfoData.EditPwdState=!0):a.Password.pwdSubmitFlag=!1};a.enter=function(){13==window.event.keyCode&&this.pwsSetSubmit()};a.pwsSetSubmit=function(){a.Password.pwdSubmitFlag&&(loadingStart(),e.post("/UM/PasswordSet",{oldPassword:a.Password.CurrentPwd,newpassword:a.Password.NewPwd}).success(function(c){""==c?(alert(Prompt.SaveOK,"green"),a.Password.pwdSubmitFlag=!1,b.InfoData.EditPwdState=!1,a.Password.CurrentPwd="",a.Password.NewPwd="",a.Password.verificationpassword="",a.PWDCurrentForm.$setPristine(),a.PWDNewForm.$setPristine(),a.PWDAgainForm.$setPristine()):(alert(c,"red"),b.InfoData.EditPwdState=!0);loadingEnd()}).error(function(a,b,c,e){loadingEnd();RestLogin(a)}))}}]);function UserSetTabCssActive(a,e){a.Usercenter=Usercenter;"User_info"==e?a.Usercenter.UserSetAction="User_info":"SchemeSet"==e?a.Usercenter.UserSetAction="SchemeSet":"BillInfo"==e?a.Usercenter.UserSetAction="BillInfo":"EmailSet"==e?a.Usercenter.UserSetAction="EmailSet":"Password"==e&&(a.Usercenter.UserSetAction="Password")}function SaveUserInfo(a,e,b,c,k,h){loadingStart();e.post("/UM/ModifyUserInfo",{name:c.SaveUserInfoArgs.accountName,email:c.SaveUserInfoArgs.accountEmail}).success(function(e){""==e?(c.InfoData.EditSateFlag=!1,""!=k&&(b.path("/UC/"+k),UserSetTabCssActive(a,k))):alert(e,"red");loadingEnd()}).error(function(a,b,c,e){loadingEnd();RestLogin(a)})}function SavePwdInfo(a,e,b,c,k,h){loadingStart();e.post("/UM/PasswordSet",{oldPassword:c.SavePwdArgs.CurrentPwd,newpassword:c.SavePwdArgs.NewPwd}).success(function(e){""==e?(c.InfoData.EditPwdState=!1,""!=k&&(b.path("/UC/"+k),UserSetTabCssActive(a,k))):alert(e,"red");loadingEnd()}).error(function(a,b,c,e){loadingEnd();RestLogin(a)})};